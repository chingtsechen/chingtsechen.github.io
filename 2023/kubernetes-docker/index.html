<!doctype html><html lang=en-us dir=ltr><head><script async src="https://www.googletagmanager.com/gtag/js?id=G-QB4H991E1G"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-QB4H991E1G")</script><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content='使用Docker的方式，單獨於一台主機內建置Rancher管理平台，已達到管理平台只是納管集群功能，不影響與消耗kubernetes集群效能，缺點是，如果主機異常，Rancher管理平台也就會異常無法使用。'><meta name=keywords content="使用Docker安裝Rancher管理平台，納管現有k8s集群(單節點-非高可用),翻轉吧金魚腦"><title>使用Docker安裝Rancher管理平台，納管現有k8s集群(單節點-非高可用)</title>
<link rel=canonical href=https://blog.goldfishbrain-fighting.com/2023/kubernetes-docker/><link rel=stylesheet href=/scss/style.min.7fb7f5621081d8ecec310edc2d95cc0b431358ce9c30c3ee8601b16732dbef57.css><script async src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script><meta name=referrer content="no-referrer-when-downgrade"><script src=//cdn.bootcss.com/jquery/3.2.1/jquery.min.js></script><script>$(document).ready(function(){var e=setInterval(s,100),t=100,n=50;function s(){$("#busuanzi_container_site_pv").css("display")!="none"&&(clearInterval(e),$("#busuanzi_value_site_pv").html(parseInt($("#busuanzi_value_site_pv").html())+t),$("#busuanzi_value_site_uv").html(parseInt($("#busuanzi_value_site_uv").html())+n))}})</script><meta property='og:title' content='使用Docker安裝Rancher管理平台，納管現有k8s集群(單節點-非高可用)'><meta property='og:description' content='使用Docker的方式，單獨於一台主機內建置Rancher管理平台，已達到管理平台只是納管集群功能，不影響與消耗kubernetes集群效能，缺點是，如果主機異常，Rancher管理平台也就會異常無法使用。'><meta property='og:url' content='https://blog.goldfishbrain-fighting.com/2023/kubernetes-docker/'><meta property='og:site_name' content='翻轉吧金魚腦'><meta property='og:type' content='article'><meta property='article:section' content='Post'><meta property='article:tag' content='kubernetes'><meta property='article:tag' content='docker'><meta property='article:tag' content='rancher'><meta property='article:published_time' content='2023-10-07T02:00:00+08:00'><meta property='article:modified_time' content='2023-10-07T02:00:00+08:00'><meta name=twitter:title content="使用Docker安裝Rancher管理平台，納管現有k8s集群(單節點-非高可用)"><meta name=twitter:description content="使用Docker的方式，單獨於一台主機內建置Rancher管理平台，已達到管理平台只是納管集群功能，不影響與消耗kubernetes集群效能，缺點是，如果主機異常，Rancher管理平台也就會異常無法使用。"><link rel="shortcut icon" href=/favicon.png><script async src="https://www.googletagmanager.com/gtag/js?id=G-QB4H991E1G"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-QB4H991E1G")</script><meta name=google-site-verification content="EkUcMLTrO3RDZzjREX9Dffy2lcjWCR-2Qtu8VF4b8sQ"><meta content="使用Docker安裝Rancher管理平台，納管現有k8s集群(單節點-非高可用),翻轉吧金魚腦" name=keywords></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><div id=article-toolbar style=position:sticky;top:5px;z-index:1000><a href=/ class=back-home><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-chevron-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="15 6 9 12 15 18"/></svg>
<span>返回</span></a></div><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">目錄</h2><div class=widget--toc><nav id=TableOfContents><ul><li><ul><li><a href=#一rancher-server安裝>一、Rancher Server安裝</a><ul><li><a href=#一使用docker起容器>一、使用docker起容器</a></li><li><a href=#二查看初始密碼>二、查看初始密碼</a></li><li><a href=#三登入>三、登入</a></li><li><a href=#四重新設定admin密碼>四、重新設定admin密碼</a></li></ul></li><li><a href=#二匯入現有集群>二、匯入現有集群</a><ul><li><a href=#一點選import-existing>一、點選Import Existing</a></li><li><a href=#二點選import-any-kubernetes-clustergeneric>二、點選Import any Kubernetes cluster(Generic)</a></li><li><a href=#三填寫cluster-name自己決定以利後續辨識點選create>三、填寫Cluster Name(自己決定，以利後續辨識)，點選Create</a></li><li><a href=#四創建之後會有提供加入的方式選擇第二項>四、創建之後，會有提供加入的方式，選擇第二項</a></li><li><a href=#五確認現有集群已加入納管>五、確認現有集群已加入納管</a></li><li><a href=#六開啟kubectl-shell介面rancher會臨時起一個容器來跑shell指令關閉shell介面容器就會刪除>六、開啟Kubectl Shell介面，Rancher會臨時起一個容器來跑Shell指令，關閉Shell介面，容器就會刪除</a></li></ul></li><li><a href=#三加入windows-server-active-directory-ldap>三、加入Windows Server Active Directory (LDAP)</a><ul><li><a href=#一查看可以整合登入驗證的方式>一、查看可以整合登入驗證的方式</a></li><li><a href=#二創建ad使用者供rancher獲取ldap使用者資料>二、創建AD使用者，供Rancher獲取ldap使用者資料</a></li><li><a href=#三使用ldapsearch測試一下是否可以查找到剛剛建立的使用者資訊>三、使用ldapsearch測試一下，是否可以查找到剛剛建立的使用者資訊</a></li><li><a href=#四整合ad驗證>四、整合AD驗證</a></li><li><a href=#五再到ad創建一個使用者驗證一下是否rancher可以獲取到此使用者帳號>五、再到AD創建一個使用者，驗證一下，是否Rancher可以獲取到此使用者帳號</a></li><li><a href=#六也可以下載連線設定檔到自己常用linux主機連線管理>六、也可以下載連線設定檔到自己常用linux主機，連線管理</a></li></ul></li></ul></li></ul></nav></div></section></aside><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><header class=article-category><a href=/categories/kubernetes/ style=background-color:#0000e3;color:#fff>kubernetes</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/2023/kubernetes-docker/>使用Docker安裝Rancher管理平台，納管現有k8s集群(單節點-非高可用)</a></h2><h3 class=article-subtitle>使用Docker的方式，單獨於一台主機內建置Rancher管理平台，已達到管理平台只是納管集群功能，不影響與消耗kubernetes集群效能，缺點是，如果主機異常，Rancher管理平台也就會異常無法使用。</h3></div><footer class=article-time><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>2023/10/07</time></div><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>閱讀時間: 3 分鐘</time></div></footer></div></header><section class=article-content><section class="toc toc--inline"><h2>目錄</h2><div><nav id=TableOfContents><ul><li><ul><li><a href=#一rancher-server安裝>一、Rancher Server安裝</a><ul><li><a href=#一使用docker起容器>一、使用docker起容器</a></li><li><a href=#二查看初始密碼>二、查看初始密碼</a></li><li><a href=#三登入>三、登入</a></li><li><a href=#四重新設定admin密碼>四、重新設定admin密碼</a></li></ul></li><li><a href=#二匯入現有集群>二、匯入現有集群</a><ul><li><a href=#一點選import-existing>一、點選Import Existing</a></li><li><a href=#二點選import-any-kubernetes-clustergeneric>二、點選Import any Kubernetes cluster(Generic)</a></li><li><a href=#三填寫cluster-name自己決定以利後續辨識點選create>三、填寫Cluster Name(自己決定，以利後續辨識)，點選Create</a></li><li><a href=#四創建之後會有提供加入的方式選擇第二項>四、創建之後，會有提供加入的方式，選擇第二項</a></li><li><a href=#五確認現有集群已加入納管>五、確認現有集群已加入納管</a></li><li><a href=#六開啟kubectl-shell介面rancher會臨時起一個容器來跑shell指令關閉shell介面容器就會刪除>六、開啟Kubectl Shell介面，Rancher會臨時起一個容器來跑Shell指令，關閉Shell介面，容器就會刪除</a></li></ul></li><li><a href=#三加入windows-server-active-directory-ldap>三、加入Windows Server Active Directory (LDAP)</a><ul><li><a href=#一查看可以整合登入驗證的方式>一、查看可以整合登入驗證的方式</a></li><li><a href=#二創建ad使用者供rancher獲取ldap使用者資料>二、創建AD使用者，供Rancher獲取ldap使用者資料</a></li><li><a href=#三使用ldapsearch測試一下是否可以查找到剛剛建立的使用者資訊>三、使用ldapsearch測試一下，是否可以查找到剛剛建立的使用者資訊</a></li><li><a href=#四整合ad驗證>四、整合AD驗證</a></li><li><a href=#五再到ad創建一個使用者驗證一下是否rancher可以獲取到此使用者帳號>五、再到AD創建一個使用者，驗證一下，是否Rancher可以獲取到此使用者帳號</a></li><li><a href=#六也可以下載連線設定檔到自己常用linux主機連線管理>六、也可以下載連線設定檔到自己常用linux主機，連線管理</a></li></ul></li></ul></li></ul></nav></div></section><p><img src=/2023/kubernetes-docker/media/Pasted-image-20230920224620.png width=1185 height=787 srcset="/2023/kubernetes-docker/media/Pasted-image-20230920224620_hu5a39cd61ec6101b6320b865185a3e4e0_367454_480x0_resize_box_3.png 480w, /2023/kubernetes-docker/media/Pasted-image-20230920224620_hu5a39cd61ec6101b6320b865185a3e4e0_367454_1024x0_resize_box_3.png 1024w" loading=lazy alt=media/Pasted-image-20230920224620.png class=gallery-image data-flex-grow=150 data-flex-basis=361px></p><p>Rancher官網安裝網址：
<a class=link href=https://ranchermanager.docs.rancher.com/zh/pages-for-subheaders/rancher-on-a-single-node-with-docker target=_blank rel=noopener>https://ranchermanager.docs.rancher.com/zh/pages-for-subheaders/rancher-on-a-single-node-with-docker</a></p><p>最新版Rancher(v2.7.6)能夠納管的kubernetes版本為1.26.4：
<a class=link href=https://www.suse.com/suse-rancher/support-matrix/all-supported-versions/rancher-v2-7-6/ target=_blank rel=noopener>https://www.suse.com/suse-rancher/support-matrix/all-supported-versions/rancher-v2-7-6/</a>
<img src=/2023/kubernetes-docker/media/Pasted-image-20230920175154.png width=767 height=576 srcset="/2023/kubernetes-docker/media/Pasted-image-20230920175154_hu01fa84ee148454aed4aa51b480f9836a_40466_480x0_resize_box_3.png 480w, /2023/kubernetes-docker/media/Pasted-image-20230920175154_hu01fa84ee148454aed4aa51b480f9836a_40466_1024x0_resize_box_3.png 1024w" loading=lazy alt=media/Pasted-image-20230920175154.png class=gallery-image data-flex-grow=133 data-flex-basis=319px></p><h2 id=一rancher-server安裝>一、Rancher Server安裝</h2><h3 id=一使用docker起容器>一、使用docker起容器</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>root@k8s-node75u:~# sudo docker run --privileged -d --restart<span class=o>=</span>unless-stopped -p 80:80 -p 443:443 rancher/rancher
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>root@k8s-node75u:~# docker ps
</span></span><span class=line><span class=cl>CONTAINER ID   IMAGE                       COMMAND                  CREATED          STATUS              PORTS                                                                      NAMES
</span></span><span class=line><span class=cl>0e92a3ece9cd   rancher/rancher             <span class=s2>&#34;entrypoint.sh&#34;</span>          <span class=m>4</span> minutes ago    Up About a minute   0.0.0.0:80-&gt;80/tcp, :::80-&gt;80/tcp, 0.0.0.0:443-&gt;443/tcp, :::443-&gt;443/tcp   dreamy_rubin
</span></span></code></pre></div><h3 id=二查看初始密碼>二、查看初始密碼</h3><p><img src=/2023/kubernetes-docker/media/Pasted-image-20230920175456.png width=766 height=755 srcset="/2023/kubernetes-docker/media/Pasted-image-20230920175456_hua3986ebe76c28593123877564810c0e5_76029_480x0_resize_box_3.png 480w, /2023/kubernetes-docker/media/Pasted-image-20230920175456_hua3986ebe76c28593123877564810c0e5_76029_1024x0_resize_box_3.png 1024w" loading=lazy alt=media/Pasted-image-20230920175456.png class=gallery-image data-flex-grow=101 data-flex-basis=243px></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>root@k8s-node75u:~# docker logs  0e92a3ece9cd  2&gt;<span class=p>&amp;</span><span class=m>1</span> <span class=p>|</span> grep <span class=s2>&#34;Bootstrap Password:&#34;</span>
</span></span><span class=line><span class=cl>2023/09/20 09:50:01 <span class=o>[</span>INFO<span class=o>]</span> Bootstrap Password: 79j4khgd9952rmn55kdntxt7kwxfn7f7dvpmrsgx6nr7wqblrtpp6l
</span></span></code></pre></div><h3 id=三登入>三、登入</h3><p><img src=/2023/kubernetes-docker/media/Pasted-image-20230920175658.png width=783 height=768 srcset="/2023/kubernetes-docker/media/Pasted-image-20230920175658_hu3d2c40f5d0939a2b52203051317c438e_76967_480x0_resize_box_3.png 480w, /2023/kubernetes-docker/media/Pasted-image-20230920175658_hu3d2c40f5d0939a2b52203051317c438e_76967_1024x0_resize_box_3.png 1024w" loading=lazy alt=media/Pasted-image-20230920175658.png class=gallery-image data-flex-grow=101 data-flex-basis=244px></p><h3 id=四重新設定admin密碼>四、重新設定admin密碼</h3><p><img src=/2023/kubernetes-docker/media/Pasted-image-20230920175838.png width=801 height=890 srcset="/2023/kubernetes-docker/media/Pasted-image-20230920175838_hu52cba99bffb2683bebf9888bc6b13c40_85503_480x0_resize_box_3.png 480w, /2023/kubernetes-docker/media/Pasted-image-20230920175838_hu52cba99bffb2683bebf9888bc6b13c40_85503_1024x0_resize_box_3.png 1024w" loading=lazy alt=media/Pasted-image-20230920175838.png class=gallery-image data-flex-grow=90 data-flex-basis=216px>
登入成功頁面
<img src=/2023/kubernetes-docker/media/Pasted-image-20230920180029.png width=1571 height=723 srcset="/2023/kubernetes-docker/media/Pasted-image-20230920180029_hufcf2fa2ea45ee7c98df35c55f7b48945_101094_480x0_resize_box_3.png 480w, /2023/kubernetes-docker/media/Pasted-image-20230920180029_hufcf2fa2ea45ee7c98df35c55f7b48945_101094_1024x0_resize_box_3.png 1024w" loading=lazy alt=media/Pasted-image-20230920180029.png class=gallery-image data-flex-grow=217 data-flex-basis=521px></p><h2 id=二匯入現有集群>二、匯入現有集群</h2><h3 id=一點選import-existing>一、點選Import Existing</h3><p><img src=/2023/kubernetes-docker/media/Pasted-image-20230920180135.png width=1568 height=715 srcset="/2023/kubernetes-docker/media/Pasted-image-20230920180135_hu81920a18e2926839b7b0711657581ae5_100846_480x0_resize_box_3.png 480w, /2023/kubernetes-docker/media/Pasted-image-20230920180135_hu81920a18e2926839b7b0711657581ae5_100846_1024x0_resize_box_3.png 1024w" loading=lazy alt=media/Pasted-image-20230920180135.png class=gallery-image data-flex-grow=219 data-flex-basis=526px></p><h3 id=二點選import-any-kubernetes-clustergeneric>二、點選Import any Kubernetes cluster(Generic)</h3><p><img src=/2023/kubernetes-docker/media/Pasted-image-20230920180232.png width=1241 height=625 srcset="/2023/kubernetes-docker/media/Pasted-image-20230920180232_hu4d47c145f3344da3a90cc7cca9c878c3_69000_480x0_resize_box_3.png 480w, /2023/kubernetes-docker/media/Pasted-image-20230920180232_hu4d47c145f3344da3a90cc7cca9c878c3_69000_1024x0_resize_box_3.png 1024w" loading=lazy alt=media/Pasted-image-20230920180232.png class=gallery-image data-flex-grow=198 data-flex-basis=476px></p><h3 id=三填寫cluster-name自己決定以利後續辨識點選create>三、填寫Cluster Name(自己決定，以利後續辨識)，點選Create</h3><p><img src=/2023/kubernetes-docker/media/Pasted-image-20230920180509.png width=1563 height=943 srcset="/2023/kubernetes-docker/media/Pasted-image-20230920180509_hud6431c9eb3b2c5342e0bb099a0106bc5_103694_480x0_resize_box_3.png 480w, /2023/kubernetes-docker/media/Pasted-image-20230920180509_hud6431c9eb3b2c5342e0bb099a0106bc5_103694_1024x0_resize_box_3.png 1024w" loading=lazy alt=media/Pasted-image-20230920180509.png class=gallery-image data-flex-grow=165 data-flex-basis=397px></p><h3 id=四創建之後會有提供加入的方式選擇第二項>四、創建之後，會有提供加入的方式，選擇第二項</h3><p><img src=/2023/kubernetes-docker/media/Pasted-image-20230920180638.png width=1559 height=805 srcset="/2023/kubernetes-docker/media/Pasted-image-20230920180638_hu962b03cd08d4a0c5eedf892051dab8f4_177154_480x0_resize_box_3.png 480w, /2023/kubernetes-docker/media/Pasted-image-20230920180638_hu962b03cd08d4a0c5eedf892051dab8f4_177154_1024x0_resize_box_3.png 1024w" loading=lazy alt=media/Pasted-image-20230920180638.png class=gallery-image data-flex-grow=193 data-flex-basis=464px></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># master節點執行</span>
</span></span><span class=line><span class=cl>root@k8s-master71u:~# curl --insecure -sfL https://192.168.1.75/v3/import/ff4mlx8k768hsz8vmwl89lqhbmcsfbttkxqdtmk4m8pgqsrnd87pqc_c-m-gq2vbtfn.yaml <span class=p>|</span> kubectl apply -f -
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 查看pod是否都創建成功</span>
</span></span><span class=line><span class=cl>root@k8s-master71u:~# kubectl get pod -n cattle-system -o wide
</span></span><span class=line><span class=cl>NAME                                    READY   STATUS    RESTARTS   AGE   IP               NODE          NOMINATED NODE   READINESS GATES
</span></span><span class=line><span class=cl>cattle-cluster-agent-6c97c478bb-mjgwg   1/1     Running   <span class=m>0</span>          5m    10.244.14.137    k8s-node75u   &lt;none&gt;           &lt;none&gt;
</span></span><span class=line><span class=cl>cattle-cluster-agent-6c97c478bb-vdn59   1/1     Running   <span class=m>0</span>          16m   10.244.255.199   k8s-node76u   &lt;none&gt;           &lt;none&gt;
</span></span><span class=line><span class=cl>rancher-webhook-74c9bd4d6-znrdp         1/1     Running   <span class=m>0</span>          61s   10.244.255.201   k8s-node76u   &lt;none&gt;           &lt;none&gt;
</span></span></code></pre></div><h3 id=五確認現有集群已加入納管>五、確認現有集群已加入納管</h3><p>加入rancher需要一點時間，請耐心等候，如果鏡像拉取失敗，可以手動去下載鏡像</p><p><img src=/2023/kubernetes-docker/media/Pasted-image-20230920183031.png width=1573 height=720 srcset="/2023/kubernetes-docker/media/Pasted-image-20230920183031_hu9e59a4907e63c34faa594edfc314c151_111515_480x0_resize_box_3.png 480w, /2023/kubernetes-docker/media/Pasted-image-20230920183031_hu9e59a4907e63c34faa594edfc314c151_111515_1024x0_resize_box_3.png 1024w" loading=lazy alt=media/Pasted-image-20230920183031.png class=gallery-image data-flex-grow=218 data-flex-basis=524px></p><p><img src=/2023/kubernetes-docker/media/Pasted-image-20230920182502.png width=1563 height=936 srcset="/2023/kubernetes-docker/media/Pasted-image-20230920182502_hu0d54cd16036aa81d0943b0f05cc93b8a_152101_480x0_resize_box_3.png 480w, /2023/kubernetes-docker/media/Pasted-image-20230920182502_hu0d54cd16036aa81d0943b0f05cc93b8a_152101_1024x0_resize_box_3.png 1024w" loading=lazy alt=media/Pasted-image-20230920182502.png class=gallery-image data-flex-grow=166 data-flex-basis=400px></p><h3 id=六開啟kubectl-shell介面rancher會臨時起一個容器來跑shell指令關閉shell介面容器就會刪除>六、開啟Kubectl Shell介面，Rancher會臨時起一個容器來跑Shell指令，關閉Shell介面，容器就會刪除</h3><p><img src=/2023/kubernetes-docker/media/Pasted-image-20230920182636.png width=1568 height=949 srcset="/2023/kubernetes-docker/media/Pasted-image-20230920182636_hu7038623ebb20f600634e4c858d61cdf9_227476_480x0_resize_box_3.png 480w, /2023/kubernetes-docker/media/Pasted-image-20230920182636_hu7038623ebb20f600634e4c858d61cdf9_227476_1024x0_resize_box_3.png 1024w" loading=lazy alt=media/Pasted-image-20230920182636.png class=gallery-image data-flex-grow=165 data-flex-basis=396px></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>root@k8s-master71u:~# kubectl get pod -n cattle-system -o wide
</span></span><span class=line><span class=cl>NAME                                    READY   STATUS    RESTARTS   AGE     IP               NODE          NOMINATED NODE   READINESS GATES
</span></span><span class=line><span class=cl>cattle-cluster-agent-6c97c478bb-mjgwg   1/1     Running   <span class=m>0</span>          6m11s   10.244.14.137    k8s-node75u   &lt;none&gt;           &lt;none&gt;
</span></span><span class=line><span class=cl>cattle-cluster-agent-6c97c478bb-vdn59   1/1     Running   <span class=m>0</span>          17m     10.244.255.199   k8s-node76u   &lt;none&gt;           &lt;none&gt;
</span></span><span class=line><span class=cl>dashboard-shell-75g77                   2/2     Running   <span class=m>0</span>          9s      10.244.255.202   k8s-node76u   &lt;none&gt;           &lt;none&gt;
</span></span><span class=line><span class=cl>rancher-webhook-74c9bd4d6-znrdp         1/1     Running   <span class=m>0</span>          2m12s   10.244.255.201   k8s-node76u   &lt;none&gt;           &lt;none&gt;
</span></span></code></pre></div><h2 id=三加入windows-server-active-directory-ldap>三、加入Windows Server Active Directory (LDAP)</h2><p>Rancher官網設定網址： <a class=link href=https://ranchermanager.docs.rancher.com/zh/how-to-guides/new-user-guides/authentication-permissions-and-global-configuration/authentication-config/configure-active-directory target=_blank rel=noopener>https://ranchermanager.docs.rancher.com/zh/how-to-guides/new-user-guides/authentication-permissions-and-global-configuration/authentication-config/configure-active-directory</a></p><h3 id=一查看可以整合登入驗證的方式>一、查看可以整合登入驗證的方式</h3><p><img src=/2023/kubernetes-docker/media/Pasted-image-20230920183804.png width=277 height=578 srcset="/2023/kubernetes-docker/media/Pasted-image-20230920183804_hubff23e8276d6d1ee799bc3e36745626f_37911_480x0_resize_box_3.png 480w, /2023/kubernetes-docker/media/Pasted-image-20230920183804_hubff23e8276d6d1ee799bc3e36745626f_37911_1024x0_resize_box_3.png 1024w" loading=lazy alt=media/Pasted-image-20230920183804.png class=gallery-image data-flex-grow=47 data-flex-basis=115px></p><p><img src=/2023/kubernetes-docker/media/Pasted-image-20230920183831.png width=1553 height=713 srcset="/2023/kubernetes-docker/media/Pasted-image-20230920183831_hu316de54a60d50e6d08a5ea8995e319c3_103739_480x0_resize_box_3.png 480w, /2023/kubernetes-docker/media/Pasted-image-20230920183831_hu316de54a60d50e6d08a5ea8995e319c3_103739_1024x0_resize_box_3.png 1024w" loading=lazy alt=media/Pasted-image-20230920183831.png class=gallery-image data-flex-grow=217 data-flex-basis=522px></p><h3 id=二創建ad使用者供rancher獲取ldap使用者資料>二、創建AD使用者，供Rancher獲取ldap使用者資料</h3><p><img src=/2023/kubernetes-docker/media/Pasted-image-20230920195052.png width=1022 height=672 srcset="/2023/kubernetes-docker/media/Pasted-image-20230920195052_hu4bf1f5dae4f9517e3a6de85d581b01ad_468873_480x0_resize_box_3.png 480w, /2023/kubernetes-docker/media/Pasted-image-20230920195052_hu4bf1f5dae4f9517e3a6de85d581b01ad_468873_1024x0_resize_box_3.png 1024w" loading=lazy alt=media/Pasted-image-20230920195052.png class=gallery-image data-flex-grow=152 data-flex-basis=365px></p><p><img src=/2023/kubernetes-docker/media/Pasted-image-20230920195204.png width=508 height=427 srcset="/2023/kubernetes-docker/media/Pasted-image-20230920195204_hu67582e5b58b9fa956d48e3e1b3025d88_55257_480x0_resize_box_3.png 480w, /2023/kubernetes-docker/media/Pasted-image-20230920195204_hu67582e5b58b9fa956d48e3e1b3025d88_55257_1024x0_resize_box_3.png 1024w" loading=lazy alt=media/Pasted-image-20230920195204.png class=gallery-image data-flex-grow=118 data-flex-basis=285px></p><p><img src=/2023/kubernetes-docker/media/Pasted-image-20230920195303.png width=512 height=430 srcset="/2023/kubernetes-docker/media/Pasted-image-20230920195303_hua519bb2883bb325622ef0a431cf08e34_56340_480x0_resize_box_3.png 480w, /2023/kubernetes-docker/media/Pasted-image-20230920195303_hua519bb2883bb325622ef0a431cf08e34_56340_1024x0_resize_box_3.png 1024w" loading=lazy alt=media/Pasted-image-20230920195303.png class=gallery-image data-flex-grow=119 data-flex-basis=285px></p><p><img src=/2023/kubernetes-docker/media/Pasted-image-20230920195336.png width=748 height=526 srcset="/2023/kubernetes-docker/media/Pasted-image-20230920195336_hu0984df2fb84430bf441ceeaf57952603_246853_480x0_resize_box_3.png 480w, /2023/kubernetes-docker/media/Pasted-image-20230920195336_hu0984df2fb84430bf441ceeaf57952603_246853_1024x0_resize_box_3.png 1024w" loading=lazy alt=media/Pasted-image-20230920195336.png class=gallery-image data-flex-grow=142 data-flex-basis=341px></p><h3 id=三使用ldapsearch測試一下是否可以查找到剛剛建立的使用者資訊>三、使用ldapsearch測試一下，是否可以查找到剛剛建立的使用者資訊</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>chenqingze@chenqingze-MBP ~ % ldapsearch -x -H <span class=s2>&#34;ldap://192.168.1.49:389&#34;</span> -D <span class=s2>&#34;jimmyhome\rancheruser&#34;</span> -w <span class=s2>&#34;密碼&#34;</span> <span class=se>\
</span></span></span><span class=line><span class=cl><span class=se></span> -b <span class=s2>&#34;dc=jimmyhome,dc=tw&#34;</span> -s sub <span class=s2>&#34;sAMAccountName=rancheruser&#34;</span>
</span></span><span class=line><span class=cl><span class=c1># extended LDIF</span>
</span></span><span class=line><span class=cl><span class=c1>#</span>
</span></span><span class=line><span class=cl><span class=c1># LDAPv3</span>
</span></span><span class=line><span class=cl><span class=c1># base &lt;dc=jimmyhome,dc=tw&gt; with scope subtree</span>
</span></span><span class=line><span class=cl><span class=c1># filter: sAMAccountName=rancheruser</span>
</span></span><span class=line><span class=cl><span class=c1># requesting: ALL</span>
</span></span><span class=line><span class=cl><span class=c1>#</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># rancheruser, Users, jimmyhome.tw</span>
</span></span><span class=line><span class=cl>dn: <span class=nv>CN</span><span class=o>=</span>rancheruser,CN<span class=o>=</span>Users,DC<span class=o>=</span>jimmyhome,DC<span class=o>=</span>tw
</span></span><span class=line><span class=cl>objectClass: top
</span></span><span class=line><span class=cl>objectClass: person
</span></span><span class=line><span class=cl>objectClass: organizationalPerson
</span></span><span class=line><span class=cl>objectClass: user
</span></span><span class=line><span class=cl>cn: rancheruser
</span></span><span class=line><span class=cl>givenName: rancheruser
</span></span><span class=line><span class=cl>distinguishedName: <span class=nv>CN</span><span class=o>=</span>rancheruser,CN<span class=o>=</span>Users,DC<span class=o>=</span>jimmyhome,DC<span class=o>=</span>tw
</span></span><span class=line><span class=cl>instanceType: <span class=m>4</span>
</span></span><span class=line><span class=cl>whenCreated: 20230920115311.0Z
</span></span><span class=line><span class=cl>whenChanged: 20230920120448.0Z
</span></span><span class=line><span class=cl>displayName: rancheruser
</span></span><span class=line><span class=cl>uSNCreated: <span class=m>16399</span>
</span></span><span class=line><span class=cl>uSNChanged: <span class=m>16452</span>
</span></span><span class=line><span class=cl>name: rancheruser
</span></span><span class=line><span class=cl>objectGUID:: <span class=nv>B9nTPDTyY0ehHZz4mWIJ1Q</span><span class=o>==</span>
</span></span><span class=line><span class=cl>userAccountControl: <span class=m>66048</span>
</span></span><span class=line><span class=cl>badPwdCount: <span class=m>0</span>
</span></span><span class=line><span class=cl>codePage: <span class=m>0</span>
</span></span><span class=line><span class=cl>countryCode: <span class=m>0</span>
</span></span><span class=line><span class=cl>badPasswordTime: <span class=m>0</span>
</span></span><span class=line><span class=cl>lastLogoff: <span class=m>0</span>
</span></span><span class=line><span class=cl>lastLogon: <span class=m>0</span>
</span></span><span class=line><span class=cl>pwdLastSet: <span class=m>133396843913520620</span>
</span></span><span class=line><span class=cl>primaryGroupID: <span class=m>513</span>
</span></span><span class=line><span class=cl>objectSid:: <span class=nv>AQUAAAAAAAUVAAAA2KPkIYA62ax0WlhyTwQAAA</span><span class=o>==</span>
</span></span><span class=line><span class=cl>accountExpires: <span class=m>9223372036854775807</span>
</span></span><span class=line><span class=cl>logonCount: <span class=m>0</span>
</span></span><span class=line><span class=cl>sAMAccountName: rancheruser
</span></span><span class=line><span class=cl>sAMAccountType: <span class=m>805306368</span>
</span></span><span class=line><span class=cl>userPrincipalName: rancheruser@jimmyhome.tw
</span></span><span class=line><span class=cl>objectCategory: <span class=nv>CN</span><span class=o>=</span>Person,CN<span class=o>=</span>Schema,CN<span class=o>=</span>Configuration,DC<span class=o>=</span>jimmyhome,DC<span class=o>=</span>tw
</span></span><span class=line><span class=cl>dSCorePropagationData: 16010101000000.0Z
</span></span><span class=line><span class=cl>lastLogonTimestamp: <span class=m>133396850882972826</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># search reference</span>
</span></span><span class=line><span class=cl>ref: ldap://ForestDnsZones.jimmyhome.tw/DC<span class=o>=</span>ForestDnsZones,DC<span class=o>=</span>jimmyhome,DC<span class=o>=</span>tw
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># search reference</span>
</span></span><span class=line><span class=cl>ref: ldap://DomainDnsZones.jimmyhome.tw/DC<span class=o>=</span>DomainDnsZones,DC<span class=o>=</span>jimmyhome,DC<span class=o>=</span>tw
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># search reference</span>
</span></span><span class=line><span class=cl>ref: ldap://jimmyhome.tw/CN<span class=o>=</span>Configuration,DC<span class=o>=</span>jimmyhome,DC<span class=o>=</span>tw
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># search result</span>
</span></span><span class=line><span class=cl>search: <span class=m>2</span>
</span></span><span class=line><span class=cl>result: <span class=m>0</span> Success
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># numResponses: 5</span>
</span></span><span class=line><span class=cl><span class=c1># numEntries: 1</span>
</span></span><span class=line><span class=cl><span class=c1># numReferences: 3</span>
</span></span></code></pre></div><h3 id=四整合ad驗證>四、整合AD驗證</h3><p><img src=/2023/kubernetes-docker/media/Pasted-image-20230920195828.png width=1565 height=752 srcset="/2023/kubernetes-docker/media/Pasted-image-20230920195828_hu32023433e28c58be869cfd4b00a53e0a_109608_480x0_resize_box_3.png 480w, /2023/kubernetes-docker/media/Pasted-image-20230920195828_hu32023433e28c58be869cfd4b00a53e0a_109608_1024x0_resize_box_3.png 1024w" loading=lazy alt=media/Pasted-image-20230920195828.png class=gallery-image data-flex-grow=208 data-flex-basis=499px></p><p><img src=/2023/kubernetes-docker/media/Pasted-image-20230920202516.png width=1562 height=770 srcset="/2023/kubernetes-docker/media/Pasted-image-20230920202516_huf5819385887aa47ed3ad2353805236a5_89123_480x0_resize_box_3.png 480w, /2023/kubernetes-docker/media/Pasted-image-20230920202516_huf5819385887aa47ed3ad2353805236a5_89123_1024x0_resize_box_3.png 1024w" loading=lazy alt=media/Pasted-image-20230920202516.png class=gallery-image data-flex-grow=202 data-flex-basis=486px></p><p><img src=/2023/kubernetes-docker/media/Pasted-image-20230920200440.png width=1564 height=876 srcset="/2023/kubernetes-docker/media/Pasted-image-20230920200440_hu594f130566eb0d55a608ebc53d559d8b_105762_480x0_resize_box_3.png 480w, /2023/kubernetes-docker/media/Pasted-image-20230920200440_hu594f130566eb0d55a608ebc53d559d8b_105762_1024x0_resize_box_3.png 1024w" loading=lazy alt=media/Pasted-image-20230920200440.png class=gallery-image data-flex-grow=178 data-flex-basis=428px>
確認驗證成功，連接到ldap
<img src=/2023/kubernetes-docker/media/Pasted-image-20230920202553.png width=1573 height=400 srcset="/2023/kubernetes-docker/media/Pasted-image-20230920202553_hu55c8f478c070de92d1bbb3a45da7ed62_61301_480x0_resize_box_3.png 480w, /2023/kubernetes-docker/media/Pasted-image-20230920202553_hu55c8f478c070de92d1bbb3a45da7ed62_61301_1024x0_resize_box_3.png 1024w" loading=lazy alt=media/Pasted-image-20230920202553.png class=gallery-image data-flex-grow=393 data-flex-basis=943px></p><p>可以看到，此時已經自動改成用剛剛驗證的ad帳戶登入了
<img src=/2023/kubernetes-docker/media/Pasted-image-20230920203808.png width=1575 height=444 srcset="/2023/kubernetes-docker/media/Pasted-image-20230920203808_hue9cb7d09133fb0a90ab4f9720061370b_73641_480x0_resize_box_3.png 480w, /2023/kubernetes-docker/media/Pasted-image-20230920203808_hue9cb7d09133fb0a90ab4f9720061370b_73641_1024x0_resize_box_3.png 1024w" loading=lazy alt=media/Pasted-image-20230920203808.png class=gallery-image data-flex-grow=354 data-flex-basis=851px></p><h3 id=五再到ad創建一個使用者驗證一下是否rancher可以獲取到此使用者帳號>五、再到AD創建一個使用者，驗證一下，是否Rancher可以獲取到此使用者帳號</h3><p><img src=/2023/kubernetes-docker/media/Pasted-image-20230920202931.png width=754 height=530 srcset="/2023/kubernetes-docker/media/Pasted-image-20230920202931_hucce501a8d63116565fd51bf626607f7a_265285_480x0_resize_box_3.png 480w, /2023/kubernetes-docker/media/Pasted-image-20230920202931_hucce501a8d63116565fd51bf626607f7a_265285_1024x0_resize_box_3.png 1024w" loading=lazy alt=media/Pasted-image-20230920202931.png class=gallery-image data-flex-grow=142 data-flex-basis=341px></p><p>編輯default project(裡面只有一個default namespace)
<img src=/2023/kubernetes-docker/media/Pasted-image-20230920203941.png width=1573 height=652 srcset="/2023/kubernetes-docker/media/Pasted-image-20230920203941_hu85815b49f4cde207d4d8d84c72ff1e58_89204_480x0_resize_box_3.png 480w, /2023/kubernetes-docker/media/Pasted-image-20230920203941_hu85815b49f4cde207d4d8d84c72ff1e58_89204_1024x0_resize_box_3.png 1024w" loading=lazy alt=media/Pasted-image-20230920203941.png class=gallery-image data-flex-grow=241 data-flex-basis=579px></p><p>添加ldap帳號
<img src=/2023/kubernetes-docker/media/Pasted-image-20230920204039.png width=1247 height=487 srcset="/2023/kubernetes-docker/media/Pasted-image-20230920204039_hu4d5d91582cc4c220bc6ff9f834b34b84_54173_480x0_resize_box_3.png 480w, /2023/kubernetes-docker/media/Pasted-image-20230920204039_hu4d5d91582cc4c220bc6ff9f834b34b84_54173_1024x0_resize_box_3.png 1024w" loading=lazy alt=media/Pasted-image-20230920204039.png class=gallery-image data-flex-grow=256 data-flex-basis=614px></p><p>可以看到有jimmy帳號
<img src=/2023/kubernetes-docker/media/Pasted-image-20230920204053.png width=600 height=515 srcset="/2023/kubernetes-docker/media/Pasted-image-20230920204053_hu2abd776d23e2d0a365cc775f8f5692c4_43125_480x0_resize_box_3.png 480w, /2023/kubernetes-docker/media/Pasted-image-20230920204053_hu2abd776d23e2d0a365cc775f8f5692c4_43125_1024x0_resize_box_3.png 1024w" loading=lazy alt=media/Pasted-image-20230920204053.png class=gallery-image data-flex-grow=116 data-flex-basis=279px></p><p>添加此帳號
<img src=/2023/kubernetes-docker/media/Pasted-image-20230920204121.png width=1573 height=871 srcset="/2023/kubernetes-docker/media/Pasted-image-20230920204121_hu80effc2f7246d9943ad2ff6d835d4b03_79555_480x0_resize_box_3.png 480w, /2023/kubernetes-docker/media/Pasted-image-20230920204121_hu80effc2f7246d9943ad2ff6d835d4b03_79555_1024x0_resize_box_3.png 1024w" loading=lazy alt=media/Pasted-image-20230920204121.png class=gallery-image data-flex-grow=180 data-flex-basis=433px></p><p>登出Rancher，改用jimmy帳號登入，密碼是ad中設定的密碼
<img src=/2023/kubernetes-docker/media/Pasted-image-20230920203512.png width=785 height=724 srcset="/2023/kubernetes-docker/media/Pasted-image-20230920203512_hu88df8f70c9e88da09d43788021a358c2_40923_480x0_resize_box_3.png 480w, /2023/kubernetes-docker/media/Pasted-image-20230920203512_hu88df8f70c9e88da09d43788021a358c2_40923_1024x0_resize_box_3.png 1024w" loading=lazy alt=media/Pasted-image-20230920203512.png class=gallery-image data-flex-grow=108 data-flex-basis=260px>
確認可以登入
<img src=/2023/kubernetes-docker/media/Pasted-image-20230920204201.png width=1572 height=664 srcset="/2023/kubernetes-docker/media/Pasted-image-20230920204201_hu7ae9ac3b08242c87cd4281f509e35bba_85934_480x0_resize_box_3.png 480w, /2023/kubernetes-docker/media/Pasted-image-20230920204201_hu7ae9ac3b08242c87cd4281f509e35bba_85934_1024x0_resize_box_3.png 1024w" loading=lazy alt=media/Pasted-image-20230920204201.png class=gallery-image data-flex-grow=236 data-flex-basis=568px></p><p><img src=/2023/kubernetes-docker/media/Pasted-image-20230920204230.png width=1561 height=692 srcset="/2023/kubernetes-docker/media/Pasted-image-20230920204230_hud978b472884248a7277e5c20dd0fafaf_82394_480x0_resize_box_3.png 480w, /2023/kubernetes-docker/media/Pasted-image-20230920204230_hud978b472884248a7277e5c20dd0fafaf_82394_1024x0_resize_box_3.png 1024w" loading=lazy alt=media/Pasted-image-20230920204230.png class=gallery-image data-flex-grow=225 data-flex-basis=541px></p><p>可以看到，能查看到default project與default namespace
<img src=/2023/kubernetes-docker/media/Pasted-image-20230920204242.png width=1568 height=428 srcset="/2023/kubernetes-docker/media/Pasted-image-20230920204242_hu72ca91c4954247a7001523fef5da9ab9_54105_480x0_resize_box_3.png 480w, /2023/kubernetes-docker/media/Pasted-image-20230920204242_hu72ca91c4954247a7001523fef5da9ab9_54105_1024x0_resize_box_3.png 1024w" loading=lazy alt=media/Pasted-image-20230920204242.png class=gallery-image data-flex-grow=366 data-flex-basis=879px></p><p>dashboard shell也是可以使用的，但只能看到default namespace的資源
<img src=/2023/kubernetes-docker/media/Pasted-image-20230920204317.png width=1562 height=588 srcset="/2023/kubernetes-docker/media/Pasted-image-20230920204317_hu6392b9858d6d8f644485c04ae83482b0_79177_480x0_resize_box_3.png 480w, /2023/kubernetes-docker/media/Pasted-image-20230920204317_hu6392b9858d6d8f644485c04ae83482b0_79177_1024x0_resize_box_3.png 1024w" loading=lazy alt=media/Pasted-image-20230920204317.png class=gallery-image data-flex-grow=265 data-flex-basis=637px></p><p>是無法查看kube-system namespace的資源，確實跟前面設定的權限是符合的
<img src=/2023/kubernetes-docker/media/Pasted-image-20230920204411.png width=1581 height=615 srcset="/2023/kubernetes-docker/media/Pasted-image-20230920204411_hu365ef24150b6d29b60f3749b249db757_101516_480x0_resize_box_3.png 480w, /2023/kubernetes-docker/media/Pasted-image-20230920204411_hu365ef24150b6d29b60f3749b249db757_101516_1024x0_resize_box_3.png 1024w" loading=lazy alt=media/Pasted-image-20230920204411.png class=gallery-image data-flex-grow=257 data-flex-basis=616px></p><h3 id=六也可以下載連線設定檔到自己常用linux主機連線管理>六、也可以下載連線設定檔到自己常用linux主機，連線管理</h3><p><img src=/2023/kubernetes-docker/media/Pasted-image-20230920204450.png width=1568 height=509 srcset="/2023/kubernetes-docker/media/Pasted-image-20230920204450_hu09d71deb5eec4885ea45686ca35e74b2_90652_480x0_resize_box_3.png 480w, /2023/kubernetes-docker/media/Pasted-image-20230920204450_hu09d71deb5eec4885ea45686ca35e74b2_90652_1024x0_resize_box_3.png 1024w" loading=lazy alt=media/Pasted-image-20230920204450.png class=gallery-image data-flex-grow=308 data-flex-basis=739px></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 1. 將下載的設定檔，scp到常用linux主機</span>
</span></span><span class=line><span class=cl>chenqingze@chenqingze-MBP ~ % scp /Users/chenqingze/Downloads/kubernetes-config.yml root@192.168.1.76:/root/
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 2. 可以看到設定檔</span>
</span></span><span class=line><span class=cl>root@k8s-node76u:~# ls -l
</span></span><span class=line><span class=cl>total <span class=m>9376</span>
</span></span><span class=line><span class=cl>-rw-r--r-- <span class=m>1</span> root root    <span class=m>1396</span> Sep <span class=m>20</span> 12:47 kubernetes-config.yml
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 3. 在使用者家目錄下，創建.kube目錄</span>
</span></span><span class=line><span class=cl>root@k8s-node76u:~# mkdir .kube
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 4. 將設定檔複製到.kube目錄，且命名為config(因kubectl預設就是用.kube/config設定檔連線)</span>
</span></span><span class=line><span class=cl>root@k8s-node76u:~# cp kubernetes-config.yml ~/.kube/config
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 5. 確認可以連線，查看default namespace下的資源</span>
</span></span><span class=line><span class=cl>root@k8s-node76u:~# kubectl get pod
</span></span><span class=line><span class=cl>NAME         READY   STATUS    RESTARTS        AGE
</span></span><span class=line><span class=cl>test-nginx   1/1     Running   <span class=m>1</span> <span class=o>(</span>3h20m ago<span class=o>)</span>   7h26m
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 6. 其他namespace下的資源，是無法查看的</span>
</span></span><span class=line><span class=cl>root@k8s-node76u:~# kubectl get pod -n kube-system
</span></span><span class=line><span class=cl>Error from server <span class=o>(</span>Forbidden<span class=o>)</span>: pods is forbidden: User <span class=s2>&#34;u-hx7xy6ap22&#34;</span> cannot list resource <span class=s2>&#34;pods&#34;</span> in API group <span class=s2>&#34;&#34;</span> in the namespace <span class=s2>&#34;kube-system&#34;</span>
</span></span></code></pre></div></section><footer class=article-footer><section class=article-tags><a href=/tags/kubernetes/>Kubernetes</a>
<a href=/tags/docker/>Docker</a>
<a href=/tags/rancher/>Rancher</a></section><section class=article-copyright><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>Licensed under CC BY-NC-SA 4.0</span></section></footer></article><aside class=related-content--wrapper><h2 class=section-title>相關文章</h2><div class=related-content><div class="flex article-list--tile"><article><a href=/2024/kubernetes-rancher-install-prometheus-selector-to-master/><div class=article-details><h2 class=article-title>Kubernetes Rancher管理平台 Prometheus監控調度到master節點</h2></div></a></article><article><a href=/2023/kubernetes-rancher-install-prometheus/><div class=article-details><h2 class=article-title>Kubernetes 使用Rancher管理平台 安裝Prometheus監控</h2></div></a></article><article class=has-image><a href=/2023/ansible-deploy-kubernetes-cluster-use-kubespray-haproxy-keepalived/><div class=article-image><img src=/2023/ansible-deploy-kubernetes-cluster-use-kubespray-haproxy-keepalived/media/_hu22d4264949f439b8802769db5f69cb0d_36536_c0cd8f7cf63dffc0c7cb863e69c61601.png width=250 height=150 loading=lazy alt="Featured image of post 使用kubespray專案，用ansible批量佈屬生產環境高可用kubernetes集群(haproxy、keepalived)" data-key=ansible-deploy-kubernetes-cluster-use-kubespray-haproxy-keepalived data-hash="md5-ksOzdmc4vGgYLEYiVrH4yg=="></div><div class=article-details><h2 class=article-title>使用kubespray專案，用ansible批量佈屬生產環境高可用kubernetes集群(haproxy、keepalived)</h2></div></a></article><article><a href=/2023/kubernetes-install/><div class=article-details><h2 class=article-title>kubeadm安裝 高可用版(ubuntu2204+k8s版本1.26.3+docker+cri-docker)</h2></div></a></article><article><a href=/2023/kubernetes-helm/><div class=article-details><h2 class=article-title>使用Helm安裝Rancher管理平台，納管現有k8s集群(高可用)</h2></div></a></article></div></div></aside><div class=disqus-container><div id=disqus_thread></div><script>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//blog-goldfishbrain-fighting-com.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div><style>.disqus-container{background-color:var(--card-background);border-radius:var(--card-border-radius);box-shadow:var(--shadow-l1);padding:var(--card-padding)}</style><script>window.addEventListener("onColorSchemeChange",e=>{typeof DISQUS=="object"&&DISQUS.reset({reload:!0})})</script><footer class=site-footer><section class=copyright>&copy;
2022 -
2024 翻轉吧金魚腦</section><section class=powerby>使用 <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> 建立<br>主題 <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.20.0>Stack</a></b> 由 <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a> 設計</section><section class=totalcount>發表了128篇文章 ·
總計63.96k字</section><section class=running-time>本站已運行
<span id=runningdays class=running-days></span></section><section class=visit-count><span id=busuanzi_container_site_pv style=display:none>本站總訪問量 <span id=busuanzi_value_site_pv></span> 次 </span>·
<span id=busuanzi_container_site_uv style=display:none>總訪客數 <span id=busuanzi_value_site_uv></span> 人</span></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script><a href=# id=back-to-top title=返回顶部></a><style>#back-to-top{display:none;position:fixed;bottom:20px;right:55px;width:55px;height:55px;border-radius:7px;background-color:rgba(64,158,255,.5);box-shadow:var(--shadow-l2);font-size:30px;text-align:center;line-height:50px;cursor:pointer}#back-to-top:before{content:' ';display:inline-block;position:relative;top:0;transform:rotate(135deg);height:10px;width:10px;border-width:0 0 2px 2px;border-color:var(--back-to-top-color);border-style:solid}#back-to-top:hover:before{border-color:#2674e0}@media screen and (max-width:768px){#back-to-top{bottom:20px;right:20px;width:40px;height:40px;font-size:10px}}@media screen and (min-width:1024px){#back-to-top{bottom:20px;right:40px}}@media screen and (min-width:1280px){#back-to-top{bottom:20px;right:55px}}@media screen and (min-width:1536px){#back-to-top{visibility:hidden}}</style><script>function backToTop(){document.documentElement.scrollIntoView({behavior:"smooth"})}window.onload=function(){let t=this.document.documentElement.scrollTop||this.document.body.scrollTop,e=this.document.getElementById("back-to-top");t>0?e.style.display="inline":e.style.display="none"},window.onscroll=function(){let t=this.document.documentElement.scrollTop||this.document.body.scrollTop,e=this.document.getElementById("back-to-top");t<200?e.style.display="none":(e.style.display="inline",e.addEventListener("click",backToTop,!1))}</script><script>(function(){var t,e=window;if(e.ChannelIO)return e.console.error("ChannelIO script included twice.");t=function(){t.c(arguments)},t.q=[],t.c=function(e){t.q.push(e)},e.ChannelIO=t;function n(){if(e.ChannelIOInitialized)return;e.ChannelIOInitialized=!0;var n,t=document.createElement("script");t.type="text/javascript",t.async=!0,t.src="https://cdn.channel.io/plugin/ch-plugin-web.js",n=document.getElementsByTagName("script")[0],n.parentNode&&n.parentNode.insertBefore(t,n)}document.readyState==="complete"?n():(e.addEventListener("DOMContentLoaded",n),e.addEventListener("load",n))})(),ChannelIO("boot",{pluginKey:"ad479103-2d28-421a-a916-ae09e72ce014"})</script><script>let s1="2023-10-7";s1=new Date(s1.replace(/-/g,"/"));let s2=new Date,timeDifference=s2.getTime()-s1.getTime(),days=Math.floor(timeDifference/(1e3*60*60*24)),hours=Math.floor(timeDifference%(1e3*60*60*24)/(1e3*60*60)),minutes=Math.floor(timeDifference%(1e3*60*60)/(1e3*60)),result=days+"天"+hours+"小時"+minutes+"分鐘";document.getElementById("runningdays").innerHTML=result</script></body></html>