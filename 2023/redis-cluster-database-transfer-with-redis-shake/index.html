<!doctype html><html lang=en-us dir=ltr><head><script async src="https://www.googletagmanager.com/gtag/js?id=G-QB4H991E1G"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-QB4H991E1G")</script><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="使用Redis-Shake，還原數據，從一個cluster遷移所有分片數據到另一個cluster，結果->可行，恢復數據非常快"><meta name=keywords content="翻轉吧金魚腦,使用Redis-Shake，還原數據，從一個cluster遷移所有分片數據到另一個cluster，結果->可行，恢復數據非常快"><title>使用Redis-Shake，還原數據，從一個cluster遷移所有分片數據到另一個cluster，結果->可行，恢復數據非常快</title>
<link rel=canonical href=https://blog.goldfishbrain-fighting.com/2023/redis-cluster-database-transfer-with-redis-shake/><link rel=stylesheet href=/scss/style.min.7fb7f5621081d8ecec310edc2d95cc0b431358ce9c30c3ee8601b16732dbef57.css><script async src=//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js></script><meta name=referrer content="no-referrer-when-downgrade"><script src=//cdn.bootcss.com/jquery/3.2.1/jquery.min.js></script><script>$(document).ready(function(){var e=setInterval(s,100),t=100,n=50;function s(){$("#busuanzi_container_site_pv").css("display")!="none"&&(clearInterval(e),$("#busuanzi_value_site_pv").html(parseInt($("#busuanzi_value_site_pv").html())+t),$("#busuanzi_value_site_uv").html(parseInt($("#busuanzi_value_site_uv").html())+n))}})</script><meta property="og:title" content="使用Redis-Shake，還原數據，從一個cluster遷移所有分片數據到另一個cluster，結果->可行，恢復數據非常快"><meta property="og:description" content="使用Redis-Shake，還原數據，從一個cluster遷移所有分片數據到另一個cluster，結果->可行，恢復數據非常快"><meta property="og:url" content="https://blog.goldfishbrain-fighting.com/2023/redis-cluster-database-transfer-with-redis-shake/"><meta property="og:site_name" content="翻轉吧金魚腦"><meta property="og:type" content="article"><meta property="article:section" content="Post"><meta property="article:tag" content="redis"><meta property="article:tag" content="redis-shake"><meta property="article:tag" content="redis-cluster"><meta property="article:published_time" content="2023-12-17T18:49:32+08:00"><meta property="article:modified_time" content="2023-12-17T18:49:32+08:00"><meta name=twitter:title content="使用Redis-Shake，還原數據，從一個cluster遷移所有分片數據到另一個cluster，結果->可行，恢復數據非常快"><meta name=twitter:description content="使用Redis-Shake，還原數據，從一個cluster遷移所有分片數據到另一個cluster，結果->可行，恢復數據非常快"><link rel="shortcut icon" href=/favicon.png><script async src="https://www.googletagmanager.com/gtag/js?id=G-QB4H991E1G"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-QB4H991E1G")</script><meta name=google-site-verification content="EkUcMLTrO3RDZzjREX9Dffy2lcjWCR-2Qtu8VF4b8sQ"><meta content="翻轉吧金魚腦,使用Redis-Shake，還原數據，從一個cluster遷移所有分片數據到另一個cluster，結果->可行，恢復數據非常快" name=keywords></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><div id=article-toolbar style=position:sticky;top:5px;z-index:1000><a href=/ class=back-home><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-chevron-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="15 6 9 12 15 18"/></svg><span>返回</span></a></div><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">目錄</h2><div class=widget--toc><nav id=TableOfContents><ul><li><ul><li><a href=#redis-cluster主機ip表>Redis Cluster主機IP表</a></li><li><a href=#golang安裝>Golang安裝</a></li><li><a href=#redis-shake設定>Redis-Shake設定</a></li><li><a href=#redis-shake開始恢復數據>Redis-Shake開始恢復數據</a><ul><li><a href=#恢復dump-master1rdb數據>恢復dump-master1，rdb數據</a></li><li><a href=#恢復dump-master2rdb數據>恢復dump-master2，rdb數據</a></li><li><a href=#恢復dump-master3rdb數據>恢復dump-master3，rdb數據</a></li><li><a href=#恢復dump-master4rdb數據>恢復dump-master4，rdb數據</a></li><li><a href=#恢復dump-master5rdb數據>恢復dump-master5，rdb數據</a></li></ul></li><li><a href=#分析數據>分析數據</a></li><li><a href=#測試數據是否正確>測試數據，是否正確</a></li></ul></li></ul></nav></div></section></aside><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><header class=article-category><a href=/categories/redis/ style=background-color:#d6332d;color:#fff>redis</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/2023/redis-cluster-database-transfer-with-redis-shake/>使用Redis-Shake，還原數據，從一個cluster遷移所有分片數據到另一個cluster，結果->可行，恢復數據非常快</a></h2><h3 class=article-subtitle>使用Redis-Shake，還原數據，從一個cluster遷移所有分片數據到另一個cluster，結果->可行，恢復數據非常快</h3></div><footer class=article-time><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg><time class=article-time--published>2023/12/17</time></div><div><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg><time class=article-time--reading>閱讀時間: 14 分鐘</time></div></footer></div></header><section class=article-content><section class="toc toc--inline"><h2>目錄</h2><div><nav id=TableOfContents><ul><li><ul><li><a href=#redis-cluster主機ip表>Redis Cluster主機IP表</a></li><li><a href=#golang安裝>Golang安裝</a></li><li><a href=#redis-shake設定>Redis-Shake設定</a></li><li><a href=#redis-shake開始恢復數據>Redis-Shake開始恢復數據</a><ul><li><a href=#恢復dump-master1rdb數據>恢復dump-master1，rdb數據</a></li><li><a href=#恢復dump-master2rdb數據>恢復dump-master2，rdb數據</a></li><li><a href=#恢復dump-master3rdb數據>恢復dump-master3，rdb數據</a></li><li><a href=#恢復dump-master4rdb數據>恢復dump-master4，rdb數據</a></li><li><a href=#恢復dump-master5rdb數據>恢復dump-master5，rdb數據</a></li></ul></li><li><a href=#分析數據>分析數據</a></li><li><a href=#測試數據是否正確>測試數據，是否正確</a></li></ul></li></ul></nav></div></section><p>專案GitHub網址：
<a class=link href=https://github.com/tair-opensource/RedisShake target=_blank rel=noopener>https://github.com/tair-opensource/RedisShake</a></p><h2 id=redis-cluster主機ip表>Redis Cluster主機IP表</h2><p><img src=/2023/redis-cluster-database-transfer-with-redis-shake/media/Pasted-image-20231217182757.png width=668 height=1011 srcset="/2023/redis-cluster-database-transfer-with-redis-shake/media/Pasted-image-20231217182757_hu958cbfd0a734f396244b4db5ea229923_132015_480x0_resize_box_3.png 480w, /2023/redis-cluster-database-transfer-with-redis-shake/media/Pasted-image-20231217182757_hu958cbfd0a734f396244b4db5ea229923_132015_1024x0_resize_box_3.png 1024w" loading=lazy class=gallery-image data-flex-grow=66 data-flex-basis=158px></p><div class=table-wrapper><table><thead><tr><th></th><th></th><th></th><th></th><th></th><th></th></tr></thead><tbody><tr><td>主機名稱</td><td>主機IP</td><td>角色</td><td>主機IP</td><td>角色</td><td>跟隨</td></tr><tr><td>redis91</td><td>192.168.1.91:6379</td><td>master</td><td>192.168.1.91:6380</td><td>slave</td><td>192.168.1.92:6380</td></tr><tr><td>redis92</td><td>192.168.1.92:6379</td><td>master</td><td>192.168.1.92:6380</td><td>slave</td><td>192.168.1.93:6380</td></tr><tr><td>redis93</td><td>192.168.1.93:6379</td><td>master</td><td>192.168.1.93:6380</td><td>slave</td><td>192.168.1.91:6380</td></tr><tr><td>redis94</td><td>192.168.1.94:6379</td><td>master</td><td>192.168.1.94:6380</td><td>slave</td><td>192.168.1.98:6380</td></tr><tr><td>redis98</td><td>192.168.1.98:6379</td><td>master</td><td>192.168.1.98:6380</td><td>slave</td><td>192.168.1.94:6380</td></tr></tbody></table></div><h2 id=golang安裝>Golang安裝</h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=o>[</span>root@redis91 ~<span class=o>]</span><span class=c1># sudo tar -C /usr/local -xzf go1.21.5.linux-amd64.tar.gz</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>[</span>root@redis91 ~<span class=o>]</span><span class=c1># sudo vim /etc/profile</span>
</span></span><span class=line><span class=cl><span class=c1># 加到最後面</span>
</span></span><span class=line><span class=cl><span class=nb>export</span> <span class=nv>PATH</span><span class=o>=</span><span class=nv>$PATH</span>:/usr/local/go/bin
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>[</span>root@redis91 ~<span class=o>]</span><span class=c1># source /etc/profile</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>[</span>root@redis91 ~<span class=o>]</span><span class=c1># go version</span>
</span></span><span class=line><span class=cl>go version go1.21.5 linux/amd64
</span></span></code></pre></div><h2 id=redis-shake設定>Redis-Shake設定</h2><p>創建工作目錄，解壓redis-shake包</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 創建工作目錄</span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@redis91 ~<span class=o>]</span><span class=c1># mkdir redis-shake</span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@redis91 ~<span class=o>]</span><span class=c1># sudo tar -C ./redis-shake -xzvf redis-shake-linux-amd64.tar.gz</span>
</span></span><span class=line><span class=cl>./redis-shake
</span></span><span class=line><span class=cl>./shake.toml
</span></span><span class=line><span class=cl><span class=o>[</span>root@redis91 ~<span class=o>]</span><span class=c1># cd redis-shake</span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@redis91 redis-shake<span class=o>]</span><span class=c1># ls -l</span>
</span></span><span class=line><span class=cl>總計 <span class=m>11212</span>
</span></span><span class=line><span class=cl>-rwxr-xr-x <span class=m>1</span> <span class=m>1001</span> <span class=m>127</span> <span class=m>11473016</span> 10月 <span class=m>11</span> 19:52 redis-shake
</span></span><span class=line><span class=cl>-rw-r--r-- <span class=m>1</span> <span class=m>1001</span> <span class=m>127</span>     <span class=m>2927</span> 10月 <span class=m>11</span> 19:52 shake.toml
</span></span></code></pre></div><p>創建dumprdbfile目錄，解壓要恢復數據的dump.rdb包，總共五個dump-master1.rdb、dump-master2.rdb、dump-master3.rdb、dump-master4.rdb、dump-master5.rdb</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=o>[</span>root@redis91 redis-shake<span class=o>]</span><span class=c1># mkdir dumprdbfile</span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@redis91 redis-shake<span class=o>]</span><span class=c1># ll</span>
</span></span><span class=line><span class=cl>總計 <span class=m>11212</span>
</span></span><span class=line><span class=cl>drwxr-xr-x <span class=m>2</span> root root        <span class=m>6</span> 12月 <span class=m>17</span> 19:55 dumprdbfile
</span></span><span class=line><span class=cl>-rwxr-xr-x <span class=m>1</span> <span class=m>1001</span>  <span class=m>127</span> <span class=m>11473016</span> 10月 <span class=m>11</span> 19:52 redis-shake
</span></span><span class=line><span class=cl>-rw-r--r-- <span class=m>1</span> <span class=m>1001</span>  <span class=m>127</span>     <span class=m>2927</span> 10月 <span class=m>11</span> 19:52 shake.toml
</span></span><span class=line><span class=cl><span class=o>[</span>root@redis91 redis-shake<span class=o>]</span><span class=c1># cd dumprdbfile/</span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@redis91 dumprdbfile<span class=o>]</span><span class=c1># ls -l</span>
</span></span><span class=line><span class=cl>總計 <span class=m>1256064</span>
</span></span><span class=line><span class=cl>-rw-r--r-- <span class=m>1</span> root root <span class=m>255824392</span> 12月 <span class=m>17</span> 19:56 redis-master1_dump_rdb.tar.gz
</span></span><span class=line><span class=cl>-rw-r--r-- <span class=m>1</span> root root <span class=m>253817683</span> 12月 <span class=m>17</span> 19:56 redis-master2_dump_rdb.tar.gz
</span></span><span class=line><span class=cl>-rw-r--r-- <span class=m>1</span> root root <span class=m>254657334</span> 12月 <span class=m>17</span> 19:56 redis-master3_dump_rdb.tar.gz
</span></span><span class=line><span class=cl>-rw-r--r-- <span class=m>1</span> root root <span class=m>254929776</span> 12月 <span class=m>17</span> 19:56 redis-master4_dump_rdb.tar.gz
</span></span><span class=line><span class=cl>-rw-r--r-- <span class=m>1</span> root root <span class=m>266967631</span> 12月 <span class=m>17</span> 19:56 redis-master5_dump_rdb.tar.gz
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>[</span>root@redis91 dumprdbfile<span class=o>]</span><span class=c1># tar -xzvf redis-master1_dump_rdb.tar.gz -O dump.rdb &gt; dump-master1.rdb</span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@redis91 dumprdbfile<span class=o>]</span><span class=c1># tar -xzvf redis-master2_dump_rdb.tar.gz -O dump.rdb &gt; dump-master2.rdb</span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@redis91 dumprdbfile<span class=o>]</span><span class=c1># tar -xzvf redis-master3_dump_rdb.tar.gz -O dump.rdb &gt; dump-master3.rdb</span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@redis91 dumprdbfile<span class=o>]</span><span class=c1># tar -xzvf redis-master4_dump_rdb.tar.gz -O dump.rdb &gt; dump-master4.rdb</span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@redis91 dumprdbfile<span class=o>]</span><span class=c1># tar -xzvf redis-master5_dump_rdb.tar.gz -O dump.rdb &gt; dump-master5.rdb</span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@redis91 dumprdbfile<span class=o>]</span><span class=c1># ls -l</span>
</span></span><span class=line><span class=cl>總計 <span class=m>3014796</span>
</span></span><span class=line><span class=cl>-rw-r--r-- <span class=m>1</span> root root <span class=m>343630318</span> 12月 <span class=m>17</span> 20:03 dump-master1.rdb
</span></span><span class=line><span class=cl>-rw-r--r-- <span class=m>1</span> root root <span class=m>348759548</span> 12月 <span class=m>17</span> 20:04 dump-master2.rdb
</span></span><span class=line><span class=cl>-rw-r--r-- <span class=m>1</span> root root <span class=m>349938872</span> 12月 <span class=m>17</span> 20:04 dump-master3.rdb
</span></span><span class=line><span class=cl>-rw-r--r-- <span class=m>1</span> root root <span class=m>402484559</span> 12月 <span class=m>17</span> 20:04 dump-master4.rdb
</span></span><span class=line><span class=cl>-rw-r--r-- <span class=m>1</span> root root <span class=m>356118026</span> 12月 <span class=m>17</span> 20:04 dump-master5.rdb
</span></span><span class=line><span class=cl>-rw-r--r-- <span class=m>1</span> root root <span class=m>255824392</span> 12月 <span class=m>17</span> 19:56 redis-master1_dump_rdb.tar.gz
</span></span><span class=line><span class=cl>-rw-r--r-- <span class=m>1</span> root root <span class=m>253817683</span> 12月 <span class=m>17</span> 19:56 redis-master2_dump_rdb.tar.gz
</span></span><span class=line><span class=cl>-rw-r--r-- <span class=m>1</span> root root <span class=m>254657334</span> 12月 <span class=m>17</span> 19:56 redis-master3_dump_rdb.tar.gz
</span></span><span class=line><span class=cl>-rw-r--r-- <span class=m>1</span> root root <span class=m>254929776</span> 12月 <span class=m>17</span> 19:56 redis-master4_dump_rdb.tar.gz
</span></span><span class=line><span class=cl>-rw-r--r-- <span class=m>1</span> root root <span class=m>266967631</span> 12月 <span class=m>17</span> 19:56 redis-master5_dump_rdb.tar.gz
</span></span></code></pre></div><p>編輯redis-shake設定檔</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>[</span>root@redis91 redis-shake<span class=o>]</span><span class=c1># vim shake.toml</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 填寫要恢復數據的rdb檔案位置</span>
</span></span><span class=line><span class=cl><span class=o>[</span>rdb_reader<span class=o>]</span>
</span></span><span class=line><span class=cl><span class=nv>filepath</span> <span class=o>=</span> <span class=s2>&#34;/root/redis-shake/dumprdbfile/dump-master1.rdb&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 填寫cluster其中一台master的ip，連接redis有帳號密碼，也要填上</span>
</span></span><span class=line><span class=cl><span class=o>[</span>redis_writer<span class=o>]</span>
</span></span><span class=line><span class=cl><span class=nv>cluster</span> <span class=o>=</span> <span class=nb>true</span>            <span class=c1># set to true if target is a redis cluster</span>
</span></span><span class=line><span class=cl><span class=nv>address</span> <span class=o>=</span> <span class=s2>&#34;192.168.1.91:6379&#34;</span> <span class=c1># when cluster is true, set address to one of the cluster node</span>
</span></span><span class=line><span class=cl><span class=nv>username</span> <span class=o>=</span> <span class=s2>&#34;帳號&#34;</span>              <span class=c1># keep empty if not using ACL</span>
</span></span><span class=line><span class=cl><span class=nv>password</span> <span class=o>=</span> <span class=s2>&#34;密碼&#34;</span>              <span class=c1># keep empty if no authentication is required</span>
</span></span><span class=line><span class=cl><span class=nv>tls</span> <span class=o>=</span> <span class=nb>false</span>
</span></span></code></pre></div><h2 id=redis-shake開始恢復數據>Redis-Shake開始恢復數據</h2><h3 id=恢復dump-master1rdb數據>恢復dump-master1，rdb數據</h3><p>開始恢復dump-master1.rdb數據至cluster</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=o>[</span>root@redis91 redis-shake<span class=o>]</span><span class=c1># ./redis-shake shake.toml</span>
</span></span><span class=line><span class=cl>Usage: redis-shake <span class=o>[</span>config file<span class=o>]</span>
</span></span><span class=line><span class=cl>Example:
</span></span><span class=line><span class=cl> 		redis-shake sync.toml <span class=c1># load config from sync.toml</span>
</span></span><span class=line><span class=cl>		redis-shake 		  <span class=c1># load config from environment variables</span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@redis91 redis-shake<span class=o>]</span><span class=c1># ./redis-shake shake.toml</span>
</span></span><span class=line><span class=cl>2023-12-17 20:16:47 INF load config from file: shake.toml
</span></span><span class=line><span class=cl>2023-12-17 20:16:47 INF log_level: <span class=o>[</span>info<span class=o>]</span>, log_file: <span class=o>[</span>/root/redis-shake/data/shake.log<span class=o>]</span>
</span></span><span class=line><span class=cl>2023-12-17 20:16:47 INF changed work dir to <span class=o>[</span>/root/redis-shake/data<span class=o>]</span>
</span></span><span class=line><span class=cl>2023-12-17 20:16:47 INF GOMAXPROCS defaults to the value of runtime.NumCPU <span class=o>[</span>8<span class=o>]</span>
</span></span><span class=line><span class=cl>2023-12-17 20:16:47 INF not <span class=nb>set</span> pprof port
</span></span><span class=line><span class=cl>2023-12-17 20:16:47 INF no <span class=k>function</span> script
</span></span><span class=line><span class=cl>2023-12-17 20:16:47 INF create RdbReader: /root/redis-shake/dumprdbfile/dump-master1.rdb
</span></span><span class=line><span class=cl>2023-12-17 20:16:47 INF redisClusterWriter load cluster nodes. <span class=nv>line</span><span class=o>=</span>2c05c930c506e54ebea35f8f0b731754cd44082a 192.168.1.91:6379@16379 myself,master - <span class=m>0</span> <span class=m>1702815406000</span> <span class=m>1</span> connected 0-3276
</span></span><span class=line><span class=cl>2023-12-17 20:16:47 INF redisClusterWriter load cluster nodes. <span class=nv>line</span><span class=o>=</span>c40f72b0ee3ac4be0b9ddaea4d16079f723e13bf 192.168.1.98:6379@16379 master - <span class=m>0</span> <span class=m>1702815406361</span> <span class=m>5</span> connected 13107-16383
</span></span><span class=line><span class=cl>2023-12-17 20:16:47 INF redisClusterWriter load cluster nodes. <span class=nv>line</span><span class=o>=</span>71d88e302c0a7ec240cbbb6f8380786d01da984c 192.168.1.92:6379@16379 master - <span class=m>0</span> <span class=m>1702815405000</span> <span class=m>2</span> connected 3277-6553
</span></span><span class=line><span class=cl>2023-12-17 20:16:47 INF redisClusterWriter load cluster nodes. <span class=nv>line</span><span class=o>=</span>caa1fb6b5fbc4e133b5ef472e2def11e836481f7 192.168.1.93:6379@16379 master - <span class=m>0</span> <span class=m>1702815403000</span> <span class=m>3</span> connected 6554-9829
</span></span><span class=line><span class=cl>2023-12-17 20:16:47 INF redisClusterWriter load cluster nodes. <span class=nv>line</span><span class=o>=</span>eaeb50d0d31025f1589b7c8cdc12867f7a474c24 192.168.1.94:6379@16379 master - <span class=m>0</span> <span class=m>1702815405357</span> <span class=m>4</span> connected 9830-13106
</span></span><span class=line><span class=cl>2023-12-17 20:16:47 INF redisClusterWriter connected to redis cluster successful. <span class=nv>addresses</span><span class=o>=[</span>192.168.1.91:6379 192.168.1.98:6379 192.168.1.92:6379 192.168.1.93:6379 192.168.1.94:6379<span class=o>]</span>
</span></span><span class=line><span class=cl>2023-12-17 20:16:47 INF create RedisClusterWriter: 192.168.1.91:6379
</span></span><span class=line><span class=cl>2023-12-17 20:16:47 INF not <span class=nb>set</span> status port
</span></span><span class=line><span class=cl>2023-12-17 20:16:47 INF start syncing...
</span></span><span class=line><span class=cl>2023-12-17 20:16:47 INF <span class=o>[</span>rdb_reader<span class=o>]</span> start <span class=nb>read</span>
</span></span><span class=line><span class=cl>2023-12-17 20:16:52 INF <span class=nv>read_count</span><span class=o>=[</span>298147<span class=o>]</span>, <span class=nv>read_ops</span><span class=o>=[</span>62121.63<span class=o>]</span>, <span class=nv>write_count</span><span class=o>=[</span>298146<span class=o>]</span>, <span class=nv>write_ops</span><span class=o>=[</span>62121.63<span class=o>]</span>, <span class=o>[</span>rdb_reader<span class=o>]</span> rdb file synced: 51.78%
</span></span><span class=line><span class=cl>2023-12-17 20:16:54 INF <span class=o>[</span>rdb_reader<span class=o>]</span> rdb file parse <span class=k>done</span>
</span></span><span class=line><span class=cl>2023-12-17 20:16:54 INF all <span class=k>done</span>
</span></span></code></pre></div><p>檢查一下，恢復數據後，數據分布和集群slot狀況</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=o>[</span>root@redis91 redis-shake<span class=o>]</span><span class=c1># redis-cli --user 帳號 --pass 密碼 --cluster check 192.168.1.91:6379</span>
</span></span><span class=line><span class=cl>Warning: Using a password with <span class=s1>&#39;-a&#39;</span> or <span class=s1>&#39;-u&#39;</span> option on the <span class=nb>command</span> line interface may not be safe.
</span></span><span class=line><span class=cl>192.168.1.91:6379 <span class=o>(</span>2c05c930...<span class=o>)</span> -&gt; <span class=m>327164</span> keys <span class=p>|</span> <span class=m>3277</span> slots <span class=p>|</span> <span class=m>1</span> slaves.
</span></span><span class=line><span class=cl>192.168.1.98:6379 <span class=o>(</span>c40f72b0...<span class=o>)</span> -&gt; <span class=m>0</span> keys <span class=p>|</span> <span class=m>3277</span> slots <span class=p>|</span> <span class=m>1</span> slaves.
</span></span><span class=line><span class=cl>192.168.1.92:6379 <span class=o>(</span>71d88e30...<span class=o>)</span> -&gt; <span class=m>108611</span> keys <span class=p>|</span> <span class=m>3277</span> slots <span class=p>|</span> <span class=m>1</span> slaves.
</span></span><span class=line><span class=cl>192.168.1.93:6379 <span class=o>(</span>caa1fb6b...<span class=o>)</span> -&gt; <span class=m>0</span> keys <span class=p>|</span> <span class=m>3276</span> slots <span class=p>|</span> <span class=m>1</span> slaves.
</span></span><span class=line><span class=cl>192.168.1.94:6379 <span class=o>(</span>eaeb50d0...<span class=o>)</span> -&gt; <span class=m>0</span> keys <span class=p>|</span> <span class=m>3277</span> slots <span class=p>|</span> <span class=m>1</span> slaves.
</span></span><span class=line><span class=cl><span class=o>[</span>OK<span class=o>]</span> <span class=m>435775</span> keys in <span class=m>5</span> masters.
</span></span><span class=line><span class=cl>26.60 keys per slot on average.
</span></span><span class=line><span class=cl>&gt;&gt;&gt; Performing Cluster Check <span class=o>(</span>using node 192.168.1.91:6379<span class=o>)</span>
</span></span><span class=line><span class=cl>M: 2c05c930c506e54ebea35f8f0b731754cd44082a 192.168.1.91:6379
</span></span><span class=line><span class=cl>   slots:<span class=o>[</span>0-3276<span class=o>]</span> <span class=o>(</span><span class=m>3277</span> slots<span class=o>)</span> master
</span></span><span class=line><span class=cl>   <span class=m>1</span> additional replica<span class=o>(</span>s<span class=o>)</span>
</span></span><span class=line><span class=cl>S: 1709189e2036c2e0c4168189be9074d66bce2991 192.168.1.92:6380
</span></span><span class=line><span class=cl>   slots: <span class=o>(</span><span class=m>0</span> slots<span class=o>)</span> slave
</span></span><span class=line><span class=cl>   replicates 2c05c930c506e54ebea35f8f0b731754cd44082a
</span></span><span class=line><span class=cl>M: c40f72b0ee3ac4be0b9ddaea4d16079f723e13bf 192.168.1.98:6379
</span></span><span class=line><span class=cl>   slots:<span class=o>[</span>13107-16383<span class=o>]</span> <span class=o>(</span><span class=m>3277</span> slots<span class=o>)</span> master
</span></span><span class=line><span class=cl>   <span class=m>1</span> additional replica<span class=o>(</span>s<span class=o>)</span>
</span></span><span class=line><span class=cl>M: 71d88e302c0a7ec240cbbb6f8380786d01da984c 192.168.1.92:6379
</span></span><span class=line><span class=cl>   slots:<span class=o>[</span>3277-6553<span class=o>]</span> <span class=o>(</span><span class=m>3277</span> slots<span class=o>)</span> master
</span></span><span class=line><span class=cl>   <span class=m>1</span> additional replica<span class=o>(</span>s<span class=o>)</span>
</span></span><span class=line><span class=cl>M: caa1fb6b5fbc4e133b5ef472e2def11e836481f7 192.168.1.93:6379
</span></span><span class=line><span class=cl>   slots:<span class=o>[</span>6554-9829<span class=o>]</span> <span class=o>(</span><span class=m>3276</span> slots<span class=o>)</span> master
</span></span><span class=line><span class=cl>   <span class=m>1</span> additional replica<span class=o>(</span>s<span class=o>)</span>
</span></span><span class=line><span class=cl>S: 500ed38b799c6d5ad13483f8e0fee45fc9142d69 192.168.1.94:6380
</span></span><span class=line><span class=cl>   slots: <span class=o>(</span><span class=m>0</span> slots<span class=o>)</span> slave
</span></span><span class=line><span class=cl>   replicates c40f72b0ee3ac4be0b9ddaea4d16079f723e13bf
</span></span><span class=line><span class=cl>S: 533669750790e904050e917657beae942185a407 192.168.1.91:6380
</span></span><span class=line><span class=cl>   slots: <span class=o>(</span><span class=m>0</span> slots<span class=o>)</span> slave
</span></span><span class=line><span class=cl>   replicates caa1fb6b5fbc4e133b5ef472e2def11e836481f7
</span></span><span class=line><span class=cl>S: b0bff6695a1318da9a01af2550c85de1e8e81a83 192.168.1.93:6380
</span></span><span class=line><span class=cl>   slots: <span class=o>(</span><span class=m>0</span> slots<span class=o>)</span> slave
</span></span><span class=line><span class=cl>   replicates 71d88e302c0a7ec240cbbb6f8380786d01da984c
</span></span><span class=line><span class=cl>M: eaeb50d0d31025f1589b7c8cdc12867f7a474c24 192.168.1.94:6379
</span></span><span class=line><span class=cl>   slots:<span class=o>[</span>9830-13106<span class=o>]</span> <span class=o>(</span><span class=m>3277</span> slots<span class=o>)</span> master
</span></span><span class=line><span class=cl>   <span class=m>1</span> additional replica<span class=o>(</span>s<span class=o>)</span>
</span></span><span class=line><span class=cl>S: 2b487243e0c78adb93ac73017d04a6ad39b51c36 192.168.1.98:6380
</span></span><span class=line><span class=cl>   slots: <span class=o>(</span><span class=m>0</span> slots<span class=o>)</span> slave
</span></span><span class=line><span class=cl>   replicates eaeb50d0d31025f1589b7c8cdc12867f7a474c24
</span></span><span class=line><span class=cl><span class=o>[</span>OK<span class=o>]</span> All nodes agree about slots configuration.
</span></span><span class=line><span class=cl>&gt;&gt;&gt; Check <span class=k>for</span> open slots...
</span></span><span class=line><span class=cl>&gt;&gt;&gt; Check slots coverage...
</span></span><span class=line><span class=cl><span class=o>[</span>OK<span class=o>]</span> All <span class=m>16384</span> slots covered.
</span></span></code></pre></div><h3 id=恢復dump-master2rdb數據>恢復dump-master2，rdb數據</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 修改要恢復數據的rdb檔案位置</span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@redis91 redis-shake<span class=o>]</span><span class=c1># vim shake.toml</span>
</span></span><span class=line><span class=cl><span class=o>[</span>rdb_reader<span class=o>]</span>
</span></span><span class=line><span class=cl><span class=nv>filepath</span> <span class=o>=</span> <span class=s2>&#34;/root/redis-shake/dumprdbfile/dump-master2.rdb&#34;</span>
</span></span></code></pre></div><p>開始恢復dump-master2.rdb數據至cluster</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=o>[</span>root@redis91 redis-shake<span class=o>]</span><span class=c1># ./redis-shake shake.toml</span>
</span></span><span class=line><span class=cl>2023-12-17 20:18:45 INF load config from file: shake.toml
</span></span><span class=line><span class=cl>2023-12-17 20:18:45 INF log_level: <span class=o>[</span>info<span class=o>]</span>, log_file: <span class=o>[</span>/root/redis-shake/data/shake.log<span class=o>]</span>
</span></span><span class=line><span class=cl>2023-12-17 20:18:45 INF changed work dir to <span class=o>[</span>/root/redis-shake/data<span class=o>]</span>
</span></span><span class=line><span class=cl>2023-12-17 20:18:45 INF GOMAXPROCS defaults to the value of runtime.NumCPU <span class=o>[</span>8<span class=o>]</span>
</span></span><span class=line><span class=cl>2023-12-17 20:18:45 INF not <span class=nb>set</span> pprof port
</span></span><span class=line><span class=cl>2023-12-17 20:18:45 INF no <span class=k>function</span> script
</span></span><span class=line><span class=cl>2023-12-17 20:18:45 INF create RdbReader: /root/redis-shake/dumprdbfile/dump-master2.rdb
</span></span><span class=line><span class=cl>2023-12-17 20:18:45 INF redisClusterWriter load cluster nodes. <span class=nv>line</span><span class=o>=</span>2c05c930c506e54ebea35f8f0b731754cd44082a 192.168.1.91:6379@16379 myself,master - <span class=m>0</span> <span class=m>1702815523000</span> <span class=m>1</span> connected 0-3276
</span></span><span class=line><span class=cl>2023-12-17 20:18:45 INF redisClusterWriter load cluster nodes. <span class=nv>line</span><span class=o>=</span>c40f72b0ee3ac4be0b9ddaea4d16079f723e13bf 192.168.1.98:6379@16379 master - <span class=m>0</span> <span class=m>1702815524860</span> <span class=m>5</span> connected 13107-16383
</span></span><span class=line><span class=cl>2023-12-17 20:18:45 INF redisClusterWriter load cluster nodes. <span class=nv>line</span><span class=o>=</span>71d88e302c0a7ec240cbbb6f8380786d01da984c 192.168.1.92:6379@16379 master - <span class=m>0</span> <span class=m>1702815521000</span> <span class=m>2</span> connected 3277-6553
</span></span><span class=line><span class=cl>2023-12-17 20:18:45 INF redisClusterWriter load cluster nodes. <span class=nv>line</span><span class=o>=</span>caa1fb6b5fbc4e133b5ef472e2def11e836481f7 192.168.1.93:6379@16379 master - <span class=m>0</span> <span class=m>1702815523000</span> <span class=m>3</span> connected 6554-9829
</span></span><span class=line><span class=cl>2023-12-17 20:18:45 INF redisClusterWriter load cluster nodes. <span class=nv>line</span><span class=o>=</span>eaeb50d0d31025f1589b7c8cdc12867f7a474c24 192.168.1.94:6379@16379 master - <span class=m>0</span> <span class=m>1702815522000</span> <span class=m>4</span> connected 9830-13106
</span></span><span class=line><span class=cl>2023-12-17 20:18:45 INF redisClusterWriter connected to redis cluster successful. <span class=nv>addresses</span><span class=o>=[</span>192.168.1.91:6379 192.168.1.98:6379 192.168.1.92:6379 192.168.1.93:6379 192.168.1.94:6379<span class=o>]</span>
</span></span><span class=line><span class=cl>2023-12-17 20:18:45 INF create RedisClusterWriter: 192.168.1.91:6379
</span></span><span class=line><span class=cl>2023-12-17 20:18:45 INF not <span class=nb>set</span> status port
</span></span><span class=line><span class=cl>2023-12-17 20:18:45 INF start syncing...
</span></span><span class=line><span class=cl>2023-12-17 20:18:45 INF <span class=o>[</span>rdb_reader<span class=o>]</span> start <span class=nb>read</span>
</span></span><span class=line><span class=cl>2023-12-17 20:18:50 INF <span class=nv>read_count</span><span class=o>=[</span>301839<span class=o>]</span>, <span class=nv>read_ops</span><span class=o>=[</span>62949.67<span class=o>]</span>, <span class=nv>write_count</span><span class=o>=[</span>301838<span class=o>]</span>, <span class=nv>write_ops</span><span class=o>=[</span>62949.67<span class=o>]</span>, <span class=o>[</span>rdb_reader<span class=o>]</span> rdb file synced: 69.52%
</span></span><span class=line><span class=cl>2023-12-17 20:18:52 INF <span class=o>[</span>rdb_reader<span class=o>]</span> rdb file parse <span class=k>done</span>
</span></span><span class=line><span class=cl>2023-12-17 20:18:52 INF all <span class=k>done</span>
</span></span></code></pre></div><p>檢查一下，恢復數據後，數據分布和集群slot狀況</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=o>[</span>root@redis91 redis-shake<span class=o>]</span><span class=c1># redis-cli --user 帳號 --pass 密碼 --cluster check 192.168.1.91:6379</span>
</span></span><span class=line><span class=cl>Warning: Using a password with <span class=s1>&#39;-a&#39;</span> or <span class=s1>&#39;-u&#39;</span> option on the <span class=nb>command</span> line interface may not be safe.
</span></span><span class=line><span class=cl>192.168.1.91:6379 <span class=o>(</span>2c05c930...<span class=o>)</span> -&gt; <span class=m>327164</span> keys <span class=p>|</span> <span class=m>3277</span> slots <span class=p>|</span> <span class=m>1</span> slaves.
</span></span><span class=line><span class=cl>192.168.1.98:6379 <span class=o>(</span>c40f72b0...<span class=o>)</span> -&gt; <span class=m>0</span> keys <span class=p>|</span> <span class=m>3277</span> slots <span class=p>|</span> <span class=m>1</span> slaves.
</span></span><span class=line><span class=cl>192.168.1.92:6379 <span class=o>(</span>71d88e30...<span class=o>)</span> -&gt; <span class=m>326861</span> keys <span class=p>|</span> <span class=m>3277</span> slots <span class=p>|</span> <span class=m>1</span> slaves.
</span></span><span class=line><span class=cl>192.168.1.93:6379 <span class=o>(</span>caa1fb6b...<span class=o>)</span> -&gt; <span class=m>218263</span> keys <span class=p>|</span> <span class=m>3276</span> slots <span class=p>|</span> <span class=m>1</span> slaves.
</span></span><span class=line><span class=cl>192.168.1.94:6379 <span class=o>(</span>eaeb50d0...<span class=o>)</span> -&gt; <span class=m>0</span> keys <span class=p>|</span> <span class=m>3277</span> slots <span class=p>|</span> <span class=m>1</span> slaves.
</span></span><span class=line><span class=cl><span class=o>[</span>OK<span class=o>]</span> <span class=m>872288</span> keys in <span class=m>5</span> masters.
</span></span><span class=line><span class=cl>53.24 keys per slot on average.
</span></span><span class=line><span class=cl>&gt;&gt;&gt; Performing Cluster Check <span class=o>(</span>using node 192.168.1.91:6379<span class=o>)</span>
</span></span><span class=line><span class=cl>M: 2c05c930c506e54ebea35f8f0b731754cd44082a 192.168.1.91:6379
</span></span><span class=line><span class=cl>   slots:<span class=o>[</span>0-3276<span class=o>]</span> <span class=o>(</span><span class=m>3277</span> slots<span class=o>)</span> master
</span></span><span class=line><span class=cl>   <span class=m>1</span> additional replica<span class=o>(</span>s<span class=o>)</span>
</span></span><span class=line><span class=cl>S: 1709189e2036c2e0c4168189be9074d66bce2991 192.168.1.92:6380
</span></span><span class=line><span class=cl>   slots: <span class=o>(</span><span class=m>0</span> slots<span class=o>)</span> slave
</span></span><span class=line><span class=cl>   replicates 2c05c930c506e54ebea35f8f0b731754cd44082a
</span></span><span class=line><span class=cl>M: c40f72b0ee3ac4be0b9ddaea4d16079f723e13bf 192.168.1.98:6379
</span></span><span class=line><span class=cl>   slots:<span class=o>[</span>13107-16383<span class=o>]</span> <span class=o>(</span><span class=m>3277</span> slots<span class=o>)</span> master
</span></span><span class=line><span class=cl>   <span class=m>1</span> additional replica<span class=o>(</span>s<span class=o>)</span>
</span></span><span class=line><span class=cl>M: 71d88e302c0a7ec240cbbb6f8380786d01da984c 192.168.1.92:6379
</span></span><span class=line><span class=cl>   slots:<span class=o>[</span>3277-6553<span class=o>]</span> <span class=o>(</span><span class=m>3277</span> slots<span class=o>)</span> master
</span></span><span class=line><span class=cl>   <span class=m>1</span> additional replica<span class=o>(</span>s<span class=o>)</span>
</span></span><span class=line><span class=cl>M: caa1fb6b5fbc4e133b5ef472e2def11e836481f7 192.168.1.93:6379
</span></span><span class=line><span class=cl>   slots:<span class=o>[</span>6554-9829<span class=o>]</span> <span class=o>(</span><span class=m>3276</span> slots<span class=o>)</span> master
</span></span><span class=line><span class=cl>   <span class=m>1</span> additional replica<span class=o>(</span>s<span class=o>)</span>
</span></span><span class=line><span class=cl>S: 500ed38b799c6d5ad13483f8e0fee45fc9142d69 192.168.1.94:6380
</span></span><span class=line><span class=cl>   slots: <span class=o>(</span><span class=m>0</span> slots<span class=o>)</span> slave
</span></span><span class=line><span class=cl>   replicates c40f72b0ee3ac4be0b9ddaea4d16079f723e13bf
</span></span><span class=line><span class=cl>S: 533669750790e904050e917657beae942185a407 192.168.1.91:6380
</span></span><span class=line><span class=cl>   slots: <span class=o>(</span><span class=m>0</span> slots<span class=o>)</span> slave
</span></span><span class=line><span class=cl>   replicates caa1fb6b5fbc4e133b5ef472e2def11e836481f7
</span></span><span class=line><span class=cl>S: b0bff6695a1318da9a01af2550c85de1e8e81a83 192.168.1.93:6380
</span></span><span class=line><span class=cl>   slots: <span class=o>(</span><span class=m>0</span> slots<span class=o>)</span> slave
</span></span><span class=line><span class=cl>   replicates 71d88e302c0a7ec240cbbb6f8380786d01da984c
</span></span><span class=line><span class=cl>M: eaeb50d0d31025f1589b7c8cdc12867f7a474c24 192.168.1.94:6379
</span></span><span class=line><span class=cl>   slots:<span class=o>[</span>9830-13106<span class=o>]</span> <span class=o>(</span><span class=m>3277</span> slots<span class=o>)</span> master
</span></span><span class=line><span class=cl>   <span class=m>1</span> additional replica<span class=o>(</span>s<span class=o>)</span>
</span></span><span class=line><span class=cl>S: 2b487243e0c78adb93ac73017d04a6ad39b51c36 192.168.1.98:6380
</span></span><span class=line><span class=cl>   slots: <span class=o>(</span><span class=m>0</span> slots<span class=o>)</span> slave
</span></span><span class=line><span class=cl>   replicates eaeb50d0d31025f1589b7c8cdc12867f7a474c24
</span></span><span class=line><span class=cl><span class=o>[</span>OK<span class=o>]</span> All nodes agree about slots configuration.
</span></span><span class=line><span class=cl>&gt;&gt;&gt; Check <span class=k>for</span> open slots...
</span></span><span class=line><span class=cl>&gt;&gt;&gt; Check slots coverage...
</span></span><span class=line><span class=cl><span class=o>[</span>OK<span class=o>]</span> All <span class=m>16384</span> slots covered.
</span></span></code></pre></div><h3 id=恢復dump-master3rdb數據>恢復dump-master3，rdb數據</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 修改要恢復數據的rdb檔案位置</span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@redis91 redis-shake<span class=o>]</span><span class=c1># vim shake.toml</span>
</span></span><span class=line><span class=cl><span class=o>[</span>rdb_reader<span class=o>]</span>
</span></span><span class=line><span class=cl><span class=nv>filepath</span> <span class=o>=</span> <span class=s2>&#34;/root/redis-shake/dumprdbfile/dump-master3.rdb&#34;</span>
</span></span></code></pre></div><p>開始恢復dump-master3.rdb數據至cluster</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=o>[</span>root@redis91 redis-shake<span class=o>]</span><span class=c1># ./redis-shake shake.toml</span>
</span></span><span class=line><span class=cl>2023-12-17 20:20:39 INF load config from file: shake.toml
</span></span><span class=line><span class=cl>2023-12-17 20:20:39 INF log_level: <span class=o>[</span>info<span class=o>]</span>, log_file: <span class=o>[</span>/root/redis-shake/data/shake.log<span class=o>]</span>
</span></span><span class=line><span class=cl>2023-12-17 20:20:39 INF changed work dir to <span class=o>[</span>/root/redis-shake/data<span class=o>]</span>
</span></span><span class=line><span class=cl>2023-12-17 20:20:39 INF GOMAXPROCS defaults to the value of runtime.NumCPU <span class=o>[</span>8<span class=o>]</span>
</span></span><span class=line><span class=cl>2023-12-17 20:20:39 INF not <span class=nb>set</span> pprof port
</span></span><span class=line><span class=cl>2023-12-17 20:20:39 INF no <span class=k>function</span> script
</span></span><span class=line><span class=cl>2023-12-17 20:20:39 INF create RdbReader: /root/redis-shake/dumprdbfile/dump-master3.rdb
</span></span><span class=line><span class=cl>2023-12-17 20:20:39 INF redisClusterWriter load cluster nodes. <span class=nv>line</span><span class=o>=</span>2c05c930c506e54ebea35f8f0b731754cd44082a 192.168.1.91:6379@16379 myself,master - <span class=m>0</span> <span class=m>1702815636000</span> <span class=m>1</span> connected 0-3276
</span></span><span class=line><span class=cl>2023-12-17 20:20:39 INF redisClusterWriter load cluster nodes. <span class=nv>line</span><span class=o>=</span>c40f72b0ee3ac4be0b9ddaea4d16079f723e13bf 192.168.1.98:6379@16379 master - <span class=m>0</span> <span class=m>1702815635243</span> <span class=m>5</span> connected 13107-16383
</span></span><span class=line><span class=cl>2023-12-17 20:20:39 INF redisClusterWriter load cluster nodes. <span class=nv>line</span><span class=o>=</span>71d88e302c0a7ec240cbbb6f8380786d01da984c 192.168.1.92:6379@16379 master - <span class=m>0</span> <span class=m>1702815636000</span> <span class=m>2</span> connected 3277-6553
</span></span><span class=line><span class=cl>2023-12-17 20:20:39 INF redisClusterWriter load cluster nodes. <span class=nv>line</span><span class=o>=</span>caa1fb6b5fbc4e133b5ef472e2def11e836481f7 192.168.1.93:6379@16379 master - <span class=m>0</span> <span class=m>1702815638000</span> <span class=m>3</span> connected 6554-9829
</span></span><span class=line><span class=cl>2023-12-17 20:20:39 INF redisClusterWriter load cluster nodes. <span class=nv>line</span><span class=o>=</span>eaeb50d0d31025f1589b7c8cdc12867f7a474c24 192.168.1.94:6379@16379 master - <span class=m>0</span> <span class=m>1702815639056</span> <span class=m>4</span> connected 9830-13106
</span></span><span class=line><span class=cl>2023-12-17 20:20:39 INF redisClusterWriter connected to redis cluster successful. <span class=nv>addresses</span><span class=o>=[</span>192.168.1.91:6379 192.168.1.98:6379 192.168.1.92:6379 192.168.1.93:6379 192.168.1.94:6379<span class=o>]</span>
</span></span><span class=line><span class=cl>2023-12-17 20:20:39 INF create RedisClusterWriter: 192.168.1.91:6379
</span></span><span class=line><span class=cl>2023-12-17 20:20:39 INF not <span class=nb>set</span> status port
</span></span><span class=line><span class=cl>2023-12-17 20:20:39 INF start syncing...
</span></span><span class=line><span class=cl>2023-12-17 20:20:39 INF <span class=o>[</span>rdb_reader<span class=o>]</span> start <span class=nb>read</span>
</span></span><span class=line><span class=cl>2023-12-17 20:20:44 INF <span class=nv>read_count</span><span class=o>=[</span>335689<span class=o>]</span>, <span class=nv>read_ops</span><span class=o>=[</span>82529.84<span class=o>]</span>, <span class=nv>write_count</span><span class=o>=[</span>335689<span class=o>]</span>, <span class=nv>write_ops</span><span class=o>=[</span>82529.84<span class=o>]</span>, <span class=o>[</span>rdb_reader<span class=o>]</span> rdb file synced: 57.47%
</span></span><span class=line><span class=cl>2023-12-17 20:20:45 INF <span class=o>[</span>rdb_reader<span class=o>]</span> rdb file parse <span class=k>done</span>
</span></span><span class=line><span class=cl>2023-12-17 20:20:45 INF all <span class=k>done</span>
</span></span></code></pre></div><p>檢查一下，恢復數據後，數據分布和集群slot狀況</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=o>[</span>root@redis91 redis-shake<span class=o>]</span><span class=c1># redis-cli --user 帳號 --pass 密碼 --cluster check 192.168.1.91:6379</span>
</span></span><span class=line><span class=cl>Warning: Using a password with <span class=s1>&#39;-a&#39;</span> or <span class=s1>&#39;-u&#39;</span> option on the <span class=nb>command</span> line interface may not be safe.
</span></span><span class=line><span class=cl>192.168.1.91:6379 <span class=o>(</span>2c05c930...<span class=o>)</span> -&gt; <span class=m>327164</span> keys <span class=p>|</span> <span class=m>3277</span> slots <span class=p>|</span> <span class=m>1</span> slaves.
</span></span><span class=line><span class=cl>192.168.1.98:6379 <span class=o>(</span>c40f72b0...<span class=o>)</span> -&gt; <span class=m>0</span> keys <span class=p>|</span> <span class=m>3277</span> slots <span class=p>|</span> <span class=m>1</span> slaves.
</span></span><span class=line><span class=cl>192.168.1.92:6379 <span class=o>(</span>71d88e30...<span class=o>)</span> -&gt; <span class=m>326860</span> keys <span class=p>|</span> <span class=m>3277</span> slots <span class=p>|</span> <span class=m>1</span> slaves.
</span></span><span class=line><span class=cl>192.168.1.93:6379 <span class=o>(</span>caa1fb6b...<span class=o>)</span> -&gt; <span class=m>327959</span> keys <span class=p>|</span> <span class=m>3276</span> slots <span class=p>|</span> <span class=m>1</span> slaves.
</span></span><span class=line><span class=cl>192.168.1.94:6379 <span class=o>(</span>eaeb50d0...<span class=o>)</span> -&gt; <span class=m>327538</span> keys <span class=p>|</span> <span class=m>3277</span> slots <span class=p>|</span> <span class=m>1</span> slaves.
</span></span><span class=line><span class=cl><span class=o>[</span>OK<span class=o>]</span> <span class=m>1309521</span> keys in <span class=m>5</span> masters.
</span></span><span class=line><span class=cl>79.93 keys per slot on average.
</span></span><span class=line><span class=cl>&gt;&gt;&gt; Performing Cluster Check <span class=o>(</span>using node 192.168.1.91:6379<span class=o>)</span>
</span></span><span class=line><span class=cl>M: 2c05c930c506e54ebea35f8f0b731754cd44082a 192.168.1.91:6379
</span></span><span class=line><span class=cl>   slots:<span class=o>[</span>0-3276<span class=o>]</span> <span class=o>(</span><span class=m>3277</span> slots<span class=o>)</span> master
</span></span><span class=line><span class=cl>   <span class=m>1</span> additional replica<span class=o>(</span>s<span class=o>)</span>
</span></span><span class=line><span class=cl>S: 1709189e2036c2e0c4168189be9074d66bce2991 192.168.1.92:6380
</span></span><span class=line><span class=cl>   slots: <span class=o>(</span><span class=m>0</span> slots<span class=o>)</span> slave
</span></span><span class=line><span class=cl>   replicates 2c05c930c506e54ebea35f8f0b731754cd44082a
</span></span><span class=line><span class=cl>M: c40f72b0ee3ac4be0b9ddaea4d16079f723e13bf 192.168.1.98:6379
</span></span><span class=line><span class=cl>   slots:<span class=o>[</span>13107-16383<span class=o>]</span> <span class=o>(</span><span class=m>3277</span> slots<span class=o>)</span> master
</span></span><span class=line><span class=cl>   <span class=m>1</span> additional replica<span class=o>(</span>s<span class=o>)</span>
</span></span><span class=line><span class=cl>M: 71d88e302c0a7ec240cbbb6f8380786d01da984c 192.168.1.92:6379
</span></span><span class=line><span class=cl>   slots:<span class=o>[</span>3277-6553<span class=o>]</span> <span class=o>(</span><span class=m>3277</span> slots<span class=o>)</span> master
</span></span><span class=line><span class=cl>   <span class=m>1</span> additional replica<span class=o>(</span>s<span class=o>)</span>
</span></span><span class=line><span class=cl>M: caa1fb6b5fbc4e133b5ef472e2def11e836481f7 192.168.1.93:6379
</span></span><span class=line><span class=cl>   slots:<span class=o>[</span>6554-9829<span class=o>]</span> <span class=o>(</span><span class=m>3276</span> slots<span class=o>)</span> master
</span></span><span class=line><span class=cl>   <span class=m>1</span> additional replica<span class=o>(</span>s<span class=o>)</span>
</span></span><span class=line><span class=cl>S: 500ed38b799c6d5ad13483f8e0fee45fc9142d69 192.168.1.94:6380
</span></span><span class=line><span class=cl>   slots: <span class=o>(</span><span class=m>0</span> slots<span class=o>)</span> slave
</span></span><span class=line><span class=cl>   replicates c40f72b0ee3ac4be0b9ddaea4d16079f723e13bf
</span></span><span class=line><span class=cl>S: 533669750790e904050e917657beae942185a407 192.168.1.91:6380
</span></span><span class=line><span class=cl>   slots: <span class=o>(</span><span class=m>0</span> slots<span class=o>)</span> slave
</span></span><span class=line><span class=cl>   replicates caa1fb6b5fbc4e133b5ef472e2def11e836481f7
</span></span><span class=line><span class=cl>S: b0bff6695a1318da9a01af2550c85de1e8e81a83 192.168.1.93:6380
</span></span><span class=line><span class=cl>   slots: <span class=o>(</span><span class=m>0</span> slots<span class=o>)</span> slave
</span></span><span class=line><span class=cl>   replicates 71d88e302c0a7ec240cbbb6f8380786d01da984c
</span></span><span class=line><span class=cl>M: eaeb50d0d31025f1589b7c8cdc12867f7a474c24 192.168.1.94:6379
</span></span><span class=line><span class=cl>   slots:<span class=o>[</span>9830-13106<span class=o>]</span> <span class=o>(</span><span class=m>3277</span> slots<span class=o>)</span> master
</span></span><span class=line><span class=cl>   <span class=m>1</span> additional replica<span class=o>(</span>s<span class=o>)</span>
</span></span><span class=line><span class=cl>S: 2b487243e0c78adb93ac73017d04a6ad39b51c36 192.168.1.98:6380
</span></span><span class=line><span class=cl>   slots: <span class=o>(</span><span class=m>0</span> slots<span class=o>)</span> slave
</span></span><span class=line><span class=cl>   replicates eaeb50d0d31025f1589b7c8cdc12867f7a474c24
</span></span><span class=line><span class=cl><span class=o>[</span>OK<span class=o>]</span> All nodes agree about slots configuration.
</span></span><span class=line><span class=cl>&gt;&gt;&gt; Check <span class=k>for</span> open slots...
</span></span><span class=line><span class=cl>&gt;&gt;&gt; Check slots coverage...
</span></span><span class=line><span class=cl><span class=o>[</span>OK<span class=o>]</span> All <span class=m>16384</span> slots covered.
</span></span></code></pre></div><h3 id=恢復dump-master4rdb數據>恢復dump-master4，rdb數據</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 修改要恢復數據的rdb檔案位置</span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@redis91 redis-shake<span class=o>]</span><span class=c1># vim shake.toml</span>
</span></span><span class=line><span class=cl><span class=o>[</span>rdb_reader<span class=o>]</span>
</span></span><span class=line><span class=cl><span class=nv>filepath</span> <span class=o>=</span> <span class=s2>&#34;/root/redis-shake/dumprdbfile/dump-master4.rdb&#34;</span>
</span></span></code></pre></div><p>開始恢復dump-master4.rdb數據至cluster</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=o>[</span>root@redis91 redis-shake<span class=o>]</span><span class=c1># ./redis-shake shake.toml</span>
</span></span><span class=line><span class=cl>2023-12-17 20:21:39 INF load config from file: shake.toml
</span></span><span class=line><span class=cl>2023-12-17 20:21:39 INF log_level: <span class=o>[</span>info<span class=o>]</span>, log_file: <span class=o>[</span>/root/redis-shake/data/shake.log<span class=o>]</span>
</span></span><span class=line><span class=cl>2023-12-17 20:21:39 INF changed work dir to <span class=o>[</span>/root/redis-shake/data<span class=o>]</span>
</span></span><span class=line><span class=cl>2023-12-17 20:21:39 INF GOMAXPROCS defaults to the value of runtime.NumCPU <span class=o>[</span>8<span class=o>]</span>
</span></span><span class=line><span class=cl>2023-12-17 20:21:39 INF not <span class=nb>set</span> pprof port
</span></span><span class=line><span class=cl>2023-12-17 20:21:39 INF no <span class=k>function</span> script
</span></span><span class=line><span class=cl>2023-12-17 20:21:39 INF create RdbReader: /root/redis-shake/dumprdbfile/dump-master4.rdb
</span></span><span class=line><span class=cl>2023-12-17 20:21:39 INF redisClusterWriter load cluster nodes. <span class=nv>line</span><span class=o>=</span>2c05c930c506e54ebea35f8f0b731754cd44082a 192.168.1.91:6379@16379 myself,master - <span class=m>0</span> <span class=m>1702815696000</span> <span class=m>1</span> connected 0-3276
</span></span><span class=line><span class=cl>2023-12-17 20:21:39 INF redisClusterWriter load cluster nodes. <span class=nv>line</span><span class=o>=</span>c40f72b0ee3ac4be0b9ddaea4d16079f723e13bf 192.168.1.98:6379@16379 master - <span class=m>0</span> <span class=m>1702815695487</span> <span class=m>5</span> connected 13107-16383
</span></span><span class=line><span class=cl>2023-12-17 20:21:39 INF redisClusterWriter load cluster nodes. <span class=nv>line</span><span class=o>=</span>71d88e302c0a7ec240cbbb6f8380786d01da984c 192.168.1.92:6379@16379 master - <span class=m>0</span> <span class=m>1702815699501</span> <span class=m>2</span> connected 3277-6553
</span></span><span class=line><span class=cl>2023-12-17 20:21:39 INF redisClusterWriter load cluster nodes. <span class=nv>line</span><span class=o>=</span>caa1fb6b5fbc4e133b5ef472e2def11e836481f7 192.168.1.93:6379@16379 master - <span class=m>0</span> <span class=m>1702815695000</span> <span class=m>3</span> connected 6554-9829
</span></span><span class=line><span class=cl>2023-12-17 20:21:39 INF redisClusterWriter load cluster nodes. <span class=nv>line</span><span class=o>=</span>eaeb50d0d31025f1589b7c8cdc12867f7a474c24 192.168.1.94:6379@16379 master - <span class=m>0</span> <span class=m>1702815697000</span> <span class=m>4</span> connected 9830-13106
</span></span><span class=line><span class=cl>2023-12-17 20:21:39 INF redisClusterWriter connected to redis cluster successful. <span class=nv>addresses</span><span class=o>=[</span>192.168.1.91:6379 192.168.1.98:6379 192.168.1.92:6379 192.168.1.93:6379 192.168.1.94:6379<span class=o>]</span>
</span></span><span class=line><span class=cl>2023-12-17 20:21:39 INF create RedisClusterWriter: 192.168.1.91:6379
</span></span><span class=line><span class=cl>2023-12-17 20:21:39 INF not <span class=nb>set</span> status port
</span></span><span class=line><span class=cl>2023-12-17 20:21:39 INF start syncing...
</span></span><span class=line><span class=cl>2023-12-17 20:21:39 INF <span class=o>[</span>rdb_reader<span class=o>]</span> start <span class=nb>read</span>
</span></span><span class=line><span class=cl>2023-12-17 20:21:44 INF <span class=nv>read_count</span><span class=o>=[</span>219205<span class=o>]</span>, <span class=nv>read_ops</span><span class=o>=[</span>48733.57<span class=o>]</span>, <span class=nv>write_count</span><span class=o>=[</span>219204<span class=o>]</span>, <span class=nv>write_ops</span><span class=o>=[</span>48733.57<span class=o>]</span>, <span class=o>[</span>rdb_reader<span class=o>]</span> rdb file synced: 53.23%
</span></span><span class=line><span class=cl>2023-12-17 20:21:48 INF <span class=o>[</span>rdb_reader<span class=o>]</span> rdb file parse <span class=k>done</span>
</span></span><span class=line><span class=cl>2023-12-17 20:21:48 INF all <span class=k>done</span>
</span></span></code></pre></div><p>檢查一下，恢復數據後，數據分布和集群slot狀況</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=o>[</span>root@redis91 redis-shake<span class=o>]</span><span class=c1># redis-cli --user 帳號 --pass 密碼 --cluster check 192.168.1.91:6379</span>
</span></span><span class=line><span class=cl>Warning: Using a password with <span class=s1>&#39;-a&#39;</span> or <span class=s1>&#39;-u&#39;</span> option on the <span class=nb>command</span> line interface may not be safe.
</span></span><span class=line><span class=cl>192.168.1.91:6379 <span class=o>(</span>2c05c930...<span class=o>)</span> -&gt; <span class=m>437387</span> keys <span class=p>|</span> <span class=m>3277</span> slots <span class=p>|</span> <span class=m>1</span> slaves.
</span></span><span class=line><span class=cl>192.168.1.98:6379 <span class=o>(</span>c40f72b0...<span class=o>)</span> -&gt; <span class=m>149</span> keys <span class=p>|</span> <span class=m>3277</span> slots <span class=p>|</span> <span class=m>1</span> slaves.
</span></span><span class=line><span class=cl>192.168.1.92:6379 <span class=o>(</span>71d88e30...<span class=o>)</span> -&gt; <span class=m>437074</span> keys <span class=p>|</span> <span class=m>3277</span> slots <span class=p>|</span> <span class=m>1</span> slaves.
</span></span><span class=line><span class=cl>192.168.1.93:6379 <span class=o>(</span>caa1fb6b...<span class=o>)</span> -&gt; <span class=m>437832</span> keys <span class=p>|</span> <span class=m>3276</span> slots <span class=p>|</span> <span class=m>1</span> slaves.
</span></span><span class=line><span class=cl>192.168.1.94:6379 <span class=o>(</span>eaeb50d0...<span class=o>)</span> -&gt; <span class=m>437593</span> keys <span class=p>|</span> <span class=m>3277</span> slots <span class=p>|</span> <span class=m>1</span> slaves.
</span></span><span class=line><span class=cl><span class=o>[</span>OK<span class=o>]</span> <span class=m>1750035</span> keys in <span class=m>5</span> masters.
</span></span><span class=line><span class=cl>106.81 keys per slot on average.
</span></span><span class=line><span class=cl>&gt;&gt;&gt; Performing Cluster Check <span class=o>(</span>using node 192.168.1.91:6379<span class=o>)</span>
</span></span><span class=line><span class=cl>M: 2c05c930c506e54ebea35f8f0b731754cd44082a 192.168.1.91:6379
</span></span><span class=line><span class=cl>   slots:<span class=o>[</span>0-3276<span class=o>]</span> <span class=o>(</span><span class=m>3277</span> slots<span class=o>)</span> master
</span></span><span class=line><span class=cl>   <span class=m>1</span> additional replica<span class=o>(</span>s<span class=o>)</span>
</span></span><span class=line><span class=cl>S: 1709189e2036c2e0c4168189be9074d66bce2991 192.168.1.92:6380
</span></span><span class=line><span class=cl>   slots: <span class=o>(</span><span class=m>0</span> slots<span class=o>)</span> slave
</span></span><span class=line><span class=cl>   replicates 2c05c930c506e54ebea35f8f0b731754cd44082a
</span></span><span class=line><span class=cl>M: c40f72b0ee3ac4be0b9ddaea4d16079f723e13bf 192.168.1.98:6379
</span></span><span class=line><span class=cl>   slots:<span class=o>[</span>13107-16383<span class=o>]</span> <span class=o>(</span><span class=m>3277</span> slots<span class=o>)</span> master
</span></span><span class=line><span class=cl>   <span class=m>1</span> additional replica<span class=o>(</span>s<span class=o>)</span>
</span></span><span class=line><span class=cl>M: 71d88e302c0a7ec240cbbb6f8380786d01da984c 192.168.1.92:6379
</span></span><span class=line><span class=cl>   slots:<span class=o>[</span>3277-6553<span class=o>]</span> <span class=o>(</span><span class=m>3277</span> slots<span class=o>)</span> master
</span></span><span class=line><span class=cl>   <span class=m>1</span> additional replica<span class=o>(</span>s<span class=o>)</span>
</span></span><span class=line><span class=cl>M: caa1fb6b5fbc4e133b5ef472e2def11e836481f7 192.168.1.93:6379
</span></span><span class=line><span class=cl>   slots:<span class=o>[</span>6554-9829<span class=o>]</span> <span class=o>(</span><span class=m>3276</span> slots<span class=o>)</span> master
</span></span><span class=line><span class=cl>   <span class=m>1</span> additional replica<span class=o>(</span>s<span class=o>)</span>
</span></span><span class=line><span class=cl>S: 500ed38b799c6d5ad13483f8e0fee45fc9142d69 192.168.1.94:6380
</span></span><span class=line><span class=cl>   slots: <span class=o>(</span><span class=m>0</span> slots<span class=o>)</span> slave
</span></span><span class=line><span class=cl>   replicates c40f72b0ee3ac4be0b9ddaea4d16079f723e13bf
</span></span><span class=line><span class=cl>S: 533669750790e904050e917657beae942185a407 192.168.1.91:6380
</span></span><span class=line><span class=cl>   slots: <span class=o>(</span><span class=m>0</span> slots<span class=o>)</span> slave
</span></span><span class=line><span class=cl>   replicates caa1fb6b5fbc4e133b5ef472e2def11e836481f7
</span></span><span class=line><span class=cl>S: b0bff6695a1318da9a01af2550c85de1e8e81a83 192.168.1.93:6380
</span></span><span class=line><span class=cl>   slots: <span class=o>(</span><span class=m>0</span> slots<span class=o>)</span> slave
</span></span><span class=line><span class=cl>   replicates 71d88e302c0a7ec240cbbb6f8380786d01da984c
</span></span><span class=line><span class=cl>M: eaeb50d0d31025f1589b7c8cdc12867f7a474c24 192.168.1.94:6379
</span></span><span class=line><span class=cl>   slots:<span class=o>[</span>9830-13106<span class=o>]</span> <span class=o>(</span><span class=m>3277</span> slots<span class=o>)</span> master
</span></span><span class=line><span class=cl>   <span class=m>1</span> additional replica<span class=o>(</span>s<span class=o>)</span>
</span></span><span class=line><span class=cl>S: 2b487243e0c78adb93ac73017d04a6ad39b51c36 192.168.1.98:6380
</span></span><span class=line><span class=cl>   slots: <span class=o>(</span><span class=m>0</span> slots<span class=o>)</span> slave
</span></span><span class=line><span class=cl>   replicates eaeb50d0d31025f1589b7c8cdc12867f7a474c24
</span></span><span class=line><span class=cl><span class=o>[</span>OK<span class=o>]</span> All nodes agree about slots configuration.
</span></span><span class=line><span class=cl>&gt;&gt;&gt; Check <span class=k>for</span> open slots...
</span></span><span class=line><span class=cl>&gt;&gt;&gt; Check slots coverage...
</span></span><span class=line><span class=cl><span class=o>[</span>OK<span class=o>]</span> All <span class=m>16384</span> slots covered.
</span></span></code></pre></div><h3 id=恢復dump-master5rdb數據>恢復dump-master5，rdb數據</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=c1># 修改要恢復數據的rdb檔案位置</span>
</span></span><span class=line><span class=cl><span class=o>[</span>root@redis91 redis-shake<span class=o>]</span><span class=c1># vim shake.toml</span>
</span></span><span class=line><span class=cl><span class=o>[</span>rdb_reader<span class=o>]</span>
</span></span><span class=line><span class=cl><span class=nv>filepath</span> <span class=o>=</span> <span class=s2>&#34;/root/redis-shake/dumprdbfile/dump-master5.rdb&#34;</span>
</span></span></code></pre></div><p>開始恢復dump-master5.rdb數據至cluster</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=o>[</span>root@redis91 redis-shake<span class=o>]</span><span class=c1># ./redis-shake shake.toml</span>
</span></span><span class=line><span class=cl>2023-12-17 20:23:23 INF load config from file: shake.toml
</span></span><span class=line><span class=cl>2023-12-17 20:23:23 INF log_level: <span class=o>[</span>info<span class=o>]</span>, log_file: <span class=o>[</span>/root/redis-shake/data/shake.log<span class=o>]</span>
</span></span><span class=line><span class=cl>2023-12-17 20:23:23 INF changed work dir to <span class=o>[</span>/root/redis-shake/data<span class=o>]</span>
</span></span><span class=line><span class=cl>2023-12-17 20:23:23 INF GOMAXPROCS defaults to the value of runtime.NumCPU <span class=o>[</span>8<span class=o>]</span>
</span></span><span class=line><span class=cl>2023-12-17 20:23:23 INF not <span class=nb>set</span> pprof port
</span></span><span class=line><span class=cl>2023-12-17 20:23:23 INF no <span class=k>function</span> script
</span></span><span class=line><span class=cl>2023-12-17 20:23:23 INF create RdbReader: /root/redis-shake/dumprdbfile/dump-master5.rdb
</span></span><span class=line><span class=cl>2023-12-17 20:23:23 INF redisClusterWriter load cluster nodes. <span class=nv>line</span><span class=o>=</span>2c05c930c506e54ebea35f8f0b731754cd44082a 192.168.1.91:6379@16379 myself,master - <span class=m>0</span> <span class=m>1702815801000</span> <span class=m>1</span> connected 0-3276
</span></span><span class=line><span class=cl>2023-12-17 20:23:23 INF redisClusterWriter load cluster nodes. <span class=nv>line</span><span class=o>=</span>c40f72b0ee3ac4be0b9ddaea4d16079f723e13bf 192.168.1.98:6379@16379 master - <span class=m>0</span> <span class=m>1702815800000</span> <span class=m>5</span> connected 13107-16383
</span></span><span class=line><span class=cl>2023-12-17 20:23:23 INF redisClusterWriter load cluster nodes. <span class=nv>line</span><span class=o>=</span>71d88e302c0a7ec240cbbb6f8380786d01da984c 192.168.1.92:6379@16379 master - <span class=m>0</span> <span class=m>1702815799000</span> <span class=m>2</span> connected 3277-6553
</span></span><span class=line><span class=cl>2023-12-17 20:23:23 INF redisClusterWriter load cluster nodes. <span class=nv>line</span><span class=o>=</span>caa1fb6b5fbc4e133b5ef472e2def11e836481f7 192.168.1.93:6379@16379 master - <span class=m>0</span> <span class=m>1702815801921</span> <span class=m>3</span> connected 6554-9829
</span></span><span class=line><span class=cl>2023-12-17 20:23:23 INF redisClusterWriter load cluster nodes. <span class=nv>line</span><span class=o>=</span>eaeb50d0d31025f1589b7c8cdc12867f7a474c24 192.168.1.94:6379@16379 master - <span class=m>0</span> <span class=m>1702815800000</span> <span class=m>4</span> connected 9830-13106
</span></span><span class=line><span class=cl>2023-12-17 20:23:23 INF redisClusterWriter connected to redis cluster successful. <span class=nv>addresses</span><span class=o>=[</span>192.168.1.91:6379 192.168.1.98:6379 192.168.1.92:6379 192.168.1.93:6379 192.168.1.94:6379<span class=o>]</span>
</span></span><span class=line><span class=cl>2023-12-17 20:23:23 INF create RedisClusterWriter: 192.168.1.91:6379
</span></span><span class=line><span class=cl>2023-12-17 20:23:23 INF not <span class=nb>set</span> status port
</span></span><span class=line><span class=cl>2023-12-17 20:23:23 INF start syncing...
</span></span><span class=line><span class=cl>2023-12-17 20:23:23 INF <span class=o>[</span>rdb_reader<span class=o>]</span> start <span class=nb>read</span>
</span></span><span class=line><span class=cl>2023-12-17 20:23:28 INF <span class=nv>read_count</span><span class=o>=[</span>318286<span class=o>]</span>, <span class=nv>read_ops</span><span class=o>=[</span>61021.11<span class=o>]</span>, <span class=nv>write_count</span><span class=o>=[</span>318285<span class=o>]</span>, <span class=nv>write_ops</span><span class=o>=[</span>61021.11<span class=o>]</span>, <span class=o>[</span>rdb_reader<span class=o>]</span> rdb file synced: 59.98%
</span></span><span class=line><span class=cl>2023-12-17 20:23:30 INF <span class=o>[</span>rdb_reader<span class=o>]</span> rdb file parse <span class=k>done</span>
</span></span><span class=line><span class=cl>2023-12-17 20:23:30 INF all <span class=k>done</span>
</span></span></code></pre></div><p>檢查一下，恢復數據後，數據分布和集群slot狀況</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=o>[</span>root@redis91 redis-shake<span class=o>]</span><span class=c1># redis-cli --user 帳號 --pass 密碼 --cluster check 192.168.1.91:6379</span>
</span></span><span class=line><span class=cl>Warning: Using a password with <span class=s1>&#39;-a&#39;</span> or <span class=s1>&#39;-u&#39;</span> option on the <span class=nb>command</span> line interface may not be safe.
</span></span><span class=line><span class=cl>192.168.1.91:6379 <span class=o>(</span>2c05c930...<span class=o>)</span> -&gt; <span class=m>436710</span> keys <span class=p>|</span> <span class=m>3277</span> slots <span class=p>|</span> <span class=m>1</span> slaves.
</span></span><span class=line><span class=cl>192.168.1.98:6379 <span class=o>(</span>c40f72b0...<span class=o>)</span> -&gt; <span class=m>437406</span> keys <span class=p>|</span> <span class=m>3277</span> slots <span class=p>|</span> <span class=m>1</span> slaves.
</span></span><span class=line><span class=cl>192.168.1.92:6379 <span class=o>(</span>71d88e30...<span class=o>)</span> -&gt; <span class=m>436424</span> keys <span class=p>|</span> <span class=m>3277</span> slots <span class=p>|</span> <span class=m>1</span> slaves.
</span></span><span class=line><span class=cl>192.168.1.93:6379 <span class=o>(</span>caa1fb6b...<span class=o>)</span> -&gt; <span class=m>437055</span> keys <span class=p>|</span> <span class=m>3276</span> slots <span class=p>|</span> <span class=m>1</span> slaves.
</span></span><span class=line><span class=cl>192.168.1.94:6379 <span class=o>(</span>eaeb50d0...<span class=o>)</span> -&gt; <span class=m>436830</span> keys <span class=p>|</span> <span class=m>3277</span> slots <span class=p>|</span> <span class=m>1</span> slaves.
</span></span><span class=line><span class=cl><span class=o>[</span>OK<span class=o>]</span> <span class=m>2184425</span> keys in <span class=m>5</span> masters.
</span></span><span class=line><span class=cl>133.33 keys per slot on average.
</span></span><span class=line><span class=cl>&gt;&gt;&gt; Performing Cluster Check <span class=o>(</span>using node 192.168.1.91:6379<span class=o>)</span>
</span></span><span class=line><span class=cl>M: 2c05c930c506e54ebea35f8f0b731754cd44082a 192.168.1.91:6379
</span></span><span class=line><span class=cl>   slots:<span class=o>[</span>0-3276<span class=o>]</span> <span class=o>(</span><span class=m>3277</span> slots<span class=o>)</span> master
</span></span><span class=line><span class=cl>   <span class=m>1</span> additional replica<span class=o>(</span>s<span class=o>)</span>
</span></span><span class=line><span class=cl>S: 1709189e2036c2e0c4168189be9074d66bce2991 192.168.1.92:6380
</span></span><span class=line><span class=cl>   slots: <span class=o>(</span><span class=m>0</span> slots<span class=o>)</span> slave
</span></span><span class=line><span class=cl>   replicates 2c05c930c506e54ebea35f8f0b731754cd44082a
</span></span><span class=line><span class=cl>M: c40f72b0ee3ac4be0b9ddaea4d16079f723e13bf 192.168.1.98:6379
</span></span><span class=line><span class=cl>   slots:<span class=o>[</span>13107-16383<span class=o>]</span> <span class=o>(</span><span class=m>3277</span> slots<span class=o>)</span> master
</span></span><span class=line><span class=cl>   <span class=m>1</span> additional replica<span class=o>(</span>s<span class=o>)</span>
</span></span><span class=line><span class=cl>M: 71d88e302c0a7ec240cbbb6f8380786d01da984c 192.168.1.92:6379
</span></span><span class=line><span class=cl>   slots:<span class=o>[</span>3277-6553<span class=o>]</span> <span class=o>(</span><span class=m>3277</span> slots<span class=o>)</span> master
</span></span><span class=line><span class=cl>   <span class=m>1</span> additional replica<span class=o>(</span>s<span class=o>)</span>
</span></span><span class=line><span class=cl>M: caa1fb6b5fbc4e133b5ef472e2def11e836481f7 192.168.1.93:6379
</span></span><span class=line><span class=cl>   slots:<span class=o>[</span>6554-9829<span class=o>]</span> <span class=o>(</span><span class=m>3276</span> slots<span class=o>)</span> master
</span></span><span class=line><span class=cl>   <span class=m>1</span> additional replica<span class=o>(</span>s<span class=o>)</span>
</span></span><span class=line><span class=cl>S: 500ed38b799c6d5ad13483f8e0fee45fc9142d69 192.168.1.94:6380
</span></span><span class=line><span class=cl>   slots: <span class=o>(</span><span class=m>0</span> slots<span class=o>)</span> slave
</span></span><span class=line><span class=cl>   replicates c40f72b0ee3ac4be0b9ddaea4d16079f723e13bf
</span></span><span class=line><span class=cl>S: 533669750790e904050e917657beae942185a407 192.168.1.91:6380
</span></span><span class=line><span class=cl>   slots: <span class=o>(</span><span class=m>0</span> slots<span class=o>)</span> slave
</span></span><span class=line><span class=cl>   replicates caa1fb6b5fbc4e133b5ef472e2def11e836481f7
</span></span><span class=line><span class=cl>S: b0bff6695a1318da9a01af2550c85de1e8e81a83 192.168.1.93:6380
</span></span><span class=line><span class=cl>   slots: <span class=o>(</span><span class=m>0</span> slots<span class=o>)</span> slave
</span></span><span class=line><span class=cl>   replicates 71d88e302c0a7ec240cbbb6f8380786d01da984c
</span></span><span class=line><span class=cl>M: eaeb50d0d31025f1589b7c8cdc12867f7a474c24 192.168.1.94:6379
</span></span><span class=line><span class=cl>   slots:<span class=o>[</span>9830-13106<span class=o>]</span> <span class=o>(</span><span class=m>3277</span> slots<span class=o>)</span> master
</span></span><span class=line><span class=cl>   <span class=m>1</span> additional replica<span class=o>(</span>s<span class=o>)</span>
</span></span><span class=line><span class=cl>S: 2b487243e0c78adb93ac73017d04a6ad39b51c36 192.168.1.98:6380
</span></span><span class=line><span class=cl>   slots: <span class=o>(</span><span class=m>0</span> slots<span class=o>)</span> slave
</span></span><span class=line><span class=cl>   replicates eaeb50d0d31025f1589b7c8cdc12867f7a474c24
</span></span><span class=line><span class=cl><span class=o>[</span>OK<span class=o>]</span> All nodes agree about slots configuration.
</span></span><span class=line><span class=cl>&gt;&gt;&gt; Check <span class=k>for</span> open slots...
</span></span><span class=line><span class=cl>&gt;&gt;&gt; Check slots coverage...
</span></span><span class=line><span class=cl><span class=o>[</span>OK<span class=o>]</span> All <span class=m>16384</span> slots covered.
</span></span></code></pre></div><h2 id=分析數據>分析數據</h2><p><img src=/2023/redis-cluster-database-transfer-with-redis-shake/media/Pasted-image-20231217202511.png width=1221 height=811 srcset="/2023/redis-cluster-database-transfer-with-redis-shake/media/Pasted-image-20231217202511_hubbad321770ed9063655dbcc7392e6aef_147929_480x0_resize_box_3.png 480w, /2023/redis-cluster-database-transfer-with-redis-shake/media/Pasted-image-20231217202511_hubbad321770ed9063655dbcc7392e6aef_147929_1024x0_resize_box_3.png 1024w" loading=lazy class=gallery-image data-flex-grow=150 data-flex-basis=361px></p><p><img src=/2023/redis-cluster-database-transfer-with-redis-shake/media/Pasted-image-20231217203437.png width=1661 height=832 srcset="/2023/redis-cluster-database-transfer-with-redis-shake/media/Pasted-image-20231217203437_hu91070495c515dc52476009876a80df1b_116118_480x0_resize_box_3.png 480w, /2023/redis-cluster-database-transfer-with-redis-shake/media/Pasted-image-20231217203437_hu91070495c515dc52476009876a80df1b_116118_1024x0_resize_box_3.png 1024w" loading=lazy class=gallery-image data-flex-grow=199 data-flex-basis=479px></p><p><img src=/2023/redis-cluster-database-transfer-with-redis-shake/media/Pasted-image-20231217203507.png width=1681 height=902 srcset="/2023/redis-cluster-database-transfer-with-redis-shake/media/Pasted-image-20231217203507_huc302e745bb689e5d0fc211bec2dadd78_265363_480x0_resize_box_3.png 480w, /2023/redis-cluster-database-transfer-with-redis-shake/media/Pasted-image-20231217203507_huc302e745bb689e5d0fc211bec2dadd78_265363_1024x0_resize_box_3.png 1024w" loading=lazy class=gallery-image data-flex-grow=186 data-flex-basis=447px></p><p>以下是將RBD檔案複製到REDIS目錄，一台一台REDIS服務重啟，慢慢導入RBD數據的效果</p><p><img src=/2023/redis-cluster-database-transfer-with-redis-shake/media/Pasted-image-20231217180124.png width=1677 height=807 srcset="/2023/redis-cluster-database-transfer-with-redis-shake/media/Pasted-image-20231217180124_hu8fe506ee02ff998d1d1e8dc4d146a970_106504_480x0_resize_box_3.png 480w, /2023/redis-cluster-database-transfer-with-redis-shake/media/Pasted-image-20231217180124_hu8fe506ee02ff998d1d1e8dc4d146a970_106504_1024x0_resize_box_3.png 1024w" loading=lazy class=gallery-image data-flex-grow=207 data-flex-basis=498px></p><p><img src=/2023/redis-cluster-database-transfer-with-redis-shake/media/Pasted-image-20231217180139.png width=1676 height=909 srcset="/2023/redis-cluster-database-transfer-with-redis-shake/media/Pasted-image-20231217180139_hucd14407a271551d597e0c9776110b94b_261103_480x0_resize_box_3.png 480w, /2023/redis-cluster-database-transfer-with-redis-shake/media/Pasted-image-20231217180139_hucd14407a271551d597e0c9776110b94b_261103_1024x0_resize_box_3.png 1024w" loading=lazy class=gallery-image data-flex-grow=184 data-flex-basis=442px></p><p>看起來效果是一樣，但是使用Redis-Shake，有幾個好處：</p><ol><li>Redis服務不用重啟，線上恢復數據</li><li>Redis slot不會有異常分配狀況，還要使用&ndash;cluster fix的狀況發生</li><li>恢復數據非常快，一個dump恢復大約5秒完成</li></ol><h2 id=測試數據是否正確>測試數據，是否正確</h2><p>來查查看數據，是不是跟之前使用重啟Redis服務恢復數據時，得到的一樣</p><p>以下是使用重啟Redis服務恢復數據時，查到的key和value</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=o>[</span>root@redis01 redis<span class=o>]</span><span class=c1># redis-cli --user 帳號 --pass 密碼 -c</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 查看key type，此key剛好就在redis01主機上，所以執行直接顯示type</span>
</span></span><span class=line><span class=cl>127.0.0.1:6379&gt; <span class=nb>type</span> spring:session:index:org.springframework.session.FindByIndexNameSessionRepository.PRINCIPAL_NAME_INDEX_NAME:362C74F290B63E5F751DCF1E49EC34BEAF6822F0
</span></span><span class=line><span class=cl><span class=nb>set</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 查看key type，此key在redis02主機上，會Redirected到此key所在slot主機上，再顯示type</span>
</span></span><span class=line><span class=cl>127.0.0.1:6379&gt; <span class=nb>type</span> DRM01001000347201
</span></span><span class=line><span class=cl>-&gt; Redirected to slot <span class=o>[</span>5914<span class=o>]</span> located at 192.168.1.12:6379
</span></span><span class=line><span class=cl><span class=nb>hash</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 查看key type，此key在redis03主機上，會Redirected到此key所在slot主機上，再顯示type</span>
</span></span><span class=line><span class=cl>192.168.1.12:6379&gt; <span class=nb>type</span> spring:session:index:org.springframework.session.FindByIndexNameSessionRepository.PRINCIPAL_NAME_INDEX_NAME:EBB87CF1F764E6BACCC709323FE1457065B0CC8E
</span></span><span class=line><span class=cl>-&gt; Redirected to slot <span class=o>[</span>10759<span class=o>]</span> located at 192.168.1.13:6379
</span></span><span class=line><span class=cl><span class=nb>set</span>
</span></span><span class=line><span class=cl>192.168.1.13:6379&gt; SMEMBERS spring:session:index:org.springframework.session.FindByIndexNameSessionRepository.PRINCIPAL_NAME_INDEX_NAME:EBB87CF1F764E6BACCC709323FE1457065B0CC8E
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>1<span class=o>)</span> <span class=s2>&#34;\xac\xed\x00\x05t\x00</span><span class=nv>$aef3b17d</span><span class=s2>-ed6f-4c4e-9cc3-ef69eda6f33c&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 查看key type，此key在redis04主機上，會Redirected到此key所在slot主機上，再顯示type</span>
</span></span><span class=line><span class=cl>192.168.1.13:6379&gt; <span class=nb>type</span> TON01001010231201
</span></span><span class=line><span class=cl>-&gt; Redirected to slot <span class=o>[</span>12921<span class=o>]</span> located at 192.168.1.14:6379
</span></span><span class=line><span class=cl><span class=nb>hash</span>
</span></span><span class=line><span class=cl>192.168.1.14:6379&gt; hgetall TON01001010231201
</span></span><span class=line><span class=cl>1<span class=o>)</span> <span class=s2>&#34;path&#34;</span>
</span></span><span class=line><span class=cl>2<span class=o>)</span> <span class=s2>&#34;/reader/book_content_unpack/teb/2022/10/17/TON01001010231201/TON01001010231201&#34;</span>
</span></span><span class=line><span class=cl>3<span class=o>)</span> <span class=s2>&#34;iv&#34;</span>
</span></span><span class=line><span class=cl>4<span class=o>)</span> <span class=s2>&#34;06ac4696c8a4bb94ecb7e82b38a1dc3f&#34;</span>
</span></span><span class=line><span class=cl>5<span class=o>)</span> <span class=s2>&#34;key&#34;</span>
</span></span><span class=line><span class=cl>6<span class=o>)</span> <span class=s2>&#34;36971e857d647324cb59e1cdf58d7071&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 查看key type，此key在redis05主機上，會Redirected到此key所在slot主機上，再顯示type</span>
</span></span><span class=line><span class=cl>192.168.1.14:6379&gt; <span class=nb>type</span> spring:session:index:org.springframework.session.FindByIndexNameSessionRepository.PRINCIPAL_NAME_INDEX_NAME:25E30A2AB63FE661B9AE7803EAD9A9AC234097FC
</span></span><span class=line><span class=cl>-&gt; Redirected to slot <span class=o>[</span>16326<span class=o>]</span> located at 192.168.1.18:6379
</span></span><span class=line><span class=cl><span class=nb>set</span>
</span></span><span class=line><span class=cl>192.168.1.18:6379&gt; SMEMBERS spring:session:index:org.springframework.session.FindByIndexNameSessionRepository.PRINCIPAL_NAME_INDEX_NAME:25E30A2AB63FE661B9AE7803EAD9A9AC234097FC
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>1<span class=o>)</span> <span class=s2>&#34;\xac\xed\x00\x05t\x00</span><span class=nv>$f0d82ce3</span><span class=s2>-28e3-493c-b992-439565cf987e&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 查看key type，此key在redis02主機上，會Redirected到此key所在slot主機上，再顯示type</span>
</span></span><span class=line><span class=cl>192.168.1.18:6379&gt; <span class=nb>type</span> BOOK_CASE_LIST_U_39048951
</span></span><span class=line><span class=cl>-&gt; Redirected to slot <span class=o>[</span>5895<span class=o>]</span> located at 192.168.1.12:6379
</span></span><span class=line><span class=cl><span class=nb>hash</span>
</span></span><span class=line><span class=cl>192.168.1.12:6379&gt; hgetall BOOK_CASE_LIST_U_39048951
</span></span><span class=line><span class=cl>1<span class=o>)</span> <span class=s2>&#34;0_5&#34;</span>
</span></span><span class=line><span class=cl>2<span class=o>)</span> <span class=s2>&#34;{\&#34;result\&#34;:\&#34;00\&#34;,\&#34;syncTime\&#34;:\&#34;20231202164546\&#34;,\&#34;ebooks\&#34;:[{\&#34;deliverId\&#34;:\&#34;SON03001000560201\&#34;,\&#34;contentId\&#34;:\&#34;SON03001000560\&#34;,\&#34;title\&#34;:\&#34;\xe6\x8a\x95\xe8\xb3\x875\xe5\xb9\xb4\xef\xbc\x8c\xe6\x9c\xac\xe9\x87\x91\xe5\xbe\x9e4\xe8\x90\xac\xe5\x88\xb01\xe5\x84\x84\xe7\x9a\x84\xe5\xa5\xb3\xe4\xba\xba\xef\xbc\x9a\xe5\xbe\x9e\xe7\x9c\x81\xe9\x8c\xa2\xe3\x80\x81\xe5\xae\x9a\xe5\xad\x98\xe5\x88\xb0\xe8\x82\xa1\xe7\xa5\xa8\xef\xbc\x8c\xe5\xb0\x88\xe5\xb1\xac\xe5\xb0\x8f\xe8\xb3\x87\xe5\xa5\xb3\xe7\x9a\x84\xe8\xb3\xaa\xe6\x84\x9f\xe7\x90\x86\xe8\xb2\xa1\xe6\x8f\x90\xe6\xa1\x88\&#34;,\&#34;publisher\&#34;:\&#34;\xe5\xb4\xa7\xe7\x87\x81\xe6\x96\x87\xe5\x8c\x96\&#34;,\&#34;author\&#34;:\&#34;\xe6\xb7\x98\xe6\xb7\x98\&#34;,\&#34;bodyTypeCode\&#34;:\&#34;201\&#34;,\&#34;ebookType\&#34;:\&#34;\xe6\x9b\xb8\xe7\xb1\x8d\&#34;,\&#34;categories\&#34;:[\&#34;\xe9\x87\x91\xe8\x9e\x8d\xe7\x90\x86\xe8\xb2\xa1\&#34;],
</span></span></span></code></pre></div><p><font color=red>注意：可以看到，數據都正確，此方法恢復數據，可行</font></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=o>[</span>root@redis91 redis<span class=o>]</span><span class=c1># redis-cli --user 帳號 --pass 密碼 -c</span>
</span></span><span class=line><span class=cl>Warning: Using a password with <span class=s1>&#39;-a&#39;</span> or <span class=s1>&#39;-u&#39;</span> option on the <span class=nb>command</span> line interface may not be safe.
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 查看key type，此key剛好就在redis01主機上，所以執行直接顯示type</span>
</span></span><span class=line><span class=cl>127.0.0.1:6379&gt; <span class=nb>type</span> spring:session:index:org.springframework.session.FindByIndexNameSessionRepository.PRINCIPAL_NAME_INDEX_NAME:362C74F290B63E5F751DCF1E49EC34BEAF6822F0
</span></span><span class=line><span class=cl><span class=nb>set</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 查看key type，此key在redis92主機上，會Redirected到此key所在slot主機上，再顯示type</span>
</span></span><span class=line><span class=cl>127.0.0.1:6379&gt; <span class=nb>type</span> DRM01001000347201
</span></span><span class=line><span class=cl>-&gt; Redirected to slot <span class=o>[</span>5914<span class=o>]</span> located at 192.168.1.92:6379
</span></span><span class=line><span class=cl><span class=nb>hash</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 查看key type，此key在redis94主機上，會Redirected到此key所在slot主機上，再顯示type</span>
</span></span><span class=line><span class=cl>192.168.1.92:6379&gt; <span class=nb>type</span> spring:session:index:org.springframework.session.FindByIndexNameSessionRepository.PRINCIPAL_NAME_INDEX_NAME:EBB87CF1F764E6BACCC709323FE1457065B0CC8E
</span></span><span class=line><span class=cl>-&gt; Redirected to slot <span class=o>[</span>10759<span class=o>]</span> located at 192.168.1.94:6379
</span></span><span class=line><span class=cl><span class=nb>set</span>
</span></span><span class=line><span class=cl>192.168.1.94:6379&gt; SMEMBERS spring:session:index:org.springframework.session.FindByIndexNameSessionRepository.PRINCIPAL_NAME_INDEX_NAME:EBB87CF1F764E6BACCC709323FE1457065B0CC8E
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>1<span class=o>)</span> <span class=s2>&#34;\xac\xed\x00\x05t\x00</span><span class=nv>$aef3b17d</span><span class=s2>-ed6f-4c4e-9cc3-ef69eda6f33c&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 查看key type，此key剛好就在redis94主機上，所以執行直接顯示type</span>
</span></span><span class=line><span class=cl>192.168.1.94:6379&gt; <span class=nb>type</span> TON01001010231201
</span></span><span class=line><span class=cl><span class=nb>hash</span>
</span></span><span class=line><span class=cl>192.168.1.94:6379&gt; hgetall TON01001010231201
</span></span><span class=line><span class=cl>1<span class=o>)</span> <span class=s2>&#34;path&#34;</span>
</span></span><span class=line><span class=cl>2<span class=o>)</span> <span class=s2>&#34;/reader/book_content_unpack/teb/2022/10/17/TON01001010231201/TON01001010231201&#34;</span>
</span></span><span class=line><span class=cl>3<span class=o>)</span> <span class=s2>&#34;key&#34;</span>
</span></span><span class=line><span class=cl>4<span class=o>)</span> <span class=s2>&#34;36971e857d647324cb59e1cdf58d7071&#34;</span>
</span></span><span class=line><span class=cl>5<span class=o>)</span> <span class=s2>&#34;iv&#34;</span>
</span></span><span class=line><span class=cl>6<span class=o>)</span> <span class=s2>&#34;06ac4696c8a4bb94ecb7e82b38a1dc3f&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 查看key type，此key在redis98主機上，會Redirected到此key所在slot主機上，再顯示type</span>
</span></span><span class=line><span class=cl>192.168.1.94:6379&gt; <span class=nb>type</span> spring:session:index:org.springframework.session.FindByIndexNameSessionRepository.PRINCIPAL_NAME_INDEX_NAME:25E30A2AB63FE661B9AE7803EAD9A9AC234097FC
</span></span><span class=line><span class=cl>-&gt; Redirected to slot <span class=o>[</span>16326<span class=o>]</span> located at 192.168.1.98:6379
</span></span><span class=line><span class=cl><span class=nb>set</span>
</span></span><span class=line><span class=cl>192.168.1.98:6379&gt; SMEMBERS spring:session:index:org.springframework.session.FindByIndexNameSessionRepository.PRINCIPAL_NAME_INDEX_NAME:25E30A2AB63FE661B9AE7803EAD9A9AC234097FC
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>1<span class=o>)</span> <span class=s2>&#34;\xac\xed\x00\x05t\x00</span><span class=nv>$f0d82ce3</span><span class=s2>-28e3-493c-b992-439565cf987e&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># 查看key type，此key在redis92主機上，會Redirected到此key所在slot主機上，再顯示type</span>
</span></span><span class=line><span class=cl>192.168.1.98:6379&gt; <span class=nb>type</span> BOOK_CASE_LIST_U_39048951
</span></span><span class=line><span class=cl>-&gt; Redirected to slot <span class=o>[</span>5895<span class=o>]</span> located at 192.168.1.92:6379
</span></span><span class=line><span class=cl><span class=nb>hash</span>
</span></span><span class=line><span class=cl>192.168.1.92:6379&gt; hgetall BOOK_CASE_LIST_U_39048951
</span></span><span class=line><span class=cl>1<span class=o>)</span> <span class=s2>&#34;0_5&#34;</span>
</span></span><span class=line><span class=cl>2<span class=o>)</span> <span class=s2>&#34;{\&#34;result\&#34;:\&#34;00\&#34;,\&#34;syncTime\&#34;:\&#34;20231202164546\&#34;,\&#34;ebooks\&#34;:[{\&#34;deliverId\&#34;:\&#34;SON03001000560201\&#34;,\&#34;contentId\&#34;:\&#34;SON03001000560\&#34;,\&#34;title\&#34;:\&#34;\xe6\x8a\x95\xe8\xb3\x875\xe5\xb9\xb4\xef\xbc\x8c\xe6\x9c\xac\xe9\x87\x91\xe5\xbe\x9e4\xe8\x90\xac\xe5\x88\xb01\xe5\x84\x84\xe7\x9a\x84\xe5\xa5\xb3\xe4\xba\xba\xef\xbc\x9a\xe5\xbe\x9e\xe7\x9c\x81\xe9\x8c\xa2\xe3\x80\x81\xe5\xae\x9a\xe5\xad\x98\xe5\x88\xb0\xe8\x82\xa1\xe7\xa5\xa8\xef\xbc\x8c\xe5\xb0\x88\xe5\xb1\xac\xe5\xb0\x8f\xe8\xb3\x87\xe5\xa5\xb3\xe7\x9a\x84\xe8\xb3\xaa\xe6\x84\x9f\xe7\x90\x86\xe8\xb2\xa1\xe6\x8f\x90\xe6\xa1\x88\&#34;,\&#34;publisher\&#34;:\&#34;\xe5\xb4\xa7\xe7\x87\x81\xe6\x96\x87\xe5\x8c\x96\&#34;,\&#34;author\&#34;:\&#34;\xe6\xb7\x98\xe6\xb7\x98\&#34;,\&#34;bodyTypeCode\&#34;:\&#34;201\&#34;,\&#34;ebookType\&#34;:\&#34;\xe6\x9b\xb8\xe7\xb1\x8d\&#34;,\&#34;categories\&#34;:[\&#34;\xe9\x87\x91
</span></span></span></code></pre></div></section><footer class=article-footer><section class=article-tags><a href=/tags/redis/>redis</a>
<a href=/tags/redis-shake/>redis-shake</a>
<a href=/tags/redis-cluster/>redis-cluster</a></section><section class=article-copyright><svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg><span>Licensed under CC BY-NC-SA 4.0</span></section></footer></article><aside class=related-content--wrapper><h2 class=section-title>相關文章</h2><div class=related-content><div class="flex article-list--tile"><article><a href=/2023/redis-cluster-database-transfer-with-redisinsight-bulk-actions/><div class=article-details><h2 class=article-title>使用RedisInsight 1.x版，BULK ACTIONS功能，還原數據，從一個cluster遷移所有分片數據到另一個cluster，結果->有些數據Key Name被修改了，此方式不可行</h2></div></a></article><article><a href=/2023/kubernetes-redisinsight/><div class=article-details><h2 class=article-title>使用Kubernetes架設RedisInsight 1.x版，管理Redis集群</h2></div></a></article><article><a href=/2023/redis-cluster-database-transfer/><div class=article-details><h2 class=article-title>Redis Cluster 資料移轉，從一個cluster遷移所有分片數據到另一個cluster</h2></div></a></article></div></div></aside><div class=disqus-container><div id=disqus_thread></div><script>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//blog-goldfishbrain-fighting-com.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div><style>.disqus-container{background-color:var(--card-background);border-radius:var(--card-border-radius);box-shadow:var(--shadow-l1);padding:var(--card-padding)}</style><script>window.addEventListener("onColorSchemeChange",e=>{typeof DISQUS=="object"&&DISQUS.reset({reload:!0})})</script><footer class=site-footer><section class=copyright>&copy;
2022 -
2023 翻轉吧金魚腦</section><section class=powerby>使用 <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a> 建立<br>主題 <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.20.0>Stack</a></b> 由 <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a> 設計</section><section class=totalcount>發表了103篇文章 ·
總計48.41k字</section><section class=running-time>本站已運行
<span id=runningdays class=running-days></span></section><section class=visit-count><span id=busuanzi_container_site_pv style=display:none>本站總訪問量 <span id=busuanzi_value_site_pv></span> 次 </span>·
<span id=busuanzi_container_site_uv style=display:none>總訪客數 <span id=busuanzi_value_site_uv></span> 人</span></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script><a href=# id=back-to-top title=返回顶部></a><style>#back-to-top{display:none;position:fixed;bottom:20px;right:55px;width:55px;height:55px;border-radius:7px;background-color:rgba(64,158,255,.5);box-shadow:var(--shadow-l2);font-size:30px;text-align:center;line-height:50px;cursor:pointer}#back-to-top:before{content:' ';display:inline-block;position:relative;top:0;transform:rotate(135deg);height:10px;width:10px;border-width:0 0 2px 2px;border-color:var(--back-to-top-color);border-style:solid}#back-to-top:hover:before{border-color:#2674e0}@media screen and (max-width:768px){#back-to-top{bottom:20px;right:20px;width:40px;height:40px;font-size:10px}}@media screen and (min-width:1024px){#back-to-top{bottom:20px;right:40px}}@media screen and (min-width:1280px){#back-to-top{bottom:20px;right:55px}}@media screen and (min-width:1536px){#back-to-top{visibility:hidden}}</style><script>function backToTop(){document.documentElement.scrollIntoView({behavior:"smooth"})}window.onload=function(){let t=this.document.documentElement.scrollTop||this.document.body.scrollTop,e=this.document.getElementById("back-to-top");t>0?e.style.display="inline":e.style.display="none"},window.onscroll=function(){let t=this.document.documentElement.scrollTop||this.document.body.scrollTop,e=this.document.getElementById("back-to-top");t<200?e.style.display="none":(e.style.display="inline",e.addEventListener("click",backToTop,!1))}</script><script>(function(){var t,e=window;if(e.ChannelIO)return e.console.error("ChannelIO script included twice.");t=function(){t.c(arguments)},t.q=[],t.c=function(e){t.q.push(e)},e.ChannelIO=t;function n(){if(e.ChannelIOInitialized)return;e.ChannelIOInitialized=!0;var n,t=document.createElement("script");t.type="text/javascript",t.async=!0,t.src="https://cdn.channel.io/plugin/ch-plugin-web.js",n=document.getElementsByTagName("script")[0],n.parentNode&&n.parentNode.insertBefore(t,n)}document.readyState==="complete"?n():(e.addEventListener("DOMContentLoaded",n),e.addEventListener("load",n))})(),ChannelIO("boot",{pluginKey:"ad479103-2d28-421a-a916-ae09e72ce014"})</script><script>let s1="2023-10-7";s1=new Date(s1.replace(/-/g,"/"));let s2=new Date,timeDifference=s2.getTime()-s1.getTime(),days=Math.floor(timeDifference/(1e3*60*60*24)),hours=Math.floor(timeDifference%(1e3*60*60*24)/(1e3*60*60)),minutes=Math.floor(timeDifference%(1e3*60*60)/(1e3*60)),result=days+"天"+hours+"小時"+minutes+"分鐘";document.getElementById("runningdays").innerHTML=result</script></body></html>