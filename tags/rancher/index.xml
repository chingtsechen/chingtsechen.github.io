<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>rancher on 翻轉吧金魚腦</title><link>https://blog.goldfishbrain-fighting.com/tags/rancher/</link><description>Recent content in rancher on 翻轉吧金魚腦</description><generator>Hugo -- gohugo.io</generator><language>en-us</language><lastBuildDate>Mon, 18 Dec 2023 21:54:42 +0800</lastBuildDate><atom:link href="https://blog.goldfishbrain-fighting.com/tags/rancher/index.xml" rel="self" type="application/rss+xml"/><item><title>Kubernetes 使用Rancher管理平台 安裝Prometheus監控</title><link>https://blog.goldfishbrain-fighting.com/2023/kubernetes-rancher-install-prometheus/</link><pubDate>Mon, 18 Dec 2023 21:54:42 +0800</pubDate><guid>https://blog.goldfishbrain-fighting.com/2023/kubernetes-rancher-install-prometheus/</guid><description>&lt;p>參考網址：
&lt;a class="link" href="https://ranchermanager.docs.rancher.com/zh/how-to-guides/advanced-user-guides/monitoring-alerting-guides/enable-monitoring" target="_blank" rel="noopener"
>https://ranchermanager.docs.rancher.com/zh/how-to-guides/advanced-user-guides/monitoring-alerting-guides/enable-monitoring&lt;/a>&lt;/p>
&lt;p>&lt;font color=red>注意：&lt;/font>&lt;/p>
&lt;p>&lt;font color=red>由於我之前有安裝rook-ceph，也有用到prometheus監控rook-ceph集群，所以也有安裝prometheus-operator，現在rancher安裝的prometheus也會用到prometheus-operator，所以這裡要刪除掉，不然會有衝突，導致rancher安裝的prometheus無法啟動。&lt;/font>&lt;/p>
&lt;p>&lt;font color=red>等安裝好rancher的prometheus，再來重新安裝rook-ceph用的prometheus。&lt;/font>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">root@k8s-master71u:~/rook/deploy/examples/monitoring# kubectl delete -f bundle.yaml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">customresourcedefinition.apiextensions.k8s.io &lt;span class="s2">&amp;#34;alertmanagerconfigs.monitoring.coreos.com&amp;#34;&lt;/span> deleted
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">customresourcedefinition.apiextensions.k8s.io &lt;span class="s2">&amp;#34;alertmanagers.monitoring.coreos.com&amp;#34;&lt;/span> deleted
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">customresourcedefinition.apiextensions.k8s.io &lt;span class="s2">&amp;#34;podmonitors.monitoring.coreos.com&amp;#34;&lt;/span> deleted
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">customresourcedefinition.apiextensions.k8s.io &lt;span class="s2">&amp;#34;probes.monitoring.coreos.com&amp;#34;&lt;/span> deleted
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">customresourcedefinition.apiextensions.k8s.io &lt;span class="s2">&amp;#34;prometheusagents.monitoring.coreos.com&amp;#34;&lt;/span> deleted
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">customresourcedefinition.apiextensions.k8s.io &lt;span class="s2">&amp;#34;prometheuses.monitoring.coreos.com&amp;#34;&lt;/span> deleted
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">customresourcedefinition.apiextensions.k8s.io &lt;span class="s2">&amp;#34;prometheusrules.monitoring.coreos.com&amp;#34;&lt;/span> deleted
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">customresourcedefinition.apiextensions.k8s.io &lt;span class="s2">&amp;#34;scrapeconfigs.monitoring.coreos.com&amp;#34;&lt;/span> deleted
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">customresourcedefinition.apiextensions.k8s.io &lt;span class="s2">&amp;#34;servicemonitors.monitoring.coreos.com&amp;#34;&lt;/span> deleted
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">customresourcedefinition.apiextensions.k8s.io &lt;span class="s2">&amp;#34;thanosrulers.monitoring.coreos.com&amp;#34;&lt;/span> deleted
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">clusterrolebinding.rbac.authorization.k8s.io &lt;span class="s2">&amp;#34;prometheus-operator&amp;#34;&lt;/span> deleted
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">clusterrole.rbac.authorization.k8s.io &lt;span class="s2">&amp;#34;prometheus-operator&amp;#34;&lt;/span> deleted
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">deployment.apps &lt;span class="s2">&amp;#34;prometheus-operator&amp;#34;&lt;/span> deleted
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">serviceaccount &lt;span class="s2">&amp;#34;prometheus-operator&amp;#34;&lt;/span> deleted
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">service &lt;span class="s2">&amp;#34;prometheus-operator&amp;#34;&lt;/span> deleted
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="安裝prometheus">安裝Prometheus&lt;/h2>
&lt;p>點選左下角，Cluster Tools-&amp;gt; Monitoring&lt;/p>
&lt;p>&lt;img src="https://blog.goldfishbrain-fighting.com/2023/kubernetes-rancher-install-prometheus/media/Pasted-image-20231218235722.png"
width="1707"
height="946"
srcset="https://blog.goldfishbrain-fighting.com/2023/kubernetes-rancher-install-prometheus/media/Pasted-image-20231218235722_hu741b6d593547bd44901779f738acfa9f_200228_480x0_resize_box_3.png 480w, https://blog.goldfishbrain-fighting.com/2023/kubernetes-rancher-install-prometheus/media/Pasted-image-20231218235722_hu741b6d593547bd44901779f738acfa9f_200228_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="180"
data-flex-basis="433px"
>&lt;/p>
&lt;p>&lt;img src="https://blog.goldfishbrain-fighting.com/2023/kubernetes-rancher-install-prometheus/media/Pasted-image-20231218235912.png"
width="1717"
height="948"
srcset="https://blog.goldfishbrain-fighting.com/2023/kubernetes-rancher-install-prometheus/media/Pasted-image-20231218235912_huf9a4c3031e451ab1209e7fc9739d2185_131124_480x0_resize_box_3.png 480w, https://blog.goldfishbrain-fighting.com/2023/kubernetes-rancher-install-prometheus/media/Pasted-image-20231218235912_huf9a4c3031e451ab1209e7fc9739d2185_131124_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="181"
data-flex-basis="434px"
>&lt;/p>
&lt;p>&lt;img src="https://blog.goldfishbrain-fighting.com/2023/kubernetes-rancher-install-prometheus/media/Pasted-image-20231218235944.png"
width="1713"
height="948"
srcset="https://blog.goldfishbrain-fighting.com/2023/kubernetes-rancher-install-prometheus/media/Pasted-image-20231218235944_hu683003fbddde459c613ad621ceb56f70_135976_480x0_resize_box_3.png 480w, https://blog.goldfishbrain-fighting.com/2023/kubernetes-rancher-install-prometheus/media/Pasted-image-20231218235944_hu683003fbddde459c613ad621ceb56f70_135976_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="180"
data-flex-basis="433px"
>&lt;/p>
&lt;p>Prometheus修改資料存儲天數，和使用持久化數據&lt;/p>
&lt;p>&lt;img src="https://blog.goldfishbrain-fighting.com/2023/kubernetes-rancher-install-prometheus/media/Pasted-image-20231219000304.png"
width="1719"
height="945"
srcset="https://blog.goldfishbrain-fighting.com/2023/kubernetes-rancher-install-prometheus/media/Pasted-image-20231219000304_hu4ca4fb6c3f4fceb808fa610437250c92_156240_480x0_resize_box_3.png 480w, https://blog.goldfishbrain-fighting.com/2023/kubernetes-rancher-install-prometheus/media/Pasted-image-20231219000304_hu4ca4fb6c3f4fceb808fa610437250c92_156240_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="181"
data-flex-basis="436px"
>&lt;/p>
&lt;p>Grafana使用持久化數據&lt;/p>
&lt;p>&lt;img src="https://blog.goldfishbrain-fighting.com/2023/kubernetes-rancher-install-prometheus/media/Pasted-image-20231219000406.png"
width="1719"
height="868"
srcset="https://blog.goldfishbrain-fighting.com/2023/kubernetes-rancher-install-prometheus/media/Pasted-image-20231219000406_hu87d5b8b891b89edc637fb6f1bd96f210_99800_480x0_resize_box_3.png 480w, https://blog.goldfishbrain-fighting.com/2023/kubernetes-rancher-install-prometheus/media/Pasted-image-20231219000406_hu87d5b8b891b89edc637fb6f1bd96f210_99800_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="198"
data-flex-basis="475px"
>&lt;/p>
&lt;p>&lt;img src="https://blog.goldfishbrain-fighting.com/2023/kubernetes-rancher-install-prometheus/media/Pasted-image-20231219000427.png"
width="1718"
height="946"
srcset="https://blog.goldfishbrain-fighting.com/2023/kubernetes-rancher-install-prometheus/media/Pasted-image-20231219000427_hu80f4cb3e46af77fb072b26e5a478aa29_112547_480x0_resize_box_3.png 480w, https://blog.goldfishbrain-fighting.com/2023/kubernetes-rancher-install-prometheus/media/Pasted-image-20231219000427_hu80f4cb3e46af77fb072b26e5a478aa29_112547_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="181"
data-flex-basis="435px"
>&lt;/p>
&lt;p>&lt;img src="https://blog.goldfishbrain-fighting.com/2023/kubernetes-rancher-install-prometheus/media/Pasted-image-20231219000732.png"
width="1719"
height="909"
srcset="https://blog.goldfishbrain-fighting.com/2023/kubernetes-rancher-install-prometheus/media/Pasted-image-20231219000732_hu175959e3b476af4e2d901ebefd4f5f58_376241_480x0_resize_box_3.png 480w, https://blog.goldfishbrain-fighting.com/2023/kubernetes-rancher-install-prometheus/media/Pasted-image-20231219000732_hu175959e3b476af4e2d901ebefd4f5f58_376241_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="189"
data-flex-basis="453px"
>&lt;/p>
&lt;p>安裝完成&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">root@k8s-master71u:~/rook/deploy/examples/monitoring# kubectl get pod -n cattle-monitoring-system
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME READY STATUS RESTARTS AGE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">alertmanager-rancher-monitoring-alertmanager-0 2/2 Running &lt;span class="m">1&lt;/span> &lt;span class="o">(&lt;/span>49s ago&lt;span class="o">)&lt;/span> 58s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">prometheus-rancher-monitoring-prometheus-0 3/3 Running &lt;span class="m">0&lt;/span> 56s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">rancher-monitoring-grafana-568d4fc6d5-zsnq7 3/4 Running &lt;span class="m">0&lt;/span> 88s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">rancher-monitoring-kube-state-metrics-56b4477cc-2zgmf 1/1 Running &lt;span class="m">0&lt;/span> 88s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">rancher-monitoring-operator-c66c76fd9-cns8h 1/1 Running &lt;span class="m">0&lt;/span> 88s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">rancher-monitoring-prometheus-adapter-7494f789f6-x2v6p 1/1 Running &lt;span class="m">0&lt;/span> 88s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">rancher-monitoring-prometheus-node-exporter-65n2k 1/1 Running &lt;span class="m">0&lt;/span> 88s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">rancher-monitoring-prometheus-node-exporter-7t4nt 1/1 Running &lt;span class="m">0&lt;/span> 88s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">rancher-monitoring-prometheus-node-exporter-s9kwh 1/1 Running &lt;span class="m">0&lt;/span> 88s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">rancher-monitoring-prometheus-node-exporter-w8tv9 1/1 Running &lt;span class="m">0&lt;/span> 88s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">rancher-monitoring-prometheus-node-exporter-zzqpc 1/1 Running &lt;span class="m">0&lt;/span> 88s
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;img src="https://blog.goldfishbrain-fighting.com/2023/kubernetes-rancher-install-prometheus/media/Pasted-image-20231219004042.png"
width="1718"
height="761"
srcset="https://blog.goldfishbrain-fighting.com/2023/kubernetes-rancher-install-prometheus/media/Pasted-image-20231219004042_hu0842e95e2649b8c35fcf46110ec67e3b_228426_480x0_resize_box_3.png 480w, https://blog.goldfishbrain-fighting.com/2023/kubernetes-rancher-install-prometheus/media/Pasted-image-20231219004042_hu0842e95e2649b8c35fcf46110ec67e3b_228426_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="225"
data-flex-basis="541px"
>&lt;/p>
&lt;h2 id="測試monitoring功能">測試Monitoring功能&lt;/h2>
&lt;p>&lt;img src="https://blog.goldfishbrain-fighting.com/2023/kubernetes-rancher-install-prometheus/media/Pasted-image-20231219012927.png"
width="1713"
height="943"
srcset="https://blog.goldfishbrain-fighting.com/2023/kubernetes-rancher-install-prometheus/media/Pasted-image-20231219012927_hu0fc5ea31c669cf294c8ebbe871fa7c48_134397_480x0_resize_box_3.png 480w, https://blog.goldfishbrain-fighting.com/2023/kubernetes-rancher-install-prometheus/media/Pasted-image-20231219012927_hu0fc5ea31c669cf294c8ebbe871fa7c48_134397_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="181"
data-flex-basis="435px"
>&lt;/p>
&lt;h3 id="查看prometheus">查看Prometheus&lt;/h3>
&lt;p>&lt;img src="https://blog.goldfishbrain-fighting.com/2023/kubernetes-rancher-install-prometheus/media/Pasted-image-20231219013023.png"
width="1712"
height="944"
srcset="https://blog.goldfishbrain-fighting.com/2023/kubernetes-rancher-install-prometheus/media/Pasted-image-20231219013023_hu55f4ff22df1ab0fb0c3e02512c362a2d_154901_480x0_resize_box_3.png 480w, https://blog.goldfishbrain-fighting.com/2023/kubernetes-rancher-install-prometheus/media/Pasted-image-20231219013023_hu55f4ff22df1ab0fb0c3e02512c362a2d_154901_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="181"
data-flex-basis="435px"
>&lt;/p>
&lt;p>&lt;img src="https://blog.goldfishbrain-fighting.com/2023/kubernetes-rancher-install-prometheus/media/Pasted-image-20231219013037.png"
width="1717"
height="944"
srcset="https://blog.goldfishbrain-fighting.com/2023/kubernetes-rancher-install-prometheus/media/Pasted-image-20231219013037_hub88a9b4b816e5d68de46b102bed26cb1_205158_480x0_resize_box_3.png 480w, https://blog.goldfishbrain-fighting.com/2023/kubernetes-rancher-install-prometheus/media/Pasted-image-20231219013037_hub88a9b4b816e5d68de46b102bed26cb1_205158_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="181"
data-flex-basis="436px"
>&lt;/p>
&lt;h3 id="查看alertmanager">查看Alertmanager&lt;/h3>
&lt;p>&lt;img src="https://blog.goldfishbrain-fighting.com/2023/kubernetes-rancher-install-prometheus/media/Pasted-image-20231219013059.png"
width="1716"
height="947"
srcset="https://blog.goldfishbrain-fighting.com/2023/kubernetes-rancher-install-prometheus/media/Pasted-image-20231219013059_hu7656d9b1bc82251953d7222d79385f62_154593_480x0_resize_box_3.png 480w, https://blog.goldfishbrain-fighting.com/2023/kubernetes-rancher-install-prometheus/media/Pasted-image-20231219013059_hu7656d9b1bc82251953d7222d79385f62_154593_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="181"
data-flex-basis="434px"
>&lt;/p>
&lt;p>&lt;img src="https://blog.goldfishbrain-fighting.com/2023/kubernetes-rancher-install-prometheus/media/Pasted-image-20231219013112.png"
width="1714"
height="946"
srcset="https://blog.goldfishbrain-fighting.com/2023/kubernetes-rancher-install-prometheus/media/Pasted-image-20231219013112_hu8fa7c34531028b95562c015662ac949e_98701_480x0_resize_box_3.png 480w, https://blog.goldfishbrain-fighting.com/2023/kubernetes-rancher-install-prometheus/media/Pasted-image-20231219013112_hu8fa7c34531028b95562c015662ac949e_98701_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="181"
data-flex-basis="434px"
>&lt;/p>
&lt;h3 id="查看grafana">查看Grafana&lt;/h3>
&lt;p>&lt;img src="https://blog.goldfishbrain-fighting.com/2023/kubernetes-rancher-install-prometheus/media/Pasted-image-20231219013140.png"
width="1713"
height="946"
srcset="https://blog.goldfishbrain-fighting.com/2023/kubernetes-rancher-install-prometheus/media/Pasted-image-20231219013140_hu6f1736b6a39cc2458e21493953e45551_154723_480x0_resize_box_3.png 480w, https://blog.goldfishbrain-fighting.com/2023/kubernetes-rancher-install-prometheus/media/Pasted-image-20231219013140_hu6f1736b6a39cc2458e21493953e45551_154723_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="181"
data-flex-basis="434px"
>&lt;/p>
&lt;p>&lt;img src="https://blog.goldfishbrain-fighting.com/2023/kubernetes-rancher-install-prometheus/media/Pasted-image-20231219013201.png"
width="1712"
height="947"
srcset="https://blog.goldfishbrain-fighting.com/2023/kubernetes-rancher-install-prometheus/media/Pasted-image-20231219013201_hue1073a9af7617e17a85afad4b23e249f_193601_480x0_resize_box_3.png 480w, https://blog.goldfishbrain-fighting.com/2023/kubernetes-rancher-install-prometheus/media/Pasted-image-20231219013201_hue1073a9af7617e17a85afad4b23e249f_193601_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="180"
data-flex-basis="433px"
>&lt;/p>
&lt;p>&lt;img src="https://blog.goldfishbrain-fighting.com/2023/kubernetes-rancher-install-prometheus/media/Pasted-image-20231219013221.png"
width="1714"
height="924"
srcset="https://blog.goldfishbrain-fighting.com/2023/kubernetes-rancher-install-prometheus/media/Pasted-image-20231219013221_huca277ea012c3d6d9912547b1911bb616_128457_480x0_resize_box_3.png 480w, https://blog.goldfishbrain-fighting.com/2023/kubernetes-rancher-install-prometheus/media/Pasted-image-20231219013221_huca277ea012c3d6d9912547b1911bb616_128457_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="185"
data-flex-basis="445px"
>&lt;/p>
&lt;h3 id="重新安裝rook-ceph用的prometheus">重新安裝rook-ceph用的prometheus&lt;/h3>
&lt;p>重新安裝rook-ceph用的prometheus，prometheus-operator就不用安裝了，也就是最前面刪除的bundle.yaml那個檔案。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">root@k8s-master71u:~/rook/deploy/examples/monitoring# kubectl create -f prometheus.yaml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">prometheus.monitoring.coreos.com/rook-prometheus created
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">root@k8s-master71u:~/rook/deploy/examples/monitoring# kubectl create -f prometheus-service.yaml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">The Service &lt;span class="s2">&amp;#34;rook-prometheus&amp;#34;&lt;/span> is invalid: spec.ports&lt;span class="o">[&lt;/span>0&lt;span class="o">]&lt;/span>.nodePort: Invalid value: 30900: provided port is already allocated
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">root@k8s-master71u:~/rook/deploy/examples/monitoring# kubectl create -f service-monitor.yaml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">servicemonitor.monitoring.coreos.com/rook-ceph-mgr created
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;img src="https://blog.goldfishbrain-fighting.com/2023/kubernetes-rancher-install-prometheus/media/Pasted-image-20231219014254.png"
width="1716"
height="553"
srcset="https://blog.goldfishbrain-fighting.com/2023/kubernetes-rancher-install-prometheus/media/Pasted-image-20231219014254_huc4ba3b28f91efb3ae172b630efc72e6d_104348_480x0_resize_box_3.png 480w, https://blog.goldfishbrain-fighting.com/2023/kubernetes-rancher-install-prometheus/media/Pasted-image-20231219014254_huc4ba3b28f91efb3ae172b630efc72e6d_104348_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="310"
data-flex-basis="744px"
>&lt;/p>
&lt;p>&lt;img src="https://blog.goldfishbrain-fighting.com/2023/kubernetes-rancher-install-prometheus/media/Pasted-image-20231219014312.png"
width="1717"
height="948"
srcset="https://blog.goldfishbrain-fighting.com/2023/kubernetes-rancher-install-prometheus/media/Pasted-image-20231219014312_hu00e271da05919ef24beef98d6f7ed7aa_254549_480x0_resize_box_3.png 480w, https://blog.goldfishbrain-fighting.com/2023/kubernetes-rancher-install-prometheus/media/Pasted-image-20231219014312_hu00e271da05919ef24beef98d6f7ed7aa_254549_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="181"
data-flex-basis="434px"
>&lt;/p></description></item><item><title>使用Docker安裝Rancher管理平台，納管現有k8s集群(單節點-非高可用)</title><link>https://blog.goldfishbrain-fighting.com/2023/kubernetes-docker/</link><pubDate>Sat, 07 Oct 2023 02:00:00 +0800</pubDate><guid>https://blog.goldfishbrain-fighting.com/2023/kubernetes-docker/</guid><description>&lt;p>&lt;img src="https://blog.goldfishbrain-fighting.com/2023/kubernetes-docker/media/Pasted-image-20230920224620.png"
width="1185"
height="787"
srcset="https://blog.goldfishbrain-fighting.com/2023/kubernetes-docker/media/Pasted-image-20230920224620_hu5a39cd61ec6101b6320b865185a3e4e0_367454_480x0_resize_box_3.png 480w, https://blog.goldfishbrain-fighting.com/2023/kubernetes-docker/media/Pasted-image-20230920224620_hu5a39cd61ec6101b6320b865185a3e4e0_367454_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="media/Pasted-image-20230920224620.png"
class="gallery-image"
data-flex-grow="150"
data-flex-basis="361px"
>&lt;/p>
&lt;p>Rancher官網安裝網址：
&lt;a class="link" href="https://ranchermanager.docs.rancher.com/zh/pages-for-subheaders/rancher-on-a-single-node-with-docker" target="_blank" rel="noopener"
>https://ranchermanager.docs.rancher.com/zh/pages-for-subheaders/rancher-on-a-single-node-with-docker&lt;/a>&lt;/p>
&lt;p>最新版Rancher(v2.7.6)能夠納管的kubernetes版本為1.26.4：
&lt;a class="link" href="https://www.suse.com/suse-rancher/support-matrix/all-supported-versions/rancher-v2-7-6/" target="_blank" rel="noopener"
>https://www.suse.com/suse-rancher/support-matrix/all-supported-versions/rancher-v2-7-6/&lt;/a>
&lt;img src="https://blog.goldfishbrain-fighting.com/2023/kubernetes-docker/media/Pasted-image-20230920175154.png"
width="767"
height="576"
srcset="https://blog.goldfishbrain-fighting.com/2023/kubernetes-docker/media/Pasted-image-20230920175154_hu01fa84ee148454aed4aa51b480f9836a_40466_480x0_resize_box_3.png 480w, https://blog.goldfishbrain-fighting.com/2023/kubernetes-docker/media/Pasted-image-20230920175154_hu01fa84ee148454aed4aa51b480f9836a_40466_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="media/Pasted-image-20230920175154.png"
class="gallery-image"
data-flex-grow="133"
data-flex-basis="319px"
>&lt;/p>
&lt;h2 id="一rancher-server安裝">一、Rancher Server安裝&lt;/h2>
&lt;h3 id="一使用docker起容器">一、使用docker起容器&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">root@k8s-node75u:~# sudo docker run --privileged -d --restart&lt;span class="o">=&lt;/span>unless-stopped -p 80:80 -p 443:443 rancher/rancher
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">root@k8s-node75u:~# docker ps
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">CONTAINER ID IMAGE COMMAND CREATED STATUS PORTS NAMES
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">0e92a3ece9cd rancher/rancher &lt;span class="s2">&amp;#34;entrypoint.sh&amp;#34;&lt;/span> &lt;span class="m">4&lt;/span> minutes ago Up About a minute 0.0.0.0:80-&amp;gt;80/tcp, :::80-&amp;gt;80/tcp, 0.0.0.0:443-&amp;gt;443/tcp, :::443-&amp;gt;443/tcp dreamy_rubin
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="二查看初始密碼">二、查看初始密碼&lt;/h3>
&lt;p>&lt;img src="https://blog.goldfishbrain-fighting.com/2023/kubernetes-docker/media/Pasted-image-20230920175456.png"
width="766"
height="755"
srcset="https://blog.goldfishbrain-fighting.com/2023/kubernetes-docker/media/Pasted-image-20230920175456_hua3986ebe76c28593123877564810c0e5_76029_480x0_resize_box_3.png 480w, https://blog.goldfishbrain-fighting.com/2023/kubernetes-docker/media/Pasted-image-20230920175456_hua3986ebe76c28593123877564810c0e5_76029_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="media/Pasted-image-20230920175456.png"
class="gallery-image"
data-flex-grow="101"
data-flex-basis="243px"
>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">root@k8s-node75u:~# docker logs 0e92a3ece9cd 2&amp;gt;&lt;span class="p">&amp;amp;&lt;/span>&lt;span class="m">1&lt;/span> &lt;span class="p">|&lt;/span> grep &lt;span class="s2">&amp;#34;Bootstrap Password:&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">2023/09/20 09:50:01 &lt;span class="o">[&lt;/span>INFO&lt;span class="o">]&lt;/span> Bootstrap Password: 79j4khgd9952rmn55kdntxt7kwxfn7f7dvpmrsgx6nr7wqblrtpp6l
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="三登入">三、登入&lt;/h3>
&lt;p>&lt;img src="https://blog.goldfishbrain-fighting.com/2023/kubernetes-docker/media/Pasted-image-20230920175658.png"
width="783"
height="768"
srcset="https://blog.goldfishbrain-fighting.com/2023/kubernetes-docker/media/Pasted-image-20230920175658_hu3d2c40f5d0939a2b52203051317c438e_76967_480x0_resize_box_3.png 480w, https://blog.goldfishbrain-fighting.com/2023/kubernetes-docker/media/Pasted-image-20230920175658_hu3d2c40f5d0939a2b52203051317c438e_76967_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="media/Pasted-image-20230920175658.png"
class="gallery-image"
data-flex-grow="101"
data-flex-basis="244px"
>&lt;/p>
&lt;h3 id="四重新設定admin密碼">四、重新設定admin密碼&lt;/h3>
&lt;p>&lt;img src="https://blog.goldfishbrain-fighting.com/2023/kubernetes-docker/media/Pasted-image-20230920175838.png"
width="801"
height="890"
srcset="https://blog.goldfishbrain-fighting.com/2023/kubernetes-docker/media/Pasted-image-20230920175838_hu52cba99bffb2683bebf9888bc6b13c40_85503_480x0_resize_box_3.png 480w, https://blog.goldfishbrain-fighting.com/2023/kubernetes-docker/media/Pasted-image-20230920175838_hu52cba99bffb2683bebf9888bc6b13c40_85503_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="media/Pasted-image-20230920175838.png"
class="gallery-image"
data-flex-grow="90"
data-flex-basis="216px"
>
登入成功頁面
&lt;img src="https://blog.goldfishbrain-fighting.com/2023/kubernetes-docker/media/Pasted-image-20230920180029.png"
width="1571"
height="723"
srcset="https://blog.goldfishbrain-fighting.com/2023/kubernetes-docker/media/Pasted-image-20230920180029_hufcf2fa2ea45ee7c98df35c55f7b48945_101094_480x0_resize_box_3.png 480w, https://blog.goldfishbrain-fighting.com/2023/kubernetes-docker/media/Pasted-image-20230920180029_hufcf2fa2ea45ee7c98df35c55f7b48945_101094_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="media/Pasted-image-20230920180029.png"
class="gallery-image"
data-flex-grow="217"
data-flex-basis="521px"
>&lt;/p>
&lt;h2 id="二匯入現有集群">二、匯入現有集群&lt;/h2>
&lt;h3 id="一點選import-existing">一、點選Import Existing&lt;/h3>
&lt;p>&lt;img src="https://blog.goldfishbrain-fighting.com/2023/kubernetes-docker/media/Pasted-image-20230920180135.png"
width="1568"
height="715"
srcset="https://blog.goldfishbrain-fighting.com/2023/kubernetes-docker/media/Pasted-image-20230920180135_hu81920a18e2926839b7b0711657581ae5_100846_480x0_resize_box_3.png 480w, https://blog.goldfishbrain-fighting.com/2023/kubernetes-docker/media/Pasted-image-20230920180135_hu81920a18e2926839b7b0711657581ae5_100846_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="media/Pasted-image-20230920180135.png"
class="gallery-image"
data-flex-grow="219"
data-flex-basis="526px"
>&lt;/p>
&lt;h3 id="二點選import-any-kubernetes-clustergeneric">二、點選Import any Kubernetes cluster(Generic)&lt;/h3>
&lt;p>&lt;img src="https://blog.goldfishbrain-fighting.com/2023/kubernetes-docker/media/Pasted-image-20230920180232.png"
width="1241"
height="625"
srcset="https://blog.goldfishbrain-fighting.com/2023/kubernetes-docker/media/Pasted-image-20230920180232_hu4d47c145f3344da3a90cc7cca9c878c3_69000_480x0_resize_box_3.png 480w, https://blog.goldfishbrain-fighting.com/2023/kubernetes-docker/media/Pasted-image-20230920180232_hu4d47c145f3344da3a90cc7cca9c878c3_69000_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="media/Pasted-image-20230920180232.png"
class="gallery-image"
data-flex-grow="198"
data-flex-basis="476px"
>&lt;/p>
&lt;h3 id="三填寫cluster-name自己決定以利後續辨識點選create">三、填寫Cluster Name(自己決定，以利後續辨識)，點選Create&lt;/h3>
&lt;p>&lt;img src="https://blog.goldfishbrain-fighting.com/2023/kubernetes-docker/media/Pasted-image-20230920180509.png"
width="1563"
height="943"
srcset="https://blog.goldfishbrain-fighting.com/2023/kubernetes-docker/media/Pasted-image-20230920180509_hud6431c9eb3b2c5342e0bb099a0106bc5_103694_480x0_resize_box_3.png 480w, https://blog.goldfishbrain-fighting.com/2023/kubernetes-docker/media/Pasted-image-20230920180509_hud6431c9eb3b2c5342e0bb099a0106bc5_103694_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="media/Pasted-image-20230920180509.png"
class="gallery-image"
data-flex-grow="165"
data-flex-basis="397px"
>&lt;/p>
&lt;h3 id="四創建之後會有提供加入的方式選擇第二項">四、創建之後，會有提供加入的方式，選擇第二項&lt;/h3>
&lt;p>&lt;img src="https://blog.goldfishbrain-fighting.com/2023/kubernetes-docker/media/Pasted-image-20230920180638.png"
width="1559"
height="805"
srcset="https://blog.goldfishbrain-fighting.com/2023/kubernetes-docker/media/Pasted-image-20230920180638_hu962b03cd08d4a0c5eedf892051dab8f4_177154_480x0_resize_box_3.png 480w, https://blog.goldfishbrain-fighting.com/2023/kubernetes-docker/media/Pasted-image-20230920180638_hu962b03cd08d4a0c5eedf892051dab8f4_177154_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="media/Pasted-image-20230920180638.png"
class="gallery-image"
data-flex-grow="193"
data-flex-basis="464px"
>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># master節點執行&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">root@k8s-master71u:~# curl --insecure -sfL https://192.168.1.75/v3/import/ff4mlx8k768hsz8vmwl89lqhbmcsfbttkxqdtmk4m8pgqsrnd87pqc_c-m-gq2vbtfn.yaml &lt;span class="p">|&lt;/span> kubectl apply -f -
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 查看pod是否都創建成功&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">root@k8s-master71u:~# kubectl get pod -n cattle-system -o wide
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME READY STATUS RESTARTS AGE IP NODE NOMINATED NODE READINESS GATES
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">cattle-cluster-agent-6c97c478bb-mjgwg 1/1 Running &lt;span class="m">0&lt;/span> 5m 10.244.14.137 k8s-node75u &amp;lt;none&amp;gt; &amp;lt;none&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">cattle-cluster-agent-6c97c478bb-vdn59 1/1 Running &lt;span class="m">0&lt;/span> 16m 10.244.255.199 k8s-node76u &amp;lt;none&amp;gt; &amp;lt;none&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">rancher-webhook-74c9bd4d6-znrdp 1/1 Running &lt;span class="m">0&lt;/span> 61s 10.244.255.201 k8s-node76u &amp;lt;none&amp;gt; &amp;lt;none&amp;gt;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="五確認現有集群已加入納管">五、確認現有集群已加入納管&lt;/h3>
&lt;p>加入rancher需要一點時間，請耐心等候，如果鏡像拉取失敗，可以手動去下載鏡像&lt;/p>
&lt;p>&lt;img src="https://blog.goldfishbrain-fighting.com/2023/kubernetes-docker/media/Pasted-image-20230920183031.png"
width="1573"
height="720"
srcset="https://blog.goldfishbrain-fighting.com/2023/kubernetes-docker/media/Pasted-image-20230920183031_hu9e59a4907e63c34faa594edfc314c151_111515_480x0_resize_box_3.png 480w, https://blog.goldfishbrain-fighting.com/2023/kubernetes-docker/media/Pasted-image-20230920183031_hu9e59a4907e63c34faa594edfc314c151_111515_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="media/Pasted-image-20230920183031.png"
class="gallery-image"
data-flex-grow="218"
data-flex-basis="524px"
>&lt;/p>
&lt;p>&lt;img src="https://blog.goldfishbrain-fighting.com/2023/kubernetes-docker/media/Pasted-image-20230920182502.png"
width="1563"
height="936"
srcset="https://blog.goldfishbrain-fighting.com/2023/kubernetes-docker/media/Pasted-image-20230920182502_hu0d54cd16036aa81d0943b0f05cc93b8a_152101_480x0_resize_box_3.png 480w, https://blog.goldfishbrain-fighting.com/2023/kubernetes-docker/media/Pasted-image-20230920182502_hu0d54cd16036aa81d0943b0f05cc93b8a_152101_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="media/Pasted-image-20230920182502.png"
class="gallery-image"
data-flex-grow="166"
data-flex-basis="400px"
>&lt;/p>
&lt;h3 id="六開啟kubectl-shell介面rancher會臨時起一個容器來跑shell指令關閉shell介面容器就會刪除">六、開啟Kubectl Shell介面，Rancher會臨時起一個容器來跑Shell指令，關閉Shell介面，容器就會刪除&lt;/h3>
&lt;p>&lt;img src="https://blog.goldfishbrain-fighting.com/2023/kubernetes-docker/media/Pasted-image-20230920182636.png"
width="1568"
height="949"
srcset="https://blog.goldfishbrain-fighting.com/2023/kubernetes-docker/media/Pasted-image-20230920182636_hu7038623ebb20f600634e4c858d61cdf9_227476_480x0_resize_box_3.png 480w, https://blog.goldfishbrain-fighting.com/2023/kubernetes-docker/media/Pasted-image-20230920182636_hu7038623ebb20f600634e4c858d61cdf9_227476_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="media/Pasted-image-20230920182636.png"
class="gallery-image"
data-flex-grow="165"
data-flex-basis="396px"
>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">root@k8s-master71u:~# kubectl get pod -n cattle-system -o wide
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME READY STATUS RESTARTS AGE IP NODE NOMINATED NODE READINESS GATES
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">cattle-cluster-agent-6c97c478bb-mjgwg 1/1 Running &lt;span class="m">0&lt;/span> 6m11s 10.244.14.137 k8s-node75u &amp;lt;none&amp;gt; &amp;lt;none&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">cattle-cluster-agent-6c97c478bb-vdn59 1/1 Running &lt;span class="m">0&lt;/span> 17m 10.244.255.199 k8s-node76u &amp;lt;none&amp;gt; &amp;lt;none&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">dashboard-shell-75g77 2/2 Running &lt;span class="m">0&lt;/span> 9s 10.244.255.202 k8s-node76u &amp;lt;none&amp;gt; &amp;lt;none&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">rancher-webhook-74c9bd4d6-znrdp 1/1 Running &lt;span class="m">0&lt;/span> 2m12s 10.244.255.201 k8s-node76u &amp;lt;none&amp;gt; &amp;lt;none&amp;gt;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="三加入windows-server-active-directory-ldap">三、加入Windows Server Active Directory (LDAP)&lt;/h2>
&lt;p>Rancher官網設定網址： &lt;a class="link" href="https://ranchermanager.docs.rancher.com/zh/how-to-guides/new-user-guides/authentication-permissions-and-global-configuration/authentication-config/configure-active-directory" target="_blank" rel="noopener"
>https://ranchermanager.docs.rancher.com/zh/how-to-guides/new-user-guides/authentication-permissions-and-global-configuration/authentication-config/configure-active-directory&lt;/a>&lt;/p>
&lt;h3 id="一查看可以整合登入驗證的方式">一、查看可以整合登入驗證的方式&lt;/h3>
&lt;p>&lt;img src="https://blog.goldfishbrain-fighting.com/2023/kubernetes-docker/media/Pasted-image-20230920183804.png"
width="277"
height="578"
srcset="https://blog.goldfishbrain-fighting.com/2023/kubernetes-docker/media/Pasted-image-20230920183804_hubff23e8276d6d1ee799bc3e36745626f_37911_480x0_resize_box_3.png 480w, https://blog.goldfishbrain-fighting.com/2023/kubernetes-docker/media/Pasted-image-20230920183804_hubff23e8276d6d1ee799bc3e36745626f_37911_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="media/Pasted-image-20230920183804.png"
class="gallery-image"
data-flex-grow="47"
data-flex-basis="115px"
>&lt;/p>
&lt;p>&lt;img src="https://blog.goldfishbrain-fighting.com/2023/kubernetes-docker/media/Pasted-image-20230920183831.png"
width="1553"
height="713"
srcset="https://blog.goldfishbrain-fighting.com/2023/kubernetes-docker/media/Pasted-image-20230920183831_hu316de54a60d50e6d08a5ea8995e319c3_103739_480x0_resize_box_3.png 480w, https://blog.goldfishbrain-fighting.com/2023/kubernetes-docker/media/Pasted-image-20230920183831_hu316de54a60d50e6d08a5ea8995e319c3_103739_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="media/Pasted-image-20230920183831.png"
class="gallery-image"
data-flex-grow="217"
data-flex-basis="522px"
>&lt;/p>
&lt;h3 id="二創建ad使用者供rancher獲取ldap使用者資料">二、創建AD使用者，供Rancher獲取ldap使用者資料&lt;/h3>
&lt;p>&lt;img src="https://blog.goldfishbrain-fighting.com/2023/kubernetes-docker/media/Pasted-image-20230920195052.png"
width="1022"
height="672"
srcset="https://blog.goldfishbrain-fighting.com/2023/kubernetes-docker/media/Pasted-image-20230920195052_hu4bf1f5dae4f9517e3a6de85d581b01ad_468873_480x0_resize_box_3.png 480w, https://blog.goldfishbrain-fighting.com/2023/kubernetes-docker/media/Pasted-image-20230920195052_hu4bf1f5dae4f9517e3a6de85d581b01ad_468873_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="media/Pasted-image-20230920195052.png"
class="gallery-image"
data-flex-grow="152"
data-flex-basis="365px"
>&lt;/p>
&lt;p>&lt;img src="https://blog.goldfishbrain-fighting.com/2023/kubernetes-docker/media/Pasted-image-20230920195204.png"
width="508"
height="427"
srcset="https://blog.goldfishbrain-fighting.com/2023/kubernetes-docker/media/Pasted-image-20230920195204_hu67582e5b58b9fa956d48e3e1b3025d88_55257_480x0_resize_box_3.png 480w, https://blog.goldfishbrain-fighting.com/2023/kubernetes-docker/media/Pasted-image-20230920195204_hu67582e5b58b9fa956d48e3e1b3025d88_55257_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="media/Pasted-image-20230920195204.png"
class="gallery-image"
data-flex-grow="118"
data-flex-basis="285px"
>&lt;/p>
&lt;p>&lt;img src="https://blog.goldfishbrain-fighting.com/2023/kubernetes-docker/media/Pasted-image-20230920195303.png"
width="512"
height="430"
srcset="https://blog.goldfishbrain-fighting.com/2023/kubernetes-docker/media/Pasted-image-20230920195303_hua519bb2883bb325622ef0a431cf08e34_56340_480x0_resize_box_3.png 480w, https://blog.goldfishbrain-fighting.com/2023/kubernetes-docker/media/Pasted-image-20230920195303_hua519bb2883bb325622ef0a431cf08e34_56340_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="media/Pasted-image-20230920195303.png"
class="gallery-image"
data-flex-grow="119"
data-flex-basis="285px"
>&lt;/p>
&lt;p>&lt;img src="https://blog.goldfishbrain-fighting.com/2023/kubernetes-docker/media/Pasted-image-20230920195336.png"
width="748"
height="526"
srcset="https://blog.goldfishbrain-fighting.com/2023/kubernetes-docker/media/Pasted-image-20230920195336_hu0984df2fb84430bf441ceeaf57952603_246853_480x0_resize_box_3.png 480w, https://blog.goldfishbrain-fighting.com/2023/kubernetes-docker/media/Pasted-image-20230920195336_hu0984df2fb84430bf441ceeaf57952603_246853_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="media/Pasted-image-20230920195336.png"
class="gallery-image"
data-flex-grow="142"
data-flex-basis="341px"
>&lt;/p>
&lt;h3 id="三使用ldapsearch測試一下是否可以查找到剛剛建立的使用者資訊">三、使用ldapsearch測試一下，是否可以查找到剛剛建立的使用者資訊&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">chenqingze@chenqingze-MBP ~ % ldapsearch -x -H &lt;span class="s2">&amp;#34;ldap://192.168.1.49:389&amp;#34;&lt;/span> -D &lt;span class="s2">&amp;#34;jimmyhome\rancheruser&amp;#34;&lt;/span> -w &lt;span class="s2">&amp;#34;密碼&amp;#34;&lt;/span> &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> -b &lt;span class="s2">&amp;#34;dc=jimmyhome,dc=tw&amp;#34;&lt;/span> -s sub &lt;span class="s2">&amp;#34;sAMAccountName=rancheruser&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># extended LDIF&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># LDAPv3&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># base &amp;lt;dc=jimmyhome,dc=tw&amp;gt; with scope subtree&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># filter: sAMAccountName=rancheruser&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># requesting: ALL&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">#&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># rancheruser, Users, jimmyhome.tw&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">dn: &lt;span class="nv">CN&lt;/span>&lt;span class="o">=&lt;/span>rancheruser,CN&lt;span class="o">=&lt;/span>Users,DC&lt;span class="o">=&lt;/span>jimmyhome,DC&lt;span class="o">=&lt;/span>tw
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">objectClass: top
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">objectClass: person
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">objectClass: organizationalPerson
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">objectClass: user
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">cn: rancheruser
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">givenName: rancheruser
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">distinguishedName: &lt;span class="nv">CN&lt;/span>&lt;span class="o">=&lt;/span>rancheruser,CN&lt;span class="o">=&lt;/span>Users,DC&lt;span class="o">=&lt;/span>jimmyhome,DC&lt;span class="o">=&lt;/span>tw
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">instanceType: &lt;span class="m">4&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">whenCreated: 20230920115311.0Z
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">whenChanged: 20230920120448.0Z
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">displayName: rancheruser
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">uSNCreated: &lt;span class="m">16399&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">uSNChanged: &lt;span class="m">16452&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">name: rancheruser
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">objectGUID:: &lt;span class="nv">B9nTPDTyY0ehHZz4mWIJ1Q&lt;/span>&lt;span class="o">==&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">userAccountControl: &lt;span class="m">66048&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">badPwdCount: &lt;span class="m">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">codePage: &lt;span class="m">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">countryCode: &lt;span class="m">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">badPasswordTime: &lt;span class="m">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lastLogoff: &lt;span class="m">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lastLogon: &lt;span class="m">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">pwdLastSet: &lt;span class="m">133396843913520620&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">primaryGroupID: &lt;span class="m">513&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">objectSid:: &lt;span class="nv">AQUAAAAAAAUVAAAA2KPkIYA62ax0WlhyTwQAAA&lt;/span>&lt;span class="o">==&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">accountExpires: &lt;span class="m">9223372036854775807&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">logonCount: &lt;span class="m">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sAMAccountName: rancheruser
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sAMAccountType: &lt;span class="m">805306368&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">userPrincipalName: rancheruser@jimmyhome.tw
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">objectCategory: &lt;span class="nv">CN&lt;/span>&lt;span class="o">=&lt;/span>Person,CN&lt;span class="o">=&lt;/span>Schema,CN&lt;span class="o">=&lt;/span>Configuration,DC&lt;span class="o">=&lt;/span>jimmyhome,DC&lt;span class="o">=&lt;/span>tw
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">dSCorePropagationData: 16010101000000.0Z
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">lastLogonTimestamp: &lt;span class="m">133396850882972826&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># search reference&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ref: ldap://ForestDnsZones.jimmyhome.tw/DC&lt;span class="o">=&lt;/span>ForestDnsZones,DC&lt;span class="o">=&lt;/span>jimmyhome,DC&lt;span class="o">=&lt;/span>tw
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># search reference&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ref: ldap://DomainDnsZones.jimmyhome.tw/DC&lt;span class="o">=&lt;/span>DomainDnsZones,DC&lt;span class="o">=&lt;/span>jimmyhome,DC&lt;span class="o">=&lt;/span>tw
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># search reference&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ref: ldap://jimmyhome.tw/CN&lt;span class="o">=&lt;/span>Configuration,DC&lt;span class="o">=&lt;/span>jimmyhome,DC&lt;span class="o">=&lt;/span>tw
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># search result&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">search: &lt;span class="m">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">result: &lt;span class="m">0&lt;/span> Success
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># numResponses: 5&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># numEntries: 1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># numReferences: 3&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="四整合ad驗證">四、整合AD驗證&lt;/h3>
&lt;p>&lt;img src="https://blog.goldfishbrain-fighting.com/2023/kubernetes-docker/media/Pasted-image-20230920195828.png"
width="1565"
height="752"
srcset="https://blog.goldfishbrain-fighting.com/2023/kubernetes-docker/media/Pasted-image-20230920195828_hu32023433e28c58be869cfd4b00a53e0a_109608_480x0_resize_box_3.png 480w, https://blog.goldfishbrain-fighting.com/2023/kubernetes-docker/media/Pasted-image-20230920195828_hu32023433e28c58be869cfd4b00a53e0a_109608_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="media/Pasted-image-20230920195828.png"
class="gallery-image"
data-flex-grow="208"
data-flex-basis="499px"
>&lt;/p>
&lt;p>&lt;img src="https://blog.goldfishbrain-fighting.com/2023/kubernetes-docker/media/Pasted-image-20230920202516.png"
width="1562"
height="770"
srcset="https://blog.goldfishbrain-fighting.com/2023/kubernetes-docker/media/Pasted-image-20230920202516_huf5819385887aa47ed3ad2353805236a5_89123_480x0_resize_box_3.png 480w, https://blog.goldfishbrain-fighting.com/2023/kubernetes-docker/media/Pasted-image-20230920202516_huf5819385887aa47ed3ad2353805236a5_89123_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="media/Pasted-image-20230920202516.png"
class="gallery-image"
data-flex-grow="202"
data-flex-basis="486px"
>&lt;/p>
&lt;p>&lt;img src="https://blog.goldfishbrain-fighting.com/2023/kubernetes-docker/media/Pasted-image-20230920200440.png"
width="1564"
height="876"
srcset="https://blog.goldfishbrain-fighting.com/2023/kubernetes-docker/media/Pasted-image-20230920200440_hu594f130566eb0d55a608ebc53d559d8b_105762_480x0_resize_box_3.png 480w, https://blog.goldfishbrain-fighting.com/2023/kubernetes-docker/media/Pasted-image-20230920200440_hu594f130566eb0d55a608ebc53d559d8b_105762_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="media/Pasted-image-20230920200440.png"
class="gallery-image"
data-flex-grow="178"
data-flex-basis="428px"
>
確認驗證成功，連接到ldap
&lt;img src="https://blog.goldfishbrain-fighting.com/2023/kubernetes-docker/media/Pasted-image-20230920202553.png"
width="1573"
height="400"
srcset="https://blog.goldfishbrain-fighting.com/2023/kubernetes-docker/media/Pasted-image-20230920202553_hu55c8f478c070de92d1bbb3a45da7ed62_61301_480x0_resize_box_3.png 480w, https://blog.goldfishbrain-fighting.com/2023/kubernetes-docker/media/Pasted-image-20230920202553_hu55c8f478c070de92d1bbb3a45da7ed62_61301_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="media/Pasted-image-20230920202553.png"
class="gallery-image"
data-flex-grow="393"
data-flex-basis="943px"
>&lt;/p>
&lt;p>可以看到，此時已經自動改成用剛剛驗證的ad帳戶登入了
&lt;img src="https://blog.goldfishbrain-fighting.com/2023/kubernetes-docker/media/Pasted-image-20230920203808.png"
width="1575"
height="444"
srcset="https://blog.goldfishbrain-fighting.com/2023/kubernetes-docker/media/Pasted-image-20230920203808_hue9cb7d09133fb0a90ab4f9720061370b_73641_480x0_resize_box_3.png 480w, https://blog.goldfishbrain-fighting.com/2023/kubernetes-docker/media/Pasted-image-20230920203808_hue9cb7d09133fb0a90ab4f9720061370b_73641_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="media/Pasted-image-20230920203808.png"
class="gallery-image"
data-flex-grow="354"
data-flex-basis="851px"
>&lt;/p>
&lt;h3 id="五再到ad創建一個使用者驗證一下是否rancher可以獲取到此使用者帳號">五、再到AD創建一個使用者，驗證一下，是否Rancher可以獲取到此使用者帳號&lt;/h3>
&lt;p>&lt;img src="https://blog.goldfishbrain-fighting.com/2023/kubernetes-docker/media/Pasted-image-20230920202931.png"
width="754"
height="530"
srcset="https://blog.goldfishbrain-fighting.com/2023/kubernetes-docker/media/Pasted-image-20230920202931_hucce501a8d63116565fd51bf626607f7a_265285_480x0_resize_box_3.png 480w, https://blog.goldfishbrain-fighting.com/2023/kubernetes-docker/media/Pasted-image-20230920202931_hucce501a8d63116565fd51bf626607f7a_265285_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="media/Pasted-image-20230920202931.png"
class="gallery-image"
data-flex-grow="142"
data-flex-basis="341px"
>&lt;/p>
&lt;p>編輯default project(裡面只有一個default namespace)
&lt;img src="https://blog.goldfishbrain-fighting.com/2023/kubernetes-docker/media/Pasted-image-20230920203941.png"
width="1573"
height="652"
srcset="https://blog.goldfishbrain-fighting.com/2023/kubernetes-docker/media/Pasted-image-20230920203941_hu85815b49f4cde207d4d8d84c72ff1e58_89204_480x0_resize_box_3.png 480w, https://blog.goldfishbrain-fighting.com/2023/kubernetes-docker/media/Pasted-image-20230920203941_hu85815b49f4cde207d4d8d84c72ff1e58_89204_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="media/Pasted-image-20230920203941.png"
class="gallery-image"
data-flex-grow="241"
data-flex-basis="579px"
>&lt;/p>
&lt;p>添加ldap帳號
&lt;img src="https://blog.goldfishbrain-fighting.com/2023/kubernetes-docker/media/Pasted-image-20230920204039.png"
width="1247"
height="487"
srcset="https://blog.goldfishbrain-fighting.com/2023/kubernetes-docker/media/Pasted-image-20230920204039_hu4d5d91582cc4c220bc6ff9f834b34b84_54173_480x0_resize_box_3.png 480w, https://blog.goldfishbrain-fighting.com/2023/kubernetes-docker/media/Pasted-image-20230920204039_hu4d5d91582cc4c220bc6ff9f834b34b84_54173_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="media/Pasted-image-20230920204039.png"
class="gallery-image"
data-flex-grow="256"
data-flex-basis="614px"
>&lt;/p>
&lt;p>可以看到有jimmy帳號
&lt;img src="https://blog.goldfishbrain-fighting.com/2023/kubernetes-docker/media/Pasted-image-20230920204053.png"
width="600"
height="515"
srcset="https://blog.goldfishbrain-fighting.com/2023/kubernetes-docker/media/Pasted-image-20230920204053_hu2abd776d23e2d0a365cc775f8f5692c4_43125_480x0_resize_box_3.png 480w, https://blog.goldfishbrain-fighting.com/2023/kubernetes-docker/media/Pasted-image-20230920204053_hu2abd776d23e2d0a365cc775f8f5692c4_43125_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="media/Pasted-image-20230920204053.png"
class="gallery-image"
data-flex-grow="116"
data-flex-basis="279px"
>&lt;/p>
&lt;p>添加此帳號
&lt;img src="https://blog.goldfishbrain-fighting.com/2023/kubernetes-docker/media/Pasted-image-20230920204121.png"
width="1573"
height="871"
srcset="https://blog.goldfishbrain-fighting.com/2023/kubernetes-docker/media/Pasted-image-20230920204121_hu80effc2f7246d9943ad2ff6d835d4b03_79555_480x0_resize_box_3.png 480w, https://blog.goldfishbrain-fighting.com/2023/kubernetes-docker/media/Pasted-image-20230920204121_hu80effc2f7246d9943ad2ff6d835d4b03_79555_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="media/Pasted-image-20230920204121.png"
class="gallery-image"
data-flex-grow="180"
data-flex-basis="433px"
>&lt;/p>
&lt;p>登出Rancher，改用jimmy帳號登入，密碼是ad中設定的密碼
&lt;img src="https://blog.goldfishbrain-fighting.com/2023/kubernetes-docker/media/Pasted-image-20230920203512.png"
width="785"
height="724"
srcset="https://blog.goldfishbrain-fighting.com/2023/kubernetes-docker/media/Pasted-image-20230920203512_hu88df8f70c9e88da09d43788021a358c2_40923_480x0_resize_box_3.png 480w, https://blog.goldfishbrain-fighting.com/2023/kubernetes-docker/media/Pasted-image-20230920203512_hu88df8f70c9e88da09d43788021a358c2_40923_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="media/Pasted-image-20230920203512.png"
class="gallery-image"
data-flex-grow="108"
data-flex-basis="260px"
>
確認可以登入
&lt;img src="https://blog.goldfishbrain-fighting.com/2023/kubernetes-docker/media/Pasted-image-20230920204201.png"
width="1572"
height="664"
srcset="https://blog.goldfishbrain-fighting.com/2023/kubernetes-docker/media/Pasted-image-20230920204201_hu7ae9ac3b08242c87cd4281f509e35bba_85934_480x0_resize_box_3.png 480w, https://blog.goldfishbrain-fighting.com/2023/kubernetes-docker/media/Pasted-image-20230920204201_hu7ae9ac3b08242c87cd4281f509e35bba_85934_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="media/Pasted-image-20230920204201.png"
class="gallery-image"
data-flex-grow="236"
data-flex-basis="568px"
>&lt;/p>
&lt;p>&lt;img src="https://blog.goldfishbrain-fighting.com/2023/kubernetes-docker/media/Pasted-image-20230920204230.png"
width="1561"
height="692"
srcset="https://blog.goldfishbrain-fighting.com/2023/kubernetes-docker/media/Pasted-image-20230920204230_hud978b472884248a7277e5c20dd0fafaf_82394_480x0_resize_box_3.png 480w, https://blog.goldfishbrain-fighting.com/2023/kubernetes-docker/media/Pasted-image-20230920204230_hud978b472884248a7277e5c20dd0fafaf_82394_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="media/Pasted-image-20230920204230.png"
class="gallery-image"
data-flex-grow="225"
data-flex-basis="541px"
>&lt;/p>
&lt;p>可以看到，能查看到default project與default namespace
&lt;img src="https://blog.goldfishbrain-fighting.com/2023/kubernetes-docker/media/Pasted-image-20230920204242.png"
width="1568"
height="428"
srcset="https://blog.goldfishbrain-fighting.com/2023/kubernetes-docker/media/Pasted-image-20230920204242_hu72ca91c4954247a7001523fef5da9ab9_54105_480x0_resize_box_3.png 480w, https://blog.goldfishbrain-fighting.com/2023/kubernetes-docker/media/Pasted-image-20230920204242_hu72ca91c4954247a7001523fef5da9ab9_54105_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="media/Pasted-image-20230920204242.png"
class="gallery-image"
data-flex-grow="366"
data-flex-basis="879px"
>&lt;/p>
&lt;p>dashboard shell也是可以使用的，但只能看到default namespace的資源
&lt;img src="https://blog.goldfishbrain-fighting.com/2023/kubernetes-docker/media/Pasted-image-20230920204317.png"
width="1562"
height="588"
srcset="https://blog.goldfishbrain-fighting.com/2023/kubernetes-docker/media/Pasted-image-20230920204317_hu6392b9858d6d8f644485c04ae83482b0_79177_480x0_resize_box_3.png 480w, https://blog.goldfishbrain-fighting.com/2023/kubernetes-docker/media/Pasted-image-20230920204317_hu6392b9858d6d8f644485c04ae83482b0_79177_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="media/Pasted-image-20230920204317.png"
class="gallery-image"
data-flex-grow="265"
data-flex-basis="637px"
>&lt;/p>
&lt;p>是無法查看kube-system namespace的資源，確實跟前面設定的權限是符合的
&lt;img src="https://blog.goldfishbrain-fighting.com/2023/kubernetes-docker/media/Pasted-image-20230920204411.png"
width="1581"
height="615"
srcset="https://blog.goldfishbrain-fighting.com/2023/kubernetes-docker/media/Pasted-image-20230920204411_hu365ef24150b6d29b60f3749b249db757_101516_480x0_resize_box_3.png 480w, https://blog.goldfishbrain-fighting.com/2023/kubernetes-docker/media/Pasted-image-20230920204411_hu365ef24150b6d29b60f3749b249db757_101516_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="media/Pasted-image-20230920204411.png"
class="gallery-image"
data-flex-grow="257"
data-flex-basis="616px"
>&lt;/p>
&lt;h3 id="六也可以下載連線設定檔到自己常用linux主機連線管理">六、也可以下載連線設定檔到自己常用linux主機，連線管理&lt;/h3>
&lt;p>&lt;img src="https://blog.goldfishbrain-fighting.com/2023/kubernetes-docker/media/Pasted-image-20230920204450.png"
width="1568"
height="509"
srcset="https://blog.goldfishbrain-fighting.com/2023/kubernetes-docker/media/Pasted-image-20230920204450_hu09d71deb5eec4885ea45686ca35e74b2_90652_480x0_resize_box_3.png 480w, https://blog.goldfishbrain-fighting.com/2023/kubernetes-docker/media/Pasted-image-20230920204450_hu09d71deb5eec4885ea45686ca35e74b2_90652_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="media/Pasted-image-20230920204450.png"
class="gallery-image"
data-flex-grow="308"
data-flex-basis="739px"
>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 1. 將下載的設定檔，scp到常用linux主機&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">chenqingze@chenqingze-MBP ~ % scp /Users/chenqingze/Downloads/kubernetes-config.yml root@192.168.1.76:/root/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 2. 可以看到設定檔&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">root@k8s-node76u:~# ls -l
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">total &lt;span class="m">9376&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-r--r-- &lt;span class="m">1&lt;/span> root root &lt;span class="m">1396&lt;/span> Sep &lt;span class="m">20&lt;/span> 12:47 kubernetes-config.yml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 3. 在使用者家目錄下，創建.kube目錄&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">root@k8s-node76u:~# mkdir .kube
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 4. 將設定檔複製到.kube目錄，且命名為config(因kubectl預設就是用.kube/config設定檔連線)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">root@k8s-node76u:~# cp kubernetes-config.yml ~/.kube/config
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 5. 確認可以連線，查看default namespace下的資源&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">root@k8s-node76u:~# kubectl get pod
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME READY STATUS RESTARTS AGE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">test-nginx 1/1 Running &lt;span class="m">1&lt;/span> &lt;span class="o">(&lt;/span>3h20m ago&lt;span class="o">)&lt;/span> 7h26m
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 6. 其他namespace下的資源，是無法查看的&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">root@k8s-node76u:~# kubectl get pod -n kube-system
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Error from server &lt;span class="o">(&lt;/span>Forbidden&lt;span class="o">)&lt;/span>: pods is forbidden: User &lt;span class="s2">&amp;#34;u-hx7xy6ap22&amp;#34;&lt;/span> cannot list resource &lt;span class="s2">&amp;#34;pods&amp;#34;&lt;/span> in API group &lt;span class="s2">&amp;#34;&amp;#34;&lt;/span> in the namespace &lt;span class="s2">&amp;#34;kube-system&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>使用Helm安裝Rancher管理平台，納管現有k8s集群(高可用)</title><link>https://blog.goldfishbrain-fighting.com/2023/kubernetes-helm/</link><pubDate>Sat, 07 Oct 2023 01:00:00 +0800</pubDate><guid>https://blog.goldfishbrain-fighting.com/2023/kubernetes-helm/</guid><description>&lt;p>&lt;img src="https://blog.goldfishbrain-fighting.com/2023/kubernetes-helm/media/Pasted-image-20230922172936.png"
width="1323"
height="728"
srcset="https://blog.goldfishbrain-fighting.com/2023/kubernetes-helm/media/Pasted-image-20230922172936_hu707fbbc58435615f6600069941230842_701550_480x0_resize_box_3.png 480w, https://blog.goldfishbrain-fighting.com/2023/kubernetes-helm/media/Pasted-image-20230922172936_hu707fbbc58435615f6600069941230842_701550_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="media/Pasted-image-20230922172936.png"
class="gallery-image"
data-flex-grow="181"
data-flex-basis="436px"
>&lt;/p>
&lt;p>安裝先決條件：&lt;/p>
&lt;ul>
&lt;li>kubernetes 集群&lt;/li>
&lt;li>Ingress Controller&lt;/li>
&lt;li>Helm 、kubectl CLI 工具&lt;/li>
&lt;/ul>
&lt;h2 id="一ingress-controller安裝">一、Ingress Controller安裝&lt;/h2>
&lt;p>github網址:&lt;/p>
&lt;p>&lt;a class="link" href="https://github.com/kubernetes/ingress-nginx" target="_blank" rel="noopener"
>https://github.com/kubernetes/ingress-nginx&lt;/a>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">chenqingze@chenqingze-MBP ~ % scp /Users/chenqingze/Downloads/ingress-nginx-controller-v1.6.4.tar.gz root@192.168.1.71:/root
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">root@k8s-master71u:~# tar -xzvf ingress-nginx-controller-v1.6.4.tar.gz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">root@k8s-master71u:~# &lt;span class="nb">cd&lt;/span> ingress-nginx-controller-v1.6.4/deploy/static/provider/baremetal
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># Deployment改成DaemonSet &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 添加hostNetwork: true&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">root@k8s-master71u:~/ingress-nginx-controller-v1.6.4/deploy/static/provider/baremetal# vim deploy.yaml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">---
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">apiVersion: apps/v1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kind: DaemonSet
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">metadata:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> labels:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> app.kubernetes.io/component: controller
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> app.kubernetes.io/instance: ingress-nginx
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> app.kubernetes.io/name: ingress-nginx
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> app.kubernetes.io/part-of: ingress-nginx
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> app.kubernetes.io/version: 1.6.4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> name: ingress-nginx-controller
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> namespace: ingress-nginx
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">spec:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> minReadySeconds: &lt;span class="m">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> revisionHistoryLimit: &lt;span class="m">10&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> selector:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> matchLabels:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> app.kubernetes.io/component: controller
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> app.kubernetes.io/instance: ingress-nginx
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> app.kubernetes.io/name: ingress-nginx
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> template:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> metadata:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> labels:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> app.kubernetes.io/component: controller
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> app.kubernetes.io/instance: ingress-nginx
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> app.kubernetes.io/name: ingress-nginx
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> spec:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> hostNetwork: &lt;span class="nb">true&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> containers:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">root@k8s-master71u:~/ingress-nginx-controller-v1.6.4/deploy/static/provider/baremetal# kubectl apply -f deploy.yaml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">root@k8s-master71u:~/ingress-nginx-controller-v1.6.4/deploy/static/provider/baremetal# kubectl get pod -n ingress-nginx -owide
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME READY STATUS RESTARTS AGE IP NODE NOMINATED NODE READINESS GATES
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ingress-nginx-admission-create-zmkrl 0/1 Completed &lt;span class="m">0&lt;/span> 73s 10.244.255.199 k8s-node76u &amp;lt;none&amp;gt; &amp;lt;none&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ingress-nginx-admission-patch-rlglf 0/1 Completed &lt;span class="m">0&lt;/span> 73s 10.244.14.133 k8s-node75u &amp;lt;none&amp;gt; &amp;lt;none&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ingress-nginx-controller-js2fl 1/1 Running &lt;span class="m">0&lt;/span> 73s 192.168.1.76 k8s-node76u &amp;lt;none&amp;gt; &amp;lt;none&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">ingress-nginx-controller-mmc2h 1/1 Running &lt;span class="m">0&lt;/span> 73s 192.168.1.75 k8s-node75u &amp;lt;none&amp;gt; &amp;lt;none&amp;gt;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="二kubectl與helm-cli-工具安裝">二、Kubectl與Helm CLI 工具安裝&lt;/h2>
&lt;p>官方安裝網站： &lt;a class="link" href="https://helm.sh/docs/intro/install/" target="_blank" rel="noopener"
>https://helm.sh/docs/intro/install/&lt;/a>&lt;/p>
&lt;p>Helm v3.12.3 Binary Releases：
&lt;a class="link" href="https://get.helm.sh/helm-v3.12.3-linux-amd64.tar.gz" target="_blank" rel="noopener"
>https://get.helm.sh/helm-v3.12.3-linux-amd64.tar.gz&lt;/a>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">root@k8s-master71u:~# wget https://get.helm.sh/helm-v3.12.3-linux-amd64.tar.gz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">root@k8s-master71u:~# tar -zxvf helm-v3.12.3-linux-amd64.tar.gz
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">root@k8s-master71u:~# mv linux-amd64/helm /usr/local/bin/helm
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>Kubectl：
&lt;a class="link" href="https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/install-kubeadm/" target="_blank" rel="noopener"
>https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/install-kubeadm/&lt;/a>&lt;/p>
&lt;p>如果主機就是master,應該都有kubectl了,此流程可以略過&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 1. Update the apt package index and install packages needed to use the Kubernetes apt repository:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo apt-get update
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo apt-get install -y apt-transport-https ca-certificates curl
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 2. Download the Google Cloud public signing key:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">curl -fsSL https://packages.cloud.google.com/apt/doc/apt-key.gpg &lt;span class="p">|&lt;/span> sudo gpg --dearmor -o /etc/apt/keyrings/kubernetes-archive-keyring.gpg
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 3. Add the Kubernetes apt repository:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> &lt;span class="s2">&amp;#34;deb [signed-by=/etc/apt/keyrings/kubernetes-archive-keyring.gpg] https://apt.kubernetes.io/ kubernetes-xenial main&amp;#34;&lt;/span> &lt;span class="p">|&lt;/span> sudo tee /etc/apt/sources.list.d/kubernetes.list
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 4. 檢查是否已經添加源 &lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">root@k8s-master71u:~# cat /etc/apt/sources.list.d/kubernetes.list
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">deb &lt;span class="o">[&lt;/span>signed-by&lt;span class="o">=&lt;/span>/etc/apt/keyrings/kubernetes-archive-keyring.gpg&lt;span class="o">]&lt;/span> https://apt.kubernetes.io/ kubernetes-xenial main
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 5. Update apt package index, install kubelet, kubeadm and kubectl, and pin their version:&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sudo apt-get update
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">root@k8s-master71u:~# sudo apt-get install -y &lt;span class="nv">kubectl&lt;/span>&lt;span class="o">=&lt;/span>1.26.3-00
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 查看版本&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">root@k8s-master71u:~# kubectl version
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="三rancher高可用管理平台安裝">三、Rancher高可用管理平台安裝&lt;/h2>
&lt;h3 id="一添加-helm-chart-倉庫">一、添加 Helm Chart 倉庫&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">root@k8s-master71u:~# helm repo add rancher-stable https://releases.rancher.com/server-charts/stable
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2">&amp;#34;rancher-stable&amp;#34;&lt;/span> has been added to your repositories
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="二為-rancher-建立命名空間">二、為 Rancher 建立命名空間&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">root@k8s-master71u:~# kubectl create namespace cattle-system
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="三選擇-ssl-配置">三、選擇 SSL 配置&lt;/h3>
&lt;p>Rancher 產生的憑證（預設）
需要 cert-manager&lt;/p>
&lt;h3 id="四安裝-cert-manager">四、安裝 cert-manager&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 如果你手動安裝了CRD，而不是在 Helm 安裝命令中添加了 &amp;#39;--set installCRDs=true&amp;#39; 選項，你應該在升級 Helm Chart 之前升級 CRD 資源。&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">root@k8s-master71u:~# kubectl apply -f https://github.com/cert-manager/cert-manager/releases/download/v1.11.0/cert-manager.crds.yaml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 添加 Jetstack Helm 倉庫&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">root@k8s-master71u:~# helm repo add jetstack https://charts.jetstack.io
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 更新本地 Helm Chart 倉庫緩存&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">root@k8s-master71u:~# helm repo update
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Hang tight &lt;span class="k">while&lt;/span> we grab the latest from your chart repositories...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">...Successfully got an update from the &lt;span class="s2">&amp;#34;jetstack&amp;#34;&lt;/span> chart repository
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">...Successfully got an update from the &lt;span class="s2">&amp;#34;rancher-stable&amp;#34;&lt;/span> chart repository
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Update Complete. ⎈Happy Helming!⎈
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 安裝 cert-manager Helm Chart&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">root@k8s-master71u:~# helm install cert-manager jetstack/cert-manager &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> --namespace cert-manager &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> --create-namespace &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> --version v1.11.0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 安裝完 cert-manager 后，你可以通過檢查 cert-manager 命名空間中正在運行的 Pod 來驗證它是否已正確部署&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">root@k8s-master71u:~# kubectl get pods --namespace cert-manager
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME READY STATUS RESTARTS AGE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">cert-manager-64f9f45d6f-8j65z 1/1 Running &lt;span class="m">0&lt;/span> 2m1s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">cert-manager-cainjector-56bbdd5c47-4hngr 1/1 Running &lt;span class="m">0&lt;/span> 2m1s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">cert-manager-startupapicheck-vzq7z 0/1 Completed &lt;span class="m">0&lt;/span> 2m
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">cert-manager-webhook-d4f4545d7-rhbkv 1/1 Running &lt;span class="m">0&lt;/span> 2m1s
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="五根據你選擇的證書選項通過-helm-安裝-rancher">五、根據你選擇的證書選項，通過 Helm 安裝 Rancher&lt;/h3>
&lt;p>採Rancher 生成的證書方式&lt;/p>
&lt;p>Rancher Helm Chart 選項：
&lt;a class="link" href="https://ranchermanager.docs.rancher.com/zh/getting-started/installation-and-upgrade/installation-references/helm-chart-options" target="_blank" rel="noopener"
>https://ranchermanager.docs.rancher.com/zh/getting-started/installation-and-upgrade/installation-references/helm-chart-options&lt;/a>&lt;/p>
&lt;p>&lt;font color=red>需多指定ingressClassName為nginx&lt;/font>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">root@k8s-master71u:~# helm install rancher rancher-stable/rancher &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> --namespace cattle-system &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> --set &lt;span class="nv">hostname&lt;/span>&lt;span class="o">=&lt;/span>rancher.jimmyhome.tw &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> --set &lt;span class="nv">bootstrapPassword&lt;/span>&lt;span class="o">=&lt;/span>admin &lt;span class="se">\
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">&lt;/span> --set ingress.ingressClassName&lt;span class="o">=&lt;/span>nginx
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME: rancher
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">LAST DEPLOYED: Wed Sep &lt;span class="m">20&lt;/span> 18:31:10 &lt;span class="m">2023&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAMESPACE: cattle-system
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">STATUS: deployed
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">REVISION: &lt;span class="m">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">TEST SUITE: None
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NOTES:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Rancher Server has been installed.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NOTE: Rancher may take several minutes to fully initialize. Please standby &lt;span class="k">while&lt;/span> Certificates are being issued, Containers are started and the Ingress rule comes up.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Check out our docs at https://rancher.com/docs/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">If you provided your own bootstrap password during installation, browse to https://rancher.jimmyhome.tw to get started.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">If this is the first &lt;span class="nb">time&lt;/span> you installed Rancher, get started by running this &lt;span class="nb">command&lt;/span> and clicking the URL it generates:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">echo&lt;/span> https://rancher.jimmyhome.tw/dashboard/?setup&lt;span class="o">=&lt;/span>&lt;span class="k">$(&lt;/span>kubectl get secret --namespace cattle-system bootstrap-secret -o go-template&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;{{.data.bootstrapPassword|base64decode}}&amp;#39;&lt;/span>&lt;span class="k">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">To get just the bootstrap password on its own, run:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">kubectl get secret --namespace cattle-system bootstrap-secret -o go-template&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;{{.data.bootstrapPassword|base64decode}}{{ &amp;#34;\n&amp;#34; }}&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Happy Containering!
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 等待 Rancher 運行&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">root@k8s-master71u:~# kubectl -n cattle-system rollout status deploy/rancher
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Waiting &lt;span class="k">for&lt;/span> deployment &lt;span class="s2">&amp;#34;rancher&amp;#34;&lt;/span> rollout to finish: &lt;span class="m">0&lt;/span> of &lt;span class="m">3&lt;/span> updated replicas are available...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Waiting &lt;span class="k">for&lt;/span> deployment &lt;span class="s2">&amp;#34;rancher&amp;#34;&lt;/span> rollout to finish: &lt;span class="m">1&lt;/span> of &lt;span class="m">3&lt;/span> updated replicas are available...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Waiting &lt;span class="k">for&lt;/span> deployment &lt;span class="s2">&amp;#34;rancher&amp;#34;&lt;/span> rollout to finish: &lt;span class="m">2&lt;/span> of &lt;span class="m">3&lt;/span> updated replicas are available...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">deployment &lt;span class="s2">&amp;#34;rancher&amp;#34;&lt;/span> successfully rolled out
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="六驗證-rancher-server-是否部署成功">六、驗證 Rancher Server 是否部署成功&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">root@k8s-master71u:~# kubectl -n cattle-system get deploy
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME READY UP-TO-DATE AVAILABLE AGE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">rancher 3/3 &lt;span class="m">3&lt;/span> &lt;span class="m">3&lt;/span> 53s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">root@k8s-master71u:~# kubectl -n cattle-system get ingress
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME CLASS HOSTS ADDRESS PORTS AGE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">rancher nginx rancher.jimmyhome.tw 192.168.1.75,192.168.1.76 80, &lt;span class="m">443&lt;/span> 67s
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 我自己的筆電，先設定/etc/hosts測試網頁訪問&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 如是內部有dns server的，就到dns server設定a record解析&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">chenqingze@chenqingze-MBP ~ % sudo vim /etc/hosts
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">192.168.1.75 rancher.jimmyhome.tw
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>打 &lt;a class="link" href="https://rancher.jimmyhome.tw" target="_blank" rel="noopener"
>https://rancher.jimmyhome.tw&lt;/a> 可以看到網頁
&lt;img src="https://blog.goldfishbrain-fighting.com/2023/kubernetes-helm/media/Pasted-image-20230921023255.png"
width="1010"
height="894"
srcset="https://blog.goldfishbrain-fighting.com/2023/kubernetes-helm/media/Pasted-image-20230921023255_hu255ddf89689e804c5d835315e9863c95_89733_480x0_resize_box_3.png 480w, https://blog.goldfishbrain-fighting.com/2023/kubernetes-helm/media/Pasted-image-20230921023255_hu255ddf89689e804c5d835315e9863c95_89733_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="media/Pasted-image-20230921023255.png"
class="gallery-image"
data-flex-grow="112"
data-flex-basis="271px"
>
由上方helm install rancher完成時，可以看到以下兩個指令，可以獲取到預設admin帳號的密碼&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># If this is the first time you installed Rancher, get started by running this command and clicking the URL it generates&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">root@k8s-master71u:~# &lt;span class="nb">echo&lt;/span> https://rancher.jimmyhome.tw/dashboard/?setup&lt;span class="o">=&lt;/span>&lt;span class="k">$(&lt;/span>kubectl get secret --namespace cattle-system bootstrap-secret -o go-template&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;{{.data.bootstrapPassword|base64decode}}&amp;#39;&lt;/span>&lt;span class="k">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">https://rancher.jimmyhome.tw/dashboard/?setup&lt;span class="o">=&lt;/span>admin
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># To get just the bootstrap password on its own, run&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">root@k8s-master71u:~# kubectl get secret --namespace cattle-system bootstrap-secret -o go-template&lt;span class="o">=&lt;/span>&lt;span class="s1">&amp;#39;{{.data.bootstrapPassword|base64decode}}{{ &amp;#34;\n&amp;#34; }}&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">admin
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>重設admin帳號的密碼
&lt;img src="https://blog.goldfishbrain-fighting.com/2023/kubernetes-helm/media/Pasted-image-20230921023557.png"
width="1008"
height="893"
srcset="https://blog.goldfishbrain-fighting.com/2023/kubernetes-helm/media/Pasted-image-20230921023557_hu9e81d5777cb32757e44e3be582d3603e_90642_480x0_resize_box_3.png 480w, https://blog.goldfishbrain-fighting.com/2023/kubernetes-helm/media/Pasted-image-20230921023557_hu9e81d5777cb32757e44e3be582d3603e_90642_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="media/Pasted-image-20230921023557.png"
class="gallery-image"
data-flex-grow="112"
data-flex-basis="270px"
>&lt;/p>
&lt;p>輸入剛剛重設的admin密碼，登入
&lt;img src="https://blog.goldfishbrain-fighting.com/2023/kubernetes-helm/media/Pasted-image-20230921031136.png"
width="991"
height="782"
srcset="https://blog.goldfishbrain-fighting.com/2023/kubernetes-helm/media/Pasted-image-20230921031136_hubdf0d5ed0ba43ff474725ac5a8ecccc3_79311_480x0_resize_box_3.png 480w, https://blog.goldfishbrain-fighting.com/2023/kubernetes-helm/media/Pasted-image-20230921031136_hubdf0d5ed0ba43ff474725ac5a8ecccc3_79311_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="media/Pasted-image-20230921031136.png"
class="gallery-image"
data-flex-grow="126"
data-flex-basis="304px"
>&lt;/p>
&lt;p>可以看到集群資訊，state為Active
&lt;img src="https://blog.goldfishbrain-fighting.com/2023/kubernetes-helm/media/Pasted-image-20230921031249.png"
width="1457"
height="722"
srcset="https://blog.goldfishbrain-fighting.com/2023/kubernetes-helm/media/Pasted-image-20230921031249_hucbbfb060f3c77e6be7bccf554592ce7d_77193_480x0_resize_box_3.png 480w, https://blog.goldfishbrain-fighting.com/2023/kubernetes-helm/media/Pasted-image-20230921031249_hucbbfb060f3c77e6be7bccf554592ce7d_77193_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="media/Pasted-image-20230921031249.png"
class="gallery-image"
data-flex-grow="201"
data-flex-basis="484px"
>&lt;/p>
&lt;p>進入集群，可以看到集群詳細訊息
&lt;img src="https://blog.goldfishbrain-fighting.com/2023/kubernetes-helm/media/Pasted-image-20230921031718.png"
width="1975"
height="944"
srcset="https://blog.goldfishbrain-fighting.com/2023/kubernetes-helm/media/Pasted-image-20230921031718_hu475c36b1f3937b05de60533cd5928b74_159357_480x0_resize_box_3.png 480w, https://blog.goldfishbrain-fighting.com/2023/kubernetes-helm/media/Pasted-image-20230921031718_hu475c36b1f3937b05de60533cd5928b74_159357_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="media/Pasted-image-20230921031718.png"
class="gallery-image"
data-flex-grow="209"
data-flex-basis="502px"
>&lt;/p>
&lt;p>也可以使用dashboard shell去管理集群
&lt;img src="https://blog.goldfishbrain-fighting.com/2023/kubernetes-helm/media/Pasted-image-20230921031746.png"
width="1983"
height="721"
srcset="https://blog.goldfishbrain-fighting.com/2023/kubernetes-helm/media/Pasted-image-20230921031746_hu87f73535b369c4edcdb990f935a08331_143573_480x0_resize_box_3.png 480w, https://blog.goldfishbrain-fighting.com/2023/kubernetes-helm/media/Pasted-image-20230921031746_hu87f73535b369c4edcdb990f935a08331_143573_1024x0_resize_box_3.png 1024w"
loading="lazy"
alt="media/Pasted-image-20230921031746.png"
class="gallery-image"
data-flex-grow="275"
data-flex-basis="660px"
>&lt;/p></description></item></channel></rss>