<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>redis on 翻轉吧金魚腦</title><link>https://blog.goldfishbrain-fighting.com/tags/redis/</link><description>Recent content in redis on 翻轉吧金魚腦</description><generator>Hugo -- gohugo.io</generator><language>en-us</language><lastBuildDate>Sun, 17 Dec 2023 18:49:32 +0800</lastBuildDate><atom:link href="https://blog.goldfishbrain-fighting.com/tags/redis/index.xml" rel="self" type="application/rss+xml"/><item><title>使用RedisInsight 1.x版，BULK ACTIONS功能，還原數據，從一個cluster遷移所有分片數據到另一個cluster，結果->有些數據Key Name被修改了，此方式不可行</title><link>https://blog.goldfishbrain-fighting.com/2023/redis-cluster-database-transfer-with-redisinsight-bulk-actions/</link><pubDate>Sun, 17 Dec 2023 17:05:34 +0800</pubDate><guid>https://blog.goldfishbrain-fighting.com/2023/redis-cluster-database-transfer-with-redisinsight-bulk-actions/</guid><description>&lt;h2 id="redis-cluster主機ip表">Redis Cluster主機IP表&lt;/h2>
&lt;p>&lt;img src="https://blog.goldfishbrain-fighting.com/2023/redis-cluster-database-transfer-with-redisinsight-bulk-actions/media/Pasted-image-20231217182757.png"
width="668"
height="1011"
srcset="https://blog.goldfishbrain-fighting.com/2023/redis-cluster-database-transfer-with-redisinsight-bulk-actions/media/Pasted-image-20231217182757_hu958cbfd0a734f396244b4db5ea229923_132015_480x0_resize_box_3.png 480w, https://blog.goldfishbrain-fighting.com/2023/redis-cluster-database-transfer-with-redisinsight-bulk-actions/media/Pasted-image-20231217182757_hu958cbfd0a734f396244b4db5ea229923_132015_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="66"
data-flex-basis="158px"
>&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>&lt;/th>
&lt;th>&lt;/th>
&lt;th>&lt;/th>
&lt;th>&lt;/th>
&lt;th>&lt;/th>
&lt;th>&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>主機名稱&lt;/td>
&lt;td>主機IP&lt;/td>
&lt;td>角色&lt;/td>
&lt;td>主機IP&lt;/td>
&lt;td>角色&lt;/td>
&lt;td>跟隨&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>redis91&lt;/td>
&lt;td>192.168.1.91:6379&lt;/td>
&lt;td>master&lt;/td>
&lt;td>192.168.1.91:6380&lt;/td>
&lt;td>slave&lt;/td>
&lt;td>192.168.1.92:6380&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>redis92&lt;/td>
&lt;td>192.168.1.92:6379&lt;/td>
&lt;td>master&lt;/td>
&lt;td>192.168.1.92:6380&lt;/td>
&lt;td>slave&lt;/td>
&lt;td>192.168.1.93:6380&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>redis93&lt;/td>
&lt;td>192.168.1.93:6379&lt;/td>
&lt;td>master&lt;/td>
&lt;td>192.168.1.93:6380&lt;/td>
&lt;td>slave&lt;/td>
&lt;td>192.168.1.91:6380&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>redis94&lt;/td>
&lt;td>192.168.1.94:6379&lt;/td>
&lt;td>master&lt;/td>
&lt;td>192.168.1.94:6380&lt;/td>
&lt;td>slave&lt;/td>
&lt;td>192.168.1.98:6380&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>redis98&lt;/td>
&lt;td>192.168.1.98:6379&lt;/td>
&lt;td>master&lt;/td>
&lt;td>192.168.1.98:6380&lt;/td>
&lt;td>slave&lt;/td>
&lt;td>192.168.1.94:6380&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h2 id="redisinsight添加redis主機">RedisInsight添加Redis主機&lt;/h2>
&lt;p>&lt;img src="https://blog.goldfishbrain-fighting.com/2023/redis-cluster-database-transfer-with-redisinsight-bulk-actions/media/Pasted-image-20231217170716.png"
width="1112"
height="679"
srcset="https://blog.goldfishbrain-fighting.com/2023/redis-cluster-database-transfer-with-redisinsight-bulk-actions/media/Pasted-image-20231217170716_hu8941ff57d904a7570160d2b84b67f41c_52216_480x0_resize_box_3.png 480w, https://blog.goldfishbrain-fighting.com/2023/redis-cluster-database-transfer-with-redisinsight-bulk-actions/media/Pasted-image-20231217170716_hu8941ff57d904a7570160d2b84b67f41c_52216_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="163"
data-flex-basis="393px"
>&lt;/p>
&lt;p>&lt;img src="https://blog.goldfishbrain-fighting.com/2023/redis-cluster-database-transfer-with-redisinsight-bulk-actions/media/Pasted-image-20231217170728.png"
width="1118"
height="632"
srcset="https://blog.goldfishbrain-fighting.com/2023/redis-cluster-database-transfer-with-redisinsight-bulk-actions/media/Pasted-image-20231217170728_hu063dd0b54e9d99400b14cc8c918e0655_90309_480x0_resize_box_3.png 480w, https://blog.goldfishbrain-fighting.com/2023/redis-cluster-database-transfer-with-redisinsight-bulk-actions/media/Pasted-image-20231217170728_hu063dd0b54e9d99400b14cc8c918e0655_90309_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="176"
data-flex-basis="424px"
>&lt;/p>
&lt;p>&lt;img src="https://blog.goldfishbrain-fighting.com/2023/redis-cluster-database-transfer-with-redisinsight-bulk-actions/media/Pasted-image-20231217170744.png"
width="1155"
height="700"
srcset="https://blog.goldfishbrain-fighting.com/2023/redis-cluster-database-transfer-with-redisinsight-bulk-actions/media/Pasted-image-20231217170744_hu8099a67496bdb5dfde1d28b49eb4b9c4_63457_480x0_resize_box_3.png 480w, https://blog.goldfishbrain-fighting.com/2023/redis-cluster-database-transfer-with-redisinsight-bulk-actions/media/Pasted-image-20231217170744_hu8099a67496bdb5dfde1d28b49eb4b9c4_63457_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="165"
data-flex-basis="396px"
>&lt;/p>
&lt;p>&lt;img src="https://blog.goldfishbrain-fighting.com/2023/redis-cluster-database-transfer-with-redisinsight-bulk-actions/media/Pasted-image-20231217173105.png"
width="1679"
height="775"
srcset="https://blog.goldfishbrain-fighting.com/2023/redis-cluster-database-transfer-with-redisinsight-bulk-actions/media/Pasted-image-20231217173105_hu0e7edbdab7fde8c2c7e2dba7a6e95699_116971_480x0_resize_box_3.png 480w, https://blog.goldfishbrain-fighting.com/2023/redis-cluster-database-transfer-with-redisinsight-bulk-actions/media/Pasted-image-20231217173105_hu0e7edbdab7fde8c2c7e2dba7a6e95699_116971_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="216"
data-flex-basis="519px"
>&lt;/p>
&lt;h2 id="使用bulk-action-restore數據">使用BULK ACTION Restore數據&lt;/h2>
&lt;p>&lt;img src="https://blog.goldfishbrain-fighting.com/2023/redis-cluster-database-transfer-with-redisinsight-bulk-actions/media/Pasted-image-20231217170841.png"
width="1118"
height="774"
srcset="https://blog.goldfishbrain-fighting.com/2023/redis-cluster-database-transfer-with-redisinsight-bulk-actions/media/Pasted-image-20231217170841_hu55eae7e8d5f6eee98578b69c9738d807_100007_480x0_resize_box_3.png 480w, https://blog.goldfishbrain-fighting.com/2023/redis-cluster-database-transfer-with-redisinsight-bulk-actions/media/Pasted-image-20231217170841_hu55eae7e8d5f6eee98578b69c9738d807_100007_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="144"
data-flex-basis="346px"
>&lt;/p>
&lt;p>我是用k8s佈屬RedisInsight，所以才看一下，佈屬到哪個節點，需要把要恢復數據的RBD檔案，傳至那台主機RedisInsight POD裡面&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">root@k8s-master71u:~# kubectl get pod -o wide
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME READY STATUS RESTARTS AGE IP NODE NOMINATED NODE READINESS GATES
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">redisinsight-cf7f6847b-s2zgg 1/1 Running &lt;span class="m">0&lt;/span> 18h 10.201.255.218 k8s-node76u &amp;lt;none&amp;gt; &amp;lt;none&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">test-nginx 1/1 Running &lt;span class="m">2&lt;/span> &lt;span class="o">(&lt;/span>13d ago&lt;span class="o">)&lt;/span> 13d 10.201.14.154 k8s-node75u &amp;lt;none&amp;gt; &amp;lt;none&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">web2-5d48fb75c5-dt5xd 1/1 Running &lt;span class="m">2&lt;/span> &lt;span class="o">(&lt;/span>13d ago&lt;span class="o">)&lt;/span> 13d 10.201.255.211 k8s-node76u &amp;lt;none&amp;gt; &amp;lt;none&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">web2-5d48fb75c5-ggmrz 1/1 Running &lt;span class="m">2&lt;/span> &lt;span class="o">(&lt;/span>13d ago&lt;span class="o">)&lt;/span> 13d 10.201.14.148 k8s-node75u &amp;lt;none&amp;gt; &amp;lt;none&amp;gt;
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">web2-5d48fb75c5-jsvck 1/1 Running &lt;span class="m">2&lt;/span> &lt;span class="o">(&lt;/span>13d ago&lt;span class="o">)&lt;/span> 13d 10.201.255.215 k8s-node76u &amp;lt;none&amp;gt; &amp;lt;none&amp;gt;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">root@k8s-node76u:~# docker ps &lt;span class="p">|&lt;/span> grep -i redis
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">5524bf7385e4 64a3d4d7e868 &lt;span class="s2">&amp;#34;bash ./docker-entry…&amp;#34;&lt;/span> &lt;span class="m">18&lt;/span> hours ago Up &lt;span class="m">18&lt;/span> hours k8s_redisinsight_redisinsight-cf7f6847b-s2zgg_default_65440569-c6e2-4f40-b836-8bf2b0c9b511_0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">efebd005bac3 registry.k8s.io/pause:3.9 &lt;span class="s2">&amp;#34;/pause&amp;#34;&lt;/span> &lt;span class="m">18&lt;/span> hours ago Up &lt;span class="m">18&lt;/span> hours k8s_POD_redisinsight-cf7f6847b-s2zgg_default_65440569-c6e2-4f40-b836-8bf2b0c9b511_0
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">root@k8s-node76u:~# docker &lt;span class="nb">exec&lt;/span> -ti 5524bf7385e4 bash
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">redisinsight@redisinsight-cf7f6847b-s2zgg:/app$ ls -l
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">total &lt;span class="m">64&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-r--r-- &lt;span class="m">1&lt;/span> root root &lt;span class="m">6015&lt;/span> May &lt;span class="m">2&lt;/span> &lt;span class="m">2023&lt;/span> appicon.pyc
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-rw-r-- &lt;span class="m">1&lt;/span> root root &lt;span class="m">841&lt;/span> May &lt;span class="m">2&lt;/span> &lt;span class="m">2023&lt;/span> docker-entry.sh
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-r--r-- &lt;span class="m">1&lt;/span> root root &lt;span class="m">377&lt;/span> May &lt;span class="m">2&lt;/span> &lt;span class="m">2023&lt;/span> entry.pyc
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-r--r-- &lt;span class="m">1&lt;/span> root root &lt;span class="m">2511&lt;/span> May &lt;span class="m">2&lt;/span> &lt;span class="m">2023&lt;/span> manage.pyc
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-rw-r-- &lt;span class="m">1&lt;/span> root root &lt;span class="m">6850&lt;/span> May &lt;span class="m">2&lt;/span> &lt;span class="m">2023&lt;/span> pyinstaller.spec
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">drwxr-xr-x &lt;span class="m">24&lt;/span> root root &lt;span class="m">4096&lt;/span> May &lt;span class="m">2&lt;/span> &lt;span class="m">2023&lt;/span> redisinsight
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-rw-r-- &lt;span class="m">1&lt;/span> root root &lt;span class="m">1089&lt;/span> May &lt;span class="m">2&lt;/span> &lt;span class="m">2023&lt;/span> requirements.txt
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-r--r-- &lt;span class="m">1&lt;/span> root root &lt;span class="m">26991&lt;/span> May &lt;span class="m">2&lt;/span> &lt;span class="m">2023&lt;/span> startup.pyc
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">redisinsight@redisinsight-cf7f6847b-s2zgg:/app$
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>將要恢復數據的RBD檔案，傳至RedisInsight POD裡面&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">root@k8s-node76u:~# chown -R root:root dump-master*.rdb
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">root@k8s-node76u:~# chmod o+rw dump-master*.rdb
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">root@k8s-node76u:~# docker cp dump-master1.rdb 5524bf7385e4:/app/dump-master1.rdb
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">root@k8s-node76u:~# docker cp dump-master2.rdb 5524bf7385e4:/app/dump-master2.rdb
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">root@k8s-node76u:~# docker cp dump-master3.rdb 5524bf7385e4:/app/dump-master3.rdb
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">root@k8s-node76u:~# docker cp dump-master4.rdb 5524bf7385e4:/app/dump-master4.rdb
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">root@k8s-node76u:~# docker cp dump-master5.rdb 5524bf7385e4:/app/dump-master5.rdb
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">redisinsight@redisinsight-cf7f6847b-s2zgg:/app$ ls -l
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">total &lt;span class="m">1758796&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-r--r-- &lt;span class="m">1&lt;/span> root root &lt;span class="m">6015&lt;/span> May &lt;span class="m">2&lt;/span> &lt;span class="m">2023&lt;/span> appicon.pyc
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-rw-r-- &lt;span class="m">1&lt;/span> root root &lt;span class="m">841&lt;/span> May &lt;span class="m">2&lt;/span> &lt;span class="m">2023&lt;/span> docker-entry.sh
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw----rw- &lt;span class="m">1&lt;/span> root root &lt;span class="m">343630318&lt;/span> Dec &lt;span class="m">5&lt;/span> 07:27 dump-master1.rdb
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw----rw- &lt;span class="m">1&lt;/span> root root &lt;span class="m">348759548&lt;/span> Dec &lt;span class="m">5&lt;/span> 07:32 dump-master2.rdb
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw----rw- &lt;span class="m">1&lt;/span> root root &lt;span class="m">349938872&lt;/span> Dec &lt;span class="m">5&lt;/span> 07:53 dump-master3.rdb
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw----rw- &lt;span class="m">1&lt;/span> root root &lt;span class="m">402484559&lt;/span> Dec &lt;span class="m">5&lt;/span> 07:56 dump-master4.rdb
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw----rw- &lt;span class="m">1&lt;/span> root root &lt;span class="m">356118026&lt;/span> Dec &lt;span class="m">5&lt;/span> 07:56 dump-master5.rdb
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-r--r-- &lt;span class="m">1&lt;/span> root root &lt;span class="m">377&lt;/span> May &lt;span class="m">2&lt;/span> &lt;span class="m">2023&lt;/span> entry.pyc
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-r--r-- &lt;span class="m">1&lt;/span> root root &lt;span class="m">2511&lt;/span> May &lt;span class="m">2&lt;/span> &lt;span class="m">2023&lt;/span> manage.pyc
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-rw-r-- &lt;span class="m">1&lt;/span> root root &lt;span class="m">6850&lt;/span> May &lt;span class="m">2&lt;/span> &lt;span class="m">2023&lt;/span> pyinstaller.spec
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">drwxr-xr-x &lt;span class="m">24&lt;/span> root root &lt;span class="m">4096&lt;/span> May &lt;span class="m">2&lt;/span> &lt;span class="m">2023&lt;/span> redisinsight
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-rw-r-- &lt;span class="m">1&lt;/span> root root &lt;span class="m">1089&lt;/span> May &lt;span class="m">2&lt;/span> &lt;span class="m">2023&lt;/span> requirements.txt
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-r--r-- &lt;span class="m">1&lt;/span> root root &lt;span class="m">26991&lt;/span> May &lt;span class="m">2&lt;/span> &lt;span class="m">2023&lt;/span> startup.pyc
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>開始恢復數據
&lt;img src="https://blog.goldfishbrain-fighting.com/2023/redis-cluster-database-transfer-with-redisinsight-bulk-actions/media/Pasted-image-20231217173157.png"
width="1124"
height="774"
srcset="https://blog.goldfishbrain-fighting.com/2023/redis-cluster-database-transfer-with-redisinsight-bulk-actions/media/Pasted-image-20231217173157_hu24a702ba6f3fc8c7d4b878270ed652e5_107549_480x0_resize_box_3.png 480w, https://blog.goldfishbrain-fighting.com/2023/redis-cluster-database-transfer-with-redisinsight-bulk-actions/media/Pasted-image-20231217173157_hu24a702ba6f3fc8c7d4b878270ed652e5_107549_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="145"
data-flex-basis="348px"
>&lt;/p>
&lt;p>&lt;img src="https://blog.goldfishbrain-fighting.com/2023/redis-cluster-database-transfer-with-redisinsight-bulk-actions/media/Pasted-image-20231217173216.png"
width="1716"
height="787"
srcset="https://blog.goldfishbrain-fighting.com/2023/redis-cluster-database-transfer-with-redisinsight-bulk-actions/media/Pasted-image-20231217173216_hud738e7dae71b3ecce62c0ff15ac06370_115574_480x0_resize_box_3.png 480w, https://blog.goldfishbrain-fighting.com/2023/redis-cluster-database-transfer-with-redisinsight-bulk-actions/media/Pasted-image-20231217173216_hud738e7dae71b3ecce62c0ff15ac06370_115574_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="218"
data-flex-basis="523px"
>&lt;/p>
&lt;p>恢復數據完成
&lt;img src="https://blog.goldfishbrain-fighting.com/2023/redis-cluster-database-transfer-with-redisinsight-bulk-actions/media/Pasted-image-20231217173438.png"
width="1714"
height="789"
srcset="https://blog.goldfishbrain-fighting.com/2023/redis-cluster-database-transfer-with-redisinsight-bulk-actions/media/Pasted-image-20231217173438_hu934af6320153a37e888616a64c623532_113353_480x0_resize_box_3.png 480w, https://blog.goldfishbrain-fighting.com/2023/redis-cluster-database-transfer-with-redisinsight-bulk-actions/media/Pasted-image-20231217173438_hu934af6320153a37e888616a64c623532_113353_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="217"
data-flex-basis="521px"
>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@redis91 redis&lt;span class="o">]&lt;/span>&lt;span class="c1"># redis-cli --user 帳號 --pass 密碼 --cluster check 192.168.1.91:6379&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Warning: Using a password with &lt;span class="s1">&amp;#39;-a&amp;#39;&lt;/span> or &lt;span class="s1">&amp;#39;-u&amp;#39;&lt;/span> option on the &lt;span class="nb">command&lt;/span> line interface may not be safe.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">192.168.1.91:6379 &lt;span class="o">(&lt;/span>2c05c930...&lt;span class="o">)&lt;/span> -&amp;gt; &lt;span class="m">122790&lt;/span> keys &lt;span class="p">|&lt;/span> &lt;span class="m">3277&lt;/span> slots &lt;span class="p">|&lt;/span> &lt;span class="m">1&lt;/span> slaves.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">192.168.1.98:6379 &lt;span class="o">(&lt;/span>c40f72b0...&lt;span class="o">)&lt;/span> -&amp;gt; &lt;span class="m">75980&lt;/span> keys &lt;span class="p">|&lt;/span> &lt;span class="m">3277&lt;/span> slots &lt;span class="p">|&lt;/span> &lt;span class="m">1&lt;/span> slaves.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">192.168.1.92:6379 &lt;span class="o">(&lt;/span>71d88e30...&lt;span class="o">)&lt;/span> -&amp;gt; &lt;span class="m">91349&lt;/span> keys &lt;span class="p">|&lt;/span> &lt;span class="m">3277&lt;/span> slots &lt;span class="p">|&lt;/span> &lt;span class="m">1&lt;/span> slaves.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">192.168.1.93:6379 &lt;span class="o">(&lt;/span>caa1fb6b...&lt;span class="o">)&lt;/span> -&amp;gt; &lt;span class="m">76507&lt;/span> keys &lt;span class="p">|&lt;/span> &lt;span class="m">3276&lt;/span> slots &lt;span class="p">|&lt;/span> &lt;span class="m">1&lt;/span> slaves.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">192.168.1.94:6379 &lt;span class="o">(&lt;/span>eaeb50d0...&lt;span class="o">)&lt;/span> -&amp;gt; &lt;span class="m">76336&lt;/span> keys &lt;span class="p">|&lt;/span> &lt;span class="m">3277&lt;/span> slots &lt;span class="p">|&lt;/span> &lt;span class="m">1&lt;/span> slaves.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>OK&lt;span class="o">]&lt;/span> &lt;span class="m">442962&lt;/span> keys in &lt;span class="m">5&lt;/span> masters.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">27.04 keys per slot on average.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;gt;&amp;gt;&amp;gt; Performing Cluster Check &lt;span class="o">(&lt;/span>using node 192.168.1.91:6379&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">M: 2c05c930c506e54ebea35f8f0b731754cd44082a 192.168.1.91:6379
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slots:&lt;span class="o">[&lt;/span>0-3276&lt;span class="o">]&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="m">3277&lt;/span> slots&lt;span class="o">)&lt;/span> master
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="m">1&lt;/span> additional replica&lt;span class="o">(&lt;/span>s&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">S: 1709189e2036c2e0c4168189be9074d66bce2991 192.168.1.92:6380
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slots: &lt;span class="o">(&lt;/span>&lt;span class="m">0&lt;/span> slots&lt;span class="o">)&lt;/span> slave
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> replicates 2c05c930c506e54ebea35f8f0b731754cd44082a
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">M: c40f72b0ee3ac4be0b9ddaea4d16079f723e13bf 192.168.1.98:6379
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slots:&lt;span class="o">[&lt;/span>13107-16383&lt;span class="o">]&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="m">3277&lt;/span> slots&lt;span class="o">)&lt;/span> master
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="m">1&lt;/span> additional replica&lt;span class="o">(&lt;/span>s&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">M: 71d88e302c0a7ec240cbbb6f8380786d01da984c 192.168.1.92:6379
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slots:&lt;span class="o">[&lt;/span>3277-6553&lt;span class="o">]&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="m">3277&lt;/span> slots&lt;span class="o">)&lt;/span> master
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="m">1&lt;/span> additional replica&lt;span class="o">(&lt;/span>s&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">M: caa1fb6b5fbc4e133b5ef472e2def11e836481f7 192.168.1.93:6379
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slots:&lt;span class="o">[&lt;/span>6554-9829&lt;span class="o">]&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="m">3276&lt;/span> slots&lt;span class="o">)&lt;/span> master
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="m">1&lt;/span> additional replica&lt;span class="o">(&lt;/span>s&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">S: 500ed38b799c6d5ad13483f8e0fee45fc9142d69 192.168.1.94:6380
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slots: &lt;span class="o">(&lt;/span>&lt;span class="m">0&lt;/span> slots&lt;span class="o">)&lt;/span> slave
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> replicates c40f72b0ee3ac4be0b9ddaea4d16079f723e13bf
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">S: 533669750790e904050e917657beae942185a407 192.168.1.91:6380
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slots: &lt;span class="o">(&lt;/span>&lt;span class="m">0&lt;/span> slots&lt;span class="o">)&lt;/span> slave
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> replicates caa1fb6b5fbc4e133b5ef472e2def11e836481f7
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">S: b0bff6695a1318da9a01af2550c85de1e8e81a83 192.168.1.93:6380
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slots: &lt;span class="o">(&lt;/span>&lt;span class="m">0&lt;/span> slots&lt;span class="o">)&lt;/span> slave
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> replicates 71d88e302c0a7ec240cbbb6f8380786d01da984c
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">M: eaeb50d0d31025f1589b7c8cdc12867f7a474c24 192.168.1.94:6379
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slots:&lt;span class="o">[&lt;/span>9830-13106&lt;span class="o">]&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="m">3277&lt;/span> slots&lt;span class="o">)&lt;/span> master
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="m">1&lt;/span> additional replica&lt;span class="o">(&lt;/span>s&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">S: 2b487243e0c78adb93ac73017d04a6ad39b51c36 192.168.1.98:6380
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slots: &lt;span class="o">(&lt;/span>&lt;span class="m">0&lt;/span> slots&lt;span class="o">)&lt;/span> slave
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> replicates eaeb50d0d31025f1589b7c8cdc12867f7a474c24
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>OK&lt;span class="o">]&lt;/span> All nodes agree about slots configuration.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;gt;&amp;gt;&amp;gt; Check &lt;span class="k">for&lt;/span> open slots...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;gt;&amp;gt;&amp;gt; Check slots coverage...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>OK&lt;span class="o">]&lt;/span> All &lt;span class="m">16384&lt;/span> slots covered.
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>再選第二個rbd檔進行恢復
&lt;img src="https://blog.goldfishbrain-fighting.com/2023/redis-cluster-database-transfer-with-redisinsight-bulk-actions/media/Pasted-image-20231217173551.png"
width="1711"
height="767"
srcset="https://blog.goldfishbrain-fighting.com/2023/redis-cluster-database-transfer-with-redisinsight-bulk-actions/media/Pasted-image-20231217173551_hu09f9e6f01303187eae4fce88869a6eaa_128490_480x0_resize_box_3.png 480w, https://blog.goldfishbrain-fighting.com/2023/redis-cluster-database-transfer-with-redisinsight-bulk-actions/media/Pasted-image-20231217173551_hu09f9e6f01303187eae4fce88869a6eaa_128490_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="223"
data-flex-basis="535px"
>&lt;/p>
&lt;p>&lt;img src="https://blog.goldfishbrain-fighting.com/2023/redis-cluster-database-transfer-with-redisinsight-bulk-actions/media/Pasted-image-20231217173646.png"
width="1718"
height="844"
srcset="https://blog.goldfishbrain-fighting.com/2023/redis-cluster-database-transfer-with-redisinsight-bulk-actions/media/Pasted-image-20231217173646_huaf632375579d3507ea0ea82dc245424e_124377_480x0_resize_box_3.png 480w, https://blog.goldfishbrain-fighting.com/2023/redis-cluster-database-transfer-with-redisinsight-bulk-actions/media/Pasted-image-20231217173646_huaf632375579d3507ea0ea82dc245424e_124377_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="203"
data-flex-basis="488px"
>&lt;/p>
&lt;p>&lt;img src="https://blog.goldfishbrain-fighting.com/2023/redis-cluster-database-transfer-with-redisinsight-bulk-actions/media/Pasted-image-20231217173937.png"
width="1714"
height="790"
srcset="https://blog.goldfishbrain-fighting.com/2023/redis-cluster-database-transfer-with-redisinsight-bulk-actions/media/Pasted-image-20231217173937_hu2e766fa75da7d163520a39c4b5a93aae_119721_480x0_resize_box_3.png 480w, https://blog.goldfishbrain-fighting.com/2023/redis-cluster-database-transfer-with-redisinsight-bulk-actions/media/Pasted-image-20231217173937_hu2e766fa75da7d163520a39c4b5a93aae_119721_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="216"
data-flex-basis="520px"
>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@redis91 redis&lt;span class="o">]&lt;/span>&lt;span class="c1"># redis-cli --user 帳號 --pass 密碼 --cluster check 192.168.1.91:6379&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Warning: Using a password with &lt;span class="s1">&amp;#39;-a&amp;#39;&lt;/span> or &lt;span class="s1">&amp;#39;-u&amp;#39;&lt;/span> option on the &lt;span class="nb">command&lt;/span> line interface may not be safe.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">192.168.1.91:6379 &lt;span class="o">(&lt;/span>2c05c930...&lt;span class="o">)&lt;/span> -&amp;gt; &lt;span class="m">198625&lt;/span> keys &lt;span class="p">|&lt;/span> &lt;span class="m">3277&lt;/span> slots &lt;span class="p">|&lt;/span> &lt;span class="m">1&lt;/span> slaves.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">192.168.1.98:6379 &lt;span class="o">(&lt;/span>c40f72b0...&lt;span class="o">)&lt;/span> -&amp;gt; &lt;span class="m">152593&lt;/span> keys &lt;span class="p">|&lt;/span> &lt;span class="m">3277&lt;/span> slots &lt;span class="p">|&lt;/span> &lt;span class="m">1&lt;/span> slaves.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">192.168.1.92:6379 &lt;span class="o">(&lt;/span>71d88e30...&lt;span class="o">)&lt;/span> -&amp;gt; &lt;span class="m">198771&lt;/span> keys &lt;span class="p">|&lt;/span> &lt;span class="m">3277&lt;/span> slots &lt;span class="p">|&lt;/span> &lt;span class="m">1&lt;/span> slaves.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">192.168.1.93:6379 &lt;span class="o">(&lt;/span>caa1fb6b...&lt;span class="o">)&lt;/span> -&amp;gt; &lt;span class="m">184053&lt;/span> keys &lt;span class="p">|&lt;/span> &lt;span class="m">3276&lt;/span> slots &lt;span class="p">|&lt;/span> &lt;span class="m">1&lt;/span> slaves.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">192.168.1.94:6379 &lt;span class="o">(&lt;/span>eaeb50d0...&lt;span class="o">)&lt;/span> -&amp;gt; &lt;span class="m">152590&lt;/span> keys &lt;span class="p">|&lt;/span> &lt;span class="m">3277&lt;/span> slots &lt;span class="p">|&lt;/span> &lt;span class="m">1&lt;/span> slaves.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>OK&lt;span class="o">]&lt;/span> &lt;span class="m">886632&lt;/span> keys in &lt;span class="m">5&lt;/span> masters.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">54.12 keys per slot on average.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;gt;&amp;gt;&amp;gt; Performing Cluster Check &lt;span class="o">(&lt;/span>using node 192.168.1.91:6379&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">M: 2c05c930c506e54ebea35f8f0b731754cd44082a 192.168.1.91:6379
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slots:&lt;span class="o">[&lt;/span>0-3276&lt;span class="o">]&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="m">3277&lt;/span> slots&lt;span class="o">)&lt;/span> master
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="m">1&lt;/span> additional replica&lt;span class="o">(&lt;/span>s&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">S: 1709189e2036c2e0c4168189be9074d66bce2991 192.168.1.92:6380
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slots: &lt;span class="o">(&lt;/span>&lt;span class="m">0&lt;/span> slots&lt;span class="o">)&lt;/span> slave
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> replicates 2c05c930c506e54ebea35f8f0b731754cd44082a
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">M: c40f72b0ee3ac4be0b9ddaea4d16079f723e13bf 192.168.1.98:6379
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slots:&lt;span class="o">[&lt;/span>13107-16383&lt;span class="o">]&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="m">3277&lt;/span> slots&lt;span class="o">)&lt;/span> master
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="m">1&lt;/span> additional replica&lt;span class="o">(&lt;/span>s&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">M: 71d88e302c0a7ec240cbbb6f8380786d01da984c 192.168.1.92:6379
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slots:&lt;span class="o">[&lt;/span>3277-6553&lt;span class="o">]&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="m">3277&lt;/span> slots&lt;span class="o">)&lt;/span> master
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="m">1&lt;/span> additional replica&lt;span class="o">(&lt;/span>s&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">M: caa1fb6b5fbc4e133b5ef472e2def11e836481f7 192.168.1.93:6379
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slots:&lt;span class="o">[&lt;/span>6554-9829&lt;span class="o">]&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="m">3276&lt;/span> slots&lt;span class="o">)&lt;/span> master
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="m">1&lt;/span> additional replica&lt;span class="o">(&lt;/span>s&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">S: 500ed38b799c6d5ad13483f8e0fee45fc9142d69 192.168.1.94:6380
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slots: &lt;span class="o">(&lt;/span>&lt;span class="m">0&lt;/span> slots&lt;span class="o">)&lt;/span> slave
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> replicates c40f72b0ee3ac4be0b9ddaea4d16079f723e13bf
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">S: 533669750790e904050e917657beae942185a407 192.168.1.91:6380
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slots: &lt;span class="o">(&lt;/span>&lt;span class="m">0&lt;/span> slots&lt;span class="o">)&lt;/span> slave
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> replicates caa1fb6b5fbc4e133b5ef472e2def11e836481f7
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">S: b0bff6695a1318da9a01af2550c85de1e8e81a83 192.168.1.93:6380
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slots: &lt;span class="o">(&lt;/span>&lt;span class="m">0&lt;/span> slots&lt;span class="o">)&lt;/span> slave
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> replicates 71d88e302c0a7ec240cbbb6f8380786d01da984c
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">M: eaeb50d0d31025f1589b7c8cdc12867f7a474c24 192.168.1.94:6379
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slots:&lt;span class="o">[&lt;/span>9830-13106&lt;span class="o">]&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="m">3277&lt;/span> slots&lt;span class="o">)&lt;/span> master
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="m">1&lt;/span> additional replica&lt;span class="o">(&lt;/span>s&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">S: 2b487243e0c78adb93ac73017d04a6ad39b51c36 192.168.1.98:6380
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slots: &lt;span class="o">(&lt;/span>&lt;span class="m">0&lt;/span> slots&lt;span class="o">)&lt;/span> slave
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> replicates eaeb50d0d31025f1589b7c8cdc12867f7a474c24
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>OK&lt;span class="o">]&lt;/span> All nodes agree about slots configuration.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;gt;&amp;gt;&amp;gt; Check &lt;span class="k">for&lt;/span> open slots...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;gt;&amp;gt;&amp;gt; Check slots coverage...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>OK&lt;span class="o">]&lt;/span> All &lt;span class="m">16384&lt;/span> slots covered.
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>再選第三個rbd檔進行恢復，陸續將5個都恢復完成&lt;/p>
&lt;p>&lt;img src="https://blog.goldfishbrain-fighting.com/2023/redis-cluster-database-transfer-with-redisinsight-bulk-actions/media/Pasted-image-20231217174037.png"
width="1716"
height="773"
srcset="https://blog.goldfishbrain-fighting.com/2023/redis-cluster-database-transfer-with-redisinsight-bulk-actions/media/Pasted-image-20231217174037_hu5f22c996f6384f509836bf44138693cf_134780_480x0_resize_box_3.png 480w, https://blog.goldfishbrain-fighting.com/2023/redis-cluster-database-transfer-with-redisinsight-bulk-actions/media/Pasted-image-20231217174037_hu5f22c996f6384f509836bf44138693cf_134780_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="221"
data-flex-basis="532px"
>&lt;/p>
&lt;p>陸續完成五個dump.rdb的RESTORE&lt;/p>
&lt;p>&lt;img src="https://blog.goldfishbrain-fighting.com/2023/redis-cluster-database-transfer-with-redisinsight-bulk-actions/media/Pasted-image-20231217174851.png"
width="1716"
height="759"
srcset="https://blog.goldfishbrain-fighting.com/2023/redis-cluster-database-transfer-with-redisinsight-bulk-actions/media/Pasted-image-20231217174851_hu20fe9b2924c3d0f7d31686b02efd9333_136972_480x0_resize_box_3.png 480w, https://blog.goldfishbrain-fighting.com/2023/redis-cluster-database-transfer-with-redisinsight-bulk-actions/media/Pasted-image-20231217174851_hu20fe9b2924c3d0f7d31686b02efd9333_136972_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="226"
data-flex-basis="542px"
>&lt;/p>
&lt;p>可以看到，key是平均寫入每個master，slot也不會有什麼改變&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@redis91 redis&lt;span class="o">]&lt;/span>&lt;span class="c1"># redis-cli --user 帳號 --pass 密碼 --cluster check 192.168.1.91:6379&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Warning: Using a password with &lt;span class="s1">&amp;#39;-a&amp;#39;&lt;/span> or &lt;span class="s1">&amp;#39;-u&amp;#39;&lt;/span> option on the &lt;span class="nb">command&lt;/span> line interface may not be safe.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">192.168.1.91:6379 &lt;span class="o">(&lt;/span>2c05c930...&lt;span class="o">)&lt;/span> -&amp;gt; &lt;span class="m">442550&lt;/span> keys &lt;span class="p">|&lt;/span> &lt;span class="m">3277&lt;/span> slots &lt;span class="p">|&lt;/span> &lt;span class="m">1&lt;/span> slaves.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">192.168.1.98:6379 &lt;span class="o">(&lt;/span>c40f72b0...&lt;span class="o">)&lt;/span> -&amp;gt; &lt;span class="m">444646&lt;/span> keys &lt;span class="p">|&lt;/span> &lt;span class="m">3277&lt;/span> slots &lt;span class="p">|&lt;/span> &lt;span class="m">1&lt;/span> slaves.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">192.168.1.92:6379 &lt;span class="o">(&lt;/span>71d88e30...&lt;span class="o">)&lt;/span> -&amp;gt; &lt;span class="m">443416&lt;/span> keys &lt;span class="p">|&lt;/span> &lt;span class="m">3277&lt;/span> slots &lt;span class="p">|&lt;/span> &lt;span class="m">1&lt;/span> slaves.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">192.168.1.93:6379 &lt;span class="o">(&lt;/span>caa1fb6b...&lt;span class="o">)&lt;/span> -&amp;gt; &lt;span class="m">444081&lt;/span> keys &lt;span class="p">|&lt;/span> &lt;span class="m">3276&lt;/span> slots &lt;span class="p">|&lt;/span> &lt;span class="m">1&lt;/span> slaves.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">192.168.1.94:6379 &lt;span class="o">(&lt;/span>eaeb50d0...&lt;span class="o">)&lt;/span> -&amp;gt; &lt;span class="m">443884&lt;/span> keys &lt;span class="p">|&lt;/span> &lt;span class="m">3277&lt;/span> slots &lt;span class="p">|&lt;/span> &lt;span class="m">1&lt;/span> slaves.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>OK&lt;span class="o">]&lt;/span> &lt;span class="m">2218577&lt;/span> keys in &lt;span class="m">5&lt;/span> masters.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">135.41 keys per slot on average.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;gt;&amp;gt;&amp;gt; Performing Cluster Check &lt;span class="o">(&lt;/span>using node 192.168.1.91:6379&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">M: 2c05c930c506e54ebea35f8f0b731754cd44082a 192.168.1.91:6379
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slots:&lt;span class="o">[&lt;/span>0-3276&lt;span class="o">]&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="m">3277&lt;/span> slots&lt;span class="o">)&lt;/span> master
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="m">1&lt;/span> additional replica&lt;span class="o">(&lt;/span>s&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">S: 1709189e2036c2e0c4168189be9074d66bce2991 192.168.1.92:6380
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slots: &lt;span class="o">(&lt;/span>&lt;span class="m">0&lt;/span> slots&lt;span class="o">)&lt;/span> slave
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> replicates 2c05c930c506e54ebea35f8f0b731754cd44082a
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">M: c40f72b0ee3ac4be0b9ddaea4d16079f723e13bf 192.168.1.98:6379
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slots:&lt;span class="o">[&lt;/span>13107-16383&lt;span class="o">]&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="m">3277&lt;/span> slots&lt;span class="o">)&lt;/span> master
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="m">1&lt;/span> additional replica&lt;span class="o">(&lt;/span>s&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">M: 71d88e302c0a7ec240cbbb6f8380786d01da984c 192.168.1.92:6379
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slots:&lt;span class="o">[&lt;/span>3277-6553&lt;span class="o">]&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="m">3277&lt;/span> slots&lt;span class="o">)&lt;/span> master
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="m">1&lt;/span> additional replica&lt;span class="o">(&lt;/span>s&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">M: caa1fb6b5fbc4e133b5ef472e2def11e836481f7 192.168.1.93:6379
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slots:&lt;span class="o">[&lt;/span>6554-9829&lt;span class="o">]&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="m">3276&lt;/span> slots&lt;span class="o">)&lt;/span> master
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="m">1&lt;/span> additional replica&lt;span class="o">(&lt;/span>s&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">S: 500ed38b799c6d5ad13483f8e0fee45fc9142d69 192.168.1.94:6380
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slots: &lt;span class="o">(&lt;/span>&lt;span class="m">0&lt;/span> slots&lt;span class="o">)&lt;/span> slave
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> replicates c40f72b0ee3ac4be0b9ddaea4d16079f723e13bf
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">S: 533669750790e904050e917657beae942185a407 192.168.1.91:6380
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slots: &lt;span class="o">(&lt;/span>&lt;span class="m">0&lt;/span> slots&lt;span class="o">)&lt;/span> slave
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> replicates caa1fb6b5fbc4e133b5ef472e2def11e836481f7
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">S: b0bff6695a1318da9a01af2550c85de1e8e81a83 192.168.1.93:6380
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slots: &lt;span class="o">(&lt;/span>&lt;span class="m">0&lt;/span> slots&lt;span class="o">)&lt;/span> slave
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> replicates 71d88e302c0a7ec240cbbb6f8380786d01da984c
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">M: eaeb50d0d31025f1589b7c8cdc12867f7a474c24 192.168.1.94:6379
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slots:&lt;span class="o">[&lt;/span>9830-13106&lt;span class="o">]&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="m">3277&lt;/span> slots&lt;span class="o">)&lt;/span> master
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="m">1&lt;/span> additional replica&lt;span class="o">(&lt;/span>s&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">S: 2b487243e0c78adb93ac73017d04a6ad39b51c36 192.168.1.98:6380
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slots: &lt;span class="o">(&lt;/span>&lt;span class="m">0&lt;/span> slots&lt;span class="o">)&lt;/span> slave
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> replicates eaeb50d0d31025f1589b7c8cdc12867f7a474c24
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>OK&lt;span class="o">]&lt;/span> All nodes agree about slots configuration.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;gt;&amp;gt;&amp;gt; Check &lt;span class="k">for&lt;/span> open slots...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;gt;&amp;gt;&amp;gt; Check slots coverage...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>OK&lt;span class="o">]&lt;/span> All &lt;span class="m">16384&lt;/span> slots covered.
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="分析數據">分析數據&lt;/h2>
&lt;p>&lt;img src="https://blog.goldfishbrain-fighting.com/2023/redis-cluster-database-transfer-with-redisinsight-bulk-actions/media/Pasted-image-20231217175052.png"
width="1652"
height="756"
srcset="https://blog.goldfishbrain-fighting.com/2023/redis-cluster-database-transfer-with-redisinsight-bulk-actions/media/Pasted-image-20231217175052_hu1e6f69fa541db1247a7b9997e31f2b7d_98815_480x0_resize_box_3.png 480w, https://blog.goldfishbrain-fighting.com/2023/redis-cluster-database-transfer-with-redisinsight-bulk-actions/media/Pasted-image-20231217175052_hu1e6f69fa541db1247a7b9997e31f2b7d_98815_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="218"
data-flex-basis="524px"
>&lt;/p>
&lt;p>&lt;img src="https://blog.goldfishbrain-fighting.com/2023/redis-cluster-database-transfer-with-redisinsight-bulk-actions/media/Pasted-image-20231217175113.png"
width="1215"
height="720"
srcset="https://blog.goldfishbrain-fighting.com/2023/redis-cluster-database-transfer-with-redisinsight-bulk-actions/media/Pasted-image-20231217175113_hu958f04d58f0c25c1ed4f6b09ce32f109_101955_480x0_resize_box_3.png 480w, https://blog.goldfishbrain-fighting.com/2023/redis-cluster-database-transfer-with-redisinsight-bulk-actions/media/Pasted-image-20231217175113_hu958f04d58f0c25c1ed4f6b09ce32f109_101955_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="168"
data-flex-basis="405px"
>&lt;/p>
&lt;p>&lt;img src="https://blog.goldfishbrain-fighting.com/2023/redis-cluster-database-transfer-with-redisinsight-bulk-actions/media/Pasted-image-20231217175141.png"
width="707"
height="549"
srcset="https://blog.goldfishbrain-fighting.com/2023/redis-cluster-database-transfer-with-redisinsight-bulk-actions/media/Pasted-image-20231217175141_hu521eac495c8b9ba0c2ed1b45668fe721_37116_480x0_resize_box_3.png 480w, https://blog.goldfishbrain-fighting.com/2023/redis-cluster-database-transfer-with-redisinsight-bulk-actions/media/Pasted-image-20231217175141_hu521eac495c8b9ba0c2ed1b45668fe721_37116_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="128"
data-flex-basis="309px"
>&lt;/p>
&lt;p>&lt;img src="https://blog.goldfishbrain-fighting.com/2023/redis-cluster-database-transfer-with-redisinsight-bulk-actions/media/Pasted-image-20231217175157.png"
width="1679"
height="913"
srcset="https://blog.goldfishbrain-fighting.com/2023/redis-cluster-database-transfer-with-redisinsight-bulk-actions/media/Pasted-image-20231217175157_huc2153e67b2b306265b0dd5015c4b6120_122574_480x0_resize_box_3.png 480w, https://blog.goldfishbrain-fighting.com/2023/redis-cluster-database-transfer-with-redisinsight-bulk-actions/media/Pasted-image-20231217175157_huc2153e67b2b306265b0dd5015c4b6120_122574_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="183"
data-flex-basis="441px"
>&lt;/p>
&lt;p>會讓REDIS執行一次bgsave，存下目前的所有key，並使用SYNC，將檔案複製到RedisInsight目錄/db/rsnaps裡面來進行分析&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@redis91 redis&lt;span class="o">]&lt;/span>&lt;span class="c1"># ll&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">總計 &lt;span class="m">595660&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-r--r-- &lt;span class="m">1&lt;/span> redis redis &lt;span class="m">609714517&lt;/span> 12月 &lt;span class="m">17&lt;/span> 17:53 dump6379.rdb
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-r--r-- &lt;span class="m">1&lt;/span> redis redis &lt;span class="m">175&lt;/span> 12月 &lt;span class="m">17&lt;/span> 17:16 dump6380.rdb
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-r--r-- &lt;span class="m">1&lt;/span> redis redis &lt;span class="m">1303&lt;/span> 12月 &lt;span class="m">16&lt;/span> 22:17 nodes-6379.conf
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-r--r-- &lt;span class="m">1&lt;/span> redis redis &lt;span class="m">1303&lt;/span> 12月 &lt;span class="m">16&lt;/span> 22:17 nodes-6380.conf
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-r--r-- &lt;span class="m">1&lt;/span> redis redis &lt;span class="m">109501&lt;/span> 12月 &lt;span class="m">16&lt;/span> 22:01 redis6380.conf
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-r--r-- &lt;span class="m">1&lt;/span> redis redis &lt;span class="m">109501&lt;/span> 12月 &lt;span class="m">16&lt;/span> 22:01 redis.conf
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-r--r-- &lt;span class="m">1&lt;/span> redis redis &lt;span class="m">1041&lt;/span> 12月 &lt;span class="m">16&lt;/span> 22:01 users.acl
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">redisinsight@redisinsight-cf7f6847b-s2zgg:/db/rsnaps$ &lt;span class="nb">pwd&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">/db/rsnaps
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">redisinsight@redisinsight-cf7f6847b-s2zgg:/db/rsnaps$ ls -lh
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">total 5.0G
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-r--r-- &lt;span class="m">1&lt;/span> redisinsight redisinsight 975M Dec &lt;span class="m">17&lt;/span> 09:56 2a974363-c6f6-4d86-9333-68a5d83f46a2.rsnap
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-r--r-- &lt;span class="m">1&lt;/span> redisinsight redisinsight 647M Dec &lt;span class="m">17&lt;/span> 09:52 2a974363-c6f6-4d86-9333-68a5d83f46a21702806698_0.rdb
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-r--r-- &lt;span class="m">1&lt;/span> redisinsight redisinsight 568M Dec &lt;span class="m">17&lt;/span> 09:52 2a974363-c6f6-4d86-9333-68a5d83f46a21702806733_1.rdb
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-r--r-- &lt;span class="m">1&lt;/span> redisinsight redisinsight 579M Dec &lt;span class="m">17&lt;/span> 09:53 2a974363-c6f6-4d86-9333-68a5d83f46a21702806764_2.rdb
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-r--r-- &lt;span class="m">1&lt;/span> redisinsight redisinsight 582M Dec &lt;span class="m">17&lt;/span> 09:53 2a974363-c6f6-4d86-9333-68a5d83f46a21702806794_3.rdb
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-r--r-- &lt;span class="m">1&lt;/span> redisinsight redisinsight 583M Dec &lt;span class="m">17&lt;/span> 09:54 2a974363-c6f6-4d86-9333-68a5d83f46a21702806827_4.rdb
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-r--r-- &lt;span class="m">1&lt;/span> redisinsight redisinsight 819M Dec &lt;span class="m">16&lt;/span> 15:10 f784974f-a2e9-4dec-a74c-2b309d733efe.rsnap
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>執行完畢後&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">redisinsight@redisinsight-cf7f6847b-s2zgg:/db/rsnaps$ ls -lh
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">total 1.8G
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-r--r-- &lt;span class="m">1&lt;/span> redisinsight redisinsight 975M Dec &lt;span class="m">17&lt;/span> 09:56 2a974363-c6f6-4d86-9333-68a5d83f46a2.rsnap
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-r--r-- &lt;span class="m">1&lt;/span> redisinsight redisinsight 819M Dec &lt;span class="m">16&lt;/span> 15:10 f784974f-a2e9-4dec-a74c-2b309d733efe.rsnap
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>用RedisInsight BULK ACTIONS復原數據的效果&lt;/p>
&lt;p>&lt;img src="https://blog.goldfishbrain-fighting.com/2023/redis-cluster-database-transfer-with-redisinsight-bulk-actions/media/Pasted-image-20231217175808.png"
width="1664"
height="878"
srcset="https://blog.goldfishbrain-fighting.com/2023/redis-cluster-database-transfer-with-redisinsight-bulk-actions/media/Pasted-image-20231217175808_huf5fd5049a9d41f530456b6c2b3e5a547_140279_480x0_resize_box_3.png 480w, https://blog.goldfishbrain-fighting.com/2023/redis-cluster-database-transfer-with-redisinsight-bulk-actions/media/Pasted-image-20231217175808_huf5fd5049a9d41f530456b6c2b3e5a547_140279_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="189"
data-flex-basis="454px"
>&lt;/p>
&lt;p>&lt;img src="https://blog.goldfishbrain-fighting.com/2023/redis-cluster-database-transfer-with-redisinsight-bulk-actions/media/Pasted-image-20231217175855.png"
width="1681"
height="913"
srcset="https://blog.goldfishbrain-fighting.com/2023/redis-cluster-database-transfer-with-redisinsight-bulk-actions/media/Pasted-image-20231217175855_hu025e17bfca9d8479fb79a7c3cbf5b100_262186_480x0_resize_box_3.png 480w, https://blog.goldfishbrain-fighting.com/2023/redis-cluster-database-transfer-with-redisinsight-bulk-actions/media/Pasted-image-20231217175855_hu025e17bfca9d8479fb79a7c3cbf5b100_262186_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="184"
data-flex-basis="441px"
>&lt;/p>
&lt;p>以下是將RBD檔案複製到REDIS目錄，一台一台REDIS服務重啟，慢慢導入RBD數據的效果&lt;/p>
&lt;p>&lt;img src="https://blog.goldfishbrain-fighting.com/2023/redis-cluster-database-transfer-with-redisinsight-bulk-actions/media/Pasted-image-20231217180124.png"
width="1677"
height="807"
srcset="https://blog.goldfishbrain-fighting.com/2023/redis-cluster-database-transfer-with-redisinsight-bulk-actions/media/Pasted-image-20231217180124_hu8fe506ee02ff998d1d1e8dc4d146a970_106504_480x0_resize_box_3.png 480w, https://blog.goldfishbrain-fighting.com/2023/redis-cluster-database-transfer-with-redisinsight-bulk-actions/media/Pasted-image-20231217180124_hu8fe506ee02ff998d1d1e8dc4d146a970_106504_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="207"
data-flex-basis="498px"
>&lt;/p>
&lt;p>&lt;img src="https://blog.goldfishbrain-fighting.com/2023/redis-cluster-database-transfer-with-redisinsight-bulk-actions/media/Pasted-image-20231217180139.png"
width="1676"
height="909"
srcset="https://blog.goldfishbrain-fighting.com/2023/redis-cluster-database-transfer-with-redisinsight-bulk-actions/media/Pasted-image-20231217180139_hucd14407a271551d597e0c9776110b94b_261103_480x0_resize_box_3.png 480w, https://blog.goldfishbrain-fighting.com/2023/redis-cluster-database-transfer-with-redisinsight-bulk-actions/media/Pasted-image-20231217180139_hucd14407a271551d597e0c9776110b94b_261103_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="184"
data-flex-basis="442px"
>&lt;/p>
&lt;p>看起來效果是一樣，但是使用RedisInsight BULK ACTIONS，有幾個好處：&lt;/p>
&lt;ol>
&lt;li>Redis服務不用重啟，線上恢復數據&lt;/li>
&lt;li>Redis slot不會有異常分配狀況，還要使用&amp;ndash;cluster fix的狀況發生&lt;/li>
&lt;/ol>
&lt;h2 id="測試數據是否正確結果-有些數據key-name被修改了">測試數據，是否正確，結果-&amp;gt;有些數據Key Name被修改了&lt;/h2>
&lt;p>來查查看數據，是不是跟之前使用重啟Redis服務恢復數據時，得到的一樣&lt;/p>
&lt;p>以下是使用重啟Redis服務恢復數據時，查到的key和value&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@redis01 redis&lt;span class="o">]&lt;/span>&lt;span class="c1"># redis-cli --user 帳號 --pass 密碼 -c&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 查看key type，此key剛好就在redis01主機上，所以執行直接顯示type&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">127.0.0.1:6379&amp;gt; &lt;span class="nb">type&lt;/span> spring:session:index:org.springframework.session.FindByIndexNameSessionRepository.PRINCIPAL_NAME_INDEX_NAME:362C74F290B63E5F751DCF1E49EC34BEAF6822F0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 查看key type，此key在redis02主機上，會Redirected到此key所在slot主機上，再顯示type&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">127.0.0.1:6379&amp;gt; &lt;span class="nb">type&lt;/span> DRM01001000347201
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-&amp;gt; Redirected to slot &lt;span class="o">[&lt;/span>5914&lt;span class="o">]&lt;/span> located at 192.168.1.12:6379
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">hash&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 查看key type，此key在redis03主機上，會Redirected到此key所在slot主機上，再顯示type&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">192.168.1.12:6379&amp;gt; &lt;span class="nb">type&lt;/span> spring:session:index:org.springframework.session.FindByIndexNameSessionRepository.PRINCIPAL_NAME_INDEX_NAME:EBB87CF1F764E6BACCC709323FE1457065B0CC8E
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-&amp;gt; Redirected to slot &lt;span class="o">[&lt;/span>10759&lt;span class="o">]&lt;/span> located at 192.168.1.13:6379
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">192.168.1.13:6379&amp;gt; SMEMBERS spring:session:index:org.springframework.session.FindByIndexNameSessionRepository.PRINCIPAL_NAME_INDEX_NAME:EBB87CF1F764E6BACCC709323FE1457065B0CC8E
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">1&lt;span class="o">)&lt;/span> &lt;span class="s2">&amp;#34;\xac\xed\x00\x05t\x00&lt;/span>&lt;span class="nv">$aef3b17d&lt;/span>&lt;span class="s2">-ed6f-4c4e-9cc3-ef69eda6f33c&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 查看key type，此key在redis04主機上，會Redirected到此key所在slot主機上，再顯示type&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">192.168.1.13:6379&amp;gt; &lt;span class="nb">type&lt;/span> TON01001010231201
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-&amp;gt; Redirected to slot &lt;span class="o">[&lt;/span>12921&lt;span class="o">]&lt;/span> located at 192.168.1.14:6379
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">hash&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">192.168.1.14:6379&amp;gt; hgetall TON01001010231201
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">1&lt;span class="o">)&lt;/span> &lt;span class="s2">&amp;#34;path&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">2&lt;span class="o">)&lt;/span> &lt;span class="s2">&amp;#34;/reader/book_content_unpack/teb/2022/10/17/TON01001010231201/TON01001010231201&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">3&lt;span class="o">)&lt;/span> &lt;span class="s2">&amp;#34;iv&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">4&lt;span class="o">)&lt;/span> &lt;span class="s2">&amp;#34;06ac4696c8a4bb94ecb7e82b38a1dc3f&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">5&lt;span class="o">)&lt;/span> &lt;span class="s2">&amp;#34;key&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">6&lt;span class="o">)&lt;/span> &lt;span class="s2">&amp;#34;36971e857d647324cb59e1cdf58d7071&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 查看key type，此key在redis05主機上，會Redirected到此key所在slot主機上，再顯示type&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">192.168.1.14:6379&amp;gt; &lt;span class="nb">type&lt;/span> spring:session:index:org.springframework.session.FindByIndexNameSessionRepository.PRINCIPAL_NAME_INDEX_NAME:25E30A2AB63FE661B9AE7803EAD9A9AC234097FC
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-&amp;gt; Redirected to slot &lt;span class="o">[&lt;/span>16326&lt;span class="o">]&lt;/span> located at 192.168.1.18:6379
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">192.168.1.18:6379&amp;gt; SMEMBERS spring:session:index:org.springframework.session.FindByIndexNameSessionRepository.PRINCIPAL_NAME_INDEX_NAME:25E30A2AB63FE661B9AE7803EAD9A9AC234097FC
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">1&lt;span class="o">)&lt;/span> &lt;span class="s2">&amp;#34;\xac\xed\x00\x05t\x00&lt;/span>&lt;span class="nv">$f0d82ce3&lt;/span>&lt;span class="s2">-28e3-493c-b992-439565cf987e&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">192.168.1.18:6379&amp;gt; &lt;span class="nb">type&lt;/span> BOOK_CASE_LIST_U_39048951
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-&amp;gt; Redirected to slot &lt;span class="o">[&lt;/span>5895&lt;span class="o">]&lt;/span> located at 192.168.1.12:6379
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">hash&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">192.168.1.12:6379&amp;gt; hgetall BOOK_CASE_LIST_U_39048951
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">1&lt;span class="o">)&lt;/span> &lt;span class="s2">&amp;#34;0_5&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">2&lt;span class="o">)&lt;/span> &lt;span class="s2">&amp;#34;{\&amp;#34;result\&amp;#34;:\&amp;#34;00\&amp;#34;,\&amp;#34;syncTime\&amp;#34;:\&amp;#34;20231202164546\&amp;#34;,\&amp;#34;ebooks\&amp;#34;:[{\&amp;#34;deliverId\&amp;#34;:\&amp;#34;SON03001000560201\&amp;#34;,\&amp;#34;contentId\&amp;#34;:\&amp;#34;SON03001000560\&amp;#34;,\&amp;#34;title\&amp;#34;:\&amp;#34;\xe6\x8a\x95\xe8\xb3\x875\xe5\xb9\xb4\xef\xbc\x8c\xe6\x9c\xac\xe9\x87\x91\xe5\xbe\x9e4\xe8\x90\xac\xe5\x88\xb01\xe5\x84\x84\xe7\x9a\x84\xe5\xa5\xb3\xe4\xba\xba\xef\xbc\x9a\xe5\xbe\x9e\xe7\x9c\x81\xe9\x8c\xa2\xe3\x80\x81\xe5\xae\x9a\xe5\xad\x98\xe5\x88\xb0\xe8\x82\xa1\xe7\xa5\xa8\xef\xbc\x8c\xe5\xb0\x88\xe5\xb1\xac\xe5\xb0\x8f\xe8\xb3\x87\xe5\xa5\xb3\xe7\x9a\x84\xe8\xb3\xaa\xe6\x84\x9f\xe7\x90\x86\xe8\xb2\xa1\xe6\x8f\x90\xe6\xa1\x88\&amp;#34;,\&amp;#34;publisher\&amp;#34;:\&amp;#34;\xe5\xb4\xa7\xe7\x87\x81\xe6\x96\x87\xe5\x8c\x96\&amp;#34;,\&amp;#34;author\&amp;#34;:\&amp;#34;\xe6\xb7\x98\xe6\xb7\x98\&amp;#34;,\&amp;#34;bodyTypeCode\&amp;#34;:\&amp;#34;201\&amp;#34;,\&amp;#34;ebookType\&amp;#34;:\&amp;#34;\xe6\x9b\xb8\xe7\xb1\x8d\&amp;#34;,\&amp;#34;categories\&amp;#34;:[\&amp;#34;\xe9\x87\x91\xe8\x9e\x8d\xe7\x90\x86\xe8\xb2\xa1\&amp;#34;],
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;font color=red>注意：可以看到，有些數據找不到了&lt;/font>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@redis91 redis&lt;span class="o">]&lt;/span>&lt;span class="c1"># redis-cli --user 帳號 --pass 密碼 -c&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Warning: Using a password with &lt;span class="s1">&amp;#39;-a&amp;#39;&lt;/span> or &lt;span class="s1">&amp;#39;-u&amp;#39;&lt;/span> option on the &lt;span class="nb">command&lt;/span> line interface may not be safe.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 此數據找不到了&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">127.0.0.1:6379&amp;gt; &lt;span class="nb">type&lt;/span> spring:session:index:org.springframework.session.FindByIndexNameSessionRepository.PRINCIPAL_NAME_INDEX_NAME:362C74F290B63E5F751DCF1E49EC34BEAF6822F0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">none
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">127.0.0.1:6379&amp;gt; &lt;span class="nb">type&lt;/span> DRM01001000347201
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-&amp;gt; Redirected to slot &lt;span class="o">[&lt;/span>5914&lt;span class="o">]&lt;/span> located at 192.168.1.92:6379
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">hash&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 此數據找不到了&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">192.168.1.92:6379&amp;gt; &lt;span class="nb">type&lt;/span> spring:session:index:org.springframework.session.FindByIndexNameSessionRepository.PRINCIPAL_NAME_INDEX_NAME:EBB87CF1F764E6BACCC709323FE1457065B0CC8E
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-&amp;gt; Redirected to slot &lt;span class="o">[&lt;/span>10759&lt;span class="o">]&lt;/span> located at 192.168.1.94:6379
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">none
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">192.168.1.94:6379&amp;gt; &lt;span class="nb">type&lt;/span> TON01001010231201
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">hash&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">192.168.1.94:6379&amp;gt; hgetall TON01001010231201
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">1&lt;span class="o">)&lt;/span> &lt;span class="s2">&amp;#34;path&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">2&lt;span class="o">)&lt;/span> &lt;span class="s2">&amp;#34;/reader/book_content_unpack/teb/2022/10/17/TON01001010231201/TON01001010231201&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">3&lt;span class="o">)&lt;/span> &lt;span class="s2">&amp;#34;key&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">4&lt;span class="o">)&lt;/span> &lt;span class="s2">&amp;#34;36971e857d647324cb59e1cdf58d7071&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">5&lt;span class="o">)&lt;/span> &lt;span class="s2">&amp;#34;iv&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">6&lt;span class="o">)&lt;/span> &lt;span class="s2">&amp;#34;06ac4696c8a4bb94ecb7e82b38a1dc3f&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 此數據找不到了&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">192.168.1.94:6379&amp;gt; &lt;span class="nb">type&lt;/span> spring:session:index:org.springframework.session.FindByIndexNameSessionRepository.PRINCIPAL_NAME_INDEX_NAME:25E30A2AB63FE661B9AE7803EAD9A9AC234097FC
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-&amp;gt; Redirected to slot &lt;span class="o">[&lt;/span>16326&lt;span class="o">]&lt;/span> located at 192.168.1.98:6379
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">none
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">192.168.1.98:6379&amp;gt; &lt;span class="nb">type&lt;/span> BOOK_CASE_LIST_U_39048951
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-&amp;gt; Redirected to slot &lt;span class="o">[&lt;/span>5895&lt;span class="o">]&lt;/span> located at 192.168.1.92:6379
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">hash&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">192.168.1.92:6379&amp;gt; hgetall BOOK_CASE_LIST_U_39048951
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">1&lt;span class="o">)&lt;/span> &lt;span class="s2">&amp;#34;0_5&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">2&lt;span class="o">)&lt;/span> &lt;span class="s2">&amp;#34;{\&amp;#34;result\&amp;#34;:\&amp;#34;00\&amp;#34;,\&amp;#34;syncTime\&amp;#34;:\&amp;#34;20231202164546\&amp;#34;,\&amp;#34;ebooks\&amp;#34;:[{\&amp;#34;deliverId\&amp;#34;:\&amp;#34;SON03001000560201\&amp;#34;,\&amp;#34;contentId\&amp;#34;:\&amp;#34;SON03001000560\&amp;#34;,\&amp;#34;title\&amp;#34;:\&amp;#34;\xe6\x8a\x95\xe8\xb3\x875\xe5\xb9\xb4\xef\xbc\x8c\xe6\x9c\xac\xe9\x87\x91\xe5\xbe\x9e4\xe8\x90\xac\xe5\x88\xb01\xe5\x84\x84\xe7\x9a\x84\xe5\xa5\xb3\xe4\xba\xba\xef\xbc\x9a\xe5\xbe\x9e\xe7\x9c\x81\xe9\x8c\xa2\xe3\x80\x81\xe5\xae\x9a\xe5\xad\x98\xe5\x88\xb0\xe8\x82\xa1\xe7\xa5\xa8\xef\xbc\x8c\xe5\xb0\x88\xe5\xb1\xac\xe5\xb0\x8f\xe8\xb3\x87\xe5\xa5\xb3\xe7\x9a\x84\xe8\xb3\xaa\xe6\x84\x9f\xe7\x90\x86\xe8\xb2\xa1\xe6\x8f\x90\xe6\xa1\x88\&amp;#34;,\&amp;#34;publisher\&amp;#34;:\&amp;#34;\xe5\xb4\xa7\xe7\x87\x81\xe6\x96\x87\xe5\x8c\x96\&amp;#34;,\&amp;#34;author\&amp;#34;:\&amp;#34;\xe6\xb7\x98\xe6\xb7\x98\&amp;#34;,\&amp;#34;bodyTypeCode\&amp;#34;:\&amp;#34;201\&amp;#34;,\&amp;#34;ebookType\&amp;#34;:\&amp;#34;\xe6\x9b\xb8\xe7\xb1\x8d\&amp;#34;,\&amp;#34;categories\&amp;#34;:[\&amp;#34;\xe9
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;font color=red>可以看到，數據樣式變了，此恢復數據方式會有問題，不可用&lt;/font>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 原數據&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">spring:session:index:org.springframework.session.FindByIndexNameSessionRepository.PRINCIPAL_NAME_INDEX_NAME:362C74F290B63E5F751DCF1E49EC34BEAF6822F0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 用RedisInsight BULK ACTIONS恢復後的數據樣式變這樣&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="se">\x&lt;/span>19spring:session:index:org.s&lt;span class="sb">`&lt;/span>&lt;span class="se">\x&lt;/span>18&lt;span class="se">\t&lt;/span>framework.&lt;span class="se">\x&lt;/span>a0!&lt;span class="se">\x&lt;/span>01.F &lt;span class="se">\&amp;#34;\x&lt;/span>02ByI@&lt;span class="err">&amp;#39;&lt;/span>&lt;span class="se">\x&lt;/span>00N &lt;span class="se">\x&lt;/span>1b&lt;span class="se">\x&lt;/span>00S&lt;span class="se">\x&lt;/span>808&lt;span class="se">\x&lt;/span>1eRepository.PRINCIPAL_NAME_INDEX&lt;span class="sb">`&lt;/span>&lt;span class="se">\n\x&lt;/span>1f:8E09B7E74AAA48FF8481847092A40E8&lt;span class="se">\b&lt;/span>A0FBB829A
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>使用Kubernetes架設RedisInsight 1.x版，管理Redis集群</title><link>https://blog.goldfishbrain-fighting.com/2023/kubernetes-redisinsight/</link><pubDate>Sun, 17 Dec 2023 00:31:18 +0800</pubDate><guid>https://blog.goldfishbrain-fighting.com/2023/kubernetes-redisinsight/</guid><description>&lt;p>參考網址：https://docs.redis.com/latest/ri/installing/install-k8s/&lt;/p>
&lt;h2 id="create-the-redisinsight-deployment-and-service">Create the RedisInsight deployment and service&lt;/h2>
&lt;p>&lt;font color=red>沒有持久化數據，也就是POD重起，設定數據就會消失&lt;/font>&lt;/p>
&lt;p>Below is an annotated YAML file that will create a RedisInsight deployment and a service in a k8s cluster.&lt;/p>
&lt;ol>
&lt;li>Create a new file redisinsight.yaml with the content below&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="line">&lt;span class="cl">&lt;span class="c"># RedisInsight service with name &amp;#39;redisinsight-service&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">apiVersion&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">v1&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">kind&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Service&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">metadata&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">redisinsight-service &lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c"># name should not be &amp;#39;redisinsight&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c"># since the service creates&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c"># environment variables that&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c"># conflicts with redisinsight&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c"># application&amp;#39;s environment&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c"># variables `REDISINSIGHT_HOST` and&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c"># `REDISINSIGHT_PORT`&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">spec&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">type&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">NodePort&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">ports&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">port&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">80&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">targetPort&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">8001&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">selector&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">app&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">redisinsight&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nn">---&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c"># RedisInsight deployment with name &amp;#39;redisinsight&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">apiVersion&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">apps/v1&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">kind&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Deployment&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">metadata&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">redisinsight&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c">#deployment name&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">labels&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">app&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">redisinsight&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c">#deployment label&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">spec&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">replicas&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">1&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c">#a single replica pod&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">selector&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">matchLabels&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">app&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">redisinsight&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c">#which pods is the deployment managing, as defined by the pod template&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">template&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c">#pod template&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">metadata&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">labels&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">app&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">redisinsight&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c">#label for pod/s&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">spec&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">containers&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">redisinsight&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c">#Container name (DNS_LABEL, unique)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">image&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">redislabs/redisinsight:latest&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c">#repo/image&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">imagePullPolicy&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">IfNotPresent&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c">#Always pull image&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">volumeMounts&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">db&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c">#Pod volumes to mount into the container&amp;#39;s filesystem. Cannot be updated.&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">mountPath&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">/db&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">ports&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">containerPort&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">8001&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c">#exposed container port and protocol&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">protocol&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">TCP&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">volumes&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">db&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">emptyDir&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>{}&lt;span class="w"> &lt;/span>&lt;span class="c"># node-ephemeral volume https://kubernetes.io/docs/concepts/storage/volumes/#emptydir&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ol start="2">
&lt;li>Create the RedisInsight deployment and service&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">kubectl apply -f redisinsight.yaml
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ol start="3">
&lt;li>Once the deployment and service are successfully applied and complete, access RedisInsight. This can be accomplished by listing the using the &lt;code>&amp;lt;external-ip&amp;gt;&lt;/code> of the service we created to reach redisinsight.&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">root@k8s-master71u:~# kubectl get svc,pod
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME TYPE CLUSTER-IP EXTERNAL-IP PORT&lt;span class="o">(&lt;/span>S&lt;span class="o">)&lt;/span> AGE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">service/redisinsight-service NodePort 10.202.52.175 &amp;lt;none&amp;gt; 80:31785/TCP 8s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME READY STATUS RESTARTS AGE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">pod/redisinsight-cf7f6847b-s2zgg 1/1 Running &lt;span class="m">0&lt;/span> 8s
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="or-create-the-redisinsight-deployment-with-persistant-storage">Or Create the RedisInsight deployment with persistant storage&lt;/h2>
&lt;p>&lt;font color=red>持久化數據，也就是POD重起，設定數據也不會消失&lt;/font>&lt;/p>
&lt;p>Below is an annotated YAML file that will create a RedisInsight deployment in a K8s cluster. It will assign a peristent volume created from a volume claim template. Write access to the container is configured in an init container. When using deployments with persistent writeable volumes, it’s best to set the strategy to &lt;code>Recreate&lt;/code>. Otherwise you may find yourself with two pods trying to use the same volume.&lt;/p>
&lt;ol>
&lt;li>Create a new file &lt;code>redisinsight.yaml&lt;/code> with the content below.&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="line">&lt;span class="cl">&lt;span class="c"># RedisInsight service with name &amp;#39;redisinsight-service&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">apiVersion&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">v1&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">kind&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Service&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">metadata&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">redisinsight-service &lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c"># name should not be &amp;#39;redisinsight&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c"># since the service creates&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c"># environment variables that&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c"># conflicts with redisinsight&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c"># application&amp;#39;s environment&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c"># variables `REDISINSIGHT_HOST` and&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c"># `REDISINSIGHT_PORT`&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">spec&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">type&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">NodePort&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">ports&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">port&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">80&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">targetPort&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">8001&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">selector&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">app&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">redisinsight&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nn">---&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">apiVersion&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">v1&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">kind&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">PersistentVolumeClaim&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">metadata&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">redisinsight-pv-claim&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">labels&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">app&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">redisinsight&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">spec&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">accessModes&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">ReadWriteOnce&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">resources&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">requests&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">storage&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">2Gi&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">storageClassName&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;rook-cephfs&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nn">---&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c"># RedisInsight deployment with name &amp;#39;redisinsight&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">apiVersion&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">apps/v1&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">kind&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Deployment&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">metadata&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">redisinsight&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c">#deployment name&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">labels&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">app&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">redisinsight&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c">#deployment label&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">spec&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">replicas&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">1&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c">#a single replica pod&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">strategy&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">type&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Recreate&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">selector&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">matchLabels&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">app&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">redisinsight&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c">#which pods is the deployment managing, as defined by the pod template&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">template&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c">#pod template&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">metadata&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">labels&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">app&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">redisinsight&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c">#label for pod/s&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">spec&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">volumes&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">db&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">persistentVolumeClaim&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">claimName&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">redisinsight-pv-claim&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">initContainers&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">init&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">image&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">busybox&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">command&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">/bin/sh&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="s1">&amp;#39;-c&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="p">|&lt;/span>&lt;span class="sd">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd"> chown -R 1001 /db&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">resources&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>{}&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">volumeMounts&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">db&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">mountPath&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">/db&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">terminationMessagePath&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">/dev/termination-log&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">terminationMessagePolicy&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">File&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">containers&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">redisinsight&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c">#Container name (DNS_LABEL, unique)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">image&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">redislabs/redisinsight:latest&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c">#repo/image&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">imagePullPolicy&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">IfNotPresent&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c">#Always pull image&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">volumeMounts&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">db&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c">#Pod volumes to mount into the container&amp;#39;s filesystem. Cannot be updated.&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">mountPath&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">/db&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">ports&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">containerPort&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">8001&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c">#exposed container port and protocol&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">protocol&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">TCP&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ol start="2">
&lt;li>Create the RedisInsight deployment and service.&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">kubectl apply -f redisinsight.yaml
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="開網頁測試">開網頁測試&lt;/h2>
&lt;p>http://192.168.1.71:31785/&lt;/p>
&lt;h3 id="redis-cluster主機ip表">Redis Cluster主機IP表&lt;/h3>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>&lt;/th>
&lt;th>&lt;/th>
&lt;th>&lt;/th>
&lt;th>&lt;/th>
&lt;th>&lt;/th>
&lt;th>&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>主機名稱&lt;/td>
&lt;td>主機IP&lt;/td>
&lt;td>角色&lt;/td>
&lt;td>主機IP&lt;/td>
&lt;td>角色&lt;/td>
&lt;td>跟隨&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>redis01&lt;/td>
&lt;td>192.168.1.11:6379&lt;/td>
&lt;td>master&lt;/td>
&lt;td>192.168.1.11:6380&lt;/td>
&lt;td>slave&lt;/td>
&lt;td>192.168.1.12:6380&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>redis02&lt;/td>
&lt;td>192.168.1.12:6379&lt;/td>
&lt;td>master&lt;/td>
&lt;td>192.168.1.12:6380&lt;/td>
&lt;td>slave&lt;/td>
&lt;td>192.168.1.13:6380&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>redis03&lt;/td>
&lt;td>192.168.1.13:6379&lt;/td>
&lt;td>master&lt;/td>
&lt;td>192.168.1.13:6380&lt;/td>
&lt;td>slave&lt;/td>
&lt;td>192.168.1.11:6380&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>redis04&lt;/td>
&lt;td>192.168.1.14:6379&lt;/td>
&lt;td>master&lt;/td>
&lt;td>192.168.1.14:6380&lt;/td>
&lt;td>slave&lt;/td>
&lt;td>192.168.1.18:6380&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>redis05&lt;/td>
&lt;td>192.168.1.18:6379&lt;/td>
&lt;td>master&lt;/td>
&lt;td>192.168.1.18:6380&lt;/td>
&lt;td>slave&lt;/td>
&lt;td>192.168.1.14:6380&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h3 id="登入畫面">登入畫面&lt;/h3>
&lt;p>&lt;img src="https://blog.goldfishbrain-fighting.com/2023/kubernetes-redisinsight/media/Pasted-image-20231216235027.png"
width="1520"
height="894"
srcset="https://blog.goldfishbrain-fighting.com/2023/kubernetes-redisinsight/media/Pasted-image-20231216235027_hubc595a2880cfb08687aea0955beb0c64_103230_480x0_resize_box_3.png 480w, https://blog.goldfishbrain-fighting.com/2023/kubernetes-redisinsight/media/Pasted-image-20231216235027_hubc595a2880cfb08687aea0955beb0c64_103230_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="170"
data-flex-basis="408px"
>&lt;/p>
&lt;h3 id="點選add-redis-database">點選ADD REDIS DATABASE&lt;/h3>
&lt;p>&lt;img src="https://blog.goldfishbrain-fighting.com/2023/kubernetes-redisinsight/media/Pasted-image-20231216235104.png"
width="1122"
height="678"
srcset="https://blog.goldfishbrain-fighting.com/2023/kubernetes-redisinsight/media/Pasted-image-20231216235104_hu816cd84f59ec0e73557eb24ada62e87c_59820_480x0_resize_box_3.png 480w, https://blog.goldfishbrain-fighting.com/2023/kubernetes-redisinsight/media/Pasted-image-20231216235104_hu816cd84f59ec0e73557eb24ada62e87c_59820_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="165"
data-flex-basis="397px"
>&lt;/p>
&lt;h3 id="填寫其中一台redis-cluster資訊">填寫其中一台redis cluster資訊&lt;/h3>
&lt;p>&lt;img src="https://blog.goldfishbrain-fighting.com/2023/kubernetes-redisinsight/media/Pasted-image-20231216235257.png"
width="1108"
height="670"
srcset="https://blog.goldfishbrain-fighting.com/2023/kubernetes-redisinsight/media/Pasted-image-20231216235257_hu43f0193d99c61175a068e1c65da95568_50719_480x0_resize_box_3.png 480w, https://blog.goldfishbrain-fighting.com/2023/kubernetes-redisinsight/media/Pasted-image-20231216235257_hu43f0193d99c61175a068e1c65da95568_50719_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="165"
data-flex-basis="396px"
>&lt;/p>
&lt;p>偵測到為Cluster，就會幫我一同找到其他節點IP&lt;/p>
&lt;p>&lt;img src="https://blog.goldfishbrain-fighting.com/2023/kubernetes-redisinsight/media/Pasted-image-20231217000345.png"
width="1121"
height="684"
srcset="https://blog.goldfishbrain-fighting.com/2023/kubernetes-redisinsight/media/Pasted-image-20231217000345_hu000ce6b82cba0ff6fa000c7b112b8380_59384_480x0_resize_box_3.png 480w, https://blog.goldfishbrain-fighting.com/2023/kubernetes-redisinsight/media/Pasted-image-20231217000345_hu000ce6b82cba0ff6fa000c7b112b8380_59384_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="163"
data-flex-basis="393px"
>&lt;/p>
&lt;h3 id="all-masterreplica-nodes-summary">ALL MASTER、REPLICA NODES SUMMARY&lt;/h3>
&lt;p>可以看到MASTER 節點，彙整總結資訊&lt;/p>
&lt;p>&lt;img src="https://blog.goldfishbrain-fighting.com/2023/kubernetes-redisinsight/media/Pasted-image-20231217000508.png"
width="1873"
height="861"
srcset="https://blog.goldfishbrain-fighting.com/2023/kubernetes-redisinsight/media/Pasted-image-20231217000508_huc4d26850c3517e5d881b327fd6d0b9d3_161690_480x0_resize_box_3.png 480w, https://blog.goldfishbrain-fighting.com/2023/kubernetes-redisinsight/media/Pasted-image-20231217000508_huc4d26850c3517e5d881b327fd6d0b9d3_161690_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="217"
data-flex-basis="522px"
>&lt;/p>
&lt;p>也可以看到REPLICA 節點，彙整總結資訊&lt;/p>
&lt;p>&lt;img src="https://blog.goldfishbrain-fighting.com/2023/kubernetes-redisinsight/media/Pasted-image-20231217000624.png"
width="1674"
height="879"
srcset="https://blog.goldfishbrain-fighting.com/2023/kubernetes-redisinsight/media/Pasted-image-20231217000624_hua887d4c4927a02e3229116473dd8c7e0_148094_480x0_resize_box_3.png 480w, https://blog.goldfishbrain-fighting.com/2023/kubernetes-redisinsight/media/Pasted-image-20231217000624_hua887d4c4927a02e3229116473dd8c7e0_148094_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="190"
data-flex-basis="457px"
>&lt;/p>
&lt;h3 id="browserscan-key">Browser(SCAN Key）&lt;/h3>
&lt;p>可以透過此，查詢所有key及其value，也可以添加KEY&lt;/p>
&lt;p>&lt;img src="https://blog.goldfishbrain-fighting.com/2023/kubernetes-redisinsight/media/Pasted-image-20231217000755.png"
width="1915"
height="871"
srcset="https://blog.goldfishbrain-fighting.com/2023/kubernetes-redisinsight/media/Pasted-image-20231217000755_huefbff92471ed817598608ac1c241ab15_241077_480x0_resize_box_3.png 480w, https://blog.goldfishbrain-fighting.com/2023/kubernetes-redisinsight/media/Pasted-image-20231217000755_huefbff92471ed817598608ac1c241ab15_241077_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="219"
data-flex-basis="527px"
>&lt;/p>
&lt;h3 id="clicommand">CLI(COMMAND）&lt;/h3>
&lt;p>可以針對節點下REDIS指令&lt;/p>
&lt;p>&lt;img src="https://blog.goldfishbrain-fighting.com/2023/kubernetes-redisinsight/media/Pasted-image-20231217000943.png"
width="1906"
height="854"
srcset="https://blog.goldfishbrain-fighting.com/2023/kubernetes-redisinsight/media/Pasted-image-20231217000943_hucc5359ba6836c337b39835780581fb06_125044_480x0_resize_box_3.png 480w, https://blog.goldfishbrain-fighting.com/2023/kubernetes-redisinsight/media/Pasted-image-20231217000943_hucc5359ba6836c337b39835780581fb06_125044_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="223"
data-flex-basis="535px"
>&lt;/p>
&lt;p>這裡針對所有MASTER下scan 0 count 50指令&lt;/p>
&lt;p>&lt;img src="https://blog.goldfishbrain-fighting.com/2023/kubernetes-redisinsight/media/Pasted-image-20231217001038.png"
width="1912"
height="835"
srcset="https://blog.goldfishbrain-fighting.com/2023/kubernetes-redisinsight/media/Pasted-image-20231217001038_hub242481e8ad9141a8375b65511187ee3_152528_480x0_resize_box_3.png 480w, https://blog.goldfishbrain-fighting.com/2023/kubernetes-redisinsight/media/Pasted-image-20231217001038_hub242481e8ad9141a8375b65511187ee3_152528_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="228"
data-flex-basis="549px"
>&lt;/p>
&lt;p>就會針對每一台MASTER幫你下指令，並統一顯示於視窗&lt;/p>
&lt;p>&lt;img src="https://blog.goldfishbrain-fighting.com/2023/kubernetes-redisinsight/media/Pasted-image-20231217001200.png"
width="1636"
height="657"
srcset="https://blog.goldfishbrain-fighting.com/2023/kubernetes-redisinsight/media/Pasted-image-20231217001200_hu982f8309205c0bf63243849c78a5c20e_316786_480x0_resize_box_3.png 480w, https://blog.goldfishbrain-fighting.com/2023/kubernetes-redisinsight/media/Pasted-image-20231217001200_hu982f8309205c0bf63243849c78a5c20e_316786_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="249"
data-flex-basis="597px"
>&lt;/p>
&lt;p>&lt;img src="https://blog.goldfishbrain-fighting.com/2023/kubernetes-redisinsight/media/Pasted-image-20231217001215.png"
width="1663"
height="657"
srcset="https://blog.goldfishbrain-fighting.com/2023/kubernetes-redisinsight/media/Pasted-image-20231217001215_hu77f57ec20b04b6925069e5dcc67587df_316377_480x0_resize_box_3.png 480w, https://blog.goldfishbrain-fighting.com/2023/kubernetes-redisinsight/media/Pasted-image-20231217001215_hu77f57ec20b04b6925069e5dcc67587df_316377_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="253"
data-flex-basis="607px"
>&lt;/p>
&lt;h3 id="analysememory-analysis">ANALYSE(Memory Analysis)&lt;/h3>
&lt;p>可以選擇使用離線分析，也就是提供他rdb file，&lt;/p>
&lt;p>或者線上分析，他會對所有redis下bgsave指令，在遠端的redis就會存下目前所有的key資訊為dump.rdb檔。&lt;/p>
&lt;p>&lt;img src="https://blog.goldfishbrain-fighting.com/2023/kubernetes-redisinsight/media/Pasted-image-20231217001720.png"
width="1354"
height="794"
srcset="https://blog.goldfishbrain-fighting.com/2023/kubernetes-redisinsight/media/Pasted-image-20231217001720_hu89b8e7b94ed341b285872504d99afd0a_140302_480x0_resize_box_3.png 480w, https://blog.goldfishbrain-fighting.com/2023/kubernetes-redisinsight/media/Pasted-image-20231217001720_hu89b8e7b94ed341b285872504d99afd0a_140302_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="170"
data-flex-basis="409px"
>&lt;/p>
&lt;h4 id="memory-overview">Memory Overview&lt;/h4>
&lt;p>&lt;img src="https://blog.goldfishbrain-fighting.com/2023/kubernetes-redisinsight/media/Pasted-image-20231217001411.png"
width="1882"
height="849"
srcset="https://blog.goldfishbrain-fighting.com/2023/kubernetes-redisinsight/media/Pasted-image-20231217001411_hub353f13bb15e8d6d47f780560c45b4ea_117088_480x0_resize_box_3.png 480w, https://blog.goldfishbrain-fighting.com/2023/kubernetes-redisinsight/media/Pasted-image-20231217001411_hub353f13bb15e8d6d47f780560c45b4ea_117088_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="221"
data-flex-basis="532px"
>&lt;/p>
&lt;p>&lt;img src="https://blog.goldfishbrain-fighting.com/2023/kubernetes-redisinsight/media/Pasted-image-20231217001423.png"
width="1874"
height="910"
srcset="https://blog.goldfishbrain-fighting.com/2023/kubernetes-redisinsight/media/Pasted-image-20231217001423_hu8a88c2f797068db404e3feb4e5eac50b_185128_480x0_resize_box_3.png 480w, https://blog.goldfishbrain-fighting.com/2023/kubernetes-redisinsight/media/Pasted-image-20231217001423_hu8a88c2f797068db404e3feb4e5eac50b_185128_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="205"
data-flex-basis="494px"
>&lt;/p>
&lt;h4 id="keyspace-summary">Keyspace Summary&lt;/h4>
&lt;p>&lt;img src="https://blog.goldfishbrain-fighting.com/2023/kubernetes-redisinsight/media/Pasted-image-20231217001438.png"
width="1919"
height="650"
srcset="https://blog.goldfishbrain-fighting.com/2023/kubernetes-redisinsight/media/Pasted-image-20231217001438_hu53ae2237005015c4c86a8e360836895c_177798_480x0_resize_box_3.png 480w, https://blog.goldfishbrain-fighting.com/2023/kubernetes-redisinsight/media/Pasted-image-20231217001438_hu53ae2237005015c4c86a8e360836895c_177798_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="295"
data-flex-basis="708px"
>&lt;/p>
&lt;h4 id="recommendations">Recommendations&lt;/h4>
&lt;p>&lt;img src="https://blog.goldfishbrain-fighting.com/2023/kubernetes-redisinsight/media/Pasted-image-20231217001500.png"
width="1347"
height="899"
srcset="https://blog.goldfishbrain-fighting.com/2023/kubernetes-redisinsight/media/Pasted-image-20231217001500_hu65a9842b606217ca1e1d2351e0fa4c16_218933_480x0_resize_box_3.png 480w, https://blog.goldfishbrain-fighting.com/2023/kubernetes-redisinsight/media/Pasted-image-20231217001500_hu65a9842b606217ca1e1d2351e0fa4c16_218933_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="149"
data-flex-basis="359px"
>&lt;/p>
&lt;h4 id="memory-analyzer">Memory Analyzer&lt;/h4>
&lt;p>&lt;img src="https://blog.goldfishbrain-fighting.com/2023/kubernetes-redisinsight/media/Pasted-image-20231217001514.png"
width="1881"
height="908"
srcset="https://blog.goldfishbrain-fighting.com/2023/kubernetes-redisinsight/media/Pasted-image-20231217001514_hua028830752b5e018d6e8bd2f94a4c129_273482_480x0_resize_box_3.png 480w, https://blog.goldfishbrain-fighting.com/2023/kubernetes-redisinsight/media/Pasted-image-20231217001514_hua028830752b5e018d6e8bd2f94a4c129_273482_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="207"
data-flex-basis="497px"
>&lt;/p>
&lt;h3 id="analyse-profilermonitor">ANALYSE Profiler(Monitor)&lt;/h3>
&lt;p>記錄當下指令執行&lt;/p>
&lt;p>&lt;img src="https://blog.goldfishbrain-fighting.com/2023/kubernetes-redisinsight/media/Pasted-image-20231217002212.png"
width="1903"
height="766"
srcset="https://blog.goldfishbrain-fighting.com/2023/kubernetes-redisinsight/media/Pasted-image-20231217002212_hu394e3ebe52a6f3c55e0006c4197c2417_127713_480x0_resize_box_3.png 480w, https://blog.goldfishbrain-fighting.com/2023/kubernetes-redisinsight/media/Pasted-image-20231217002212_hu394e3ebe52a6f3c55e0006c4197c2417_127713_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="248"
data-flex-basis="596px"
>&lt;/p>
&lt;p>&lt;img src="https://blog.goldfishbrain-fighting.com/2023/kubernetes-redisinsight/media/Pasted-image-20231217002230.png"
width="1916"
height="795"
srcset="https://blog.goldfishbrain-fighting.com/2023/kubernetes-redisinsight/media/Pasted-image-20231217002230_hu9f703c181e6a5b16f8082c8c97b36aee_114738_480x0_resize_box_3.png 480w, https://blog.goldfishbrain-fighting.com/2023/kubernetes-redisinsight/media/Pasted-image-20231217002230_hu9f703c181e6a5b16f8082c8c97b36aee_114738_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="241"
data-flex-basis="578px"
>&lt;/p>
&lt;h3 id="analyse-slowlog">ANALYSE Slowlog&lt;/h3>
&lt;p>查看目前有沒有slowlog慢日誌產生&lt;/p>
&lt;p>&lt;img src="https://blog.goldfishbrain-fighting.com/2023/kubernetes-redisinsight/media/Pasted-image-20231217002242.png"
width="1914"
height="782"
srcset="https://blog.goldfishbrain-fighting.com/2023/kubernetes-redisinsight/media/Pasted-image-20231217002242_hu5ee9039f311db725ba369211d2105819_124388_480x0_resize_box_3.png 480w, https://blog.goldfishbrain-fighting.com/2023/kubernetes-redisinsight/media/Pasted-image-20231217002242_hu5ee9039f311db725ba369211d2105819_124388_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="244"
data-flex-basis="587px"
>&lt;/p>
&lt;h3 id="bulk-actions">Bulk Actions&lt;/h3>
&lt;p>&lt;img src="https://blog.goldfishbrain-fighting.com/2023/kubernetes-redisinsight/media/Pasted-image-20231217002349.png"
width="1865"
height="771"
srcset="https://blog.goldfishbrain-fighting.com/2023/kubernetes-redisinsight/media/Pasted-image-20231217002349_hu28bcbf2c09fed4869ce237cced7d569c_118656_480x0_resize_box_3.png 480w, https://blog.goldfishbrain-fighting.com/2023/kubernetes-redisinsight/media/Pasted-image-20231217002349_hu28bcbf2c09fed4869ce237cced7d569c_118656_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="241"
data-flex-basis="580px"
>&lt;/p>
&lt;h3 id="datebase-configuration">DATEBASE Configuration&lt;/h3>
&lt;p>可以查看，並設定REDIS&lt;/p>
&lt;p>&lt;img src="https://blog.goldfishbrain-fighting.com/2023/kubernetes-redisinsight/media/Pasted-image-20231217002605.png"
width="1321"
height="920"
srcset="https://blog.goldfishbrain-fighting.com/2023/kubernetes-redisinsight/media/Pasted-image-20231217002605_hu72f2db596c7d1961a33efee3e1ceb93b_155110_480x0_resize_box_3.png 480w, https://blog.goldfishbrain-fighting.com/2023/kubernetes-redisinsight/media/Pasted-image-20231217002605_hu72f2db596c7d1961a33efee3e1ceb93b_155110_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="143"
data-flex-basis="344px"
>&lt;/p>
&lt;h3 id="datebase-cluster-management">DATEBASE Cluster Management&lt;/h3>
&lt;p>可以管理Cluster&lt;/p>
&lt;p>&lt;img src="https://blog.goldfishbrain-fighting.com/2023/kubernetes-redisinsight/media/Pasted-image-20231217002652.png"
width="1528"
height="758"
srcset="https://blog.goldfishbrain-fighting.com/2023/kubernetes-redisinsight/media/Pasted-image-20231217002652_hucbe0daba715cf90120a1dfcdefcbafed_144547_480x0_resize_box_3.png 480w, https://blog.goldfishbrain-fighting.com/2023/kubernetes-redisinsight/media/Pasted-image-20231217002652_hucbe0daba715cf90120a1dfcdefcbafed_144547_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="201"
data-flex-basis="483px"
>&lt;/p>
&lt;h3 id="datebase-client-list">DATEBASE Client List&lt;/h3>
&lt;p>可以看到目前連接的客戶端資訊&lt;/p>
&lt;p>&lt;img src="https://blog.goldfishbrain-fighting.com/2023/kubernetes-redisinsight/media/Pasted-image-20231217002741.png"
width="1119"
height="912"
srcset="https://blog.goldfishbrain-fighting.com/2023/kubernetes-redisinsight/media/Pasted-image-20231217002741_hu4e64c5dd0c1ff4561f2410ddd39bf1fb_224268_480x0_resize_box_3.png 480w, https://blog.goldfishbrain-fighting.com/2023/kubernetes-redisinsight/media/Pasted-image-20231217002741_hu4e64c5dd0c1ff4561f2410ddd39bf1fb_224268_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="122"
data-flex-basis="294px"
>&lt;/p></description></item><item><title>Redis Cluster 資料移轉，從一個cluster遷移所有分片數據到另一個cluster</title><link>https://blog.goldfishbrain-fighting.com/2023/redis-cluster-database-transfer/</link><pubDate>Sat, 16 Dec 2023 23:43:00 +0800</pubDate><guid>https://blog.goldfishbrain-fighting.com/2023/redis-cluster-database-transfer/</guid><description>&lt;h2 id="redis-cluster來源主機ip表">Redis Cluster來源主機IP表&lt;/h2>
&lt;p>&lt;img src="https://blog.goldfishbrain-fighting.com/2023/redis-cluster-database-transfer/media/Pasted-image-20231217005056.png"
width="668"
height="1011"
srcset="https://blog.goldfishbrain-fighting.com/2023/redis-cluster-database-transfer/media/Pasted-image-20231217005056_hu970dfcb3f0cf2fdac96614a15315f26c_135448_480x0_resize_box_3.png 480w, https://blog.goldfishbrain-fighting.com/2023/redis-cluster-database-transfer/media/Pasted-image-20231217005056_hu970dfcb3f0cf2fdac96614a15315f26c_135448_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="66"
data-flex-basis="158px"
>&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>&lt;/th>
&lt;th>&lt;/th>
&lt;th>&lt;/th>
&lt;th>&lt;/th>
&lt;th>&lt;/th>
&lt;th>&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>主機名稱&lt;/td>
&lt;td>主機IP&lt;/td>
&lt;td>角色&lt;/td>
&lt;td>主機IP&lt;/td>
&lt;td>角色&lt;/td>
&lt;td>跟隨&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>redis91&lt;/td>
&lt;td>192.168.1.91:6379&lt;/td>
&lt;td>master&lt;/td>
&lt;td>192.168.1.91:6380&lt;/td>
&lt;td>slave&lt;/td>
&lt;td>192.168.1.92:6380&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>redis92&lt;/td>
&lt;td>192.168.1.92:6379&lt;/td>
&lt;td>master&lt;/td>
&lt;td>192.168.1.92:6380&lt;/td>
&lt;td>slave&lt;/td>
&lt;td>192.168.1.93:6380&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>redis93&lt;/td>
&lt;td>192.168.1.93:6379&lt;/td>
&lt;td>master&lt;/td>
&lt;td>192.168.1.93:6380&lt;/td>
&lt;td>slave&lt;/td>
&lt;td>192.168.1.91:6380&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>redis94&lt;/td>
&lt;td>192.168.1.94:6379&lt;/td>
&lt;td>master&lt;/td>
&lt;td>192.168.1.94:6380&lt;/td>
&lt;td>slave&lt;/td>
&lt;td>192.168.1.98:6380&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>redis98&lt;/td>
&lt;td>192.168.1.98:6379&lt;/td>
&lt;td>master&lt;/td>
&lt;td>192.168.1.98:6380&lt;/td>
&lt;td>slave&lt;/td>
&lt;td>192.168.1.94:6380&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h2 id="redis-cluster目的主機ip表">Redis Cluster目的主機IP表&lt;/h2>
&lt;p>&lt;img src="https://blog.goldfishbrain-fighting.com/2023/redis-cluster-database-transfer/media/Pasted-image-20231217005115.png"
width="668"
height="1011"
srcset="https://blog.goldfishbrain-fighting.com/2023/redis-cluster-database-transfer/media/Pasted-image-20231217005115_hua47f22cd06286ccf2b27f50d9b902ee1_132470_480x0_resize_box_3.png 480w, https://blog.goldfishbrain-fighting.com/2023/redis-cluster-database-transfer/media/Pasted-image-20231217005115_hua47f22cd06286ccf2b27f50d9b902ee1_132470_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="66"
data-flex-basis="158px"
>&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>&lt;/th>
&lt;th>&lt;/th>
&lt;th>&lt;/th>
&lt;th>&lt;/th>
&lt;th>&lt;/th>
&lt;th>&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>主機名稱&lt;/td>
&lt;td>主機IP&lt;/td>
&lt;td>角色&lt;/td>
&lt;td>主機IP&lt;/td>
&lt;td>角色&lt;/td>
&lt;td>跟隨&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>redis01&lt;/td>
&lt;td>192.168.1.11:6379&lt;/td>
&lt;td>master&lt;/td>
&lt;td>192.168.1.11:6380&lt;/td>
&lt;td>slave&lt;/td>
&lt;td>192.168.1.12:6380&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>redis02&lt;/td>
&lt;td>192.168.1.12:6379&lt;/td>
&lt;td>master&lt;/td>
&lt;td>192.168.1.12:6380&lt;/td>
&lt;td>slave&lt;/td>
&lt;td>192.168.1.13:6380&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>redis03&lt;/td>
&lt;td>192.168.1.13:6379&lt;/td>
&lt;td>master&lt;/td>
&lt;td>192.168.1.13:6380&lt;/td>
&lt;td>slave&lt;/td>
&lt;td>192.168.1.11:6380&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>redis04&lt;/td>
&lt;td>192.168.1.14:6379&lt;/td>
&lt;td>master&lt;/td>
&lt;td>192.168.1.14:6380&lt;/td>
&lt;td>slave&lt;/td>
&lt;td>192.168.1.18:6380&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>redis05&lt;/td>
&lt;td>192.168.1.18:6379&lt;/td>
&lt;td>master&lt;/td>
&lt;td>192.168.1.18:6380&lt;/td>
&lt;td>slave&lt;/td>
&lt;td>192.168.1.14:6380&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h2 id="實現目的與流程">實現目的與流程&lt;/h2>
&lt;ol>
&lt;li>從來源5台master使用bgsave指令，產生各master的數據檔案dump.rdb，共會產生5個dump.rdb檔&lt;/li>
&lt;li>將來源dump.rdb檔案傳送至目的5台master的redis工作目錄下，覆蓋原dump.rdb檔&lt;/li>
&lt;li>一台一台重啟redis服務&lt;/li>
&lt;li>重啟一台redis服務，就檢查一次數據恢復狀況(&amp;ndash;cluster check)，並修復(&amp;ndash;cluster fix)&lt;/li>
&lt;li>確定檢查正常，再執行下一台redis服務重啟&lt;/li>
&lt;li>直到5台都執行完畢，確認數據全部還原至目的集群&lt;/li>
&lt;/ol>
&lt;p>&lt;font color=red>注意：以上流程，一定要一台一台來執行，不能一次全部重啟redis服務&lt;/font>&lt;/p>
&lt;h2 id="目的cluser建置">目的cluser建置&lt;/h2>
&lt;h3 id="master-cluster集群創建master">master cluster集群創建(master)&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@redis01 redis&lt;span class="o">]&lt;/span>&lt;span class="c1"># redis-cli --user 帳號 --pass 密碼 --cluster create 192.168.1.11:6379 192.168.1.12:6379 192.168.1.13:6379 192.168.1.14:6379 192.168.1.18:6379&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Warning: Using a password with &lt;span class="s1">&amp;#39;-a&amp;#39;&lt;/span> or &lt;span class="s1">&amp;#39;-u&amp;#39;&lt;/span> option on the &lt;span class="nb">command&lt;/span> line interface may not be safe.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;gt;&amp;gt;&amp;gt; Performing &lt;span class="nb">hash&lt;/span> slots allocation on &lt;span class="m">5&lt;/span> nodes...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Master&lt;span class="o">[&lt;/span>0&lt;span class="o">]&lt;/span> -&amp;gt; Slots &lt;span class="m">0&lt;/span> - &lt;span class="m">3276&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Master&lt;span class="o">[&lt;/span>1&lt;span class="o">]&lt;/span> -&amp;gt; Slots &lt;span class="m">3277&lt;/span> - &lt;span class="m">6553&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Master&lt;span class="o">[&lt;/span>2&lt;span class="o">]&lt;/span> -&amp;gt; Slots &lt;span class="m">6554&lt;/span> - &lt;span class="m">9829&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Master&lt;span class="o">[&lt;/span>3&lt;span class="o">]&lt;/span> -&amp;gt; Slots &lt;span class="m">9830&lt;/span> - &lt;span class="m">13106&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Master&lt;span class="o">[&lt;/span>4&lt;span class="o">]&lt;/span> -&amp;gt; Slots &lt;span class="m">13107&lt;/span> - &lt;span class="m">16383&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">M: 216fa2035f19dbf88e5e6ab709861ba11b1705de 192.168.1.11:6379
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slots:&lt;span class="o">[&lt;/span>0-3276&lt;span class="o">]&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="m">3277&lt;/span> slots&lt;span class="o">)&lt;/span> master
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">M: 00bbea618be49cb6ce38b1371b3cf57fea59f557 192.168.1.12:6379
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slots:&lt;span class="o">[&lt;/span>3277-6553&lt;span class="o">]&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="m">3277&lt;/span> slots&lt;span class="o">)&lt;/span> master
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">M: 980e3f5cbfc7739ded0ed08d60127888d7593e25 192.168.1.13:6379
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slots:&lt;span class="o">[&lt;/span>6554-9829&lt;span class="o">]&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="m">3276&lt;/span> slots&lt;span class="o">)&lt;/span> master
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">M: 6637e3135cfa345bc155d39fa07718882e9b5bf8 192.168.1.14:6379
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slots:&lt;span class="o">[&lt;/span>9830-13106&lt;span class="o">]&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="m">3277&lt;/span> slots&lt;span class="o">)&lt;/span> master
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">M: 059bda64ea1e49e38ef833ed9e997cffd7dff0c5 192.168.1.18:6379
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slots:&lt;span class="o">[&lt;/span>13107-16383&lt;span class="o">]&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="m">3277&lt;/span> slots&lt;span class="o">)&lt;/span> master
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Can I &lt;span class="nb">set&lt;/span> the above configuration? &lt;span class="o">(&lt;/span>&lt;span class="nb">type&lt;/span> &lt;span class="s1">&amp;#39;yes&amp;#39;&lt;/span> to accept&lt;span class="o">)&lt;/span>: yes
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;gt;&amp;gt;&amp;gt; Nodes configuration updated
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;gt;&amp;gt;&amp;gt; Assign a different config epoch to each node
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;gt;&amp;gt;&amp;gt; Sending CLUSTER MEET messages to join the cluster
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Waiting &lt;span class="k">for&lt;/span> the cluster to join
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;gt;&amp;gt;&amp;gt; Performing Cluster Check &lt;span class="o">(&lt;/span>using node 192.168.1.11:6379&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">M: 216fa2035f19dbf88e5e6ab709861ba11b1705de 192.168.1.11:6379
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slots:&lt;span class="o">[&lt;/span>0-3276&lt;span class="o">]&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="m">3277&lt;/span> slots&lt;span class="o">)&lt;/span> master
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">M: 00bbea618be49cb6ce38b1371b3cf57fea59f557 192.168.1.12:6379
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slots:&lt;span class="o">[&lt;/span>3277-6553&lt;span class="o">]&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="m">3277&lt;/span> slots&lt;span class="o">)&lt;/span> master
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">M: 980e3f5cbfc7739ded0ed08d60127888d7593e25 192.168.1.13:6379
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slots:&lt;span class="o">[&lt;/span>6554-9829&lt;span class="o">]&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="m">3276&lt;/span> slots&lt;span class="o">)&lt;/span> master
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">M: 059bda64ea1e49e38ef833ed9e997cffd7dff0c5 192.168.1.18:6379
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slots:&lt;span class="o">[&lt;/span>13107-16383&lt;span class="o">]&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="m">3277&lt;/span> slots&lt;span class="o">)&lt;/span> master
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">M: 6637e3135cfa345bc155d39fa07718882e9b5bf8 192.168.1.14:6379
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slots:&lt;span class="o">[&lt;/span>9830-13106&lt;span class="o">]&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="m">3277&lt;/span> slots&lt;span class="o">)&lt;/span> master
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>OK&lt;span class="o">]&lt;/span> All nodes agree about slots configuration.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;gt;&amp;gt;&amp;gt; Check &lt;span class="k">for&lt;/span> open slots...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;gt;&amp;gt;&amp;gt; Check slots coverage...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>OK&lt;span class="o">]&lt;/span> All &lt;span class="m">16384&lt;/span> slots covered.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@redis01 redis&lt;span class="o">]&lt;/span>&lt;span class="c1"># redis-cli -c&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">127.0.0.1:6379&amp;gt; auth 帳號 密碼
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">OK
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">127.0.0.1:6379&amp;gt; CLUSTER info
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">cluster_state:ok
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">cluster_slots_assigned:16384
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">cluster_slots_ok:16384
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">cluster_slots_pfail:0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">cluster_slots_fail:0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">cluster_known_nodes:5
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">cluster_size:5
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">cluster_current_epoch:5
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">cluster_my_epoch:1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">cluster_stats_messages_ping_sent:85
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">cluster_stats_messages_pong_sent:92
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">cluster_stats_messages_sent:177
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">cluster_stats_messages_ping_received:88
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">cluster_stats_messages_pong_received:85
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">cluster_stats_messages_meet_received:4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">cluster_stats_messages_received:177
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">127.0.0.1:6379&amp;gt; CLUSTER NODES
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">00bbea618be49cb6ce38b1371b3cf57fea59f557 192.168.1.12:6379@16379 master - &lt;span class="m">0&lt;/span> &lt;span class="m">1702735779504&lt;/span> &lt;span class="m">2&lt;/span> connected 3277-6553
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">980e3f5cbfc7739ded0ed08d60127888d7593e25 192.168.1.13:6379@16379 master - &lt;span class="m">0&lt;/span> &lt;span class="m">1702735780000&lt;/span> &lt;span class="m">3&lt;/span> connected 6554-9829
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">059bda64ea1e49e38ef833ed9e997cffd7dff0c5 192.168.1.18:6379@16379 master - &lt;span class="m">0&lt;/span> &lt;span class="m">1702735778502&lt;/span> &lt;span class="m">5&lt;/span> connected 13107-16383
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">216fa2035f19dbf88e5e6ab709861ba11b1705de 192.168.1.11:6379@16379 myself,master - &lt;span class="m">0&lt;/span> &lt;span class="m">1702735779000&lt;/span> &lt;span class="m">1&lt;/span> connected 0-3276
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">6637e3135cfa345bc155d39fa07718882e9b5bf8 192.168.1.14:6379@16379 master - &lt;span class="m">0&lt;/span> &lt;span class="m">1702735780506&lt;/span> &lt;span class="m">4&lt;/span> connected 9830-13106
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="master-cluster集群創建slave加入">master cluster集群創建(slave加入)&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">redis-cli --user 帳號 --pass 密碼 --cluster add-node --cluster-slave --cluster-master-id 216fa2035f19dbf88e5e6ab709861ba11b1705de 192.168.1.12:6380 192.168.1.11:6379
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">redis-cli --user 帳號 --pass 密碼 --cluster add-node --cluster-slave --cluster-master-id 00bbea618be49cb6ce38b1371b3cf57fea59f557 192.168.1.13:6380 192.168.1.12:6379
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">redis-cli --user 帳號 --pass 密碼 --cluster add-node --cluster-slave --cluster-master-id 980e3f5cbfc7739ded0ed08d60127888d7593e25 192.168.1.11:6380 192.168.1.13:6379
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">redis-cli --user 帳號 --pass 密碼 --cluster add-node --cluster-slave --cluster-master-id 6637e3135cfa345bc155d39fa07718882e9b5bf8 192.168.1.18:6380 192.168.1.14:6379
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">redis-cli --user 帳號 --pass 密碼 --cluster add-node --cluster-slave --cluster-master-id 059bda64ea1e49e38ef833ed9e997cffd7dff0c5 192.168.1.14:6380 192.168.1.18:6379
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="檢查集群狀況">檢查集群狀況&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@redis01 redis&lt;span class="o">]&lt;/span>&lt;span class="c1"># redis-cli --user 帳號 --pass 密碼 --cluster check 192.168.1.11:6379&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Warning: Using a password with &lt;span class="s1">&amp;#39;-a&amp;#39;&lt;/span> or &lt;span class="s1">&amp;#39;-u&amp;#39;&lt;/span> option on the &lt;span class="nb">command&lt;/span> line interface may not be safe.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">192.168.1.11:6379 &lt;span class="o">(&lt;/span>216fa203...&lt;span class="o">)&lt;/span> -&amp;gt; &lt;span class="m">0&lt;/span> keys &lt;span class="p">|&lt;/span> &lt;span class="m">3277&lt;/span> slots &lt;span class="p">|&lt;/span> &lt;span class="m">1&lt;/span> slaves.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">192.168.1.18:6379 &lt;span class="o">(&lt;/span>059bda64...&lt;span class="o">)&lt;/span> -&amp;gt; &lt;span class="m">0&lt;/span> keys &lt;span class="p">|&lt;/span> &lt;span class="m">3277&lt;/span> slots &lt;span class="p">|&lt;/span> &lt;span class="m">1&lt;/span> slaves.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">192.168.1.12:6379 &lt;span class="o">(&lt;/span>00bbea61...&lt;span class="o">)&lt;/span> -&amp;gt; &lt;span class="m">0&lt;/span> keys &lt;span class="p">|&lt;/span> &lt;span class="m">3277&lt;/span> slots &lt;span class="p">|&lt;/span> &lt;span class="m">1&lt;/span> slaves.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">192.168.1.13:6379 &lt;span class="o">(&lt;/span>980e3f5c...&lt;span class="o">)&lt;/span> -&amp;gt; &lt;span class="m">0&lt;/span> keys &lt;span class="p">|&lt;/span> &lt;span class="m">3276&lt;/span> slots &lt;span class="p">|&lt;/span> &lt;span class="m">1&lt;/span> slaves.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">192.168.1.14:6379 &lt;span class="o">(&lt;/span>6637e313...&lt;span class="o">)&lt;/span> -&amp;gt; &lt;span class="m">0&lt;/span> keys &lt;span class="p">|&lt;/span> &lt;span class="m">3277&lt;/span> slots &lt;span class="p">|&lt;/span> &lt;span class="m">1&lt;/span> slaves.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>OK&lt;span class="o">]&lt;/span> &lt;span class="m">0&lt;/span> keys in &lt;span class="m">5&lt;/span> masters.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">0.00 keys per slot on average.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;gt;&amp;gt;&amp;gt; Performing Cluster Check &lt;span class="o">(&lt;/span>using node 192.168.1.11:6379&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">M: 216fa2035f19dbf88e5e6ab709861ba11b1705de 192.168.1.11:6379
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slots:&lt;span class="o">[&lt;/span>0-3276&lt;span class="o">]&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="m">3277&lt;/span> slots&lt;span class="o">)&lt;/span> master
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="m">1&lt;/span> additional replica&lt;span class="o">(&lt;/span>s&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">M: 059bda64ea1e49e38ef833ed9e997cffd7dff0c5 192.168.1.18:6379
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slots:&lt;span class="o">[&lt;/span>13107-16383&lt;span class="o">]&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="m">3277&lt;/span> slots&lt;span class="o">)&lt;/span> master
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="m">1&lt;/span> additional replica&lt;span class="o">(&lt;/span>s&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">S: a6b58413201cc43612df257da40992c0ce6a3510 192.168.1.13:6380
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slots: &lt;span class="o">(&lt;/span>&lt;span class="m">0&lt;/span> slots&lt;span class="o">)&lt;/span> slave
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> replicates 00bbea618be49cb6ce38b1371b3cf57fea59f557
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">S: 6076d42c63dfd435f784391f871d101c3d1a7aa5 192.168.1.11:6380
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slots: &lt;span class="o">(&lt;/span>&lt;span class="m">0&lt;/span> slots&lt;span class="o">)&lt;/span> slave
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> replicates 980e3f5cbfc7739ded0ed08d60127888d7593e25
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">M: 00bbea618be49cb6ce38b1371b3cf57fea59f557 192.168.1.12:6379
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slots:&lt;span class="o">[&lt;/span>3277-6553&lt;span class="o">]&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="m">3277&lt;/span> slots&lt;span class="o">)&lt;/span> master
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="m">1&lt;/span> additional replica&lt;span class="o">(&lt;/span>s&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">M: 980e3f5cbfc7739ded0ed08d60127888d7593e25 192.168.1.13:6379
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slots:&lt;span class="o">[&lt;/span>6554-9829&lt;span class="o">]&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="m">3276&lt;/span> slots&lt;span class="o">)&lt;/span> master
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="m">1&lt;/span> additional replica&lt;span class="o">(&lt;/span>s&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">S: 915d7535fc4ebe9853ad2ee5fb9033b549b5a5cb 192.168.1.18:6380
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slots: &lt;span class="o">(&lt;/span>&lt;span class="m">0&lt;/span> slots&lt;span class="o">)&lt;/span> slave
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> replicates 6637e3135cfa345bc155d39fa07718882e9b5bf8
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">S: aed68c3aa851fdcab4d691b02a2a941b39d43ab5 192.168.1.14:6380
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slots: &lt;span class="o">(&lt;/span>&lt;span class="m">0&lt;/span> slots&lt;span class="o">)&lt;/span> slave
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> replicates 059bda64ea1e49e38ef833ed9e997cffd7dff0c5
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">M: 6637e3135cfa345bc155d39fa07718882e9b5bf8 192.168.1.14:6379
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slots:&lt;span class="o">[&lt;/span>9830-13106&lt;span class="o">]&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="m">3277&lt;/span> slots&lt;span class="o">)&lt;/span> master
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="m">1&lt;/span> additional replica&lt;span class="o">(&lt;/span>s&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">S: 61d58f3e445d8d5398221d22bc358c65a189faf4 192.168.1.12:6380
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slots: &lt;span class="o">(&lt;/span>&lt;span class="m">0&lt;/span> slots&lt;span class="o">)&lt;/span> slave
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> replicates 216fa2035f19dbf88e5e6ab709861ba11b1705de
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>OK&lt;span class="o">]&lt;/span> All nodes agree about slots configuration.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;gt;&amp;gt;&amp;gt; Check &lt;span class="k">for&lt;/span> open slots...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;gt;&amp;gt;&amp;gt; Check slots coverage...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>OK&lt;span class="o">]&lt;/span> All &lt;span class="m">16384&lt;/span> slots covered.
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="load來源dumprdb檔重啟redis服務">Load來源dump.rdb檔，重啟Redis服務&lt;/h2>
&lt;h3 id="第一台redis011921681116379">第一台redis01(192.168.1.11:6379)&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@redis01 redis&lt;span class="o">]&lt;/span>&lt;span class="c1"># systemctl restart redis&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@redis01 redis&lt;span class="o">]&lt;/span>&lt;span class="c1"># systemctl status redis&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>執行&amp;ndash;cluster fix，&lt;/p>
&lt;p>執行&amp;ndash;cluster check，最後面要沒報錯才OK&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@redis01 redis&lt;span class="o">]&lt;/span>&lt;span class="c1"># redis-cli --user 帳號 --pass 密碼 --cluster fix 192.168.1.11:6379&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@redis01 redis&lt;span class="o">]&lt;/span>&lt;span class="c1"># redis-cli --user 帳號 --pass 密碼 --cluster check 192.168.1.11:6379&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Warning: Using a password with &lt;span class="s1">&amp;#39;-a&amp;#39;&lt;/span> or &lt;span class="s1">&amp;#39;-u&amp;#39;&lt;/span> option on the &lt;span class="nb">command&lt;/span> line interface may not be safe.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">192.168.1.11:6379 &lt;span class="o">(&lt;/span>216fa203...&lt;span class="o">)&lt;/span> -&amp;gt; &lt;span class="m">435929&lt;/span> keys &lt;span class="p">|&lt;/span> &lt;span class="m">4096&lt;/span> slots &lt;span class="p">|&lt;/span> &lt;span class="m">1&lt;/span> slaves.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">192.168.1.12:6379 &lt;span class="o">(&lt;/span>00bbea61...&lt;span class="o">)&lt;/span> -&amp;gt; &lt;span class="m">0&lt;/span> keys &lt;span class="p">|&lt;/span> &lt;span class="m">2458&lt;/span> slots &lt;span class="p">|&lt;/span> &lt;span class="m">1&lt;/span> slaves.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">192.168.1.14:6379 &lt;span class="o">(&lt;/span>6637e313...&lt;span class="o">)&lt;/span> -&amp;gt; &lt;span class="m">0&lt;/span> keys &lt;span class="p">|&lt;/span> &lt;span class="m">3277&lt;/span> slots &lt;span class="p">|&lt;/span> &lt;span class="m">1&lt;/span> slaves.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">192.168.1.13:6379 &lt;span class="o">(&lt;/span>980e3f5c...&lt;span class="o">)&lt;/span> -&amp;gt; &lt;span class="m">0&lt;/span> keys &lt;span class="p">|&lt;/span> &lt;span class="m">3276&lt;/span> slots &lt;span class="p">|&lt;/span> &lt;span class="m">1&lt;/span> slaves.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">192.168.1.18:6379 &lt;span class="o">(&lt;/span>059bda64...&lt;span class="o">)&lt;/span> -&amp;gt; &lt;span class="m">0&lt;/span> keys &lt;span class="p">|&lt;/span> &lt;span class="m">3277&lt;/span> slots &lt;span class="p">|&lt;/span> &lt;span class="m">1&lt;/span> slaves.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>OK&lt;span class="o">]&lt;/span> &lt;span class="m">435929&lt;/span> keys in &lt;span class="m">5&lt;/span> masters.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">26.61 keys per slot on average.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;gt;&amp;gt;&amp;gt; Performing Cluster Check &lt;span class="o">(&lt;/span>using node 192.168.1.11:6379&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">M: 216fa2035f19dbf88e5e6ab709861ba11b1705de 192.168.1.11:6379
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slots:&lt;span class="o">[&lt;/span>0-4095&lt;span class="o">]&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="m">4096&lt;/span> slots&lt;span class="o">)&lt;/span> master
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="m">1&lt;/span> additional replica&lt;span class="o">(&lt;/span>s&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">S: 61d58f3e445d8d5398221d22bc358c65a189faf4 192.168.1.12:6380
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slots: &lt;span class="o">(&lt;/span>&lt;span class="m">0&lt;/span> slots&lt;span class="o">)&lt;/span> slave
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> replicates 216fa2035f19dbf88e5e6ab709861ba11b1705de
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">S: 6076d42c63dfd435f784391f871d101c3d1a7aa5 192.168.1.11:6380
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slots: &lt;span class="o">(&lt;/span>&lt;span class="m">0&lt;/span> slots&lt;span class="o">)&lt;/span> slave
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> replicates 980e3f5cbfc7739ded0ed08d60127888d7593e25
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">S: 915d7535fc4ebe9853ad2ee5fb9033b549b5a5cb 192.168.1.18:6380
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slots: &lt;span class="o">(&lt;/span>&lt;span class="m">0&lt;/span> slots&lt;span class="o">)&lt;/span> slave
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> replicates 6637e3135cfa345bc155d39fa07718882e9b5bf8
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">M: 00bbea618be49cb6ce38b1371b3cf57fea59f557 192.168.1.12:6379
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slots:&lt;span class="o">[&lt;/span>4096-6553&lt;span class="o">]&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="m">2458&lt;/span> slots&lt;span class="o">)&lt;/span> master
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="m">1&lt;/span> additional replica&lt;span class="o">(&lt;/span>s&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">S: a6b58413201cc43612df257da40992c0ce6a3510 192.168.1.13:6380
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slots: &lt;span class="o">(&lt;/span>&lt;span class="m">0&lt;/span> slots&lt;span class="o">)&lt;/span> slave
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> replicates 00bbea618be49cb6ce38b1371b3cf57fea59f557
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">M: 6637e3135cfa345bc155d39fa07718882e9b5bf8 192.168.1.14:6379
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slots:&lt;span class="o">[&lt;/span>9830-13106&lt;span class="o">]&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="m">3277&lt;/span> slots&lt;span class="o">)&lt;/span> master
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="m">1&lt;/span> additional replica&lt;span class="o">(&lt;/span>s&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">M: 980e3f5cbfc7739ded0ed08d60127888d7593e25 192.168.1.13:6379
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slots:&lt;span class="o">[&lt;/span>6554-9829&lt;span class="o">]&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="m">3276&lt;/span> slots&lt;span class="o">)&lt;/span> master
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="m">1&lt;/span> additional replica&lt;span class="o">(&lt;/span>s&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">M: 059bda64ea1e49e38ef833ed9e997cffd7dff0c5 192.168.1.18:6379
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slots:&lt;span class="o">[&lt;/span>13107-16383&lt;span class="o">]&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="m">3277&lt;/span> slots&lt;span class="o">)&lt;/span> master
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="m">1&lt;/span> additional replica&lt;span class="o">(&lt;/span>s&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">S: aed68c3aa851fdcab4d691b02a2a941b39d43ab5 192.168.1.14:6380
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slots: &lt;span class="o">(&lt;/span>&lt;span class="m">0&lt;/span> slots&lt;span class="o">)&lt;/span> slave
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> replicates 059bda64ea1e49e38ef833ed9e997cffd7dff0c5
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>OK&lt;span class="o">]&lt;/span> All nodes agree about slots configuration.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;gt;&amp;gt;&amp;gt; Check &lt;span class="k">for&lt;/span> open slots...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;gt;&amp;gt;&amp;gt; Check slots coverage...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>OK&lt;span class="o">]&lt;/span> All &lt;span class="m">16384&lt;/span> slots covered.
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="第二台redis021921681126379">第二台redis02(192.168.1.12:6379)&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@redis02 redis&lt;span class="o">]&lt;/span>&lt;span class="c1"># systemctl restart redis&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@redis02 redis&lt;span class="o">]&lt;/span>&lt;span class="c1"># systemctl status redis&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>執行&amp;ndash;cluster fix，&lt;/p>
&lt;p>執行&amp;ndash;cluster check，最後面要沒報錯才OK&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@redis01 redis&lt;span class="o">]&lt;/span>&lt;span class="c1"># redis-cli --user 帳號 --pass 密碼 --cluster fix 192.168.1.12:6379&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@redis01 redis&lt;span class="o">]&lt;/span>&lt;span class="c1"># redis-cli --user 帳號 --pass 密碼 --cluster check 192.168.1.12:6379&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Warning: Using a password with &lt;span class="s1">&amp;#39;-a&amp;#39;&lt;/span> or &lt;span class="s1">&amp;#39;-u&amp;#39;&lt;/span> option on the &lt;span class="nb">command&lt;/span> line interface may not be safe.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">192.168.1.12:6379 &lt;span class="o">(&lt;/span>00bbea61...&lt;span class="o">)&lt;/span> -&amp;gt; &lt;span class="m">436657&lt;/span> keys &lt;span class="p">|&lt;/span> &lt;span class="m">4096&lt;/span> slots &lt;span class="p">|&lt;/span> &lt;span class="m">1&lt;/span> slaves.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">192.168.1.14:6379 &lt;span class="o">(&lt;/span>6637e313...&lt;span class="o">)&lt;/span> -&amp;gt; &lt;span class="m">0&lt;/span> keys &lt;span class="p">|&lt;/span> &lt;span class="m">3277&lt;/span> slots &lt;span class="p">|&lt;/span> &lt;span class="m">1&lt;/span> slaves.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">192.168.1.18:6379 &lt;span class="o">(&lt;/span>059bda64...&lt;span class="o">)&lt;/span> -&amp;gt; &lt;span class="m">0&lt;/span> keys &lt;span class="p">|&lt;/span> &lt;span class="m">3277&lt;/span> slots &lt;span class="p">|&lt;/span> &lt;span class="m">1&lt;/span> slaves.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">192.168.1.11:6379 &lt;span class="o">(&lt;/span>216fa203...&lt;span class="o">)&lt;/span> -&amp;gt; &lt;span class="m">435928&lt;/span> keys &lt;span class="p">|&lt;/span> &lt;span class="m">4096&lt;/span> slots &lt;span class="p">|&lt;/span> &lt;span class="m">1&lt;/span> slaves.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">192.168.1.13:6379 &lt;span class="o">(&lt;/span>980e3f5c...&lt;span class="o">)&lt;/span> -&amp;gt; &lt;span class="m">0&lt;/span> keys &lt;span class="p">|&lt;/span> &lt;span class="m">1638&lt;/span> slots &lt;span class="p">|&lt;/span> &lt;span class="m">1&lt;/span> slaves.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>OK&lt;span class="o">]&lt;/span> &lt;span class="m">872585&lt;/span> keys in &lt;span class="m">5&lt;/span> masters.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">53.26 keys per slot on average.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;gt;&amp;gt;&amp;gt; Performing Cluster Check &lt;span class="o">(&lt;/span>using node 192.168.1.12:6379&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">M: 00bbea618be49cb6ce38b1371b3cf57fea59f557 192.168.1.12:6379
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slots:&lt;span class="o">[&lt;/span>4096-8191&lt;span class="o">]&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="m">4096&lt;/span> slots&lt;span class="o">)&lt;/span> master
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="m">1&lt;/span> additional replica&lt;span class="o">(&lt;/span>s&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">M: 6637e3135cfa345bc155d39fa07718882e9b5bf8 192.168.1.14:6379
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slots:&lt;span class="o">[&lt;/span>9830-13106&lt;span class="o">]&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="m">3277&lt;/span> slots&lt;span class="o">)&lt;/span> master
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="m">1&lt;/span> additional replica&lt;span class="o">(&lt;/span>s&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">M: 059bda64ea1e49e38ef833ed9e997cffd7dff0c5 192.168.1.18:6379
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slots:&lt;span class="o">[&lt;/span>13107-16383&lt;span class="o">]&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="m">3277&lt;/span> slots&lt;span class="o">)&lt;/span> master
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="m">1&lt;/span> additional replica&lt;span class="o">(&lt;/span>s&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">S: 61d58f3e445d8d5398221d22bc358c65a189faf4 192.168.1.12:6380
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slots: &lt;span class="o">(&lt;/span>&lt;span class="m">0&lt;/span> slots&lt;span class="o">)&lt;/span> slave
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> replicates 216fa2035f19dbf88e5e6ab709861ba11b1705de
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">M: 216fa2035f19dbf88e5e6ab709861ba11b1705de 192.168.1.11:6379
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slots:&lt;span class="o">[&lt;/span>0-4095&lt;span class="o">]&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="m">4096&lt;/span> slots&lt;span class="o">)&lt;/span> master
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="m">1&lt;/span> additional replica&lt;span class="o">(&lt;/span>s&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">M: 980e3f5cbfc7739ded0ed08d60127888d7593e25 192.168.1.13:6379
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slots:&lt;span class="o">[&lt;/span>8192-9829&lt;span class="o">]&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="m">1638&lt;/span> slots&lt;span class="o">)&lt;/span> master
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="m">1&lt;/span> additional replica&lt;span class="o">(&lt;/span>s&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">S: 6076d42c63dfd435f784391f871d101c3d1a7aa5 192.168.1.11:6380
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slots: &lt;span class="o">(&lt;/span>&lt;span class="m">0&lt;/span> slots&lt;span class="o">)&lt;/span> slave
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> replicates 980e3f5cbfc7739ded0ed08d60127888d7593e25
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">S: 915d7535fc4ebe9853ad2ee5fb9033b549b5a5cb 192.168.1.18:6380
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slots: &lt;span class="o">(&lt;/span>&lt;span class="m">0&lt;/span> slots&lt;span class="o">)&lt;/span> slave
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> replicates 6637e3135cfa345bc155d39fa07718882e9b5bf8
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">S: a6b58413201cc43612df257da40992c0ce6a3510 192.168.1.13:6380
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slots: &lt;span class="o">(&lt;/span>&lt;span class="m">0&lt;/span> slots&lt;span class="o">)&lt;/span> slave
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> replicates 00bbea618be49cb6ce38b1371b3cf57fea59f557
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">S: aed68c3aa851fdcab4d691b02a2a941b39d43ab5 192.168.1.14:6380
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slots: &lt;span class="o">(&lt;/span>&lt;span class="m">0&lt;/span> slots&lt;span class="o">)&lt;/span> slave
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> replicates 059bda64ea1e49e38ef833ed9e997cffd7dff0c5
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>OK&lt;span class="o">]&lt;/span> All nodes agree about slots configuration.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;gt;&amp;gt;&amp;gt; Check &lt;span class="k">for&lt;/span> open slots...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;gt;&amp;gt;&amp;gt; Check slots coverage...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>OK&lt;span class="o">]&lt;/span> All &lt;span class="m">16384&lt;/span> slots covered.
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="第三台redis031921681136379">第三台redis03(192.168.1.13:6379)&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@redis03 redis&lt;span class="o">]&lt;/span>&lt;span class="c1"># systemctl restart redis&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@redis03 redis&lt;span class="o">]&lt;/span>&lt;span class="c1"># systemctl status redis&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>執行&amp;ndash;cluster fix，&lt;/p>
&lt;p>執行&amp;ndash;cluster check，最後面要沒報錯才OK&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@redis01 redis&lt;span class="o">]&lt;/span>&lt;span class="c1"># redis-cli --user 帳號 --pass 密碼 --cluster fix 192.168.1.13:6379&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@redis01 redis&lt;span class="o">]&lt;/span>&lt;span class="c1"># redis-cli --user 帳號 --pass 密碼 --cluster check 192.168.1.13:6379&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Warning: Using a password with &lt;span class="s1">&amp;#39;-a&amp;#39;&lt;/span> or &lt;span class="s1">&amp;#39;-u&amp;#39;&lt;/span> option on the &lt;span class="nb">command&lt;/span> line interface may not be safe.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">192.168.1.13:6379 &lt;span class="o">(&lt;/span>980e3f5c...&lt;span class="o">)&lt;/span> -&amp;gt; &lt;span class="m">436921&lt;/span> keys &lt;span class="p">|&lt;/span> &lt;span class="m">4096&lt;/span> slots &lt;span class="p">|&lt;/span> &lt;span class="m">1&lt;/span> slaves.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">192.168.1.12:6379 &lt;span class="o">(&lt;/span>00bbea61...&lt;span class="o">)&lt;/span> -&amp;gt; &lt;span class="m">436657&lt;/span> keys &lt;span class="p">|&lt;/span> &lt;span class="m">4096&lt;/span> slots &lt;span class="p">|&lt;/span> &lt;span class="m">1&lt;/span> slaves.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">192.168.1.11:6379 &lt;span class="o">(&lt;/span>216fa203...&lt;span class="o">)&lt;/span> -&amp;gt; &lt;span class="m">435927&lt;/span> keys &lt;span class="p">|&lt;/span> &lt;span class="m">4096&lt;/span> slots &lt;span class="p">|&lt;/span> &lt;span class="m">1&lt;/span> slaves.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">192.168.1.14:6379 &lt;span class="o">(&lt;/span>6637e313...&lt;span class="o">)&lt;/span> -&amp;gt; &lt;span class="m">0&lt;/span> keys &lt;span class="p">|&lt;/span> &lt;span class="m">819&lt;/span> slots &lt;span class="p">|&lt;/span> &lt;span class="m">1&lt;/span> slaves.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">192.168.1.18:6379 &lt;span class="o">(&lt;/span>059bda64...&lt;span class="o">)&lt;/span> -&amp;gt; &lt;span class="m">0&lt;/span> keys &lt;span class="p">|&lt;/span> &lt;span class="m">3277&lt;/span> slots &lt;span class="p">|&lt;/span> &lt;span class="m">1&lt;/span> slaves.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>OK&lt;span class="o">]&lt;/span> &lt;span class="m">1309505&lt;/span> keys in &lt;span class="m">5&lt;/span> masters.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">79.93 keys per slot on average.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;gt;&amp;gt;&amp;gt; Performing Cluster Check &lt;span class="o">(&lt;/span>using node 192.168.1.13:6379&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">M: 980e3f5cbfc7739ded0ed08d60127888d7593e25 192.168.1.13:6379
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slots:&lt;span class="o">[&lt;/span>8192-12287&lt;span class="o">]&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="m">4096&lt;/span> slots&lt;span class="o">)&lt;/span> master
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="m">1&lt;/span> additional replica&lt;span class="o">(&lt;/span>s&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">S: 915d7535fc4ebe9853ad2ee5fb9033b549b5a5cb 192.168.1.18:6380
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slots: &lt;span class="o">(&lt;/span>&lt;span class="m">0&lt;/span> slots&lt;span class="o">)&lt;/span> slave
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> replicates 6637e3135cfa345bc155d39fa07718882e9b5bf8
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">S: 6076d42c63dfd435f784391f871d101c3d1a7aa5 192.168.1.11:6380
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slots: &lt;span class="o">(&lt;/span>&lt;span class="m">0&lt;/span> slots&lt;span class="o">)&lt;/span> slave
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> replicates 980e3f5cbfc7739ded0ed08d60127888d7593e25
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">S: aed68c3aa851fdcab4d691b02a2a941b39d43ab5 192.168.1.14:6380
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slots: &lt;span class="o">(&lt;/span>&lt;span class="m">0&lt;/span> slots&lt;span class="o">)&lt;/span> slave
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> replicates 059bda64ea1e49e38ef833ed9e997cffd7dff0c5
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">S: 61d58f3e445d8d5398221d22bc358c65a189faf4 192.168.1.12:6380
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slots: &lt;span class="o">(&lt;/span>&lt;span class="m">0&lt;/span> slots&lt;span class="o">)&lt;/span> slave
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> replicates 216fa2035f19dbf88e5e6ab709861ba11b1705de
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">S: a6b58413201cc43612df257da40992c0ce6a3510 192.168.1.13:6380
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slots: &lt;span class="o">(&lt;/span>&lt;span class="m">0&lt;/span> slots&lt;span class="o">)&lt;/span> slave
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> replicates 00bbea618be49cb6ce38b1371b3cf57fea59f557
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">M: 00bbea618be49cb6ce38b1371b3cf57fea59f557 192.168.1.12:6379
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slots:&lt;span class="o">[&lt;/span>4096-8191&lt;span class="o">]&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="m">4096&lt;/span> slots&lt;span class="o">)&lt;/span> master
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="m">1&lt;/span> additional replica&lt;span class="o">(&lt;/span>s&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">M: 216fa2035f19dbf88e5e6ab709861ba11b1705de 192.168.1.11:6379
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slots:&lt;span class="o">[&lt;/span>0-4095&lt;span class="o">]&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="m">4096&lt;/span> slots&lt;span class="o">)&lt;/span> master
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="m">1&lt;/span> additional replica&lt;span class="o">(&lt;/span>s&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">M: 6637e3135cfa345bc155d39fa07718882e9b5bf8 192.168.1.14:6379
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slots:&lt;span class="o">[&lt;/span>12288-13106&lt;span class="o">]&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="m">819&lt;/span> slots&lt;span class="o">)&lt;/span> master
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="m">1&lt;/span> additional replica&lt;span class="o">(&lt;/span>s&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">M: 059bda64ea1e49e38ef833ed9e997cffd7dff0c5 192.168.1.18:6379
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slots:&lt;span class="o">[&lt;/span>13107-16383&lt;span class="o">]&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="m">3277&lt;/span> slots&lt;span class="o">)&lt;/span> master
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="m">1&lt;/span> additional replica&lt;span class="o">(&lt;/span>s&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>OK&lt;span class="o">]&lt;/span> All nodes agree about slots configuration.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;gt;&amp;gt;&amp;gt; Check &lt;span class="k">for&lt;/span> open slots...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;gt;&amp;gt;&amp;gt; Check slots coverage...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>OK&lt;span class="o">]&lt;/span> All &lt;span class="m">16384&lt;/span> slots covered.
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="第四台redis041921681146379">第四台redis04(192.168.1.14:6379)&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@redis04 redis&lt;span class="o">]&lt;/span>&lt;span class="c1"># systemctl restart redis&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@redis04 redis&lt;span class="o">]&lt;/span>&lt;span class="c1"># systemctl status redis&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>執行&amp;ndash;cluster fix，&lt;/p>
&lt;p>執行&amp;ndash;cluster check，最後面要沒報錯才OK&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@redis01 redis&lt;span class="o">]&lt;/span>&lt;span class="c1"># redis-cli --user 帳號 --pass 密碼 --cluster fix 192.168.1.14:6379&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@redis01 redis&lt;span class="o">]&lt;/span>&lt;span class="c1"># redis-cli --user 帳號 --pass 密碼 --cluster check 192.168.1.14:6379&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Warning: Using a password with &lt;span class="s1">&amp;#39;-a&amp;#39;&lt;/span> or &lt;span class="s1">&amp;#39;-u&amp;#39;&lt;/span> option on the &lt;span class="nb">command&lt;/span> line interface may not be safe.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">192.168.1.14:6379 &lt;span class="o">(&lt;/span>6637e313...&lt;span class="o">)&lt;/span> -&amp;gt; &lt;span class="m">438263&lt;/span> keys &lt;span class="p">|&lt;/span> &lt;span class="m">3280&lt;/span> slots &lt;span class="p">|&lt;/span> &lt;span class="m">1&lt;/span> slaves.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">192.168.1.11:6379 &lt;span class="o">(&lt;/span>216fa203...&lt;span class="o">)&lt;/span> -&amp;gt; &lt;span class="m">435926&lt;/span> keys &lt;span class="p">|&lt;/span> &lt;span class="m">3276&lt;/span> slots &lt;span class="p">|&lt;/span> &lt;span class="m">1&lt;/span> slaves.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">192.168.1.13:6379 &lt;span class="o">(&lt;/span>980e3f5c...&lt;span class="o">)&lt;/span> -&amp;gt; &lt;span class="m">436921&lt;/span> keys &lt;span class="p">|&lt;/span> &lt;span class="m">3276&lt;/span> slots &lt;span class="p">|&lt;/span> &lt;span class="m">1&lt;/span> slaves.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">192.168.1.12:6379 &lt;span class="o">(&lt;/span>00bbea61...&lt;span class="o">)&lt;/span> -&amp;gt; &lt;span class="m">436656&lt;/span> keys &lt;span class="p">|&lt;/span> &lt;span class="m">3276&lt;/span> slots &lt;span class="p">|&lt;/span> &lt;span class="m">1&lt;/span> slaves.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">192.168.1.18:6379 &lt;span class="o">(&lt;/span>059bda64...&lt;span class="o">)&lt;/span> -&amp;gt; &lt;span class="m">0&lt;/span> keys &lt;span class="p">|&lt;/span> &lt;span class="m">3276&lt;/span> slots &lt;span class="p">|&lt;/span> &lt;span class="m">1&lt;/span> slaves.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>OK&lt;span class="o">]&lt;/span> &lt;span class="m">1747766&lt;/span> keys in &lt;span class="m">5&lt;/span> masters.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">106.68 keys per slot on average.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;gt;&amp;gt;&amp;gt; Performing Cluster Check &lt;span class="o">(&lt;/span>using node 192.168.1.14:6379&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">M: 6637e3135cfa345bc155d39fa07718882e9b5bf8 192.168.1.14:6379
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slots:&lt;span class="o">[&lt;/span>0-819&lt;span class="o">]&lt;/span>,&lt;span class="o">[&lt;/span>4096-4915&lt;span class="o">]&lt;/span>,&lt;span class="o">[&lt;/span>8192-9011&lt;span class="o">]&lt;/span>,&lt;span class="o">[&lt;/span>12288-13107&lt;span class="o">]&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="m">3280&lt;/span> slots&lt;span class="o">)&lt;/span> master
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="m">1&lt;/span> additional replica&lt;span class="o">(&lt;/span>s&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">M: 216fa2035f19dbf88e5e6ab709861ba11b1705de 192.168.1.11:6379
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slots:&lt;span class="o">[&lt;/span>820-4095&lt;span class="o">]&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="m">3276&lt;/span> slots&lt;span class="o">)&lt;/span> master
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="m">1&lt;/span> additional replica&lt;span class="o">(&lt;/span>s&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">S: aed68c3aa851fdcab4d691b02a2a941b39d43ab5 192.168.1.14:6380
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slots: &lt;span class="o">(&lt;/span>&lt;span class="m">0&lt;/span> slots&lt;span class="o">)&lt;/span> slave
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> replicates 059bda64ea1e49e38ef833ed9e997cffd7dff0c5
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">S: a6b58413201cc43612df257da40992c0ce6a3510 192.168.1.13:6380
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slots: &lt;span class="o">(&lt;/span>&lt;span class="m">0&lt;/span> slots&lt;span class="o">)&lt;/span> slave
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> replicates 00bbea618be49cb6ce38b1371b3cf57fea59f557
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">S: 61d58f3e445d8d5398221d22bc358c65a189faf4 192.168.1.12:6380
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slots: &lt;span class="o">(&lt;/span>&lt;span class="m">0&lt;/span> slots&lt;span class="o">)&lt;/span> slave
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> replicates 216fa2035f19dbf88e5e6ab709861ba11b1705de
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">S: 915d7535fc4ebe9853ad2ee5fb9033b549b5a5cb 192.168.1.18:6380
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slots: &lt;span class="o">(&lt;/span>&lt;span class="m">0&lt;/span> slots&lt;span class="o">)&lt;/span> slave
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> replicates 6637e3135cfa345bc155d39fa07718882e9b5bf8
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">M: 980e3f5cbfc7739ded0ed08d60127888d7593e25 192.168.1.13:6379
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slots:&lt;span class="o">[&lt;/span>9012-12287&lt;span class="o">]&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="m">3276&lt;/span> slots&lt;span class="o">)&lt;/span> master
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="m">1&lt;/span> additional replica&lt;span class="o">(&lt;/span>s&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">S: 6076d42c63dfd435f784391f871d101c3d1a7aa5 192.168.1.11:6380
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slots: &lt;span class="o">(&lt;/span>&lt;span class="m">0&lt;/span> slots&lt;span class="o">)&lt;/span> slave
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> replicates 980e3f5cbfc7739ded0ed08d60127888d7593e25
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">M: 00bbea618be49cb6ce38b1371b3cf57fea59f557 192.168.1.12:6379
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slots:&lt;span class="o">[&lt;/span>4916-8191&lt;span class="o">]&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="m">3276&lt;/span> slots&lt;span class="o">)&lt;/span> master
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="m">1&lt;/span> additional replica&lt;span class="o">(&lt;/span>s&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">M: 059bda64ea1e49e38ef833ed9e997cffd7dff0c5 192.168.1.18:6379
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slots:&lt;span class="o">[&lt;/span>13108-16383&lt;span class="o">]&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="m">3276&lt;/span> slots&lt;span class="o">)&lt;/span> master
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="m">1&lt;/span> additional replica&lt;span class="o">(&lt;/span>s&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>OK&lt;span class="o">]&lt;/span> All nodes agree about slots configuration.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;gt;&amp;gt;&amp;gt; Check &lt;span class="k">for&lt;/span> open slots...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;gt;&amp;gt;&amp;gt; Check slots coverage...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>OK&lt;span class="o">]&lt;/span> All &lt;span class="m">16384&lt;/span> slots covered.
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="第五台redis051921681186379">第五台redis05(192.168.1.18:6379)&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@redis05 redis&lt;span class="o">]&lt;/span>&lt;span class="c1"># systemctl restart redis&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@redis05 redis&lt;span class="o">]&lt;/span>&lt;span class="c1"># systemctl status redis&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>執行&amp;ndash;cluster fix，&lt;/p>
&lt;p>執行&amp;ndash;cluster check，最後面要沒報錯才OK&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@redis01 redis&lt;span class="o">]&lt;/span>&lt;span class="c1"># redis-cli --user 帳號 --pass 密碼 --cluster fix 192.168.1.18:6379&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@redis01 redis&lt;span class="o">]&lt;/span>&lt;span class="c1"># redis-cli --user 帳號 --pass 密碼 --cluster check 192.168.1.18:6379&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Warning: Using a password with &lt;span class="s1">&amp;#39;-a&amp;#39;&lt;/span> or &lt;span class="s1">&amp;#39;-u&amp;#39;&lt;/span> option on the &lt;span class="nb">command&lt;/span> line interface may not be safe.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">192.168.1.18:6379 &lt;span class="o">(&lt;/span>059bda64...&lt;span class="o">)&lt;/span> -&amp;gt; &lt;span class="m">435798&lt;/span> keys &lt;span class="p">|&lt;/span> &lt;span class="m">3276&lt;/span> slots &lt;span class="p">|&lt;/span> &lt;span class="m">1&lt;/span> slaves.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">192.168.1.14:6379 &lt;span class="o">(&lt;/span>6637e313...&lt;span class="o">)&lt;/span> -&amp;gt; &lt;span class="m">438263&lt;/span> keys &lt;span class="p">|&lt;/span> &lt;span class="m">3280&lt;/span> slots &lt;span class="p">|&lt;/span> &lt;span class="m">1&lt;/span> slaves.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">192.168.1.12:6379 &lt;span class="o">(&lt;/span>00bbea61...&lt;span class="o">)&lt;/span> -&amp;gt; &lt;span class="m">436655&lt;/span> keys &lt;span class="p">|&lt;/span> &lt;span class="m">3276&lt;/span> slots &lt;span class="p">|&lt;/span> &lt;span class="m">1&lt;/span> slaves.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">192.168.1.13:6379 &lt;span class="o">(&lt;/span>980e3f5c...&lt;span class="o">)&lt;/span> -&amp;gt; &lt;span class="m">436921&lt;/span> keys &lt;span class="p">|&lt;/span> &lt;span class="m">3276&lt;/span> slots &lt;span class="p">|&lt;/span> &lt;span class="m">1&lt;/span> slaves.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">192.168.1.11:6379 &lt;span class="o">(&lt;/span>216fa203...&lt;span class="o">)&lt;/span> -&amp;gt; &lt;span class="m">435926&lt;/span> keys &lt;span class="p">|&lt;/span> &lt;span class="m">3276&lt;/span> slots &lt;span class="p">|&lt;/span> &lt;span class="m">1&lt;/span> slaves.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>OK&lt;span class="o">]&lt;/span> &lt;span class="m">2183563&lt;/span> keys in &lt;span class="m">5&lt;/span> masters.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">133.27 keys per slot on average.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;gt;&amp;gt;&amp;gt; Performing Cluster Check &lt;span class="o">(&lt;/span>using node 192.168.1.18:6379&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">M: 059bda64ea1e49e38ef833ed9e997cffd7dff0c5 192.168.1.18:6379
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slots:&lt;span class="o">[&lt;/span>13108-16383&lt;span class="o">]&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="m">3276&lt;/span> slots&lt;span class="o">)&lt;/span> master
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="m">1&lt;/span> additional replica&lt;span class="o">(&lt;/span>s&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">S: 6076d42c63dfd435f784391f871d101c3d1a7aa5 192.168.1.11:6380
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slots: &lt;span class="o">(&lt;/span>&lt;span class="m">0&lt;/span> slots&lt;span class="o">)&lt;/span> slave
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> replicates 980e3f5cbfc7739ded0ed08d60127888d7593e25
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">M: 6637e3135cfa345bc155d39fa07718882e9b5bf8 192.168.1.14:6379
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slots:&lt;span class="o">[&lt;/span>0-819&lt;span class="o">]&lt;/span>,&lt;span class="o">[&lt;/span>4096-4915&lt;span class="o">]&lt;/span>,&lt;span class="o">[&lt;/span>8192-9011&lt;span class="o">]&lt;/span>,&lt;span class="o">[&lt;/span>12288-13107&lt;span class="o">]&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="m">3280&lt;/span> slots&lt;span class="o">)&lt;/span> master
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="m">1&lt;/span> additional replica&lt;span class="o">(&lt;/span>s&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">S: 915d7535fc4ebe9853ad2ee5fb9033b549b5a5cb 192.168.1.18:6380
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slots: &lt;span class="o">(&lt;/span>&lt;span class="m">0&lt;/span> slots&lt;span class="o">)&lt;/span> slave
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> replicates 6637e3135cfa345bc155d39fa07718882e9b5bf8
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">S: 61d58f3e445d8d5398221d22bc358c65a189faf4 192.168.1.12:6380
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slots: &lt;span class="o">(&lt;/span>&lt;span class="m">0&lt;/span> slots&lt;span class="o">)&lt;/span> slave
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> replicates 216fa2035f19dbf88e5e6ab709861ba11b1705de
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">M: 00bbea618be49cb6ce38b1371b3cf57fea59f557 192.168.1.12:6379
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slots:&lt;span class="o">[&lt;/span>4916-8191&lt;span class="o">]&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="m">3276&lt;/span> slots&lt;span class="o">)&lt;/span> master
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="m">1&lt;/span> additional replica&lt;span class="o">(&lt;/span>s&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">M: 980e3f5cbfc7739ded0ed08d60127888d7593e25 192.168.1.13:6379
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slots:&lt;span class="o">[&lt;/span>9012-12287&lt;span class="o">]&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="m">3276&lt;/span> slots&lt;span class="o">)&lt;/span> master
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="m">1&lt;/span> additional replica&lt;span class="o">(&lt;/span>s&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">S: a6b58413201cc43612df257da40992c0ce6a3510 192.168.1.13:6380
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slots: &lt;span class="o">(&lt;/span>&lt;span class="m">0&lt;/span> slots&lt;span class="o">)&lt;/span> slave
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> replicates 00bbea618be49cb6ce38b1371b3cf57fea59f557
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">S: aed68c3aa851fdcab4d691b02a2a941b39d43ab5 192.168.1.14:6380
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slots: &lt;span class="o">(&lt;/span>&lt;span class="m">0&lt;/span> slots&lt;span class="o">)&lt;/span> slave
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> replicates 059bda64ea1e49e38ef833ed9e997cffd7dff0c5
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">M: 216fa2035f19dbf88e5e6ab709861ba11b1705de 192.168.1.11:6379
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slots:&lt;span class="o">[&lt;/span>820-4095&lt;span class="o">]&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="m">3276&lt;/span> slots&lt;span class="o">)&lt;/span> master
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="m">1&lt;/span> additional replica&lt;span class="o">(&lt;/span>s&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>OK&lt;span class="o">]&lt;/span> All nodes agree about slots configuration.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;gt;&amp;gt;&amp;gt; Check &lt;span class="k">for&lt;/span> open slots...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;gt;&amp;gt;&amp;gt; Check slots coverage...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>OK&lt;span class="o">]&lt;/span> All &lt;span class="m">16384&lt;/span> slots covered.
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="測試key與value是否正常">測試key與value是否正常&lt;/h2>
&lt;p>藉由type key方式，確認是否有查到key的type，&lt;/p>
&lt;p>並確認是否針對key所在slot的位置，有Redirected過去key所在的主機，&lt;/p>
&lt;p>並查看key是否有取到正確的值。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@redis01 redis&lt;span class="o">]&lt;/span>&lt;span class="c1"># redis-cli --user 帳號 --pass 密碼 -c&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 查看key type，此key剛好就在redis01主機上，所以執行直接顯示type&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">127.0.0.1:6379&amp;gt; &lt;span class="nb">type&lt;/span> spring:session:index:org.springframework.session.FindByIndexNameSessionRepository.PRINCIPAL_NAME_INDEX_NAME:362C74F290B63E5F751DCF1E49EC34BEAF6822F0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 查看key type，此key在redis02主機上，會Redirected到此key所在slot主機上，再顯示type&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">127.0.0.1:6379&amp;gt; &lt;span class="nb">type&lt;/span> DRM01001000347201
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-&amp;gt; Redirected to slot &lt;span class="o">[&lt;/span>5914&lt;span class="o">]&lt;/span> located at 192.168.1.12:6379
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">hash&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 查看key type，此key在redis03主機上，會Redirected到此key所在slot主機上，再顯示type&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">192.168.1.12:6379&amp;gt; &lt;span class="nb">type&lt;/span> spring:session:index:org.springframework.session.FindByIndexNameSessionRepository.PRINCIPAL_NAME_INDEX_NAME:EBB87CF1F764E6BACCC709323FE1457065B0CC8E
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-&amp;gt; Redirected to slot &lt;span class="o">[&lt;/span>10759&lt;span class="o">]&lt;/span> located at 192.168.1.13:6379
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">192.168.1.13:6379&amp;gt; SMEMBERS spring:session:index:org.springframework.session.FindByIndexNameSessionRepository.PRINCIPAL_NAME_INDEX_NAME:EBB87CF1F764E6BACCC709323FE1457065B0CC8E
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">1&lt;span class="o">)&lt;/span> &lt;span class="s2">&amp;#34;\xac\xed\x00\x05t\x00&lt;/span>&lt;span class="nv">$aef3b17d&lt;/span>&lt;span class="s2">-ed6f-4c4e-9cc3-ef69eda6f33c&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 查看key type，此key在redis04主機上，會Redirected到此key所在slot主機上，再顯示type&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">192.168.1.13:6379&amp;gt; &lt;span class="nb">type&lt;/span> TON01001010231201
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-&amp;gt; Redirected to slot &lt;span class="o">[&lt;/span>12921&lt;span class="o">]&lt;/span> located at 192.168.1.14:6379
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">hash&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">192.168.1.14:6379&amp;gt; hgetall TON01001010231201
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">1&lt;span class="o">)&lt;/span> &lt;span class="s2">&amp;#34;path&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">2&lt;span class="o">)&lt;/span> &lt;span class="s2">&amp;#34;/reader/book_content_unpack/teb/2022/10/17/TON01001010231201/TON01001010231201&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">3&lt;span class="o">)&lt;/span> &lt;span class="s2">&amp;#34;iv&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">4&lt;span class="o">)&lt;/span> &lt;span class="s2">&amp;#34;06ac4696c8a4bb94ecb7e82b38a1dc3f&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">5&lt;span class="o">)&lt;/span> &lt;span class="s2">&amp;#34;key&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">6&lt;span class="o">)&lt;/span> &lt;span class="s2">&amp;#34;36971e857d647324cb59e1cdf58d7071&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 查看key type，此key在redis05主機上，會Redirected到此key所在slot主機上，再顯示type&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">192.168.1.14:6379&amp;gt; &lt;span class="nb">type&lt;/span> spring:session:index:org.springframework.session.FindByIndexNameSessionRepository.PRINCIPAL_NAME_INDEX_NAME:25E30A2AB63FE661B9AE7803EAD9A9AC234097FC
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-&amp;gt; Redirected to slot &lt;span class="o">[&lt;/span>16326&lt;span class="o">]&lt;/span> located at 192.168.1.18:6379
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">192.168.1.18:6379&amp;gt; SMEMBERS spring:session:index:org.springframework.session.FindByIndexNameSessionRepository.PRINCIPAL_NAME_INDEX_NAME:25E30A2AB63FE661B9AE7803EAD9A9AC234097FC
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">1&lt;span class="o">)&lt;/span> &lt;span class="s2">&amp;#34;\xac\xed\x00\x05t\x00&lt;/span>&lt;span class="nv">$f0d82ce3&lt;/span>&lt;span class="s2">-28e3-493c-b992-439565cf987e&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">192.168.1.18:6379&amp;gt; &lt;span class="nb">type&lt;/span> BOOK_CASE_LIST_U_39048951
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-&amp;gt; Redirected to slot &lt;span class="o">[&lt;/span>5895&lt;span class="o">]&lt;/span> located at 192.168.1.12:6379
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">hash&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">192.168.1.12:6379&amp;gt; hgetall BOOK_CASE_LIST_U_39048951
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">1&lt;span class="o">)&lt;/span> &lt;span class="s2">&amp;#34;0_5&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">2&lt;span class="o">)&lt;/span> &lt;span class="s2">&amp;#34;{\&amp;#34;result\&amp;#34;:\&amp;#34;00\&amp;#34;,\&amp;#34;syncTime\&amp;#34;:\&amp;#34;20231202164546\&amp;#34;,\&amp;#34;ebooks\&amp;#34;:[{\&amp;#34;deliverId\&amp;#34;:\&amp;#34;SON03001000560201\&amp;#34;,\&amp;#34;contentId\&amp;#34;:\&amp;#34;SON03001000560\&amp;#34;,\&amp;#34;title\&amp;#34;:\&amp;#34;\xe6\x8a\x95\xe8\xb3\x875\xe5\xb9\xb4\xef\xbc\x8c\xe6\x9c\xac\xe9\x87\x91\xe5\xbe\x9e4\xe8\x90\xac\xe5\x88\xb01\xe5\x84\x84\xe7\x9a\x84\xe5\xa5\xb3\xe4\xba\xba\xef\xbc\x9a\xe5\xbe\x9e\xe7\x9c\x81\xe9\x8c\xa2\xe3\x80\x81\xe5\xae\x9a\xe5\xad\x98\xe5\x88\xb0\xe8\x82\xa1\xe7\xa5\xa8\xef\xbc\x8c\xe5\xb0\x88\xe5\xb1\xac\xe5\xb0\x8f\xe8\xb3\x87\xe5\xa5\xb3\xe7\x9a\x84\xe8\xb3\xaa\xe6\x84\x9f\xe7\x90\x86\xe8\xb2\xa1\xe6\x8f\x90\xe6\xa1\x88\&amp;#34;,\&amp;#34;publisher\&amp;#34;:\&amp;#34;\xe5\xb4\xa7\xe7\x87\x81\xe6\x96\x87\xe5\x8c\x96\&amp;#34;,\&amp;#34;author\&amp;#34;:\&amp;#34;\xe6\xb7\x98\xe6\xb7\x98\&amp;#34;,\&amp;#34;bodyTypeCode\&amp;#34;:\&amp;#34;201\&amp;#34;,\&amp;#34;ebookType\&amp;#34;:\&amp;#34;\xe6\x9b\xb8\xe7\xb1\x8d\&amp;#34;,\&amp;#34;categories\&amp;#34;:[\&amp;#34;\xe9\x87\x91\xe8\x9e\x8d\xe7\x90\x86\xe8\xb2\xa1\&amp;#34;],
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="redis工作目錄檔案">redis工作目錄檔案&lt;/h2>
&lt;p>dump.rdb：是來源的檔案，覆蓋成dump6379.rdb，讓redis 6379 PORT使用這個檔案恢復數據&lt;/p>
&lt;p>dump6380.rdb：是redis 6380 PORT使用的rdb檔&lt;/p>
&lt;p>nodes-6379.conf：是redis 6379 PORT Cluster建置後產生的node資訊檔&lt;/p>
&lt;p>nodes-6380.conf：是redis 6380 PORT Cluster建置後產生的node資訊檔&lt;/p>
&lt;p>redis6380.conf：是redis 6380 PORT Cluster的設定檔&lt;/p>
&lt;p>redis.conf：是redis 6379 PORT Cluster的設定檔&lt;/p>
&lt;p>users.acl：是redis 6379、6380 PORT共用的acl檔&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@redis01 ~&lt;span class="o">]&lt;/span>&lt;span class="c1"># cd /usr/local/redis/&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@redis01 redis&lt;span class="o">]&lt;/span>&lt;span class="c1"># ll&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">總計 &lt;span class="m">1443640&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-r--r-- &lt;span class="m">1&lt;/span> redis redis &lt;span class="m">553867150&lt;/span> 12月 &lt;span class="m">16&lt;/span> 23:27 dump6379.rdb
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-r--r-- &lt;span class="m">1&lt;/span> redis redis &lt;span class="m">580550225&lt;/span> 12月 &lt;span class="m">16&lt;/span> 23:27 dump6380.rdb
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw------- &lt;span class="m">1&lt;/span> redis redis &lt;span class="m">343630318&lt;/span> 12月 &lt;span class="m">16&lt;/span> 22:27 dump.rdb
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-r--r-- &lt;span class="m">1&lt;/span> redis redis &lt;span class="m">1333&lt;/span> 12月 &lt;span class="m">16&lt;/span> 23:27 nodes-6379.conf
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-r--r-- &lt;span class="m">1&lt;/span> redis redis &lt;span class="m">1333&lt;/span> 12月 &lt;span class="m">16&lt;/span> 23:27 nodes-6380.conf
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-r--r-- &lt;span class="m">1&lt;/span> redis redis &lt;span class="m">109501&lt;/span> 12月 &lt;span class="m">16&lt;/span> 21:59 redis6380.conf
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-r--r-- &lt;span class="m">1&lt;/span> redis redis &lt;span class="m">109501&lt;/span> 12月 &lt;span class="m">16&lt;/span> 21:59 redis.conf
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-r--r-- &lt;span class="m">1&lt;/span> redis redis &lt;span class="m">1041&lt;/span> 12月 &lt;span class="m">16&lt;/span> 21:59 users.acl
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@redis02 ~&lt;span class="o">]&lt;/span>&lt;span class="c1"># cd /usr/local/redis/&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@redis02 redis&lt;span class="o">]&lt;/span>&lt;span class="c1"># ll&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">總計 &lt;span class="m">1444340&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-r--r-- &lt;span class="m">1&lt;/span> redis redis &lt;span class="m">576136538&lt;/span> 12月 &lt;span class="m">16&lt;/span> 23:27 dump6379.rdb
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-r--r-- &lt;span class="m">1&lt;/span> redis redis &lt;span class="m">553867150&lt;/span> 12月 &lt;span class="m">16&lt;/span> 23:27 dump6380.rdb
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw------- &lt;span class="m">1&lt;/span> redis redis &lt;span class="m">348759548&lt;/span> 12月 &lt;span class="m">16&lt;/span> 22:34 dump.rdb
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-r--r-- &lt;span class="m">1&lt;/span> redis redis &lt;span class="m">1334&lt;/span> 12月 &lt;span class="m">16&lt;/span> 23:27 nodes-6379.conf
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-r--r-- &lt;span class="m">1&lt;/span> redis redis &lt;span class="m">1334&lt;/span> 12月 &lt;span class="m">16&lt;/span> 23:28 nodes-6380.conf
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-r--r-- &lt;span class="m">1&lt;/span> redis redis &lt;span class="m">109501&lt;/span> 12月 &lt;span class="m">16&lt;/span> 22:00 redis6380.conf
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-r--r-- &lt;span class="m">1&lt;/span> redis redis &lt;span class="m">109501&lt;/span> 12月 &lt;span class="m">16&lt;/span> 22:00 redis.conf
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-r--r-- &lt;span class="m">1&lt;/span> redis redis &lt;span class="m">1041&lt;/span> 12月 &lt;span class="m">16&lt;/span> 22:00 users.acl
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@redis03 ~&lt;span class="o">]&lt;/span>&lt;span class="c1"># cd /usr/local/redis/&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@redis03 redis&lt;span class="o">]&lt;/span>&lt;span class="c1"># ll&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">總計 &lt;span class="m">1471548&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-r--r-- &lt;span class="m">1&lt;/span> redis redis &lt;span class="m">580550225&lt;/span> 12月 &lt;span class="m">16&lt;/span> 23:27 dump6379.rdb
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-r--r-- &lt;span class="m">1&lt;/span> redis redis &lt;span class="m">576136538&lt;/span> 12月 &lt;span class="m">16&lt;/span> 23:27 dump6380.rdb
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw------- &lt;span class="m">1&lt;/span> redis redis &lt;span class="m">349938872&lt;/span> 12月 &lt;span class="m">16&lt;/span> 22:38 dump.rdb
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-r--r-- &lt;span class="m">1&lt;/span> redis redis &lt;span class="m">1333&lt;/span> 12月 &lt;span class="m">16&lt;/span> 23:27 nodes-6379.conf
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-r--r-- &lt;span class="m">1&lt;/span> redis redis &lt;span class="m">1333&lt;/span> 12月 &lt;span class="m">16&lt;/span> 23:27 nodes-6380.conf
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-r--r-- &lt;span class="m">1&lt;/span> redis redis &lt;span class="m">109501&lt;/span> 12月 &lt;span class="m">16&lt;/span> 22:00 redis6380.conf
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-r--r-- &lt;span class="m">1&lt;/span> redis redis &lt;span class="m">109501&lt;/span> 12月 &lt;span class="m">16&lt;/span> 22:00 redis.conf
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-r--r-- &lt;span class="m">1&lt;/span> redis redis &lt;span class="m">1041&lt;/span> 12月 &lt;span class="m">16&lt;/span> 22:00 users.acl
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@redis04 ~&lt;span class="o">]&lt;/span>&lt;span class="c1"># cd /usr/local/redis/&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@redis04 redis&lt;span class="o">]&lt;/span>&lt;span class="c1"># ll&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">總計 &lt;span class="m">1679456&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-r--r-- &lt;span class="m">1&lt;/span> redis redis &lt;span class="m">738751856&lt;/span> 12月 &lt;span class="m">16&lt;/span> 23:27 dump6379.rdb
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-r--r-- &lt;span class="m">1&lt;/span> redis redis &lt;span class="m">578286056&lt;/span> 12月 &lt;span class="m">16&lt;/span> 23:27 dump6380.rdb
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw------- &lt;span class="m">1&lt;/span> redis redis &lt;span class="m">402484559&lt;/span> 12月 &lt;span class="m">16&lt;/span> 22:41 dump.rdb
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-r--r-- &lt;span class="m">1&lt;/span> redis redis &lt;span class="m">1335&lt;/span> 12月 &lt;span class="m">16&lt;/span> 23:28 nodes-6379.conf
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-r--r-- &lt;span class="m">1&lt;/span> redis redis &lt;span class="m">1334&lt;/span> 12月 &lt;span class="m">16&lt;/span> 23:28 nodes-6380.conf
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-r--r-- &lt;span class="m">1&lt;/span> redis redis &lt;span class="m">109501&lt;/span> 12月 &lt;span class="m">16&lt;/span> 22:00 redis6380.conf
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-r--r-- &lt;span class="m">1&lt;/span> redis redis &lt;span class="m">109501&lt;/span> 12月 &lt;span class="m">16&lt;/span> 22:00 redis.conf
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-r--r-- &lt;span class="m">1&lt;/span> redis redis &lt;span class="m">1041&lt;/span> 12月 &lt;span class="m">16&lt;/span> 22:00 users.acl
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@redis05 ~&lt;span class="o">]&lt;/span>&lt;span class="c1"># cd /usr/local/redis/&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@redis05 redis&lt;span class="o">]&lt;/span>&lt;span class="c1"># ll&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">總計 &lt;span class="m">1634176&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-r--r-- &lt;span class="m">1&lt;/span> redis redis &lt;span class="m">578286056&lt;/span> 12月 &lt;span class="m">16&lt;/span> 23:27 dump6379.rdb
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-r--r-- &lt;span class="m">1&lt;/span> redis redis &lt;span class="m">738751856&lt;/span> 12月 &lt;span class="m">16&lt;/span> 23:27 dump6380.rdb
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw------- &lt;span class="m">1&lt;/span> redis redis &lt;span class="m">356118026&lt;/span> 12月 &lt;span class="m">16&lt;/span> 22:44 dump.rdb
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-r--r-- &lt;span class="m">1&lt;/span> redis redis &lt;span class="m">1335&lt;/span> 12月 &lt;span class="m">16&lt;/span> 23:28 nodes-6379.conf
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-r--r-- &lt;span class="m">1&lt;/span> redis redis &lt;span class="m">1334&lt;/span> 12月 &lt;span class="m">16&lt;/span> 23:28 nodes-6380.conf
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-r--r-- &lt;span class="m">1&lt;/span> redis redis &lt;span class="m">109501&lt;/span> 12月 &lt;span class="m">16&lt;/span> 22:00 redis6380.conf
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-r--r-- &lt;span class="m">1&lt;/span> redis redis &lt;span class="m">109501&lt;/span> 12月 &lt;span class="m">16&lt;/span> 22:00 redis.conf
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-r--r-- &lt;span class="m">1&lt;/span> redis redis &lt;span class="m">1041&lt;/span> 12月 &lt;span class="m">16&lt;/span> 22:00 users.acl
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item><item><title>Jenkins+Gitlab+Ansible 版控與佈屬 Redis Redis-Sentinel集群</title><link>https://blog.goldfishbrain-fighting.com/2023/devops-jenkins-gitlab-ansible-redis/</link><pubDate>Sun, 08 Oct 2023 11:49:00 +0800</pubDate><guid>https://blog.goldfishbrain-fighting.com/2023/devops-jenkins-gitlab-ansible-redis/</guid><description>&lt;h1 id="今日大綱">今日大綱&lt;/h1>
&lt;ol>
&lt;li>Ansible自動化安裝Redis、Redis-Sentinel服務&lt;/li>
&lt;li>Gitlab redis-config設定檔管理
&lt;ol>
&lt;li>創建project&lt;/li>
&lt;li>將設定檔傳入&lt;/li>
&lt;/ol>
&lt;/li>
&lt;li>Ansible佈屬腳本撰寫&lt;/li>
&lt;li>Jenkins Free-Style專案建立
&lt;ol>
&lt;li>創建Free-Style軟體專案&lt;/li>
&lt;li>參數化構建&lt;/li>
&lt;li>原始碼管理&lt;/li>
&lt;li>Build Steps: Invoke Ansible Playbook&lt;/li>
&lt;li>建置測試&lt;/li>
&lt;/ol>
&lt;/li>
&lt;/ol>
&lt;p>&lt;img src="https://ithelp.ithome.com.tw/upload/images/20230913/20132481A1zg9qCmwo.png"
loading="lazy"
alt="https://ithelp.ithome.com.tw/upload/images/20230913/20132481A1zg9qCmwo.png"
>&lt;/p>
&lt;p>&lt;img src="https://ithelp.ithome.com.tw/upload/images/20230913/20132481T64YfhjSvU.png"
loading="lazy"
alt="https://ithelp.ithome.com.tw/upload/images/20230913/20132481T64YfhjSvU.png"
>&lt;/p>
&lt;h1 id="ansible自動化安裝redisredis-sentinel服務">Ansible自動化安裝Redis、Redis-Sentinel服務&lt;/h1>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># ansible佈屬腳本目錄&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@ansible ansible&lt;span class="o">]&lt;/span>&lt;span class="c1"># ll&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">總計 &lt;span class="m">24&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-r--r--. &lt;span class="m">1&lt;/span> root root &lt;span class="m">12593&lt;/span> 9月 &lt;span class="m">11&lt;/span> 22:52 hosts
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">drwxr-xr-x. &lt;span class="m">33&lt;/span> root root &lt;span class="m">4096&lt;/span> 9月 &lt;span class="m">12&lt;/span> 21:05 roles
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-r--r--. &lt;span class="m">1&lt;/span> root root &lt;span class="m">2091&lt;/span> 9月 &lt;span class="m">11&lt;/span> 22:38 site.yml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 主機清單&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@ansible ansible&lt;span class="o">]&lt;/span>&lt;span class="c1"># cat hosts&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>redis&lt;span class="o">]&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">192.168.1.11 &lt;span class="nv">ansible_nodename&lt;/span>&lt;span class="o">=&lt;/span>redis01
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">192.168.1.12 &lt;span class="nv">ansible_nodename&lt;/span>&lt;span class="o">=&lt;/span>redis02
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">192.168.1.13 &lt;span class="nv">ansible_nodename&lt;/span>&lt;span class="o">=&lt;/span>redis03
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">192.168.1.14 &lt;span class="nv">ansible_nodename&lt;/span>&lt;span class="o">=&lt;/span>redis04
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 選擇要佈屬的主機和角色，使用become: yes(sudo su -)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@ansible ansible&lt;span class="o">]&lt;/span>&lt;span class="c1"># cat site.yml&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">- hosts: redis
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> remote_user: root
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> gather_facts: &lt;span class="nb">false&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> become: yes
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> roles:
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> - roles/redis
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 要佈屬的任務腳本&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@ansible ansible&lt;span class="o">]&lt;/span>&lt;span class="c1"># cat roles/redis/tasks/main.yml&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 執行佈屬&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@ansible ansible&lt;span class="o">]&lt;/span>&lt;span class="c1"># ansible-playbook -i hosts site.yml --ask-pass&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">PLAY RECAP *******************************************************************************************************************
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">192.168.1.11 : &lt;span class="nv">ok&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">46&lt;/span> &lt;span class="nv">changed&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">45&lt;/span> &lt;span class="nv">unreachable&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">failed&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">skipped&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">rescued&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">ignored&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">192.168.1.12 : &lt;span class="nv">ok&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">46&lt;/span> &lt;span class="nv">changed&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">45&lt;/span> &lt;span class="nv">unreachable&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">failed&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">skipped&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">rescued&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">ignored&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">192.168.1.13 : &lt;span class="nv">ok&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">46&lt;/span> &lt;span class="nv">changed&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">45&lt;/span> &lt;span class="nv">unreachable&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">failed&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">skipped&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">rescued&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">ignored&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">2&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">192.168.1.14 : &lt;span class="nv">ok&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">46&lt;/span> &lt;span class="nv">changed&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">45&lt;/span> &lt;span class="nv">unreachable&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">failed&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">skipped&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">rescued&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">0&lt;/span> &lt;span class="nv">ignored&lt;/span>&lt;span class="o">=&lt;/span>&lt;span class="m">2&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h1 id="gitlab-redis-config設定檔管理">Gitlab redis-config設定檔管理&lt;/h1>
&lt;h2 id="1-創建project">1. 創建project&lt;/h2>
&lt;p>&lt;img src="https://ithelp.ithome.com.tw/upload/images/20230913/201324811FAyYPAkSA.png"
loading="lazy"
alt="https://ithelp.ithome.com.tw/upload/images/20230913/201324811FAyYPAkSA.png"
>&lt;/p>
&lt;h2 id="2-將設定檔傳入">2. 將設定檔傳入&lt;/h2>
&lt;p>&lt;img src="https://ithelp.ithome.com.tw/upload/images/20230913/20132481dsdfZSG51j.png"
loading="lazy"
alt="https://ithelp.ithome.com.tw/upload/images/20230913/20132481dsdfZSG51j.png"
>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 使用已存在目錄的方式，將設定檔傳入&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 當前目錄&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">chenqingze@chenqingze-MBP redis-config-test % ll
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">total &lt;span class="m">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">drwxr-xr-x@ &lt;span class="m">5&lt;/span> chenqingze staff &lt;span class="m">160&lt;/span> &lt;span class="m">9&lt;/span> &lt;span class="m">12&lt;/span> 22:49 batch
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">drwxr-xr-x@ &lt;span class="m">4&lt;/span> chenqingze staff &lt;span class="m">128&lt;/span> &lt;span class="m">9&lt;/span> &lt;span class="m">12&lt;/span> 22:44 t1zone
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">drwxr-xr-x@ &lt;span class="m">4&lt;/span> chenqingze staff &lt;span class="m">128&lt;/span> &lt;span class="m">9&lt;/span> &lt;span class="m">12&lt;/span> 22:45 t2zone
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 傳入gitlab&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">chenqingze@chenqingze-MBP redis-config-test % git init
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Initialized empty Git repository in /Users/chenqingze/Desktop/redis-config-test/redis-config-test/.git/
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">chenqingze@chenqingze-MBP redis-config-test % git remote add origin http://gitlab.jimmyhome.tw/root/redis-config-test.git
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">chenqingze@chenqingze-MBP redis-config-test % git add .
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">chenqingze@chenqingze-MBP redis-config-test % git commit -m &lt;span class="s2">&amp;#34;Initial commit&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">chenqingze@chenqingze-MBP redis-config-test % git branch -m main master
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">chenqingze@chenqingze-MBP redis-config-test % git push -u origin master
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Enumerating objects: 19, &lt;span class="k">done&lt;/span>.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Counting objects: 100% &lt;span class="o">(&lt;/span>19/19&lt;span class="o">)&lt;/span>, &lt;span class="k">done&lt;/span>.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Delta compression using up to &lt;span class="m">10&lt;/span> threads
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Compressing objects: 100% &lt;span class="o">(&lt;/span>19/19&lt;span class="o">)&lt;/span>, &lt;span class="k">done&lt;/span>.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Writing objects: 100% &lt;span class="o">(&lt;/span>19/19&lt;span class="o">)&lt;/span>, 45.79 KiB &lt;span class="p">|&lt;/span> 7.63 MiB/s, &lt;span class="k">done&lt;/span>.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Total &lt;span class="m">19&lt;/span> &lt;span class="o">(&lt;/span>delta 6&lt;span class="o">)&lt;/span>, reused &lt;span class="m">0&lt;/span> &lt;span class="o">(&lt;/span>delta 0&lt;span class="o">)&lt;/span>, pack-reused &lt;span class="m">0&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">To http://gitlab.jimmyhome.tw/root/redis-config-test.git
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> * &lt;span class="o">[&lt;/span>new branch&lt;span class="o">]&lt;/span> master -&amp;gt; master
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">branch &lt;span class="s1">&amp;#39;master&amp;#39;&lt;/span> &lt;span class="nb">set&lt;/span> up to track &lt;span class="s1">&amp;#39;origin/master&amp;#39;&lt;/span>.
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;img src="https://ithelp.ithome.com.tw/upload/images/20230913/20132481x1b02IPM1q.png"
loading="lazy"
alt="https://ithelp.ithome.com.tw/upload/images/20230913/20132481x1b02IPM1q.png"
>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">redis-sentinel.conf -&amp;gt; redis-sentinel設定檔
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">redis.conf -&amp;gt; redis設定檔
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">sentinel-users.acl -&amp;gt; redis-sentinel的acl設定檔
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">users.acl -&amp;gt; redis的acl設定檔
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;img src="https://ithelp.ithome.com.tw/upload/images/20230913/201324818UCYMZ6gqm.png"
loading="lazy"
alt="https://ithelp.ithome.com.tw/upload/images/20230913/201324818UCYMZ6gqm.png"
>&lt;/p>
&lt;h1 id="ansible佈屬腳本撰寫">Ansible佈屬腳本撰寫&lt;/h1>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">1. 變數定義與獲取、判斷輸入選項&lt;span class="o">(&lt;/span>Jenkins本地端操作&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 1. 獲取項目的工作目錄 &lt;span class="o">{{&lt;/span> workspace.stdout &lt;span class="o">}}&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 2. 確認function是否沒有選擇，沒有選擇，報錯終止流程
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 3. 確認masterip不能沒有輸入，沒有輸入，報錯終止流程
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 4. 確認masterip只能一個，一個以上則報錯，報錯終止流程
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 5. 確認slaveip不能沒有輸入，沒有輸入，報錯終止流程
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">2. masterip開始流程
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 0. 確認Redis服務是否活著，活著的話，報錯終止流程
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 0. 確認Redis-Sentinel服務是否活著，活著的話，報錯終止流程
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 1. 拷貝檔案至遠端主機
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 2. 替換redis-sentinel.conf配置文件，將masterip寫入
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">3. slaveip開始流程
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 0. 確認Redis服務是否啟動，啟動的話，報錯終止流程
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 0. 確認Redis-Sentinel服務是否啟動，啟動的話，報錯終止流程
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 1. 拷貝檔案至遠端主機
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 2. 替換redis-sentinel.conf配置文件，將masterip寫入
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 3. 將slaveof masterip 6379寫入redis.conf配置文件
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">4. all開始流程
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 0. 確認Redis服務是否啟動，啟動的話，報錯終止流程
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 0. 確認Redis-Sentinel服務是否啟動，啟動的話，報錯終止流程
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 1. 啟動，開機自啟動redis服務
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 2. 確認Redis服務是否正常啟動，不啟動的話，報錯終止流程
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 3. 啟動，開機自啟動redis-sentinel服務
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 4. 確認Redis-Sentinel服務是否正常啟動，不啟動的話，報錯終止流程
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> redis-sentinel剛啟動連接，需要一點時間偵測，所以流程暫停5秒
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> 5. 查看Redis-Sentinel狀態連接狀態&lt;span class="o">(&lt;/span>/usr/local/bin/redis-cli -p &lt;span class="m">26379&lt;/span> info &lt;span class="p">|&lt;/span> grep -i &lt;span class="o">{{&lt;/span> &lt;span class="k">function&lt;/span> &lt;span class="o">}})&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-yml" data-lang="yml">&lt;span class="line">&lt;span class="cl">&lt;span class="p">[&lt;/span>&lt;span class="l">root@ansible ansible]# cat se_redis-config-test_deploy.yml&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c">##################變數定義與獲取、判斷輸入選項(Jenkins本地端操作)###################&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>- &lt;span class="nt">hosts&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">all&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">gather_facts&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">no&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">tasks&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c"># 1. 獲取項目的工作目錄 {{ workspace.stdout }}&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Get WorkSpace Work Path&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">shell&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">cmd&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;echo ${WORKSPACE}&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">register&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">workspace&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">delegate_to&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">127.0.0.1&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c"># 2. 確認function是否沒有選擇，沒有選擇，報錯終止流程&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Check Function Choice&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">shell&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">cmd&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;echo {{ function }} | wc -w&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">register&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">is_function&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">delegate_to&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">127.0.0.1&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">failed_when&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;&amp;#39;0&amp;#39; == is_function.stdout&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c"># 3. 確認masterip不能沒有輸入，沒有輸入，報錯終止流程&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Check Masterip Input&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">shell&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">cmd&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;echo {{ masterip }} | wc -w&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">register&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">is_masterip&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">delegate_to&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">127.0.0.1&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">failed_when&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;&amp;#39;0&amp;#39; == is_masterip.stdout&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c"># 4. 確認masterip只能一個，一個以上則報錯，報錯終止流程&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Check Masterip Count&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">shell&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">cmd&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;echo -e &amp;#39;{{ masterip }}&amp;#39; | wc -l&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">register&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">is_masterip&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">delegate_to&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">127.0.0.1&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">failed_when&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;is_masterip.stdout &amp;gt; &amp;#39;1&amp;#39;&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c"># 5. 確認slaveip不能沒有輸入，沒有輸入，報錯終止流程&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Check Slaveip Input&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">shell&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">cmd&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;echo {{ slaveip }} | wc -w&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">register&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">is_slaveip&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">delegate_to&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">127.0.0.1&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">failed_when&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;&amp;#39;0&amp;#39; == is_slaveip.stdout&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c">################################masterip開始流程###################################&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>- &lt;span class="nt">hosts&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;{{ masterip }}&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">gather_facts&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">no&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">tasks&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c"># 0. 確認Redis服務是否活著，活著的話，報錯終止流程&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Check Redis Service&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">command&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">/usr/bin/systemctl is-active redis&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">register&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">command_result&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">failed_when&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;&amp;#39;active&amp;#39; == command_result.stdout&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c"># 0. 確認Redis-Sentinel服務是否活著，活著的話，報錯終止流程&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Check Redis-Sentinel Service&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">command&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">/usr/bin/systemctl is-active redis-sentinel&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">register&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">command_result&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">failed_when&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;&amp;#39;active&amp;#39; == command_result.stdout&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c"># 1. 拷貝檔案至遠端主機&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Copy Filepath To Remote Server&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">copy&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">src&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;{{ workspace.stdout }}/{{ zone }}/{{ function }}/&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">dest&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;/usr/local/redis/&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">owner&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">redis&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">group&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">redis&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">mode&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;0644&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c"># 2. 替換redis-sentinel.conf配置文件，將masterip寫入&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Replace Masterip To redis-sentinel.conf&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">shell&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;sed -i &amp;#39;s/o.o.o.o/{{ masterip }}/g&amp;#39; /usr/local/redis/redis-sentinel.conf&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c">################################slaveip開始流程###################################&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>- &lt;span class="nt">hosts&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;{{ slaveip }}&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">gather_facts&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">no&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">tasks&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c"># 0. 確認Redis服務是否啟動，啟動的話，報錯終止流程&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Check Redis Service&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">command&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">/usr/bin/systemctl is-active redis&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">register&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">command_result&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">failed_when&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;&amp;#39;active&amp;#39; == command_result.stdout&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c"># 0. 確認Redis-Sentinel服務是否啟動，啟動的話，報錯終止流程&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Check Redis-Sentinel Service&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">command&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">/usr/bin/systemctl is-active redis-sentinel&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">register&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">command_result&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">failed_when&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;&amp;#39;active&amp;#39; == command_result.stdout&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c"># 1. 拷貝檔案至遠端主機&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Copy Filepath To Remote Server&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">copy&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">src&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;{{ workspace.stdout }}/{{ zone }}/{{ function }}/&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">dest&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;/usr/local/redis/&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">owner&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">redis&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">group&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">redis&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">mode&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s1">&amp;#39;0644&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c"># 2. 替換redis-sentinel.conf配置文件，將masterip寫入&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Replace Masterip To redis-sentinel.conf&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">shell&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;sed -i &amp;#39;s/o.o.o.o/{{ masterip }}/g&amp;#39; /usr/local/redis/redis-sentinel.conf&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c"># 3. 將slaveof masterip 6379寫入redis.conf配置文件&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Add Slaveof To redis.conf&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">blockinfile&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">path&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">/usr/local/redis/redis.conf&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">block&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="p">|&lt;/span>&lt;span class="sd">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd"> slaveof {{ masterip }} 6379&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c">##################################all開始流程#####################################&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>- &lt;span class="nt">hosts&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">all&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">gather_facts&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">no&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">tasks&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c"># 0. 確認Redis服務是否啟動，啟動的話，報錯終止流程&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Check Redis Service&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">command&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">/usr/bin/systemctl is-active redis&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">register&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">command_result&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">failed_when&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;&amp;#39;active&amp;#39; == command_result.stdout&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c"># 0. 確認Redis-Sentinel服務是否啟動，啟動的話，報錯終止流程&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Check Redis-Sentinel Service&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">command&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">/usr/bin/systemctl is-active redis-sentinel&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">register&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">command_result&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">failed_when&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;&amp;#39;active&amp;#39; == command_result.stdout&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c"># 1. 啟動，開機自啟動redis服務&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c"># 2. 確認Redis服務是否正常啟動，不啟動的話，報錯終止流程&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Enabled、Started Redis&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">systemd&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">redis&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">enabled&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">state&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">started&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Check Redis Service&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">command&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">/usr/bin/systemctl is-active redis&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">register&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">command_result&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">failed_when&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;&amp;#39;failed&amp;#39; in command_result.stdout or &amp;#39;unknown&amp;#39; in command_result.stdout or &amp;#39;inactive&amp;#39; in command_result.stdout&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c"># 3. 啟動，開機自啟動redis-sentinel服務&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c"># 4. 確認Redis-Sentinel服務是否正常啟動，不啟動的話，報錯終止流程&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Enabled、Started Redis-Sentinel&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">systemd&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">redis-sentinel&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">enabled&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">true&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">state&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">started&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Check Redis-Sentinel Service&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">command&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">/usr/bin/systemctl is-active redis-sentinel&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">register&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">command_result&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">failed_when&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;&amp;#39;failed&amp;#39; in command_result.stdout or &amp;#39;unknown&amp;#39; in command_result.stdout or &amp;#39;inactive&amp;#39; in command_result.stdout&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c"># redis-sentinel剛啟動連接，需要一點時間偵測，所以流程暫停5秒&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Pause for 5 seconds to build app cache&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">pause&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">seconds&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">5&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c"># 5. 查看Redis-Sentinel狀態連接狀態(/usr/local/bin/redis-cli -p 26379 info | grep -i web-front)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Check Redis-Sentinel info&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">shell&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;/usr/local/bin/redis-cli -p 26379 info | grep -i {{ function }}&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">register&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;command_result&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">args&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">warn&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">no&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">ignore_errors&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">True&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Runcommand Redis-Sentinel info Msg&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">debug&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">msg&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;{{ command_result.stdout_lines }}&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">ignore_errors&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="kc">True&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h1 id="jenkins-free-style專案建立">Jenkins Free-Style專案建立&lt;/h1>
&lt;h2 id="1-創建free-style軟體專案">1. 創建Free-Style軟體專案&lt;/h2>
&lt;p>&lt;img src="https://ithelp.ithome.com.tw/upload/images/20230913/20132481aMfv8sP1jS.png"
loading="lazy"
alt="https://ithelp.ithome.com.tw/upload/images/20230913/20132481aMfv8sP1jS.png"
>&lt;/p>
&lt;h2 id="2-參數化構建">2. 參數化構建&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">Active Choices Parameter
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;img src="https://ithelp.ithome.com.tw/upload/images/20230913/201324816dBspBN6eY.png"
loading="lazy"
alt="https://ithelp.ithome.com.tw/upload/images/20230913/201324816dBspBN6eY.png"
>
&lt;img src="https://ithelp.ithome.com.tw/upload/images/20230913/20132481CW3GbdJirK.png"
loading="lazy"
alt="https://ithelp.ithome.com.tw/upload/images/20230913/20132481CW3GbdJirK.png"
>&lt;/p>
&lt;hr>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">Active Choices Reactive Parameter
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;img src="https://ithelp.ithome.com.tw/upload/images/20230913/20132481Lp13bGXNcC.png"
loading="lazy"
alt="https://ithelp.ithome.com.tw/upload/images/20230913/20132481Lp13bGXNcC.png"
>
&lt;img src="https://ithelp.ithome.com.tw/upload/images/20230913/20132481iOycuFWgoP.png"
loading="lazy"
alt="https://ithelp.ithome.com.tw/upload/images/20230913/20132481iOycuFWgoP.png"
>&lt;/p>
&lt;hr>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">文字參數
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;img src="https://ithelp.ithome.com.tw/upload/images/20230913/20132481eP6AKSX7e5.png"
loading="lazy"
alt="https://ithelp.ithome.com.tw/upload/images/20230913/20132481eP6AKSX7e5.png"
>&lt;/p>
&lt;hr>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">文字參數
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;img src="https://ithelp.ithome.com.tw/upload/images/20230913/20132481yAkfGqKUdj.png"
loading="lazy"
alt="https://ithelp.ithome.com.tw/upload/images/20230913/20132481yAkfGqKUdj.png"
>&lt;/p>
&lt;hr>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">使用ansible這台主機來跑佈屬流程
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;img src="https://ithelp.ithome.com.tw/upload/images/20230913/20132481ipmJ9CICyP.png"
loading="lazy"
alt="https://ithelp.ithome.com.tw/upload/images/20230913/20132481ipmJ9CICyP.png"
>&lt;/p>
&lt;h2 id="3-原始碼管理">3. 原始碼管理&lt;/h2>
&lt;p>&lt;img src="https://ithelp.ithome.com.tw/upload/images/20230913/20132481ZKuUi0pyiK.png"
loading="lazy"
alt="https://ithelp.ithome.com.tw/upload/images/20230913/20132481ZKuUi0pyiK.png"
>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">原始碼管理&lt;span class="o">(&lt;/span>連接Gitlab&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">##### Gitlab複製下來的clone&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">http://gitlab.jimmyhome.tw/root/redis-config-test.git
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">##### Credential&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">連接gitlab帳號和密碼
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;img src="https://ithelp.ithome.com.tw/upload/images/20230913/20132481Kr0sAjwIin.png"
loading="lazy"
alt="https://ithelp.ithome.com.tw/upload/images/20230913/20132481Kr0sAjwIin.png"
>&lt;/p>
&lt;h2 id="4-build-steps-invoke-ansible-playbook">4. Build Steps: Invoke Ansible Playbook&lt;/h2>
&lt;p>&lt;img src="https://ithelp.ithome.com.tw/upload/images/20230913/20132481pTjDL6LvhP.png"
loading="lazy"
alt="https://ithelp.ithome.com.tw/upload/images/20230913/20132481pTjDL6LvhP.png"
>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">Invoke Ansible Playbook
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">##### ansible腳本位置&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Playbook path: /root/ansible/se_redis-config-test_deploy.yml
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1">##### Inventory主機IP&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">以下撰寫方式，ip都會傳入
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;img src="https://ithelp.ithome.com.tw/upload/images/20230913/20132481uYiDE3t2eA.png"
loading="lazy"
alt="https://ithelp.ithome.com.tw/upload/images/20230913/20132481uYiDE3t2eA.png"
>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">連接要佈屬的主機，使用帳號，我這裡用key，
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">所以我有從ansible主機，產生key，ssh-copy-id 要佈屬的主機
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@ansible ~&lt;span class="o">]&lt;/span>&lt;span class="c1"># ssh-copy-id 192.168.1.11&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">/usr/bin/ssh-copy-id: INFO: Source of key&lt;span class="o">(&lt;/span>s&lt;span class="o">)&lt;/span> to be installed: &lt;span class="s2">&amp;#34;/root/.ssh/id_rsa.pub&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">/usr/bin/ssh-copy-id: INFO: attempting to log in with the new key&lt;span class="o">(&lt;/span>s&lt;span class="o">)&lt;/span>, to filter out any that are already installed
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">/usr/bin/ssh-copy-id: INFO: &lt;span class="m">1&lt;/span> key&lt;span class="o">(&lt;/span>s&lt;span class="o">)&lt;/span> remain to be installed -- &lt;span class="k">if&lt;/span> you are prompted now it is to install the new keys
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">root@192.168.1.11&lt;span class="s1">&amp;#39;s password:
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1">Number of key(s) added: 1
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s1">Now try logging into the machine, with: &amp;#34;ssh &amp;#39;&lt;/span>192.168.1.11&lt;span class="err">&amp;#39;&lt;/span>&lt;span class="s2">&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2">and check to make sure that only the key(s) you wanted were added.
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2">[root@ansible ~]# ssh-copy-id 192.168.1.12
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2">[root@ansible ~]# ssh-copy-id 192.168.1.13
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2">[root@ansible ~]# ssh-copy-id 192.168.1.14
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">Jenkins參數，要傳入ansible內
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Extra Variables
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;img src="https://ithelp.ithome.com.tw/upload/images/20230913/20132481JVmDfr5D8r.png"
loading="lazy"
alt="https://ithelp.ithome.com.tw/upload/images/20230913/20132481JVmDfr5D8r.png"
>
&lt;img src="https://ithelp.ithome.com.tw/upload/images/20230913/20132481lnceXat7Q5.png"
loading="lazy"
alt="https://ithelp.ithome.com.tw/upload/images/20230913/20132481lnceXat7Q5.png"
>&lt;/p>
&lt;h2 id="5-建置測試">5. 建置測試&lt;/h2>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">可以看到，zone選擇，function也會跟著變動
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;img src="https://ithelp.ithome.com.tw/upload/images/20230913/20132481kddeuPgLDr.png"
loading="lazy"
alt="https://ithelp.ithome.com.tw/upload/images/20230913/20132481kddeuPgLDr.png"
>
&lt;img src="https://ithelp.ithome.com.tw/upload/images/20230913/20132481KWj671Rc4p.png"
loading="lazy"
alt="https://ithelp.ithome.com.tw/upload/images/20230913/20132481KWj671Rc4p.png"
>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">輸入IP處，slaveip可以輸入多個
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;img src="https://ithelp.ithome.com.tw/upload/images/20230913/20132481GguK5r8Es5.png"
loading="lazy"
alt="https://ithelp.ithome.com.tw/upload/images/20230913/20132481GguK5r8Es5.png"
>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">可以看到，redis-sentinel已經成功啟動，有偵測到目前master是誰，也偵測到slaves主機有3台，總共4台主機啟動sentinel服務
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;img src="https://ithelp.ithome.com.tw/upload/images/20230913/20132481BEZgT17eQl.png"
loading="lazy"
alt="https://ithelp.ithome.com.tw/upload/images/20230913/20132481BEZgT17eQl.png"
>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">進redis主機直接確認，使用redis-cli登入，選擇index 1，
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span> 1個key為test value為1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">get key test，value為1
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@redis01 redis&lt;span class="o">]&lt;/span>&lt;span class="c1"># redis-cli&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">127.0.0.1:6379&amp;gt; &lt;span class="k">select&lt;/span> &lt;span class="m">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">OK
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">127.0.0.1:6379&lt;span class="o">[&lt;/span>1&lt;span class="o">]&lt;/span>&amp;gt; &lt;span class="nb">set&lt;/span> &lt;span class="nb">test&lt;/span> &lt;span class="m">1&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">OK
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">127.0.0.1:6379&lt;span class="o">[&lt;/span>1&lt;span class="o">]&lt;/span>&amp;gt; get &lt;span class="nb">test&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="s2">&amp;#34;1&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@redis01 redis&lt;span class="o">]&lt;/span>&lt;span class="c1"># redis-cli -p 26379&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">master0:name&lt;span class="o">=&lt;/span>search,status&lt;span class="o">=&lt;/span>ok,address&lt;span class="o">=&lt;/span>192.168.1.11:6379,slaves&lt;span class="o">=&lt;/span>3,sentinels&lt;span class="o">=&lt;/span>&lt;span class="m">4&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">可以看到，如果再次佈屬，會顯示失敗，因為主機redis和redis-sentinel服務如果是active狀態，就不能佈屬&lt;span class="o">(&lt;/span>腳本一開始就有添加此段），
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">防止輸入IP輸錯，導致設定檔覆蓋，營運中的redis服務異常
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>&lt;img src="https://ithelp.ithome.com.tw/upload/images/20230913/20132481P7LDryWPOC.png"
loading="lazy"
alt="https://ithelp.ithome.com.tw/upload/images/20230913/20132481P7LDryWPOC.png"
>&lt;/p>
&lt;p>&lt;img src="https://ithelp.ithome.com.tw/upload/images/20230913/20132481R6pScPLx4K.png"
loading="lazy"
alt="https://ithelp.ithome.com.tw/upload/images/20230913/20132481R6pScPLx4K.png"
>&lt;/p>
&lt;h1 id="youtube教學影片">YouTube教學影片&lt;/h1>
&lt;p>&lt;a class="link" href="https://www.youtube.com/watch?v=2h1r68Im_Bg" target="_blank" rel="noopener"
>&lt;img src="https://img.youtube.com/vi/2h1r68Im_Bg/0.jpg"
loading="lazy"
alt="Yes"
>&lt;/a>&lt;/p></description></item></channel></rss>