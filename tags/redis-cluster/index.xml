<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>redis-cluster on 翻轉吧金魚腦</title><link>https://blog.goldfishbrain-fighting.com/tags/redis-cluster/</link><description>Recent content in redis-cluster on 翻轉吧金魚腦</description><generator>Hugo -- gohugo.io</generator><language>en-us</language><lastBuildDate>Sun, 17 Dec 2023 00:31:18 +0800</lastBuildDate><atom:link href="https://blog.goldfishbrain-fighting.com/tags/redis-cluster/index.xml" rel="self" type="application/rss+xml"/><item><title>使用Kubernetes架設RedisInsight 1.x版，管理Redis集群</title><link>https://blog.goldfishbrain-fighting.com/2023/kubernetes-redisinsight/</link><pubDate>Sun, 17 Dec 2023 00:31:18 +0800</pubDate><guid>https://blog.goldfishbrain-fighting.com/2023/kubernetes-redisinsight/</guid><description>&lt;p>參考網址：https://docs.redis.com/latest/ri/installing/install-k8s/&lt;/p>
&lt;h2 id="create-the-redisinsight-deployment-and-service">Create the RedisInsight deployment and service&lt;/h2>
&lt;p>&lt;font color=red>沒有持久化數據，也就是POD重起，設定數據就會消失&lt;/font>&lt;/p>
&lt;p>Below is an annotated YAML file that will create a RedisInsight deployment and a service in a k8s cluster.&lt;/p>
&lt;ol>
&lt;li>Create a new file redisinsight.yaml with the content below&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="line">&lt;span class="cl">&lt;span class="c"># RedisInsight service with name &amp;#39;redisinsight-service&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">apiVersion&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">v1&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">kind&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Service&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">metadata&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">redisinsight-service &lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c"># name should not be &amp;#39;redisinsight&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c"># since the service creates&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c"># environment variables that&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c"># conflicts with redisinsight&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c"># application&amp;#39;s environment&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c"># variables `REDISINSIGHT_HOST` and&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c"># `REDISINSIGHT_PORT`&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">spec&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">type&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">NodePort&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">ports&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">port&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">80&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">targetPort&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">8001&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">selector&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">app&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">redisinsight&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nn">---&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c"># RedisInsight deployment with name &amp;#39;redisinsight&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">apiVersion&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">apps/v1&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">kind&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Deployment&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">metadata&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">redisinsight&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c">#deployment name&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">labels&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">app&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">redisinsight&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c">#deployment label&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">spec&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">replicas&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">1&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c">#a single replica pod&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">selector&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">matchLabels&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">app&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">redisinsight&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c">#which pods is the deployment managing, as defined by the pod template&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">template&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c">#pod template&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">metadata&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">labels&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">app&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">redisinsight&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c">#label for pod/s&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">spec&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">containers&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">redisinsight&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c">#Container name (DNS_LABEL, unique)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">image&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">redislabs/redisinsight:latest&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c">#repo/image&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">imagePullPolicy&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">IfNotPresent&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c">#Always pull image&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">volumeMounts&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">db&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c">#Pod volumes to mount into the container&amp;#39;s filesystem. Cannot be updated.&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">mountPath&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">/db&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">ports&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">containerPort&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">8001&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c">#exposed container port and protocol&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">protocol&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">TCP&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">volumes&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">db&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">emptyDir&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>{}&lt;span class="w"> &lt;/span>&lt;span class="c"># node-ephemeral volume https://kubernetes.io/docs/concepts/storage/volumes/#emptydir&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ol start="2">
&lt;li>Create the RedisInsight deployment and service&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">kubectl apply -f redisinsight.yaml
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ol start="3">
&lt;li>Once the deployment and service are successfully applied and complete, access RedisInsight. This can be accomplished by listing the using the &lt;code>&amp;lt;external-ip&amp;gt;&lt;/code> of the service we created to reach redisinsight.&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">root@k8s-master71u:~# kubectl get svc,pod
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME TYPE CLUSTER-IP EXTERNAL-IP PORT&lt;span class="o">(&lt;/span>S&lt;span class="o">)&lt;/span> AGE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">service/redisinsight-service NodePort 10.202.52.175 &amp;lt;none&amp;gt; 80:31785/TCP 8s
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">NAME READY STATUS RESTARTS AGE
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">pod/redisinsight-cf7f6847b-s2zgg 1/1 Running &lt;span class="m">0&lt;/span> 8s
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="or-create-the-redisinsight-deployment-with-persistant-storage">Or Create the RedisInsight deployment with persistant storage&lt;/h2>
&lt;p>&lt;font color=red>持久化數據，也就是POD重起，設定數據也不會消失&lt;/font>&lt;/p>
&lt;p>Below is an annotated YAML file that will create a RedisInsight deployment in a K8s cluster. It will assign a peristent volume created from a volume claim template. Write access to the container is configured in an init container. When using deployments with persistent writeable volumes, it’s best to set the strategy to &lt;code>Recreate&lt;/code>. Otherwise you may find yourself with two pods trying to use the same volume.&lt;/p>
&lt;ol>
&lt;li>Create a new file &lt;code>redisinsight.yaml&lt;/code> with the content below.&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-yaml" data-lang="yaml">&lt;span class="line">&lt;span class="cl">&lt;span class="c"># RedisInsight service with name &amp;#39;redisinsight-service&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">apiVersion&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">v1&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">kind&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Service&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">metadata&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">redisinsight-service &lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c"># name should not be &amp;#39;redisinsight&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c"># since the service creates&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c"># environment variables that&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c"># conflicts with redisinsight&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c"># application&amp;#39;s environment&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c"># variables `REDISINSIGHT_HOST` and&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="c"># `REDISINSIGHT_PORT`&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">spec&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">type&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">NodePort&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">ports&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">port&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">80&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">targetPort&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">8001&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">selector&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">app&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">redisinsight&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nn">---&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">apiVersion&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">v1&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">kind&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">PersistentVolumeClaim&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">metadata&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">redisinsight-pv-claim&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">labels&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">app&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">redisinsight&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">spec&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">accessModes&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">ReadWriteOnce&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">resources&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">requests&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">storage&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">2Gi&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">storageClassName&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="s2">&amp;#34;rook-cephfs&amp;#34;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nn">---&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="c"># RedisInsight deployment with name &amp;#39;redisinsight&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">apiVersion&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">apps/v1&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">kind&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Deployment&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">metadata&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">redisinsight&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c">#deployment name&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">labels&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">app&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">redisinsight&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c">#deployment label&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w">&lt;/span>&lt;span class="nt">spec&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">replicas&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">1&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c">#a single replica pod&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">strategy&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">type&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">Recreate&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">selector&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">matchLabels&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">app&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">redisinsight&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c">#which pods is the deployment managing, as defined by the pod template&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">template&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c">#pod template&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">metadata&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">labels&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">app&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">redisinsight&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c">#label for pod/s&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">spec&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">volumes&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">db&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">persistentVolumeClaim&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">claimName&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">redisinsight-pv-claim&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">initContainers&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">init&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">image&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">busybox&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">command&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="l">/bin/sh&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="s1">&amp;#39;-c&amp;#39;&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="p">|&lt;/span>&lt;span class="sd">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="sd"> chown -R 1001 /db&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">resources&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>{}&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">volumeMounts&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">db&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">mountPath&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">/db&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">terminationMessagePath&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">/dev/termination-log&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">terminationMessagePolicy&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">File&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">containers&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">redisinsight&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c">#Container name (DNS_LABEL, unique)&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">image&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">redislabs/redisinsight:latest&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c">#repo/image&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">imagePullPolicy&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">IfNotPresent&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c">#Always pull image&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">volumeMounts&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">name&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">db&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c">#Pod volumes to mount into the container&amp;#39;s filesystem. Cannot be updated.&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">mountPath&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">/db&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">ports&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>- &lt;span class="nt">containerPort&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="m">8001&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="c">#exposed container port and protocol&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="w"> &lt;/span>&lt;span class="nt">protocol&lt;/span>&lt;span class="p">:&lt;/span>&lt;span class="w"> &lt;/span>&lt;span class="l">TCP&lt;/span>&lt;span class="w">
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;ol start="2">
&lt;li>Create the RedisInsight deployment and service.&lt;/li>
&lt;/ol>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">kubectl apply -f redisinsight.yaml
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="開網頁測試">開網頁測試&lt;/h2>
&lt;p>http://192.168.1.71:31785/&lt;/p>
&lt;h3 id="redis-cluster主機ip表">Redis Cluster主機IP表&lt;/h3>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>&lt;/th>
&lt;th>&lt;/th>
&lt;th>&lt;/th>
&lt;th>&lt;/th>
&lt;th>&lt;/th>
&lt;th>&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>主機名稱&lt;/td>
&lt;td>主機IP&lt;/td>
&lt;td>角色&lt;/td>
&lt;td>主機IP&lt;/td>
&lt;td>角色&lt;/td>
&lt;td>跟隨&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>redis01&lt;/td>
&lt;td>192.168.1.11:6379&lt;/td>
&lt;td>master&lt;/td>
&lt;td>192.168.1.11:6380&lt;/td>
&lt;td>slave&lt;/td>
&lt;td>192.168.1.12:6380&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>redis02&lt;/td>
&lt;td>192.168.1.12:6379&lt;/td>
&lt;td>master&lt;/td>
&lt;td>192.168.1.12:6380&lt;/td>
&lt;td>slave&lt;/td>
&lt;td>192.168.1.13:6380&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>redis03&lt;/td>
&lt;td>192.168.1.13:6379&lt;/td>
&lt;td>master&lt;/td>
&lt;td>192.168.1.13:6380&lt;/td>
&lt;td>slave&lt;/td>
&lt;td>192.168.1.11:6380&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>redis04&lt;/td>
&lt;td>192.168.1.14:6379&lt;/td>
&lt;td>master&lt;/td>
&lt;td>192.168.1.14:6380&lt;/td>
&lt;td>slave&lt;/td>
&lt;td>192.168.1.18:6380&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>redis05&lt;/td>
&lt;td>192.168.1.18:6379&lt;/td>
&lt;td>master&lt;/td>
&lt;td>192.168.1.18:6380&lt;/td>
&lt;td>slave&lt;/td>
&lt;td>192.168.1.14:6380&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h3 id="登入畫面">登入畫面&lt;/h3>
&lt;p>&lt;img src="https://blog.goldfishbrain-fighting.com/2023/kubernetes-redisinsight/media/Pasted-image-20231216235027.png"
width="1520"
height="894"
srcset="https://blog.goldfishbrain-fighting.com/2023/kubernetes-redisinsight/media/Pasted-image-20231216235027_hubc595a2880cfb08687aea0955beb0c64_103230_480x0_resize_box_3.png 480w, https://blog.goldfishbrain-fighting.com/2023/kubernetes-redisinsight/media/Pasted-image-20231216235027_hubc595a2880cfb08687aea0955beb0c64_103230_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="170"
data-flex-basis="408px"
>&lt;/p>
&lt;h3 id="點選add-redis-database">點選ADD REDIS DATABASE&lt;/h3>
&lt;p>&lt;img src="https://blog.goldfishbrain-fighting.com/2023/kubernetes-redisinsight/media/Pasted-image-20231216235104.png"
width="1122"
height="678"
srcset="https://blog.goldfishbrain-fighting.com/2023/kubernetes-redisinsight/media/Pasted-image-20231216235104_hu816cd84f59ec0e73557eb24ada62e87c_59820_480x0_resize_box_3.png 480w, https://blog.goldfishbrain-fighting.com/2023/kubernetes-redisinsight/media/Pasted-image-20231216235104_hu816cd84f59ec0e73557eb24ada62e87c_59820_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="165"
data-flex-basis="397px"
>&lt;/p>
&lt;h3 id="填寫其中一台redis-cluster資訊">填寫其中一台redis cluster資訊&lt;/h3>
&lt;p>&lt;img src="https://blog.goldfishbrain-fighting.com/2023/kubernetes-redisinsight/media/Pasted-image-20231216235257.png"
width="1108"
height="670"
srcset="https://blog.goldfishbrain-fighting.com/2023/kubernetes-redisinsight/media/Pasted-image-20231216235257_hu43f0193d99c61175a068e1c65da95568_50719_480x0_resize_box_3.png 480w, https://blog.goldfishbrain-fighting.com/2023/kubernetes-redisinsight/media/Pasted-image-20231216235257_hu43f0193d99c61175a068e1c65da95568_50719_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="165"
data-flex-basis="396px"
>&lt;/p>
&lt;p>偵測到為Cluster，就會幫我一同找到其他節點IP&lt;/p>
&lt;p>&lt;img src="https://blog.goldfishbrain-fighting.com/2023/kubernetes-redisinsight/media/Pasted-image-20231217000345.png"
width="1121"
height="684"
srcset="https://blog.goldfishbrain-fighting.com/2023/kubernetes-redisinsight/media/Pasted-image-20231217000345_hu000ce6b82cba0ff6fa000c7b112b8380_59384_480x0_resize_box_3.png 480w, https://blog.goldfishbrain-fighting.com/2023/kubernetes-redisinsight/media/Pasted-image-20231217000345_hu000ce6b82cba0ff6fa000c7b112b8380_59384_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="163"
data-flex-basis="393px"
>&lt;/p>
&lt;h3 id="all-masterreplica-nodes-summary">ALL MASTER、REPLICA NODES SUMMARY&lt;/h3>
&lt;p>可以看到MASTER 節點，彙整總結資訊&lt;/p>
&lt;p>&lt;img src="https://blog.goldfishbrain-fighting.com/2023/kubernetes-redisinsight/media/Pasted-image-20231217000508.png"
width="1873"
height="861"
srcset="https://blog.goldfishbrain-fighting.com/2023/kubernetes-redisinsight/media/Pasted-image-20231217000508_huc4d26850c3517e5d881b327fd6d0b9d3_161690_480x0_resize_box_3.png 480w, https://blog.goldfishbrain-fighting.com/2023/kubernetes-redisinsight/media/Pasted-image-20231217000508_huc4d26850c3517e5d881b327fd6d0b9d3_161690_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="217"
data-flex-basis="522px"
>&lt;/p>
&lt;p>也可以看到REPLICA 節點，彙整總結資訊&lt;/p>
&lt;p>&lt;img src="https://blog.goldfishbrain-fighting.com/2023/kubernetes-redisinsight/media/Pasted-image-20231217000624.png"
width="1674"
height="879"
srcset="https://blog.goldfishbrain-fighting.com/2023/kubernetes-redisinsight/media/Pasted-image-20231217000624_hua887d4c4927a02e3229116473dd8c7e0_148094_480x0_resize_box_3.png 480w, https://blog.goldfishbrain-fighting.com/2023/kubernetes-redisinsight/media/Pasted-image-20231217000624_hua887d4c4927a02e3229116473dd8c7e0_148094_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="190"
data-flex-basis="457px"
>&lt;/p>
&lt;h3 id="browserscan-key">Browser(SCAN Key）&lt;/h3>
&lt;p>可以透過此，查詢所有key及其value，也可以添加KEY&lt;/p>
&lt;p>&lt;img src="https://blog.goldfishbrain-fighting.com/2023/kubernetes-redisinsight/media/Pasted-image-20231217000755.png"
width="1915"
height="871"
srcset="https://blog.goldfishbrain-fighting.com/2023/kubernetes-redisinsight/media/Pasted-image-20231217000755_huefbff92471ed817598608ac1c241ab15_241077_480x0_resize_box_3.png 480w, https://blog.goldfishbrain-fighting.com/2023/kubernetes-redisinsight/media/Pasted-image-20231217000755_huefbff92471ed817598608ac1c241ab15_241077_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="219"
data-flex-basis="527px"
>&lt;/p>
&lt;h3 id="clicommand">CLI(COMMAND）&lt;/h3>
&lt;p>可以針對節點下REDIS指令&lt;/p>
&lt;p>&lt;img src="https://blog.goldfishbrain-fighting.com/2023/kubernetes-redisinsight/media/Pasted-image-20231217000943.png"
width="1906"
height="854"
srcset="https://blog.goldfishbrain-fighting.com/2023/kubernetes-redisinsight/media/Pasted-image-20231217000943_hucc5359ba6836c337b39835780581fb06_125044_480x0_resize_box_3.png 480w, https://blog.goldfishbrain-fighting.com/2023/kubernetes-redisinsight/media/Pasted-image-20231217000943_hucc5359ba6836c337b39835780581fb06_125044_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="223"
data-flex-basis="535px"
>&lt;/p>
&lt;p>這裡針對所有MASTER下scan 0 count 50指令&lt;/p>
&lt;p>&lt;img src="https://blog.goldfishbrain-fighting.com/2023/kubernetes-redisinsight/media/Pasted-image-20231217001038.png"
width="1912"
height="835"
srcset="https://blog.goldfishbrain-fighting.com/2023/kubernetes-redisinsight/media/Pasted-image-20231217001038_hub242481e8ad9141a8375b65511187ee3_152528_480x0_resize_box_3.png 480w, https://blog.goldfishbrain-fighting.com/2023/kubernetes-redisinsight/media/Pasted-image-20231217001038_hub242481e8ad9141a8375b65511187ee3_152528_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="228"
data-flex-basis="549px"
>&lt;/p>
&lt;p>就會針對每一台MASTER幫你下指令，並統一顯示於視窗&lt;/p>
&lt;p>&lt;img src="https://blog.goldfishbrain-fighting.com/2023/kubernetes-redisinsight/media/Pasted-image-20231217001200.png"
width="1636"
height="657"
srcset="https://blog.goldfishbrain-fighting.com/2023/kubernetes-redisinsight/media/Pasted-image-20231217001200_hu982f8309205c0bf63243849c78a5c20e_316786_480x0_resize_box_3.png 480w, https://blog.goldfishbrain-fighting.com/2023/kubernetes-redisinsight/media/Pasted-image-20231217001200_hu982f8309205c0bf63243849c78a5c20e_316786_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="249"
data-flex-basis="597px"
>&lt;/p>
&lt;p>&lt;img src="https://blog.goldfishbrain-fighting.com/2023/kubernetes-redisinsight/media/Pasted-image-20231217001215.png"
width="1663"
height="657"
srcset="https://blog.goldfishbrain-fighting.com/2023/kubernetes-redisinsight/media/Pasted-image-20231217001215_hu77f57ec20b04b6925069e5dcc67587df_316377_480x0_resize_box_3.png 480w, https://blog.goldfishbrain-fighting.com/2023/kubernetes-redisinsight/media/Pasted-image-20231217001215_hu77f57ec20b04b6925069e5dcc67587df_316377_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="253"
data-flex-basis="607px"
>&lt;/p>
&lt;h3 id="analysememory-analysis">ANALYSE(Memory Analysis)&lt;/h3>
&lt;p>可以選擇使用離線分析，也就是提供他rdb file，
或者線上分析，他會對所有redis下bgsave指令，在遠端的redis就會存下目前所有的key資訊為dump.rdb檔。&lt;/p>
&lt;p>&lt;img src="https://blog.goldfishbrain-fighting.com/2023/kubernetes-redisinsight/media/Pasted-image-20231217001720.png"
width="1354"
height="794"
srcset="https://blog.goldfishbrain-fighting.com/2023/kubernetes-redisinsight/media/Pasted-image-20231217001720_hu89b8e7b94ed341b285872504d99afd0a_140302_480x0_resize_box_3.png 480w, https://blog.goldfishbrain-fighting.com/2023/kubernetes-redisinsight/media/Pasted-image-20231217001720_hu89b8e7b94ed341b285872504d99afd0a_140302_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="170"
data-flex-basis="409px"
>&lt;/p>
&lt;h4 id="memory-overview">Memory Overview&lt;/h4>
&lt;p>&lt;img src="https://blog.goldfishbrain-fighting.com/2023/kubernetes-redisinsight/media/Pasted-image-20231217001411.png"
width="1882"
height="849"
srcset="https://blog.goldfishbrain-fighting.com/2023/kubernetes-redisinsight/media/Pasted-image-20231217001411_hub353f13bb15e8d6d47f780560c45b4ea_117088_480x0_resize_box_3.png 480w, https://blog.goldfishbrain-fighting.com/2023/kubernetes-redisinsight/media/Pasted-image-20231217001411_hub353f13bb15e8d6d47f780560c45b4ea_117088_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="221"
data-flex-basis="532px"
>&lt;/p>
&lt;p>&lt;img src="https://blog.goldfishbrain-fighting.com/2023/kubernetes-redisinsight/media/Pasted-image-20231217001423.png"
width="1874"
height="910"
srcset="https://blog.goldfishbrain-fighting.com/2023/kubernetes-redisinsight/media/Pasted-image-20231217001423_hu8a88c2f797068db404e3feb4e5eac50b_185128_480x0_resize_box_3.png 480w, https://blog.goldfishbrain-fighting.com/2023/kubernetes-redisinsight/media/Pasted-image-20231217001423_hu8a88c2f797068db404e3feb4e5eac50b_185128_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="205"
data-flex-basis="494px"
>&lt;/p>
&lt;h4 id="keyspace-summary">Keyspace Summary&lt;/h4>
&lt;p>&lt;img src="https://blog.goldfishbrain-fighting.com/2023/kubernetes-redisinsight/media/Pasted-image-20231217001438.png"
width="1919"
height="650"
srcset="https://blog.goldfishbrain-fighting.com/2023/kubernetes-redisinsight/media/Pasted-image-20231217001438_hu53ae2237005015c4c86a8e360836895c_177798_480x0_resize_box_3.png 480w, https://blog.goldfishbrain-fighting.com/2023/kubernetes-redisinsight/media/Pasted-image-20231217001438_hu53ae2237005015c4c86a8e360836895c_177798_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="295"
data-flex-basis="708px"
>&lt;/p>
&lt;h4 id="recommendations">Recommendations&lt;/h4>
&lt;p>&lt;img src="https://blog.goldfishbrain-fighting.com/2023/kubernetes-redisinsight/media/Pasted-image-20231217001500.png"
width="1347"
height="899"
srcset="https://blog.goldfishbrain-fighting.com/2023/kubernetes-redisinsight/media/Pasted-image-20231217001500_hu65a9842b606217ca1e1d2351e0fa4c16_218933_480x0_resize_box_3.png 480w, https://blog.goldfishbrain-fighting.com/2023/kubernetes-redisinsight/media/Pasted-image-20231217001500_hu65a9842b606217ca1e1d2351e0fa4c16_218933_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="149"
data-flex-basis="359px"
>&lt;/p>
&lt;h4 id="memory-analyzer">Memory Analyzer&lt;/h4>
&lt;p>&lt;img src="https://blog.goldfishbrain-fighting.com/2023/kubernetes-redisinsight/media/Pasted-image-20231217001514.png"
width="1881"
height="908"
srcset="https://blog.goldfishbrain-fighting.com/2023/kubernetes-redisinsight/media/Pasted-image-20231217001514_hua028830752b5e018d6e8bd2f94a4c129_273482_480x0_resize_box_3.png 480w, https://blog.goldfishbrain-fighting.com/2023/kubernetes-redisinsight/media/Pasted-image-20231217001514_hua028830752b5e018d6e8bd2f94a4c129_273482_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="207"
data-flex-basis="497px"
>&lt;/p>
&lt;h3 id="analyse-profilermonitor">ANALYSE Profiler(Monitor)&lt;/h3>
&lt;p>記錄當下指令執行&lt;/p>
&lt;p>&lt;img src="https://blog.goldfishbrain-fighting.com/2023/kubernetes-redisinsight/media/Pasted-image-20231217002212.png"
width="1903"
height="766"
srcset="https://blog.goldfishbrain-fighting.com/2023/kubernetes-redisinsight/media/Pasted-image-20231217002212_hu394e3ebe52a6f3c55e0006c4197c2417_127713_480x0_resize_box_3.png 480w, https://blog.goldfishbrain-fighting.com/2023/kubernetes-redisinsight/media/Pasted-image-20231217002212_hu394e3ebe52a6f3c55e0006c4197c2417_127713_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="248"
data-flex-basis="596px"
>&lt;/p>
&lt;p>&lt;img src="https://blog.goldfishbrain-fighting.com/2023/kubernetes-redisinsight/media/Pasted-image-20231217002230.png"
width="1916"
height="795"
srcset="https://blog.goldfishbrain-fighting.com/2023/kubernetes-redisinsight/media/Pasted-image-20231217002230_hu9f703c181e6a5b16f8082c8c97b36aee_114738_480x0_resize_box_3.png 480w, https://blog.goldfishbrain-fighting.com/2023/kubernetes-redisinsight/media/Pasted-image-20231217002230_hu9f703c181e6a5b16f8082c8c97b36aee_114738_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="241"
data-flex-basis="578px"
>&lt;/p>
&lt;h3 id="analyse-slowlog">ANALYSE Slowlog&lt;/h3>
&lt;p>查看目前有沒有slowlog慢日誌產生&lt;/p>
&lt;p>&lt;img src="https://blog.goldfishbrain-fighting.com/2023/kubernetes-redisinsight/media/Pasted-image-20231217002242.png"
width="1914"
height="782"
srcset="https://blog.goldfishbrain-fighting.com/2023/kubernetes-redisinsight/media/Pasted-image-20231217002242_hu5ee9039f311db725ba369211d2105819_124388_480x0_resize_box_3.png 480w, https://blog.goldfishbrain-fighting.com/2023/kubernetes-redisinsight/media/Pasted-image-20231217002242_hu5ee9039f311db725ba369211d2105819_124388_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="244"
data-flex-basis="587px"
>&lt;/p>
&lt;h3 id="bulk-actions">Bulk Actions&lt;/h3>
&lt;p>&lt;img src="https://blog.goldfishbrain-fighting.com/2023/kubernetes-redisinsight/media/Pasted-image-20231217002349.png"
width="1865"
height="771"
srcset="https://blog.goldfishbrain-fighting.com/2023/kubernetes-redisinsight/media/Pasted-image-20231217002349_hu28bcbf2c09fed4869ce237cced7d569c_118656_480x0_resize_box_3.png 480w, https://blog.goldfishbrain-fighting.com/2023/kubernetes-redisinsight/media/Pasted-image-20231217002349_hu28bcbf2c09fed4869ce237cced7d569c_118656_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="241"
data-flex-basis="580px"
>&lt;/p>
&lt;h3 id="datebase-configuration">DATEBASE Configuration&lt;/h3>
&lt;p>可以查看，並設定REDIS&lt;/p>
&lt;p>&lt;img src="https://blog.goldfishbrain-fighting.com/2023/kubernetes-redisinsight/media/Pasted-image-20231217002605.png"
width="1321"
height="920"
srcset="https://blog.goldfishbrain-fighting.com/2023/kubernetes-redisinsight/media/Pasted-image-20231217002605_hu72f2db596c7d1961a33efee3e1ceb93b_155110_480x0_resize_box_3.png 480w, https://blog.goldfishbrain-fighting.com/2023/kubernetes-redisinsight/media/Pasted-image-20231217002605_hu72f2db596c7d1961a33efee3e1ceb93b_155110_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="143"
data-flex-basis="344px"
>&lt;/p>
&lt;h3 id="datebase-cluster-management">DATEBASE Cluster Management&lt;/h3>
&lt;p>可以管理Cluster&lt;/p>
&lt;p>&lt;img src="https://blog.goldfishbrain-fighting.com/2023/kubernetes-redisinsight/media/Pasted-image-20231217002652.png"
width="1528"
height="758"
srcset="https://blog.goldfishbrain-fighting.com/2023/kubernetes-redisinsight/media/Pasted-image-20231217002652_hucbe0daba715cf90120a1dfcdefcbafed_144547_480x0_resize_box_3.png 480w, https://blog.goldfishbrain-fighting.com/2023/kubernetes-redisinsight/media/Pasted-image-20231217002652_hucbe0daba715cf90120a1dfcdefcbafed_144547_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="201"
data-flex-basis="483px"
>&lt;/p>
&lt;h3 id="datebase-client-list">DATEBASE Client List&lt;/h3>
&lt;p>可以看到目前連接的客戶端資訊&lt;/p>
&lt;p>&lt;img src="https://blog.goldfishbrain-fighting.com/2023/kubernetes-redisinsight/media/Pasted-image-20231217002741.png"
width="1119"
height="912"
srcset="https://blog.goldfishbrain-fighting.com/2023/kubernetes-redisinsight/media/Pasted-image-20231217002741_hu4e64c5dd0c1ff4561f2410ddd39bf1fb_224268_480x0_resize_box_3.png 480w, https://blog.goldfishbrain-fighting.com/2023/kubernetes-redisinsight/media/Pasted-image-20231217002741_hu4e64c5dd0c1ff4561f2410ddd39bf1fb_224268_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="122"
data-flex-basis="294px"
>&lt;/p></description></item><item><title>Redis Cluster 資料移轉，從一個cluster遷移所有分片數據到另一個cluster</title><link>https://blog.goldfishbrain-fighting.com/2023/redis-cluster-database-transfer/</link><pubDate>Sat, 16 Dec 2023 23:43:00 +0800</pubDate><guid>https://blog.goldfishbrain-fighting.com/2023/redis-cluster-database-transfer/</guid><description>&lt;h2 id="redis-cluster來源主機ip表">Redis Cluster來源主機IP表&lt;/h2>
&lt;p>&lt;img src="https://blog.goldfishbrain-fighting.com/2023/redis-cluster-database-transfer/media/Pasted-image-20231217005056.png"
width="668"
height="1011"
srcset="https://blog.goldfishbrain-fighting.com/2023/redis-cluster-database-transfer/media/Pasted-image-20231217005056_hu970dfcb3f0cf2fdac96614a15315f26c_135448_480x0_resize_box_3.png 480w, https://blog.goldfishbrain-fighting.com/2023/redis-cluster-database-transfer/media/Pasted-image-20231217005056_hu970dfcb3f0cf2fdac96614a15315f26c_135448_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="66"
data-flex-basis="158px"
>&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>&lt;/th>
&lt;th>&lt;/th>
&lt;th>&lt;/th>
&lt;th>&lt;/th>
&lt;th>&lt;/th>
&lt;th>&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>主機名稱&lt;/td>
&lt;td>主機IP&lt;/td>
&lt;td>角色&lt;/td>
&lt;td>主機IP&lt;/td>
&lt;td>角色&lt;/td>
&lt;td>跟隨&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>redis91&lt;/td>
&lt;td>192.168.1.91:6379&lt;/td>
&lt;td>master&lt;/td>
&lt;td>192.168.1.91:6380&lt;/td>
&lt;td>slave&lt;/td>
&lt;td>192.168.1.92:6380&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>redis92&lt;/td>
&lt;td>192.168.1.92:6379&lt;/td>
&lt;td>master&lt;/td>
&lt;td>192.168.1.92:6380&lt;/td>
&lt;td>slave&lt;/td>
&lt;td>192.168.1.93:6380&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>redis93&lt;/td>
&lt;td>192.168.1.93:6379&lt;/td>
&lt;td>master&lt;/td>
&lt;td>192.168.1.93:6380&lt;/td>
&lt;td>slave&lt;/td>
&lt;td>192.168.1.91:6380&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>redis94&lt;/td>
&lt;td>192.168.1.94:6379&lt;/td>
&lt;td>master&lt;/td>
&lt;td>192.168.1.94:6380&lt;/td>
&lt;td>slave&lt;/td>
&lt;td>192.168.1.98:6380&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>redis98&lt;/td>
&lt;td>192.168.1.98:6379&lt;/td>
&lt;td>master&lt;/td>
&lt;td>192.168.1.98:6380&lt;/td>
&lt;td>slave&lt;/td>
&lt;td>192.168.1.94:6380&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h2 id="redis-cluster目的主機ip表">Redis Cluster目的主機IP表&lt;/h2>
&lt;p>&lt;img src="https://blog.goldfishbrain-fighting.com/2023/redis-cluster-database-transfer/media/Pasted-image-20231217005115.png"
width="668"
height="1011"
srcset="https://blog.goldfishbrain-fighting.com/2023/redis-cluster-database-transfer/media/Pasted-image-20231217005115_hua47f22cd06286ccf2b27f50d9b902ee1_132470_480x0_resize_box_3.png 480w, https://blog.goldfishbrain-fighting.com/2023/redis-cluster-database-transfer/media/Pasted-image-20231217005115_hua47f22cd06286ccf2b27f50d9b902ee1_132470_1024x0_resize_box_3.png 1024w"
loading="lazy"
class="gallery-image"
data-flex-grow="66"
data-flex-basis="158px"
>&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>&lt;/th>
&lt;th>&lt;/th>
&lt;th>&lt;/th>
&lt;th>&lt;/th>
&lt;th>&lt;/th>
&lt;th>&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>主機名稱&lt;/td>
&lt;td>主機IP&lt;/td>
&lt;td>角色&lt;/td>
&lt;td>主機IP&lt;/td>
&lt;td>角色&lt;/td>
&lt;td>跟隨&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>redis01&lt;/td>
&lt;td>192.168.1.11:6379&lt;/td>
&lt;td>master&lt;/td>
&lt;td>192.168.1.11:6380&lt;/td>
&lt;td>slave&lt;/td>
&lt;td>192.168.1.12:6380&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>redis02&lt;/td>
&lt;td>192.168.1.12:6379&lt;/td>
&lt;td>master&lt;/td>
&lt;td>192.168.1.12:6380&lt;/td>
&lt;td>slave&lt;/td>
&lt;td>192.168.1.13:6380&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>redis03&lt;/td>
&lt;td>192.168.1.13:6379&lt;/td>
&lt;td>master&lt;/td>
&lt;td>192.168.1.13:6380&lt;/td>
&lt;td>slave&lt;/td>
&lt;td>192.168.1.11:6380&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>redis04&lt;/td>
&lt;td>192.168.1.14:6379&lt;/td>
&lt;td>master&lt;/td>
&lt;td>192.168.1.14:6380&lt;/td>
&lt;td>slave&lt;/td>
&lt;td>192.168.1.18:6380&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>redis05&lt;/td>
&lt;td>192.168.1.18:6379&lt;/td>
&lt;td>master&lt;/td>
&lt;td>192.168.1.18:6380&lt;/td>
&lt;td>slave&lt;/td>
&lt;td>192.168.1.14:6380&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;h2 id="實現目的與流程">實現目的與流程&lt;/h2>
&lt;ol>
&lt;li>從來源5台master使用bgsave指令，產生各master的數據檔案dump.rdb，共會產生5個dump.rdb檔&lt;/li>
&lt;li>將來源dump.rdb檔案傳送至目的5台master的redis工作目錄下，覆蓋原dump.rdb檔&lt;/li>
&lt;li>一台一台重啟redis服務&lt;/li>
&lt;li>重啟一台redis服務，就檢查一次數據恢復狀況(&amp;ndash;cluster check)，並修復(&amp;ndash;cluster fix)&lt;/li>
&lt;li>確定檢查正常，再執行下一台redis服務重啟&lt;/li>
&lt;li>直到5台都執行完畢，確認數據全部還原至目的集群&lt;/li>
&lt;/ol>
&lt;p>&lt;font color=red>注意：以上流程，一定要一台一台來執行，不能一次全部重啟redis服務&lt;/font>&lt;/p>
&lt;h2 id="目的cluser建置">目的cluser建置&lt;/h2>
&lt;h3 id="master-cluster集群創建master">master cluster集群創建(master)&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@redis01 redis&lt;span class="o">]&lt;/span>&lt;span class="c1"># redis-cli --user 帳號 --pass 密碼 --cluster create 192.168.1.11:6379 192.168.1.12:6379 192.168.1.13:6379 192.168.1.14:6379 192.168.1.18:6379&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Warning: Using a password with &lt;span class="s1">&amp;#39;-a&amp;#39;&lt;/span> or &lt;span class="s1">&amp;#39;-u&amp;#39;&lt;/span> option on the &lt;span class="nb">command&lt;/span> line interface may not be safe.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;gt;&amp;gt;&amp;gt; Performing &lt;span class="nb">hash&lt;/span> slots allocation on &lt;span class="m">5&lt;/span> nodes...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Master&lt;span class="o">[&lt;/span>0&lt;span class="o">]&lt;/span> -&amp;gt; Slots &lt;span class="m">0&lt;/span> - &lt;span class="m">3276&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Master&lt;span class="o">[&lt;/span>1&lt;span class="o">]&lt;/span> -&amp;gt; Slots &lt;span class="m">3277&lt;/span> - &lt;span class="m">6553&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Master&lt;span class="o">[&lt;/span>2&lt;span class="o">]&lt;/span> -&amp;gt; Slots &lt;span class="m">6554&lt;/span> - &lt;span class="m">9829&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Master&lt;span class="o">[&lt;/span>3&lt;span class="o">]&lt;/span> -&amp;gt; Slots &lt;span class="m">9830&lt;/span> - &lt;span class="m">13106&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Master&lt;span class="o">[&lt;/span>4&lt;span class="o">]&lt;/span> -&amp;gt; Slots &lt;span class="m">13107&lt;/span> - &lt;span class="m">16383&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">M: 216fa2035f19dbf88e5e6ab709861ba11b1705de 192.168.1.11:6379
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slots:&lt;span class="o">[&lt;/span>0-3276&lt;span class="o">]&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="m">3277&lt;/span> slots&lt;span class="o">)&lt;/span> master
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">M: 00bbea618be49cb6ce38b1371b3cf57fea59f557 192.168.1.12:6379
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slots:&lt;span class="o">[&lt;/span>3277-6553&lt;span class="o">]&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="m">3277&lt;/span> slots&lt;span class="o">)&lt;/span> master
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">M: 980e3f5cbfc7739ded0ed08d60127888d7593e25 192.168.1.13:6379
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slots:&lt;span class="o">[&lt;/span>6554-9829&lt;span class="o">]&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="m">3276&lt;/span> slots&lt;span class="o">)&lt;/span> master
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">M: 6637e3135cfa345bc155d39fa07718882e9b5bf8 192.168.1.14:6379
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slots:&lt;span class="o">[&lt;/span>9830-13106&lt;span class="o">]&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="m">3277&lt;/span> slots&lt;span class="o">)&lt;/span> master
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">M: 059bda64ea1e49e38ef833ed9e997cffd7dff0c5 192.168.1.18:6379
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slots:&lt;span class="o">[&lt;/span>13107-16383&lt;span class="o">]&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="m">3277&lt;/span> slots&lt;span class="o">)&lt;/span> master
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Can I &lt;span class="nb">set&lt;/span> the above configuration? &lt;span class="o">(&lt;/span>&lt;span class="nb">type&lt;/span> &lt;span class="s1">&amp;#39;yes&amp;#39;&lt;/span> to accept&lt;span class="o">)&lt;/span>: yes
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;gt;&amp;gt;&amp;gt; Nodes configuration updated
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;gt;&amp;gt;&amp;gt; Assign a different config epoch to each node
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;gt;&amp;gt;&amp;gt; Sending CLUSTER MEET messages to join the cluster
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Waiting &lt;span class="k">for&lt;/span> the cluster to join
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;gt;&amp;gt;&amp;gt; Performing Cluster Check &lt;span class="o">(&lt;/span>using node 192.168.1.11:6379&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">M: 216fa2035f19dbf88e5e6ab709861ba11b1705de 192.168.1.11:6379
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slots:&lt;span class="o">[&lt;/span>0-3276&lt;span class="o">]&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="m">3277&lt;/span> slots&lt;span class="o">)&lt;/span> master
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">M: 00bbea618be49cb6ce38b1371b3cf57fea59f557 192.168.1.12:6379
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slots:&lt;span class="o">[&lt;/span>3277-6553&lt;span class="o">]&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="m">3277&lt;/span> slots&lt;span class="o">)&lt;/span> master
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">M: 980e3f5cbfc7739ded0ed08d60127888d7593e25 192.168.1.13:6379
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slots:&lt;span class="o">[&lt;/span>6554-9829&lt;span class="o">]&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="m">3276&lt;/span> slots&lt;span class="o">)&lt;/span> master
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">M: 059bda64ea1e49e38ef833ed9e997cffd7dff0c5 192.168.1.18:6379
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slots:&lt;span class="o">[&lt;/span>13107-16383&lt;span class="o">]&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="m">3277&lt;/span> slots&lt;span class="o">)&lt;/span> master
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">M: 6637e3135cfa345bc155d39fa07718882e9b5bf8 192.168.1.14:6379
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slots:&lt;span class="o">[&lt;/span>9830-13106&lt;span class="o">]&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="m">3277&lt;/span> slots&lt;span class="o">)&lt;/span> master
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>OK&lt;span class="o">]&lt;/span> All nodes agree about slots configuration.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;gt;&amp;gt;&amp;gt; Check &lt;span class="k">for&lt;/span> open slots...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;gt;&amp;gt;&amp;gt; Check slots coverage...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>OK&lt;span class="o">]&lt;/span> All &lt;span class="m">16384&lt;/span> slots covered.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@redis01 redis&lt;span class="o">]&lt;/span>&lt;span class="c1"># redis-cli -c&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">127.0.0.1:6379&amp;gt; auth 帳號 密碼
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">OK
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">127.0.0.1:6379&amp;gt; CLUSTER info
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">cluster_state:ok
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">cluster_slots_assigned:16384
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">cluster_slots_ok:16384
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">cluster_slots_pfail:0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">cluster_slots_fail:0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">cluster_known_nodes:5
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">cluster_size:5
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">cluster_current_epoch:5
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">cluster_my_epoch:1
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">cluster_stats_messages_ping_sent:85
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">cluster_stats_messages_pong_sent:92
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">cluster_stats_messages_sent:177
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">cluster_stats_messages_ping_received:88
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">cluster_stats_messages_pong_received:85
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">cluster_stats_messages_meet_received:4
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">cluster_stats_messages_received:177
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">127.0.0.1:6379&amp;gt; CLUSTER NODES
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">00bbea618be49cb6ce38b1371b3cf57fea59f557 192.168.1.12:6379@16379 master - &lt;span class="m">0&lt;/span> &lt;span class="m">1702735779504&lt;/span> &lt;span class="m">2&lt;/span> connected 3277-6553
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">980e3f5cbfc7739ded0ed08d60127888d7593e25 192.168.1.13:6379@16379 master - &lt;span class="m">0&lt;/span> &lt;span class="m">1702735780000&lt;/span> &lt;span class="m">3&lt;/span> connected 6554-9829
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">059bda64ea1e49e38ef833ed9e997cffd7dff0c5 192.168.1.18:6379@16379 master - &lt;span class="m">0&lt;/span> &lt;span class="m">1702735778502&lt;/span> &lt;span class="m">5&lt;/span> connected 13107-16383
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">216fa2035f19dbf88e5e6ab709861ba11b1705de 192.168.1.11:6379@16379 myself,master - &lt;span class="m">0&lt;/span> &lt;span class="m">1702735779000&lt;/span> &lt;span class="m">1&lt;/span> connected 0-3276
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">6637e3135cfa345bc155d39fa07718882e9b5bf8 192.168.1.14:6379@16379 master - &lt;span class="m">0&lt;/span> &lt;span class="m">1702735780506&lt;/span> &lt;span class="m">4&lt;/span> connected 9830-13106
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="master-cluster集群創建slave加入">master cluster集群創建(slave加入)&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">redis-cli --user 帳號 --pass 密碼 --cluster add-node --cluster-slave --cluster-master-id 216fa2035f19dbf88e5e6ab709861ba11b1705de 192.168.1.12:6380 192.168.1.11:6379
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">redis-cli --user 帳號 --pass 密碼 --cluster add-node --cluster-slave --cluster-master-id 00bbea618be49cb6ce38b1371b3cf57fea59f557 192.168.1.13:6380 192.168.1.12:6379
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">redis-cli --user 帳號 --pass 密碼 --cluster add-node --cluster-slave --cluster-master-id 980e3f5cbfc7739ded0ed08d60127888d7593e25 192.168.1.11:6380 192.168.1.13:6379
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">redis-cli --user 帳號 --pass 密碼 --cluster add-node --cluster-slave --cluster-master-id 6637e3135cfa345bc155d39fa07718882e9b5bf8 192.168.1.18:6380 192.168.1.14:6379
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">redis-cli --user 帳號 --pass 密碼 --cluster add-node --cluster-slave --cluster-master-id 059bda64ea1e49e38ef833ed9e997cffd7dff0c5 192.168.1.14:6380 192.168.1.18:6379
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="檢查集群狀況">檢查集群狀況&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@redis01 redis&lt;span class="o">]&lt;/span>&lt;span class="c1"># redis-cli --user 帳號 --pass 密碼 --cluster check 192.168.1.11:6379&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Warning: Using a password with &lt;span class="s1">&amp;#39;-a&amp;#39;&lt;/span> or &lt;span class="s1">&amp;#39;-u&amp;#39;&lt;/span> option on the &lt;span class="nb">command&lt;/span> line interface may not be safe.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">192.168.1.11:6379 &lt;span class="o">(&lt;/span>216fa203...&lt;span class="o">)&lt;/span> -&amp;gt; &lt;span class="m">0&lt;/span> keys &lt;span class="p">|&lt;/span> &lt;span class="m">3277&lt;/span> slots &lt;span class="p">|&lt;/span> &lt;span class="m">1&lt;/span> slaves.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">192.168.1.18:6379 &lt;span class="o">(&lt;/span>059bda64...&lt;span class="o">)&lt;/span> -&amp;gt; &lt;span class="m">0&lt;/span> keys &lt;span class="p">|&lt;/span> &lt;span class="m">3277&lt;/span> slots &lt;span class="p">|&lt;/span> &lt;span class="m">1&lt;/span> slaves.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">192.168.1.12:6379 &lt;span class="o">(&lt;/span>00bbea61...&lt;span class="o">)&lt;/span> -&amp;gt; &lt;span class="m">0&lt;/span> keys &lt;span class="p">|&lt;/span> &lt;span class="m">3277&lt;/span> slots &lt;span class="p">|&lt;/span> &lt;span class="m">1&lt;/span> slaves.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">192.168.1.13:6379 &lt;span class="o">(&lt;/span>980e3f5c...&lt;span class="o">)&lt;/span> -&amp;gt; &lt;span class="m">0&lt;/span> keys &lt;span class="p">|&lt;/span> &lt;span class="m">3276&lt;/span> slots &lt;span class="p">|&lt;/span> &lt;span class="m">1&lt;/span> slaves.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">192.168.1.14:6379 &lt;span class="o">(&lt;/span>6637e313...&lt;span class="o">)&lt;/span> -&amp;gt; &lt;span class="m">0&lt;/span> keys &lt;span class="p">|&lt;/span> &lt;span class="m">3277&lt;/span> slots &lt;span class="p">|&lt;/span> &lt;span class="m">1&lt;/span> slaves.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>OK&lt;span class="o">]&lt;/span> &lt;span class="m">0&lt;/span> keys in &lt;span class="m">5&lt;/span> masters.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">0.00 keys per slot on average.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;gt;&amp;gt;&amp;gt; Performing Cluster Check &lt;span class="o">(&lt;/span>using node 192.168.1.11:6379&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">M: 216fa2035f19dbf88e5e6ab709861ba11b1705de 192.168.1.11:6379
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slots:&lt;span class="o">[&lt;/span>0-3276&lt;span class="o">]&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="m">3277&lt;/span> slots&lt;span class="o">)&lt;/span> master
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="m">1&lt;/span> additional replica&lt;span class="o">(&lt;/span>s&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">M: 059bda64ea1e49e38ef833ed9e997cffd7dff0c5 192.168.1.18:6379
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slots:&lt;span class="o">[&lt;/span>13107-16383&lt;span class="o">]&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="m">3277&lt;/span> slots&lt;span class="o">)&lt;/span> master
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="m">1&lt;/span> additional replica&lt;span class="o">(&lt;/span>s&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">S: a6b58413201cc43612df257da40992c0ce6a3510 192.168.1.13:6380
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slots: &lt;span class="o">(&lt;/span>&lt;span class="m">0&lt;/span> slots&lt;span class="o">)&lt;/span> slave
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> replicates 00bbea618be49cb6ce38b1371b3cf57fea59f557
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">S: 6076d42c63dfd435f784391f871d101c3d1a7aa5 192.168.1.11:6380
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slots: &lt;span class="o">(&lt;/span>&lt;span class="m">0&lt;/span> slots&lt;span class="o">)&lt;/span> slave
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> replicates 980e3f5cbfc7739ded0ed08d60127888d7593e25
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">M: 00bbea618be49cb6ce38b1371b3cf57fea59f557 192.168.1.12:6379
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slots:&lt;span class="o">[&lt;/span>3277-6553&lt;span class="o">]&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="m">3277&lt;/span> slots&lt;span class="o">)&lt;/span> master
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="m">1&lt;/span> additional replica&lt;span class="o">(&lt;/span>s&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">M: 980e3f5cbfc7739ded0ed08d60127888d7593e25 192.168.1.13:6379
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slots:&lt;span class="o">[&lt;/span>6554-9829&lt;span class="o">]&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="m">3276&lt;/span> slots&lt;span class="o">)&lt;/span> master
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="m">1&lt;/span> additional replica&lt;span class="o">(&lt;/span>s&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">S: 915d7535fc4ebe9853ad2ee5fb9033b549b5a5cb 192.168.1.18:6380
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slots: &lt;span class="o">(&lt;/span>&lt;span class="m">0&lt;/span> slots&lt;span class="o">)&lt;/span> slave
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> replicates 6637e3135cfa345bc155d39fa07718882e9b5bf8
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">S: aed68c3aa851fdcab4d691b02a2a941b39d43ab5 192.168.1.14:6380
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slots: &lt;span class="o">(&lt;/span>&lt;span class="m">0&lt;/span> slots&lt;span class="o">)&lt;/span> slave
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> replicates 059bda64ea1e49e38ef833ed9e997cffd7dff0c5
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">M: 6637e3135cfa345bc155d39fa07718882e9b5bf8 192.168.1.14:6379
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slots:&lt;span class="o">[&lt;/span>9830-13106&lt;span class="o">]&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="m">3277&lt;/span> slots&lt;span class="o">)&lt;/span> master
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="m">1&lt;/span> additional replica&lt;span class="o">(&lt;/span>s&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">S: 61d58f3e445d8d5398221d22bc358c65a189faf4 192.168.1.12:6380
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slots: &lt;span class="o">(&lt;/span>&lt;span class="m">0&lt;/span> slots&lt;span class="o">)&lt;/span> slave
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> replicates 216fa2035f19dbf88e5e6ab709861ba11b1705de
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>OK&lt;span class="o">]&lt;/span> All nodes agree about slots configuration.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;gt;&amp;gt;&amp;gt; Check &lt;span class="k">for&lt;/span> open slots...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;gt;&amp;gt;&amp;gt; Check slots coverage...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>OK&lt;span class="o">]&lt;/span> All &lt;span class="m">16384&lt;/span> slots covered.
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="load來源dumprdb檔重啟redis服務">Load來源dump.rdb檔，重啟Redis服務&lt;/h2>
&lt;h3 id="第一台redis011921681116379">第一台redis01(192.168.1.11:6379)&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@redis01 redis&lt;span class="o">]&lt;/span>&lt;span class="c1"># systemctl restart redis&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@redis01 redis&lt;span class="o">]&lt;/span>&lt;span class="c1"># systemctl status redis&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>執行&amp;ndash;cluster fix，
執行&amp;ndash;cluster check，最後面要沒報錯才OK&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@redis01 redis&lt;span class="o">]&lt;/span>&lt;span class="c1"># redis-cli --user 帳號 --pass 密碼 --cluster fix 192.168.1.11:6379&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@redis01 redis&lt;span class="o">]&lt;/span>&lt;span class="c1"># redis-cli --user 帳號 --pass 密碼 --cluster check 192.168.1.11:6379&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Warning: Using a password with &lt;span class="s1">&amp;#39;-a&amp;#39;&lt;/span> or &lt;span class="s1">&amp;#39;-u&amp;#39;&lt;/span> option on the &lt;span class="nb">command&lt;/span> line interface may not be safe.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">192.168.1.11:6379 &lt;span class="o">(&lt;/span>216fa203...&lt;span class="o">)&lt;/span> -&amp;gt; &lt;span class="m">435929&lt;/span> keys &lt;span class="p">|&lt;/span> &lt;span class="m">4096&lt;/span> slots &lt;span class="p">|&lt;/span> &lt;span class="m">1&lt;/span> slaves.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">192.168.1.12:6379 &lt;span class="o">(&lt;/span>00bbea61...&lt;span class="o">)&lt;/span> -&amp;gt; &lt;span class="m">0&lt;/span> keys &lt;span class="p">|&lt;/span> &lt;span class="m">2458&lt;/span> slots &lt;span class="p">|&lt;/span> &lt;span class="m">1&lt;/span> slaves.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">192.168.1.14:6379 &lt;span class="o">(&lt;/span>6637e313...&lt;span class="o">)&lt;/span> -&amp;gt; &lt;span class="m">0&lt;/span> keys &lt;span class="p">|&lt;/span> &lt;span class="m">3277&lt;/span> slots &lt;span class="p">|&lt;/span> &lt;span class="m">1&lt;/span> slaves.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">192.168.1.13:6379 &lt;span class="o">(&lt;/span>980e3f5c...&lt;span class="o">)&lt;/span> -&amp;gt; &lt;span class="m">0&lt;/span> keys &lt;span class="p">|&lt;/span> &lt;span class="m">3276&lt;/span> slots &lt;span class="p">|&lt;/span> &lt;span class="m">1&lt;/span> slaves.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">192.168.1.18:6379 &lt;span class="o">(&lt;/span>059bda64...&lt;span class="o">)&lt;/span> -&amp;gt; &lt;span class="m">0&lt;/span> keys &lt;span class="p">|&lt;/span> &lt;span class="m">3277&lt;/span> slots &lt;span class="p">|&lt;/span> &lt;span class="m">1&lt;/span> slaves.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>OK&lt;span class="o">]&lt;/span> &lt;span class="m">435929&lt;/span> keys in &lt;span class="m">5&lt;/span> masters.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">26.61 keys per slot on average.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;gt;&amp;gt;&amp;gt; Performing Cluster Check &lt;span class="o">(&lt;/span>using node 192.168.1.11:6379&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">M: 216fa2035f19dbf88e5e6ab709861ba11b1705de 192.168.1.11:6379
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slots:&lt;span class="o">[&lt;/span>0-4095&lt;span class="o">]&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="m">4096&lt;/span> slots&lt;span class="o">)&lt;/span> master
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="m">1&lt;/span> additional replica&lt;span class="o">(&lt;/span>s&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">S: 61d58f3e445d8d5398221d22bc358c65a189faf4 192.168.1.12:6380
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slots: &lt;span class="o">(&lt;/span>&lt;span class="m">0&lt;/span> slots&lt;span class="o">)&lt;/span> slave
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> replicates 216fa2035f19dbf88e5e6ab709861ba11b1705de
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">S: 6076d42c63dfd435f784391f871d101c3d1a7aa5 192.168.1.11:6380
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slots: &lt;span class="o">(&lt;/span>&lt;span class="m">0&lt;/span> slots&lt;span class="o">)&lt;/span> slave
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> replicates 980e3f5cbfc7739ded0ed08d60127888d7593e25
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">S: 915d7535fc4ebe9853ad2ee5fb9033b549b5a5cb 192.168.1.18:6380
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slots: &lt;span class="o">(&lt;/span>&lt;span class="m">0&lt;/span> slots&lt;span class="o">)&lt;/span> slave
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> replicates 6637e3135cfa345bc155d39fa07718882e9b5bf8
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">M: 00bbea618be49cb6ce38b1371b3cf57fea59f557 192.168.1.12:6379
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slots:&lt;span class="o">[&lt;/span>4096-6553&lt;span class="o">]&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="m">2458&lt;/span> slots&lt;span class="o">)&lt;/span> master
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="m">1&lt;/span> additional replica&lt;span class="o">(&lt;/span>s&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">S: a6b58413201cc43612df257da40992c0ce6a3510 192.168.1.13:6380
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slots: &lt;span class="o">(&lt;/span>&lt;span class="m">0&lt;/span> slots&lt;span class="o">)&lt;/span> slave
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> replicates 00bbea618be49cb6ce38b1371b3cf57fea59f557
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">M: 6637e3135cfa345bc155d39fa07718882e9b5bf8 192.168.1.14:6379
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slots:&lt;span class="o">[&lt;/span>9830-13106&lt;span class="o">]&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="m">3277&lt;/span> slots&lt;span class="o">)&lt;/span> master
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="m">1&lt;/span> additional replica&lt;span class="o">(&lt;/span>s&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">M: 980e3f5cbfc7739ded0ed08d60127888d7593e25 192.168.1.13:6379
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slots:&lt;span class="o">[&lt;/span>6554-9829&lt;span class="o">]&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="m">3276&lt;/span> slots&lt;span class="o">)&lt;/span> master
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="m">1&lt;/span> additional replica&lt;span class="o">(&lt;/span>s&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">M: 059bda64ea1e49e38ef833ed9e997cffd7dff0c5 192.168.1.18:6379
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slots:&lt;span class="o">[&lt;/span>13107-16383&lt;span class="o">]&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="m">3277&lt;/span> slots&lt;span class="o">)&lt;/span> master
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="m">1&lt;/span> additional replica&lt;span class="o">(&lt;/span>s&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">S: aed68c3aa851fdcab4d691b02a2a941b39d43ab5 192.168.1.14:6380
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slots: &lt;span class="o">(&lt;/span>&lt;span class="m">0&lt;/span> slots&lt;span class="o">)&lt;/span> slave
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> replicates 059bda64ea1e49e38ef833ed9e997cffd7dff0c5
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>OK&lt;span class="o">]&lt;/span> All nodes agree about slots configuration.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;gt;&amp;gt;&amp;gt; Check &lt;span class="k">for&lt;/span> open slots...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;gt;&amp;gt;&amp;gt; Check slots coverage...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>OK&lt;span class="o">]&lt;/span> All &lt;span class="m">16384&lt;/span> slots covered.
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="第二台redis021921681126379">第二台redis02(192.168.1.12:6379)&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@redis02 redis&lt;span class="o">]&lt;/span>&lt;span class="c1"># systemctl restart redis&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@redis02 redis&lt;span class="o">]&lt;/span>&lt;span class="c1"># systemctl status redis&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>執行&amp;ndash;cluster fix，
執行&amp;ndash;cluster check，最後面要沒報錯才OK&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@redis01 redis&lt;span class="o">]&lt;/span>&lt;span class="c1"># redis-cli --user 帳號 --pass 密碼 --cluster fix 192.168.1.12:6379&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@redis01 redis&lt;span class="o">]&lt;/span>&lt;span class="c1"># redis-cli --user 帳號 --pass 密碼 --cluster check 192.168.1.12:6379&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Warning: Using a password with &lt;span class="s1">&amp;#39;-a&amp;#39;&lt;/span> or &lt;span class="s1">&amp;#39;-u&amp;#39;&lt;/span> option on the &lt;span class="nb">command&lt;/span> line interface may not be safe.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">192.168.1.12:6379 &lt;span class="o">(&lt;/span>00bbea61...&lt;span class="o">)&lt;/span> -&amp;gt; &lt;span class="m">436657&lt;/span> keys &lt;span class="p">|&lt;/span> &lt;span class="m">4096&lt;/span> slots &lt;span class="p">|&lt;/span> &lt;span class="m">1&lt;/span> slaves.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">192.168.1.14:6379 &lt;span class="o">(&lt;/span>6637e313...&lt;span class="o">)&lt;/span> -&amp;gt; &lt;span class="m">0&lt;/span> keys &lt;span class="p">|&lt;/span> &lt;span class="m">3277&lt;/span> slots &lt;span class="p">|&lt;/span> &lt;span class="m">1&lt;/span> slaves.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">192.168.1.18:6379 &lt;span class="o">(&lt;/span>059bda64...&lt;span class="o">)&lt;/span> -&amp;gt; &lt;span class="m">0&lt;/span> keys &lt;span class="p">|&lt;/span> &lt;span class="m">3277&lt;/span> slots &lt;span class="p">|&lt;/span> &lt;span class="m">1&lt;/span> slaves.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">192.168.1.11:6379 &lt;span class="o">(&lt;/span>216fa203...&lt;span class="o">)&lt;/span> -&amp;gt; &lt;span class="m">435928&lt;/span> keys &lt;span class="p">|&lt;/span> &lt;span class="m">4096&lt;/span> slots &lt;span class="p">|&lt;/span> &lt;span class="m">1&lt;/span> slaves.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">192.168.1.13:6379 &lt;span class="o">(&lt;/span>980e3f5c...&lt;span class="o">)&lt;/span> -&amp;gt; &lt;span class="m">0&lt;/span> keys &lt;span class="p">|&lt;/span> &lt;span class="m">1638&lt;/span> slots &lt;span class="p">|&lt;/span> &lt;span class="m">1&lt;/span> slaves.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>OK&lt;span class="o">]&lt;/span> &lt;span class="m">872585&lt;/span> keys in &lt;span class="m">5&lt;/span> masters.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">53.26 keys per slot on average.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;gt;&amp;gt;&amp;gt; Performing Cluster Check &lt;span class="o">(&lt;/span>using node 192.168.1.12:6379&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">M: 00bbea618be49cb6ce38b1371b3cf57fea59f557 192.168.1.12:6379
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slots:&lt;span class="o">[&lt;/span>4096-8191&lt;span class="o">]&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="m">4096&lt;/span> slots&lt;span class="o">)&lt;/span> master
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="m">1&lt;/span> additional replica&lt;span class="o">(&lt;/span>s&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">M: 6637e3135cfa345bc155d39fa07718882e9b5bf8 192.168.1.14:6379
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slots:&lt;span class="o">[&lt;/span>9830-13106&lt;span class="o">]&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="m">3277&lt;/span> slots&lt;span class="o">)&lt;/span> master
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="m">1&lt;/span> additional replica&lt;span class="o">(&lt;/span>s&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">M: 059bda64ea1e49e38ef833ed9e997cffd7dff0c5 192.168.1.18:6379
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slots:&lt;span class="o">[&lt;/span>13107-16383&lt;span class="o">]&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="m">3277&lt;/span> slots&lt;span class="o">)&lt;/span> master
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="m">1&lt;/span> additional replica&lt;span class="o">(&lt;/span>s&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">S: 61d58f3e445d8d5398221d22bc358c65a189faf4 192.168.1.12:6380
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slots: &lt;span class="o">(&lt;/span>&lt;span class="m">0&lt;/span> slots&lt;span class="o">)&lt;/span> slave
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> replicates 216fa2035f19dbf88e5e6ab709861ba11b1705de
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">M: 216fa2035f19dbf88e5e6ab709861ba11b1705de 192.168.1.11:6379
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slots:&lt;span class="o">[&lt;/span>0-4095&lt;span class="o">]&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="m">4096&lt;/span> slots&lt;span class="o">)&lt;/span> master
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="m">1&lt;/span> additional replica&lt;span class="o">(&lt;/span>s&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">M: 980e3f5cbfc7739ded0ed08d60127888d7593e25 192.168.1.13:6379
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slots:&lt;span class="o">[&lt;/span>8192-9829&lt;span class="o">]&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="m">1638&lt;/span> slots&lt;span class="o">)&lt;/span> master
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="m">1&lt;/span> additional replica&lt;span class="o">(&lt;/span>s&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">S: 6076d42c63dfd435f784391f871d101c3d1a7aa5 192.168.1.11:6380
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slots: &lt;span class="o">(&lt;/span>&lt;span class="m">0&lt;/span> slots&lt;span class="o">)&lt;/span> slave
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> replicates 980e3f5cbfc7739ded0ed08d60127888d7593e25
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">S: 915d7535fc4ebe9853ad2ee5fb9033b549b5a5cb 192.168.1.18:6380
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slots: &lt;span class="o">(&lt;/span>&lt;span class="m">0&lt;/span> slots&lt;span class="o">)&lt;/span> slave
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> replicates 6637e3135cfa345bc155d39fa07718882e9b5bf8
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">S: a6b58413201cc43612df257da40992c0ce6a3510 192.168.1.13:6380
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slots: &lt;span class="o">(&lt;/span>&lt;span class="m">0&lt;/span> slots&lt;span class="o">)&lt;/span> slave
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> replicates 00bbea618be49cb6ce38b1371b3cf57fea59f557
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">S: aed68c3aa851fdcab4d691b02a2a941b39d43ab5 192.168.1.14:6380
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slots: &lt;span class="o">(&lt;/span>&lt;span class="m">0&lt;/span> slots&lt;span class="o">)&lt;/span> slave
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> replicates 059bda64ea1e49e38ef833ed9e997cffd7dff0c5
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>OK&lt;span class="o">]&lt;/span> All nodes agree about slots configuration.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;gt;&amp;gt;&amp;gt; Check &lt;span class="k">for&lt;/span> open slots...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;gt;&amp;gt;&amp;gt; Check slots coverage...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>OK&lt;span class="o">]&lt;/span> All &lt;span class="m">16384&lt;/span> slots covered.
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="第三台redis031921681136379">第三台redis03(192.168.1.13:6379)&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@redis03 redis&lt;span class="o">]&lt;/span>&lt;span class="c1"># systemctl restart redis&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@redis03 redis&lt;span class="o">]&lt;/span>&lt;span class="c1"># systemctl status redis&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>執行&amp;ndash;cluster fix，
執行&amp;ndash;cluster check，最後面要沒報錯才OK&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@redis01 redis&lt;span class="o">]&lt;/span>&lt;span class="c1"># redis-cli --user 帳號 --pass 密碼 --cluster fix 192.168.1.13:6379&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@redis01 redis&lt;span class="o">]&lt;/span>&lt;span class="c1"># redis-cli --user 帳號 --pass 密碼 --cluster check 192.168.1.13:6379&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Warning: Using a password with &lt;span class="s1">&amp;#39;-a&amp;#39;&lt;/span> or &lt;span class="s1">&amp;#39;-u&amp;#39;&lt;/span> option on the &lt;span class="nb">command&lt;/span> line interface may not be safe.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">192.168.1.13:6379 &lt;span class="o">(&lt;/span>980e3f5c...&lt;span class="o">)&lt;/span> -&amp;gt; &lt;span class="m">436921&lt;/span> keys &lt;span class="p">|&lt;/span> &lt;span class="m">4096&lt;/span> slots &lt;span class="p">|&lt;/span> &lt;span class="m">1&lt;/span> slaves.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">192.168.1.12:6379 &lt;span class="o">(&lt;/span>00bbea61...&lt;span class="o">)&lt;/span> -&amp;gt; &lt;span class="m">436657&lt;/span> keys &lt;span class="p">|&lt;/span> &lt;span class="m">4096&lt;/span> slots &lt;span class="p">|&lt;/span> &lt;span class="m">1&lt;/span> slaves.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">192.168.1.11:6379 &lt;span class="o">(&lt;/span>216fa203...&lt;span class="o">)&lt;/span> -&amp;gt; &lt;span class="m">435927&lt;/span> keys &lt;span class="p">|&lt;/span> &lt;span class="m">4096&lt;/span> slots &lt;span class="p">|&lt;/span> &lt;span class="m">1&lt;/span> slaves.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">192.168.1.14:6379 &lt;span class="o">(&lt;/span>6637e313...&lt;span class="o">)&lt;/span> -&amp;gt; &lt;span class="m">0&lt;/span> keys &lt;span class="p">|&lt;/span> &lt;span class="m">819&lt;/span> slots &lt;span class="p">|&lt;/span> &lt;span class="m">1&lt;/span> slaves.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">192.168.1.18:6379 &lt;span class="o">(&lt;/span>059bda64...&lt;span class="o">)&lt;/span> -&amp;gt; &lt;span class="m">0&lt;/span> keys &lt;span class="p">|&lt;/span> &lt;span class="m">3277&lt;/span> slots &lt;span class="p">|&lt;/span> &lt;span class="m">1&lt;/span> slaves.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>OK&lt;span class="o">]&lt;/span> &lt;span class="m">1309505&lt;/span> keys in &lt;span class="m">5&lt;/span> masters.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">79.93 keys per slot on average.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;gt;&amp;gt;&amp;gt; Performing Cluster Check &lt;span class="o">(&lt;/span>using node 192.168.1.13:6379&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">M: 980e3f5cbfc7739ded0ed08d60127888d7593e25 192.168.1.13:6379
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slots:&lt;span class="o">[&lt;/span>8192-12287&lt;span class="o">]&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="m">4096&lt;/span> slots&lt;span class="o">)&lt;/span> master
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="m">1&lt;/span> additional replica&lt;span class="o">(&lt;/span>s&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">S: 915d7535fc4ebe9853ad2ee5fb9033b549b5a5cb 192.168.1.18:6380
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slots: &lt;span class="o">(&lt;/span>&lt;span class="m">0&lt;/span> slots&lt;span class="o">)&lt;/span> slave
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> replicates 6637e3135cfa345bc155d39fa07718882e9b5bf8
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">S: 6076d42c63dfd435f784391f871d101c3d1a7aa5 192.168.1.11:6380
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slots: &lt;span class="o">(&lt;/span>&lt;span class="m">0&lt;/span> slots&lt;span class="o">)&lt;/span> slave
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> replicates 980e3f5cbfc7739ded0ed08d60127888d7593e25
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">S: aed68c3aa851fdcab4d691b02a2a941b39d43ab5 192.168.1.14:6380
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slots: &lt;span class="o">(&lt;/span>&lt;span class="m">0&lt;/span> slots&lt;span class="o">)&lt;/span> slave
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> replicates 059bda64ea1e49e38ef833ed9e997cffd7dff0c5
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">S: 61d58f3e445d8d5398221d22bc358c65a189faf4 192.168.1.12:6380
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slots: &lt;span class="o">(&lt;/span>&lt;span class="m">0&lt;/span> slots&lt;span class="o">)&lt;/span> slave
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> replicates 216fa2035f19dbf88e5e6ab709861ba11b1705de
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">S: a6b58413201cc43612df257da40992c0ce6a3510 192.168.1.13:6380
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slots: &lt;span class="o">(&lt;/span>&lt;span class="m">0&lt;/span> slots&lt;span class="o">)&lt;/span> slave
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> replicates 00bbea618be49cb6ce38b1371b3cf57fea59f557
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">M: 00bbea618be49cb6ce38b1371b3cf57fea59f557 192.168.1.12:6379
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slots:&lt;span class="o">[&lt;/span>4096-8191&lt;span class="o">]&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="m">4096&lt;/span> slots&lt;span class="o">)&lt;/span> master
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="m">1&lt;/span> additional replica&lt;span class="o">(&lt;/span>s&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">M: 216fa2035f19dbf88e5e6ab709861ba11b1705de 192.168.1.11:6379
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slots:&lt;span class="o">[&lt;/span>0-4095&lt;span class="o">]&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="m">4096&lt;/span> slots&lt;span class="o">)&lt;/span> master
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="m">1&lt;/span> additional replica&lt;span class="o">(&lt;/span>s&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">M: 6637e3135cfa345bc155d39fa07718882e9b5bf8 192.168.1.14:6379
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slots:&lt;span class="o">[&lt;/span>12288-13106&lt;span class="o">]&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="m">819&lt;/span> slots&lt;span class="o">)&lt;/span> master
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="m">1&lt;/span> additional replica&lt;span class="o">(&lt;/span>s&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">M: 059bda64ea1e49e38ef833ed9e997cffd7dff0c5 192.168.1.18:6379
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slots:&lt;span class="o">[&lt;/span>13107-16383&lt;span class="o">]&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="m">3277&lt;/span> slots&lt;span class="o">)&lt;/span> master
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="m">1&lt;/span> additional replica&lt;span class="o">(&lt;/span>s&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>OK&lt;span class="o">]&lt;/span> All nodes agree about slots configuration.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;gt;&amp;gt;&amp;gt; Check &lt;span class="k">for&lt;/span> open slots...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;gt;&amp;gt;&amp;gt; Check slots coverage...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>OK&lt;span class="o">]&lt;/span> All &lt;span class="m">16384&lt;/span> slots covered.
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="第四台redis041921681146379">第四台redis04(192.168.1.14:6379)&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@redis04 redis&lt;span class="o">]&lt;/span>&lt;span class="c1"># systemctl restart redis&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@redis04 redis&lt;span class="o">]&lt;/span>&lt;span class="c1"># systemctl status redis&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>執行&amp;ndash;cluster fix，
執行&amp;ndash;cluster check，最後面要沒報錯才OK&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@redis01 redis&lt;span class="o">]&lt;/span>&lt;span class="c1"># redis-cli --user 帳號 --pass 密碼 --cluster fix 192.168.1.14:6379&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@redis01 redis&lt;span class="o">]&lt;/span>&lt;span class="c1"># redis-cli --user 帳號 --pass 密碼 --cluster check 192.168.1.14:6379&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Warning: Using a password with &lt;span class="s1">&amp;#39;-a&amp;#39;&lt;/span> or &lt;span class="s1">&amp;#39;-u&amp;#39;&lt;/span> option on the &lt;span class="nb">command&lt;/span> line interface may not be safe.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">192.168.1.14:6379 &lt;span class="o">(&lt;/span>6637e313...&lt;span class="o">)&lt;/span> -&amp;gt; &lt;span class="m">438263&lt;/span> keys &lt;span class="p">|&lt;/span> &lt;span class="m">3280&lt;/span> slots &lt;span class="p">|&lt;/span> &lt;span class="m">1&lt;/span> slaves.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">192.168.1.11:6379 &lt;span class="o">(&lt;/span>216fa203...&lt;span class="o">)&lt;/span> -&amp;gt; &lt;span class="m">435926&lt;/span> keys &lt;span class="p">|&lt;/span> &lt;span class="m">3276&lt;/span> slots &lt;span class="p">|&lt;/span> &lt;span class="m">1&lt;/span> slaves.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">192.168.1.13:6379 &lt;span class="o">(&lt;/span>980e3f5c...&lt;span class="o">)&lt;/span> -&amp;gt; &lt;span class="m">436921&lt;/span> keys &lt;span class="p">|&lt;/span> &lt;span class="m">3276&lt;/span> slots &lt;span class="p">|&lt;/span> &lt;span class="m">1&lt;/span> slaves.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">192.168.1.12:6379 &lt;span class="o">(&lt;/span>00bbea61...&lt;span class="o">)&lt;/span> -&amp;gt; &lt;span class="m">436656&lt;/span> keys &lt;span class="p">|&lt;/span> &lt;span class="m">3276&lt;/span> slots &lt;span class="p">|&lt;/span> &lt;span class="m">1&lt;/span> slaves.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">192.168.1.18:6379 &lt;span class="o">(&lt;/span>059bda64...&lt;span class="o">)&lt;/span> -&amp;gt; &lt;span class="m">0&lt;/span> keys &lt;span class="p">|&lt;/span> &lt;span class="m">3276&lt;/span> slots &lt;span class="p">|&lt;/span> &lt;span class="m">1&lt;/span> slaves.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>OK&lt;span class="o">]&lt;/span> &lt;span class="m">1747766&lt;/span> keys in &lt;span class="m">5&lt;/span> masters.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">106.68 keys per slot on average.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;gt;&amp;gt;&amp;gt; Performing Cluster Check &lt;span class="o">(&lt;/span>using node 192.168.1.14:6379&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">M: 6637e3135cfa345bc155d39fa07718882e9b5bf8 192.168.1.14:6379
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slots:&lt;span class="o">[&lt;/span>0-819&lt;span class="o">]&lt;/span>,&lt;span class="o">[&lt;/span>4096-4915&lt;span class="o">]&lt;/span>,&lt;span class="o">[&lt;/span>8192-9011&lt;span class="o">]&lt;/span>,&lt;span class="o">[&lt;/span>12288-13107&lt;span class="o">]&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="m">3280&lt;/span> slots&lt;span class="o">)&lt;/span> master
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="m">1&lt;/span> additional replica&lt;span class="o">(&lt;/span>s&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">M: 216fa2035f19dbf88e5e6ab709861ba11b1705de 192.168.1.11:6379
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slots:&lt;span class="o">[&lt;/span>820-4095&lt;span class="o">]&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="m">3276&lt;/span> slots&lt;span class="o">)&lt;/span> master
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="m">1&lt;/span> additional replica&lt;span class="o">(&lt;/span>s&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">S: aed68c3aa851fdcab4d691b02a2a941b39d43ab5 192.168.1.14:6380
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slots: &lt;span class="o">(&lt;/span>&lt;span class="m">0&lt;/span> slots&lt;span class="o">)&lt;/span> slave
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> replicates 059bda64ea1e49e38ef833ed9e997cffd7dff0c5
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">S: a6b58413201cc43612df257da40992c0ce6a3510 192.168.1.13:6380
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slots: &lt;span class="o">(&lt;/span>&lt;span class="m">0&lt;/span> slots&lt;span class="o">)&lt;/span> slave
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> replicates 00bbea618be49cb6ce38b1371b3cf57fea59f557
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">S: 61d58f3e445d8d5398221d22bc358c65a189faf4 192.168.1.12:6380
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slots: &lt;span class="o">(&lt;/span>&lt;span class="m">0&lt;/span> slots&lt;span class="o">)&lt;/span> slave
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> replicates 216fa2035f19dbf88e5e6ab709861ba11b1705de
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">S: 915d7535fc4ebe9853ad2ee5fb9033b549b5a5cb 192.168.1.18:6380
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slots: &lt;span class="o">(&lt;/span>&lt;span class="m">0&lt;/span> slots&lt;span class="o">)&lt;/span> slave
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> replicates 6637e3135cfa345bc155d39fa07718882e9b5bf8
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">M: 980e3f5cbfc7739ded0ed08d60127888d7593e25 192.168.1.13:6379
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slots:&lt;span class="o">[&lt;/span>9012-12287&lt;span class="o">]&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="m">3276&lt;/span> slots&lt;span class="o">)&lt;/span> master
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="m">1&lt;/span> additional replica&lt;span class="o">(&lt;/span>s&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">S: 6076d42c63dfd435f784391f871d101c3d1a7aa5 192.168.1.11:6380
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slots: &lt;span class="o">(&lt;/span>&lt;span class="m">0&lt;/span> slots&lt;span class="o">)&lt;/span> slave
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> replicates 980e3f5cbfc7739ded0ed08d60127888d7593e25
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">M: 00bbea618be49cb6ce38b1371b3cf57fea59f557 192.168.1.12:6379
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slots:&lt;span class="o">[&lt;/span>4916-8191&lt;span class="o">]&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="m">3276&lt;/span> slots&lt;span class="o">)&lt;/span> master
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="m">1&lt;/span> additional replica&lt;span class="o">(&lt;/span>s&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">M: 059bda64ea1e49e38ef833ed9e997cffd7dff0c5 192.168.1.18:6379
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slots:&lt;span class="o">[&lt;/span>13108-16383&lt;span class="o">]&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="m">3276&lt;/span> slots&lt;span class="o">)&lt;/span> master
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="m">1&lt;/span> additional replica&lt;span class="o">(&lt;/span>s&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>OK&lt;span class="o">]&lt;/span> All nodes agree about slots configuration.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;gt;&amp;gt;&amp;gt; Check &lt;span class="k">for&lt;/span> open slots...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;gt;&amp;gt;&amp;gt; Check slots coverage...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>OK&lt;span class="o">]&lt;/span> All &lt;span class="m">16384&lt;/span> slots covered.
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="第五台redis051921681186379">第五台redis05(192.168.1.18:6379)&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@redis05 redis&lt;span class="o">]&lt;/span>&lt;span class="c1"># systemctl restart redis&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@redis05 redis&lt;span class="o">]&lt;/span>&lt;span class="c1"># systemctl status redis&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>執行&amp;ndash;cluster fix，
執行&amp;ndash;cluster check，最後面要沒報錯才OK&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@redis01 redis&lt;span class="o">]&lt;/span>&lt;span class="c1"># redis-cli --user 帳號 --pass 密碼 --cluster fix 192.168.1.18:6379&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@redis01 redis&lt;span class="o">]&lt;/span>&lt;span class="c1"># redis-cli --user 帳號 --pass 密碼 --cluster check 192.168.1.18:6379&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">Warning: Using a password with &lt;span class="s1">&amp;#39;-a&amp;#39;&lt;/span> or &lt;span class="s1">&amp;#39;-u&amp;#39;&lt;/span> option on the &lt;span class="nb">command&lt;/span> line interface may not be safe.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">192.168.1.18:6379 &lt;span class="o">(&lt;/span>059bda64...&lt;span class="o">)&lt;/span> -&amp;gt; &lt;span class="m">435798&lt;/span> keys &lt;span class="p">|&lt;/span> &lt;span class="m">3276&lt;/span> slots &lt;span class="p">|&lt;/span> &lt;span class="m">1&lt;/span> slaves.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">192.168.1.14:6379 &lt;span class="o">(&lt;/span>6637e313...&lt;span class="o">)&lt;/span> -&amp;gt; &lt;span class="m">438263&lt;/span> keys &lt;span class="p">|&lt;/span> &lt;span class="m">3280&lt;/span> slots &lt;span class="p">|&lt;/span> &lt;span class="m">1&lt;/span> slaves.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">192.168.1.12:6379 &lt;span class="o">(&lt;/span>00bbea61...&lt;span class="o">)&lt;/span> -&amp;gt; &lt;span class="m">436655&lt;/span> keys &lt;span class="p">|&lt;/span> &lt;span class="m">3276&lt;/span> slots &lt;span class="p">|&lt;/span> &lt;span class="m">1&lt;/span> slaves.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">192.168.1.13:6379 &lt;span class="o">(&lt;/span>980e3f5c...&lt;span class="o">)&lt;/span> -&amp;gt; &lt;span class="m">436921&lt;/span> keys &lt;span class="p">|&lt;/span> &lt;span class="m">3276&lt;/span> slots &lt;span class="p">|&lt;/span> &lt;span class="m">1&lt;/span> slaves.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">192.168.1.11:6379 &lt;span class="o">(&lt;/span>216fa203...&lt;span class="o">)&lt;/span> -&amp;gt; &lt;span class="m">435926&lt;/span> keys &lt;span class="p">|&lt;/span> &lt;span class="m">3276&lt;/span> slots &lt;span class="p">|&lt;/span> &lt;span class="m">1&lt;/span> slaves.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>OK&lt;span class="o">]&lt;/span> &lt;span class="m">2183563&lt;/span> keys in &lt;span class="m">5&lt;/span> masters.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">133.27 keys per slot on average.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;gt;&amp;gt;&amp;gt; Performing Cluster Check &lt;span class="o">(&lt;/span>using node 192.168.1.18:6379&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">M: 059bda64ea1e49e38ef833ed9e997cffd7dff0c5 192.168.1.18:6379
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slots:&lt;span class="o">[&lt;/span>13108-16383&lt;span class="o">]&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="m">3276&lt;/span> slots&lt;span class="o">)&lt;/span> master
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="m">1&lt;/span> additional replica&lt;span class="o">(&lt;/span>s&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">S: 6076d42c63dfd435f784391f871d101c3d1a7aa5 192.168.1.11:6380
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slots: &lt;span class="o">(&lt;/span>&lt;span class="m">0&lt;/span> slots&lt;span class="o">)&lt;/span> slave
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> replicates 980e3f5cbfc7739ded0ed08d60127888d7593e25
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">M: 6637e3135cfa345bc155d39fa07718882e9b5bf8 192.168.1.14:6379
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slots:&lt;span class="o">[&lt;/span>0-819&lt;span class="o">]&lt;/span>,&lt;span class="o">[&lt;/span>4096-4915&lt;span class="o">]&lt;/span>,&lt;span class="o">[&lt;/span>8192-9011&lt;span class="o">]&lt;/span>,&lt;span class="o">[&lt;/span>12288-13107&lt;span class="o">]&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="m">3280&lt;/span> slots&lt;span class="o">)&lt;/span> master
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="m">1&lt;/span> additional replica&lt;span class="o">(&lt;/span>s&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">S: 915d7535fc4ebe9853ad2ee5fb9033b549b5a5cb 192.168.1.18:6380
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slots: &lt;span class="o">(&lt;/span>&lt;span class="m">0&lt;/span> slots&lt;span class="o">)&lt;/span> slave
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> replicates 6637e3135cfa345bc155d39fa07718882e9b5bf8
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">S: 61d58f3e445d8d5398221d22bc358c65a189faf4 192.168.1.12:6380
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slots: &lt;span class="o">(&lt;/span>&lt;span class="m">0&lt;/span> slots&lt;span class="o">)&lt;/span> slave
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> replicates 216fa2035f19dbf88e5e6ab709861ba11b1705de
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">M: 00bbea618be49cb6ce38b1371b3cf57fea59f557 192.168.1.12:6379
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slots:&lt;span class="o">[&lt;/span>4916-8191&lt;span class="o">]&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="m">3276&lt;/span> slots&lt;span class="o">)&lt;/span> master
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="m">1&lt;/span> additional replica&lt;span class="o">(&lt;/span>s&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">M: 980e3f5cbfc7739ded0ed08d60127888d7593e25 192.168.1.13:6379
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slots:&lt;span class="o">[&lt;/span>9012-12287&lt;span class="o">]&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="m">3276&lt;/span> slots&lt;span class="o">)&lt;/span> master
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="m">1&lt;/span> additional replica&lt;span class="o">(&lt;/span>s&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">S: a6b58413201cc43612df257da40992c0ce6a3510 192.168.1.13:6380
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slots: &lt;span class="o">(&lt;/span>&lt;span class="m">0&lt;/span> slots&lt;span class="o">)&lt;/span> slave
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> replicates 00bbea618be49cb6ce38b1371b3cf57fea59f557
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">S: aed68c3aa851fdcab4d691b02a2a941b39d43ab5 192.168.1.14:6380
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slots: &lt;span class="o">(&lt;/span>&lt;span class="m">0&lt;/span> slots&lt;span class="o">)&lt;/span> slave
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> replicates 059bda64ea1e49e38ef833ed9e997cffd7dff0c5
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">M: 216fa2035f19dbf88e5e6ab709861ba11b1705de 192.168.1.11:6379
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> slots:&lt;span class="o">[&lt;/span>820-4095&lt;span class="o">]&lt;/span> &lt;span class="o">(&lt;/span>&lt;span class="m">3276&lt;/span> slots&lt;span class="o">)&lt;/span> master
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl"> &lt;span class="m">1&lt;/span> additional replica&lt;span class="o">(&lt;/span>s&lt;span class="o">)&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>OK&lt;span class="o">]&lt;/span> All nodes agree about slots configuration.
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;gt;&amp;gt;&amp;gt; Check &lt;span class="k">for&lt;/span> open slots...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&amp;gt;&amp;gt;&amp;gt; Check slots coverage...
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>OK&lt;span class="o">]&lt;/span> All &lt;span class="m">16384&lt;/span> slots covered.
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="測試key與value是否正常">測試key與value是否正常&lt;/h2>
&lt;p>藉由type key方式，確認是否有查到key的type，
並確認是否針對key所在slot的位置，有Redirected過去key所在的主機，
並查看key是否有取到正確的值。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@redis01 redis&lt;span class="o">]&lt;/span>&lt;span class="c1"># redis-cli --user 帳號 --pass 密碼 -c&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 查看key type，此key剛好就在redis01主機上，所以執行直接顯示type&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">127.0.0.1:6379&amp;gt; &lt;span class="nb">type&lt;/span> spring:session:index:org.springframework.session.FindByIndexNameSessionRepository.PRINCIPAL_NAME_INDEX_NAME:362C74F290B63E5F751DCF1E49EC34BEAF6822F0
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 查看key type，此key在redis02主機上，會Redirected到此key所在slot主機上，再顯示type&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">127.0.0.1:6379&amp;gt; &lt;span class="nb">type&lt;/span> DRM01001000347201
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-&amp;gt; Redirected to slot &lt;span class="o">[&lt;/span>5914&lt;span class="o">]&lt;/span> located at 192.168.1.12:6379
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">hash&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 查看key type，此key在redis03主機上，會Redirected到此key所在slot主機上，再顯示type&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">192.168.1.12:6379&amp;gt; &lt;span class="nb">type&lt;/span> spring:session:index:org.springframework.session.FindByIndexNameSessionRepository.PRINCIPAL_NAME_INDEX_NAME:EBB87CF1F764E6BACCC709323FE1457065B0CC8E
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-&amp;gt; Redirected to slot &lt;span class="o">[&lt;/span>10759&lt;span class="o">]&lt;/span> located at 192.168.1.13:6379
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">192.168.1.13:6379&amp;gt; SMEMBERS spring:session:index:org.springframework.session.FindByIndexNameSessionRepository.PRINCIPAL_NAME_INDEX_NAME:EBB87CF1F764E6BACCC709323FE1457065B0CC8E
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">1&lt;span class="o">)&lt;/span> &lt;span class="s2">&amp;#34;\xac\xed\x00\x05t\x00&lt;/span>&lt;span class="nv">$aef3b17d&lt;/span>&lt;span class="s2">-ed6f-4c4e-9cc3-ef69eda6f33c&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 查看key type，此key在redis04主機上，會Redirected到此key所在slot主機上，再顯示type&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">192.168.1.13:6379&amp;gt; &lt;span class="nb">type&lt;/span> TON01001010231201
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-&amp;gt; Redirected to slot &lt;span class="o">[&lt;/span>12921&lt;span class="o">]&lt;/span> located at 192.168.1.14:6379
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">hash&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">192.168.1.14:6379&amp;gt; hgetall TON01001010231201
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">1&lt;span class="o">)&lt;/span> &lt;span class="s2">&amp;#34;path&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">2&lt;span class="o">)&lt;/span> &lt;span class="s2">&amp;#34;/reader/book_content_unpack/teb/2022/10/17/TON01001010231201/TON01001010231201&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">3&lt;span class="o">)&lt;/span> &lt;span class="s2">&amp;#34;iv&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">4&lt;span class="o">)&lt;/span> &lt;span class="s2">&amp;#34;06ac4696c8a4bb94ecb7e82b38a1dc3f&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">5&lt;span class="o">)&lt;/span> &lt;span class="s2">&amp;#34;key&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">6&lt;span class="o">)&lt;/span> &lt;span class="s2">&amp;#34;36971e857d647324cb59e1cdf58d7071&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="c1"># 查看key type，此key在redis05主機上，會Redirected到此key所在slot主機上，再顯示type&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">192.168.1.14:6379&amp;gt; &lt;span class="nb">type&lt;/span> spring:session:index:org.springframework.session.FindByIndexNameSessionRepository.PRINCIPAL_NAME_INDEX_NAME:25E30A2AB63FE661B9AE7803EAD9A9AC234097FC
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-&amp;gt; Redirected to slot &lt;span class="o">[&lt;/span>16326&lt;span class="o">]&lt;/span> located at 192.168.1.18:6379
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">set&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">192.168.1.18:6379&amp;gt; SMEMBERS spring:session:index:org.springframework.session.FindByIndexNameSessionRepository.PRINCIPAL_NAME_INDEX_NAME:25E30A2AB63FE661B9AE7803EAD9A9AC234097FC
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">1&lt;span class="o">)&lt;/span> &lt;span class="s2">&amp;#34;\xac\xed\x00\x05t\x00&lt;/span>&lt;span class="nv">$f0d82ce3&lt;/span>&lt;span class="s2">-28e3-493c-b992-439565cf987e&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">192.168.1.18:6379&amp;gt; &lt;span class="nb">type&lt;/span> BOOK_CASE_LIST_U_39048951
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-&amp;gt; Redirected to slot &lt;span class="o">[&lt;/span>5895&lt;span class="o">]&lt;/span> located at 192.168.1.12:6379
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="nb">hash&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">192.168.1.12:6379&amp;gt; hgetall BOOK_CASE_LIST_U_39048951
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">1&lt;span class="o">)&lt;/span> &lt;span class="s2">&amp;#34;0_5&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">2&lt;span class="o">)&lt;/span> &lt;span class="s2">&amp;#34;{\&amp;#34;result\&amp;#34;:\&amp;#34;00\&amp;#34;,\&amp;#34;syncTime\&amp;#34;:\&amp;#34;20231202164546\&amp;#34;,\&amp;#34;ebooks\&amp;#34;:[{\&amp;#34;deliverId\&amp;#34;:\&amp;#34;SON03001000560201\&amp;#34;,\&amp;#34;contentId\&amp;#34;:\&amp;#34;SON03001000560\&amp;#34;,\&amp;#34;title\&amp;#34;:\&amp;#34;\xe6\x8a\x95\xe8\xb3\x875\xe5\xb9\xb4\xef\xbc\x8c\xe6\x9c\xac\xe9\x87\x91\xe5\xbe\x9e4\xe8\x90\xac\xe5\x88\xb01\xe5\x84\x84\xe7\x9a\x84\xe5\xa5\xb3\xe4\xba\xba\xef\xbc\x9a\xe5\xbe\x9e\xe7\x9c\x81\xe9\x8c\xa2\xe3\x80\x81\xe5\xae\x9a\xe5\xad\x98\xe5\x88\xb0\xe8\x82\xa1\xe7\xa5\xa8\xef\xbc\x8c\xe5\xb0\x88\xe5\xb1\xac\xe5\xb0\x8f\xe8\xb3\x87\xe5\xa5\xb3\xe7\x9a\x84\xe8\xb3\xaa\xe6\x84\x9f\xe7\x90\x86\xe8\xb2\xa1\xe6\x8f\x90\xe6\xa1\x88\&amp;#34;,\&amp;#34;publisher\&amp;#34;:\&amp;#34;\xe5\xb4\xa7\xe7\x87\x81\xe6\x96\x87\xe5\x8c\x96\&amp;#34;,\&amp;#34;author\&amp;#34;:\&amp;#34;\xe6\xb7\x98\xe6\xb7\x98\&amp;#34;,\&amp;#34;bodyTypeCode\&amp;#34;:\&amp;#34;201\&amp;#34;,\&amp;#34;ebookType\&amp;#34;:\&amp;#34;\xe6\x9b\xb8\xe7\xb1\x8d\&amp;#34;,\&amp;#34;categories\&amp;#34;:[\&amp;#34;\xe9\x87\x91\xe8\x9e\x8d\xe7\x90\x86\xe8\xb2\xa1\&amp;#34;],
&lt;/span>&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="redis工作目錄檔案">redis工作目錄檔案&lt;/h2>
&lt;p>dump.rdb：是來源的檔案，覆蓋成dump6379.rdb，讓redis 6379 PORT使用這個檔案恢復數據
dump6380.rdb：是redis 6380 PORT使用的rdb檔
nodes-6379.conf：是redis 6379 PORT Cluster建置後產生的node資訊檔
nodes-6380.conf：是redis 6380 PORT Cluster建置後產生的node資訊檔
redis6380.conf：是redis 6380 PORT Cluster的設定檔
redis.conf：是redis 6379 PORT Cluster的設定檔
users.acl：是redis 6379、6380 PORT共用的acl檔&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" class="chroma">&lt;code class="language-bash" data-lang="bash">&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@redis01 ~&lt;span class="o">]&lt;/span>&lt;span class="c1"># cd /usr/local/redis/&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@redis01 redis&lt;span class="o">]&lt;/span>&lt;span class="c1"># ll&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">總計 &lt;span class="m">1443640&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-r--r-- &lt;span class="m">1&lt;/span> redis redis &lt;span class="m">553867150&lt;/span> 12月 &lt;span class="m">16&lt;/span> 23:27 dump6379.rdb
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-r--r-- &lt;span class="m">1&lt;/span> redis redis &lt;span class="m">580550225&lt;/span> 12月 &lt;span class="m">16&lt;/span> 23:27 dump6380.rdb
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw------- &lt;span class="m">1&lt;/span> redis redis &lt;span class="m">343630318&lt;/span> 12月 &lt;span class="m">16&lt;/span> 22:27 dump.rdb
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-r--r-- &lt;span class="m">1&lt;/span> redis redis &lt;span class="m">1333&lt;/span> 12月 &lt;span class="m">16&lt;/span> 23:27 nodes-6379.conf
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-r--r-- &lt;span class="m">1&lt;/span> redis redis &lt;span class="m">1333&lt;/span> 12月 &lt;span class="m">16&lt;/span> 23:27 nodes-6380.conf
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-r--r-- &lt;span class="m">1&lt;/span> redis redis &lt;span class="m">109501&lt;/span> 12月 &lt;span class="m">16&lt;/span> 21:59 redis6380.conf
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-r--r-- &lt;span class="m">1&lt;/span> redis redis &lt;span class="m">109501&lt;/span> 12月 &lt;span class="m">16&lt;/span> 21:59 redis.conf
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-r--r-- &lt;span class="m">1&lt;/span> redis redis &lt;span class="m">1041&lt;/span> 12月 &lt;span class="m">16&lt;/span> 21:59 users.acl
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@redis02 ~&lt;span class="o">]&lt;/span>&lt;span class="c1"># cd /usr/local/redis/&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@redis02 redis&lt;span class="o">]&lt;/span>&lt;span class="c1"># ll&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">總計 &lt;span class="m">1444340&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-r--r-- &lt;span class="m">1&lt;/span> redis redis &lt;span class="m">576136538&lt;/span> 12月 &lt;span class="m">16&lt;/span> 23:27 dump6379.rdb
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-r--r-- &lt;span class="m">1&lt;/span> redis redis &lt;span class="m">553867150&lt;/span> 12月 &lt;span class="m">16&lt;/span> 23:27 dump6380.rdb
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw------- &lt;span class="m">1&lt;/span> redis redis &lt;span class="m">348759548&lt;/span> 12月 &lt;span class="m">16&lt;/span> 22:34 dump.rdb
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-r--r-- &lt;span class="m">1&lt;/span> redis redis &lt;span class="m">1334&lt;/span> 12月 &lt;span class="m">16&lt;/span> 23:27 nodes-6379.conf
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-r--r-- &lt;span class="m">1&lt;/span> redis redis &lt;span class="m">1334&lt;/span> 12月 &lt;span class="m">16&lt;/span> 23:28 nodes-6380.conf
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-r--r-- &lt;span class="m">1&lt;/span> redis redis &lt;span class="m">109501&lt;/span> 12月 &lt;span class="m">16&lt;/span> 22:00 redis6380.conf
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-r--r-- &lt;span class="m">1&lt;/span> redis redis &lt;span class="m">109501&lt;/span> 12月 &lt;span class="m">16&lt;/span> 22:00 redis.conf
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-r--r-- &lt;span class="m">1&lt;/span> redis redis &lt;span class="m">1041&lt;/span> 12月 &lt;span class="m">16&lt;/span> 22:00 users.acl
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@redis03 ~&lt;span class="o">]&lt;/span>&lt;span class="c1"># cd /usr/local/redis/&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@redis03 redis&lt;span class="o">]&lt;/span>&lt;span class="c1"># ll&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">總計 &lt;span class="m">1471548&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-r--r-- &lt;span class="m">1&lt;/span> redis redis &lt;span class="m">580550225&lt;/span> 12月 &lt;span class="m">16&lt;/span> 23:27 dump6379.rdb
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-r--r-- &lt;span class="m">1&lt;/span> redis redis &lt;span class="m">576136538&lt;/span> 12月 &lt;span class="m">16&lt;/span> 23:27 dump6380.rdb
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw------- &lt;span class="m">1&lt;/span> redis redis &lt;span class="m">349938872&lt;/span> 12月 &lt;span class="m">16&lt;/span> 22:38 dump.rdb
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-r--r-- &lt;span class="m">1&lt;/span> redis redis &lt;span class="m">1333&lt;/span> 12月 &lt;span class="m">16&lt;/span> 23:27 nodes-6379.conf
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-r--r-- &lt;span class="m">1&lt;/span> redis redis &lt;span class="m">1333&lt;/span> 12月 &lt;span class="m">16&lt;/span> 23:27 nodes-6380.conf
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-r--r-- &lt;span class="m">1&lt;/span> redis redis &lt;span class="m">109501&lt;/span> 12月 &lt;span class="m">16&lt;/span> 22:00 redis6380.conf
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-r--r-- &lt;span class="m">1&lt;/span> redis redis &lt;span class="m">109501&lt;/span> 12月 &lt;span class="m">16&lt;/span> 22:00 redis.conf
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-r--r-- &lt;span class="m">1&lt;/span> redis redis &lt;span class="m">1041&lt;/span> 12月 &lt;span class="m">16&lt;/span> 22:00 users.acl
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@redis04 ~&lt;span class="o">]&lt;/span>&lt;span class="c1"># cd /usr/local/redis/&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@redis04 redis&lt;span class="o">]&lt;/span>&lt;span class="c1"># ll&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">總計 &lt;span class="m">1679456&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-r--r-- &lt;span class="m">1&lt;/span> redis redis &lt;span class="m">738751856&lt;/span> 12月 &lt;span class="m">16&lt;/span> 23:27 dump6379.rdb
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-r--r-- &lt;span class="m">1&lt;/span> redis redis &lt;span class="m">578286056&lt;/span> 12月 &lt;span class="m">16&lt;/span> 23:27 dump6380.rdb
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw------- &lt;span class="m">1&lt;/span> redis redis &lt;span class="m">402484559&lt;/span> 12月 &lt;span class="m">16&lt;/span> 22:41 dump.rdb
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-r--r-- &lt;span class="m">1&lt;/span> redis redis &lt;span class="m">1335&lt;/span> 12月 &lt;span class="m">16&lt;/span> 23:28 nodes-6379.conf
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-r--r-- &lt;span class="m">1&lt;/span> redis redis &lt;span class="m">1334&lt;/span> 12月 &lt;span class="m">16&lt;/span> 23:28 nodes-6380.conf
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-r--r-- &lt;span class="m">1&lt;/span> redis redis &lt;span class="m">109501&lt;/span> 12月 &lt;span class="m">16&lt;/span> 22:00 redis6380.conf
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-r--r-- &lt;span class="m">1&lt;/span> redis redis &lt;span class="m">109501&lt;/span> 12月 &lt;span class="m">16&lt;/span> 22:00 redis.conf
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-r--r-- &lt;span class="m">1&lt;/span> redis redis &lt;span class="m">1041&lt;/span> 12月 &lt;span class="m">16&lt;/span> 22:00 users.acl
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@redis05 ~&lt;span class="o">]&lt;/span>&lt;span class="c1"># cd /usr/local/redis/&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">&lt;span class="o">[&lt;/span>root@redis05 redis&lt;span class="o">]&lt;/span>&lt;span class="c1"># ll&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">總計 &lt;span class="m">1634176&lt;/span>
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-r--r-- &lt;span class="m">1&lt;/span> redis redis &lt;span class="m">578286056&lt;/span> 12月 &lt;span class="m">16&lt;/span> 23:27 dump6379.rdb
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-r--r-- &lt;span class="m">1&lt;/span> redis redis &lt;span class="m">738751856&lt;/span> 12月 &lt;span class="m">16&lt;/span> 23:27 dump6380.rdb
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw------- &lt;span class="m">1&lt;/span> redis redis &lt;span class="m">356118026&lt;/span> 12月 &lt;span class="m">16&lt;/span> 22:44 dump.rdb
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-r--r-- &lt;span class="m">1&lt;/span> redis redis &lt;span class="m">1335&lt;/span> 12月 &lt;span class="m">16&lt;/span> 23:28 nodes-6379.conf
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-r--r-- &lt;span class="m">1&lt;/span> redis redis &lt;span class="m">1334&lt;/span> 12月 &lt;span class="m">16&lt;/span> 23:28 nodes-6380.conf
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-r--r-- &lt;span class="m">1&lt;/span> redis redis &lt;span class="m">109501&lt;/span> 12月 &lt;span class="m">16&lt;/span> 22:00 redis6380.conf
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-r--r-- &lt;span class="m">1&lt;/span> redis redis &lt;span class="m">109501&lt;/span> 12月 &lt;span class="m">16&lt;/span> 22:00 redis.conf
&lt;/span>&lt;/span>&lt;span class="line">&lt;span class="cl">-rw-r--r-- &lt;span class="m">1&lt;/span> redis redis &lt;span class="m">1041&lt;/span> 12月 &lt;span class="m">16&lt;/span> 22:00 users.acl
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div></description></item></channel></rss>